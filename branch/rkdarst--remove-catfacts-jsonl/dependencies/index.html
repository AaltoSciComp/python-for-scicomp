<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Dependency management" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/dependencies/" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="How do you track dependencies of your project?: Dependency: Reliance on a external component. In this case, a separately installed software package such as numpy.. Exercises 1: PyPI (The Python Pac..." />
<meta property="og:image" content="https://www.aalto.fi/sites/g/files/flghsv161/files/styles/o_914w_ah_n/public/2022-11/PFSC22_v2.png" />
<meta property="og:image:alt" content="Python for Scientific Computing course logo with date of 22-25/11/2022, twitch.tv/coderefinery, and partner logos" />
<meta name="description" content="How do you track dependencies of your project?: Dependency: Reliance on a external component. In this case, a separately installed software package such as numpy.. Exercises 1: PyPI (The Python Pac..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dependency management &mdash; Python for Scientific Computing  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/logo-hexagons-02-compact.svg.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Binder" href="../binder/" />
    <link rel="prev" title="Python multithreading solution" href="../parallel-pi-multiprocessing/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../" class="icon icon-home"> Python for Scientific Computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python/">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy-advanced/">Advanced NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-visualization/">Data visualization with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-formats/">Data formats with Pandas and Numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/">Web APIs with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/">Library ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel programming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dependency management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-do-you-track-dependencies-of-your-project">How do you track dependencies of your project?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-1">Exercises 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pypi-the-python-package-index-and-ana-conda">PyPI (The Python Package Index) and (Ana)conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-isolated-environments">Creating isolated environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-2">Exercises 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-3">Exercises 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-that-might-happen-with-manual-installation">Problems that might happen with manual installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recording-dependencies">Recording dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies-4">Dependencies 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">How to communicate the dependencies as part of a report/thesis/publication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#version-pinning-for-package-creators">Version pinning for package creators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binder/">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Dependency management</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/dependencies.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dependency-management">
<span id="id1"></span><h1>Dependency management<a class="headerlink" href="#dependency-management" title="Permalink to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Do you expect your code to work in one year?  Five?  What if it
uses <code class="docutils literal notranslate"><span class="pre">numpy</span></code> or <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code> or <code class="docutils literal notranslate"><span class="pre">random-github-package</span></code> ?</p></li>
<li><p>How can my collaborators get the same results as me? What about
future me?</p></li>
<li><p>How can my collaborators easily install my codes with all the necessary dependencies?</p></li>
<li><p>How can I make it easy for my colleagues to reproduce my results?</p></li>
<li><p>How can I work on two (or more) projects with different and conflicting dependencies?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to record dependencies</p></li>
<li><p>Be able to communicate the dependencies as part of a report/thesis/publication</p></li>
<li><p>Learn how to use isolated environments for different projects</p></li>
<li><p>Simplify the use and reuse of scripts and projects</p></li>
</ul>
</div>
<section id="how-do-you-track-dependencies-of-your-project">
<h2>How do you track dependencies of your project?<a class="headerlink" href="#how-do-you-track-dependencies-of-your-project" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Dependency</strong>: Reliance on a external component.  In this case, a
separately installed software package such as <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p></li>
</ul>
</section>
<section id="exercises-1">
<h2>Exercises 1<a class="headerlink" href="#exercises-1" title="Permalink to this heading"></a></h2>
<div class="admonition-dependencies-1-15-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Dependencies-1 (15 min)</p>
<p>Please discuss <strong>in breakout rooms</strong> and answer via <strong>collaborative document</strong> the
following questions:</p>
<ul class="simple">
<li><p>How do you install Python packages (libraries) that you use in your work?
From PyPI using pip? From other places using pip? Using conda?</p></li>
<li><p>How do you track/record the dependencies? Do you write them into a file or README? Into
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>?</p></li>
<li><p>If you track dependencies in a file, why do you do this?</p></li>
<li><p>Have you ever experienced that a project needed a different version of a Python
library than the one on your computer? If yes, how did you solve it?</p></li>
</ul>
</div>
</section>
<section id="pypi-the-python-package-index-and-ana-conda">
<span id="pypi"></span><h2>PyPI (The Python Package Index) and (Ana)conda<a class="headerlink" href="#pypi-the-python-package-index-and-ana-conda" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>PyPI (The Python Package Index) and Conda are popular packaging/dependency
management tools.</p></li>
<li><p>When you run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> you typically install from <a class="reference external" href="https://pypi.org/">PyPI</a> but one can also <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> from a GitHub
repository and similar.</p></li>
<li><p>When you run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span></code> you typically install from <a class="reference external" href="https://anaconda.org/">Anaconda Cloud</a> but there are many community-driven conda channels
and you can create your own.</p></li>
</ul>
<p>Why are there two ecosystems?</p>
<div class="admonition-pypi admonition">
<p class="admonition-title">PyPI</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <code class="docutils literal notranslate"><span class="pre">pip</span></code></p></li>
<li><p><strong>Summary:</strong> PyPI is traditionally used for Python-only packages or
for Python interfaces to external libraries. There are also packages
with bundled external libraries (such as numpy).</p></li>
<li><p><strong>Amount of packages:</strong> Huge number. Old versions are supported for
a long time.</p></li>
<li><p><strong>How libraries are handled:</strong> If your code depends on external
libraries or tools, these things need to be either included in the
pip-package or provided via some other installation system (like
operating system installer or manual installation).</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Easy to use</p></li>
<li><p>Package creation is easy</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Installing packages that need external libraries can be complicated</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-conda admonition">
<p class="admonition-title">Conda</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <code class="docutils literal notranslate"><span class="pre">conda</span></code> or <code class="docutils literal notranslate"><span class="pre">mamba</span></code></p></li>
<li><p><strong>Summary:</strong> Conda aims to be a more general package distribution tool
and it tries to provide not only the Python packages, but also libraries
and tools needed by the Python packages. Most scientific software written
in Python uses external libraries to speed up calculations and installing
these libraries can often become complicated without conda.</p></li>
<li><p><strong>Amount of packages:</strong> Most popular packages are provided. Other packages
can be installed via pip.</p></li>
<li><p><strong>How libraries are handled:</strong> Required libraries are installed as separate
conda packages.</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Quite easy to use</p></li>
<li><p>Easier to manage packages that need external libraries</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Package creation is harder</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-anaconda-vs-miniconda-vs-conda-vs-mamba-vs-anaconda-cloud-vs-conda-forge solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Anaconda vs. miniconda vs. conda vs. mamba vs. Anaconda Cloud vs. conda-forge</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.anaconda.com/">Anaconda</a> - a distribution of conda packages
made by Anaconda Inc.. It is free for academic and non-commercial use.</p></li>
<li><p><a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a> - a minimal installer for conda.</p></li>
<li><p><a class="reference external" href="https://conda.io/">conda</a> - a package and environment management system
used by Anaconda. It is an open source project maintained by Anaconda Inc..</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/index.html">mamba</a> - a drop in
replacement for conda that does installations faster.</p></li>
<li><p><a class="reference external" href="https://anaconda.org/">Anaconda Cloud</a> - a package cloud maintained by
Anaconda Inc. It is a free repository that houses conda package channels.</p></li>
<li><p><a class="reference external" href="https://conda-forge.org/">Conda-forge</a> - the largest open source
community channel.</p></li>
</ul>
</div>
<p>In the packaging episode we will meet PyPI and Anaconda again and practice how
to share Python packages.</p>
</section>
<section id="creating-isolated-environments">
<h2>Creating isolated environments<a class="headerlink" href="#creating-isolated-environments" title="Permalink to this heading"></a></h2>
<p>Isolated environments solve a couple of problems:</p>
<ul class="simple">
<li><p>You can install specific, also older, versions of packages into them.</p></li>
<li><p>You can create one environment for each project and you won’t encounter any
problems if the two projects require different versions of packages.</p></li>
<li><p>If you make some mistake and install something you did not want or need, you
can remove the environment and create a new one.</p></li>
<li><p>You can export a list of packages in an environment and share it with your
code. This makes replicating your results easier.</p></li>
</ul>
</section>
<section id="exercises-2">
<h2>Exercises 2<a class="headerlink" href="#exercises-2" title="Permalink to this heading"></a></h2>
<div class="admonition-dependencies-2-15-min exercise important admonition" id="exercise-1">
<p class="admonition-title">Dependencies-2 (15 min)</p>
<blockquote>
<div></div></blockquote>
<p>Chloe just joined your team and will be working on her Master Thesis. She is
quite familiar with Python, still finishing some Python assignments (due in a
few weeks) and you give her a Python code for analyzing and plotting your
favorite data. The thing is that your Python code has been developed by
another Master Student (from last year) and requires a older version of
Numpy (1.18.1) and Matplotlib (3.1.3) (otherwise the code fails). The code
could probably work with a recent version of Python but has been validated with
Python 3.7 only. Having no idea what the code does, she decides that the best
approach is to <strong>create an isolated environment</strong> with the same dependencies
that were used previously. This will give her a baseline for future upgrade and
developments.</p>
<p>For this first exercise, we will be using conda for creating an isolated environment.</p>
<ol class="arabic">
<li><p>Create a conda environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda create --name python37-env <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.7 <span class="nv">numpy</span><span class="o">=</span><span class="m">1</span>.18.1 <span class="nv">matplotlib</span><span class="o">=</span><span class="m">3</span>.1.3
</pre></div>
</div>
</li>
</ol>
<p>Conda environments can also be managed (create, update, delete) from the
<strong>anaconda-navigator</strong>. Check out the corresponding documentation <a class="reference external" href="https://docs.anaconda.com/anaconda/navigator/getting-started/#navigator-managing-environments">here</a>.</p>
<ol class="arabic" start="2">
<li><p>Activate the environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda activate python37-env
</pre></div>
</div>
<div class="admonition-conda-activate-versus-source-activate callout admonition" id="callout-0">
<p class="admonition-title">conda activate versus source activate</p>
<p>If you do not have a recent version of Anaconda or anaconda has not been
setup properly, you may encounter an error. With older version of anaconda,
you can try:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span> activate python37-env
</pre></div>
</div>
</div>
</li>
<li><p>Open a Python console and check that you have effectively the right version for each package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">import numpy</span>
<span class="go">import matplotlib</span>

<span class="go">print(&#39;Numpy version: &#39;, numpy.__version__)</span>
<span class="go">print(&#39;Matplotlib version: &#39;, matplotlib.__version__)</span>
</pre></div>
</div>
<p>Or use the one-liner if you have access to a terminal like bash</p>
<p>python -c “import numpy; print(numpy.__version__)”
python -c “import matplotlib;print(matplotlib.__version__)”</p>
</li>
<li><p>Deactivate the environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda deactivate
</pre></div>
</div>
</li>
<li><p>Check Numpy and Matplotlib versions in the default environment to make
sure they are different from <strong>python37-env</strong>.</p></li>
</ol>
<p>There is no need to specify the conda environment when using deactivate. It
deactivates the current environment.</p>
<div class="admonition-remark callout admonition" id="callout-1">
<p class="admonition-title">Remark</p>
<ul>
<li><p>Sometimes the package version you would need does not seem to be
available. You may have to select another <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">conda channel</a>
for instance <a class="reference external" href="https://conda-forge.org/">conda-forge</a>. Channels can then
be indicated when installing a package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda install -c conda-forge <span class="nv">matplotlib</span><span class="o">=</span><span class="m">3</span>.1.3
</pre></div>
</div>
</li>
<li><p>We will see below that rather than specifying the list of dependencies as
argument of <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span></code>, it is recommended to record dependencies in
a file.</p></li>
</ul>
</div>
</div>
</section>
<section id="exercises-3">
<h2>Exercises 3<a class="headerlink" href="#exercises-3" title="Permalink to this heading"></a></h2>
<div class="admonition-dependencies-3-15-min-optional exercise important admonition" id="exercise-2">
<p class="admonition-title">Dependencies-3 (15 min, optional)</p>
<p>This is the same exercise as before but we use virtualenv rather than conda.</p>
<ol class="arabic">
<li><p>Create a venv:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 -m venv scicomp
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">scicomp</span></code> is the name of the virtual environment. It creates a new
folder called <code class="docutils literal notranslate"><span class="pre">scicomp</span></code>.</p>
</li>
<li><p>Activate it. To activate your newly created virtual environment locate the
script called <code class="docutils literal notranslate"><span class="pre">activate</span></code> and execute it.</p>
<ul>
<li><p><strong>Linux/Mac-OSX</strong>: look at <code class="docutils literal notranslate"><span class="pre">bin</span></code> folder in the <code class="docutils literal notranslate"><span class="pre">scicomp</span></code> folder:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span> scicomp/bin/activate
</pre></div>
</div>
</li>
<li><p><strong>Windows</strong>: most likely you can find it in the <code class="docutils literal notranslate"><span class="pre">Scripts</span></code> folder.</p></li>
</ul>
</li>
<li><p>Install Numpy 1.18.1 and Matplotlib 3.1.3 into the virtual environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install <span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.18.1
<span class="gp">$ </span>pip install <span class="nv">matplotlib</span><span class="o">==</span><span class="m">3</span>.1.3
</pre></div>
</div>
</li>
<li><p>Deactivate it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>deactivate
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="problems-that-might-happen-with-manual-installation">
<h2>Problems that might happen with manual installation<a class="headerlink" href="#problems-that-might-happen-with-manual-installation" title="Permalink to this heading"></a></h2>
<p>Running the install commands manually can result in unexpected behaviour
such as:</p>
<ul class="simple">
<li><p>The installer might remove an already installed packages or update them.</p></li>
<li><p>The installer might not find a package that works with already installed packages.</p></li>
</ul>
<p>The reason for this is that the installer does not know what commands
you ran in the past. It only knows the state of your environment and what
you’re currently telling it to install.</p>
<p>For example, check what version of <code class="docutils literal notranslate"><span class="pre">scipy</span></code> you’ll get if you run</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ pip install scipy
</pre></div>
</div>
<p>or</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ conda install scipy
</pre></div>
</div>
<p>Depending on your environment you can get <code class="docutils literal notranslate"><span class="pre">scipy</span></code> with versions from
<code class="docutils literal notranslate"><span class="pre">1.6.2</span></code> with no numpy upgrade to <code class="docutils literal notranslate"><span class="pre">1.9.3</span></code> with automatic numpy upgrade.</p>
<p>These kinds of problems can be mitigated by recording dependencies in an
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
</section>
<section id="recording-dependencies">
<h2>Recording dependencies<a class="headerlink" href="#recording-dependencies" title="Permalink to this heading"></a></h2>
<p>There are two standard ways to record dependencies for Python projects:
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> (used by virtual environment) is a simple
text file which looks like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">numpy</span>
<span class="go">matplotlib</span>
<span class="go">pandas</span>
<span class="go">scipy</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">environments.yml</span></code> (for conda) is a yaml-file which looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span><span class="w"></span>
<span class="nt">channels</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">defaults</span><span class="w"></span>
<span class="nt">dependencies</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scipy</span><span class="w"></span>
</pre></div>
</div>
<p>If you need to recreate the exact same environment later on, it can be very
useful to <strong>pin dependencies</strong> to certain versions. For example, there
is usually a delay between doing research and that research being published.
During this time the dependencies might update and reviewers or interested
researchers might not be able to replicate your results or run your code.</p>
<p>Here are the two files again, but this time with versions pinned:</p>
<p><code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> with versions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">numpy==1.18.1</span>
<span class="go">matplotlib==3.1.3</span>
<span class="go">pandas==1.1.2</span>
<span class="go">scipy==1.6.2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">environments.yml</span></code> with versions:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span><span class="w"></span>
<span class="nt">channels</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">defaults</span><span class="w"></span>
<span class="nt">dependencies</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python=3.7</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy=1.18.1</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib=3.1.3</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas=1.1.2</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scipy=1.6.2</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Conda can also read and write <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> can also refer to packages on Github.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">environments.yml</span></code> can also contain a <code class="docutils literal notranslate"><span class="pre">pip</span></code> section.</p></li>
<li><p>See also: <a class="reference external" href="https://coderefinery.github.io/reproducible-research/03-dependencies/#dependencies">https://coderefinery.github.io/reproducible-research/03-dependencies/#dependencies</a>.</p></li>
</ul>
<div class="admonition-putting-too-strict-requirements-can-be-counter-productive admonition">
<p class="admonition-title">Putting too strict requirements can be counter-productive</p>
<p>Putting exact version numbers can be good for single-use applications,
like replicating a research paper, but it is usually bad for long-term
maintenance because the program won’t update at the same time as it’s
requirements do.</p>
<p>If you’re creating a library, adding strict dependencies can also create
a situation where the library cannot coexist with another library.</p>
</div>
</section>
<section id="dependencies-4">
<h2>Dependencies 4<a class="headerlink" href="#dependencies-4" title="Permalink to this heading"></a></h2>
<div class="admonition-dependencies-4-15-min exercise important admonition" id="exercise-3">
<p class="admonition-title">Dependencies-4 (15 min)</p>
<ul class="simple">
<li><p>Create the file <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code></p></li>
<li><dl class="simple">
<dt>Create an environment based on these dependencies:</dt><dd><ul>
<li><p>Conda: <code class="docutils literal notranslate"><span class="pre">$ conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">--file</span> <span class="pre">environment.yml</span></code></p></li>
<li><p>Virtual environment: First create and activate, then <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Freeze the environment:</dt><dd><ul>
<li><p>Conda: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">conda</span> <span class="pre">env</span> <span class="pre">export</span> <span class="pre">&gt;</span> <span class="pre">environment.yml</span></code></p></li>
<li><p>Virtual environment: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">pip</span> <span class="pre">freeze</span> <span class="pre">&gt;</span> <span class="pre">requirements.txt</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Have a look at the generated (“frozen”) file.</p></li>
</ul>
</div>
<div class="admonition-hint-updating-packages-from-dependency-files admonition">
<p class="admonition-title">Hint: Updating packages from dependency files</p>
<p>Instead of installing packages with <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">somepackage</span></code>,
you can add <code class="docutils literal notranslate"><span class="pre">somepackage</span></code> to <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and re-run
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code>.</p>
<p>With conda, you can add the package to <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and
run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">conda</span> <span class="pre">env</span> <span class="pre">update</span> <span class="pre">--file</span> <span class="pre">environment.yml</span></code></p>
</div>
</section>
<section id="how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">
<h2>How to communicate the dependencies as part of a report/thesis/publication<a class="headerlink" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication" title="Permalink to this heading"></a></h2>
<p>Each notebook or script or project which depends on libraries should come with
either a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>, unless you are creating
and distributing this project as Python package (see next section).</p>
<ul class="simple">
<li><p>Attach a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> to your thesis.</p></li>
<li><p>Even better: put <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> in your Git repository along your code.</p></li>
<li><p>Even better: also binderize your analysis pipeline (more about that in a later session).</p></li>
</ul>
</section>
<section id="version-pinning-for-package-creators">
<span id="version-pinning"></span><h2>Version pinning for package creators<a class="headerlink" href="#version-pinning-for-package-creators" title="Permalink to this heading"></a></h2>
<p>We will talk about packaging in a different session but when you create a library and package
projects, you express dependencies either in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>
(PyPI) or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> (conda).</p>
<p>These dependencies will then be used by either other libraries (who in turn
write their own <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>) or by
people directly (filling out <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>).</p>
<p>Now as a library creator you have a difficult choice. You can either pin versions very
narrowly like here (example taken from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy==1.19.2&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib==3.3.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas==1.1.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy==1.5.2&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>or you can define a range or keep them undefined like here (example taken from
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Should we pin the versions here or not?</p>
<ul class="simple">
<li><p>Pinning versions here would be good for reproducibility.</p></li>
<li><p>However pinning versions may make it difficult for this library to be used in a project alongside other
libraries with conflicting version dependencies.</p></li>
<li><p>Therefore <strong>as library creator make the version requirements as wide as possible</strong>.</p>
<ul>
<li><p>Set minimum version when you know of a reason: <code class="docutils literal notranslate"><span class="pre">&gt;=2.1</span></code></p></li>
<li><p>Sometimes set maximum version to next major version (<code class="docutils literal notranslate"><span class="pre">&lt;4</span></code>) (when
you currently use <code class="docutils literal notranslate"><span class="pre">3.x.y</span></code>) when you expect issues with next
major version.</p></li>
</ul>
</li>
<li><p>As the “end consumer” of libraries, define your dependencies as narrowly as possible.</p></li>
</ul>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this heading"></a></h2>
<p>Other tools for dependency management:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://python-poetry.org/">Poetry</a>: dependency management and packaging</p></li>
<li><p><a class="reference external" href="https://pipenv.pypa.io/">Pipenv</a>: dependency management, alternative to Poetry</p></li>
<li><p><a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>: if you need different Python versions for different projects</p></li>
<li><p><a class="reference external" href="https://github.com/thoth-station/micropipenv">micropipenv</a>: lightweight tool to “rule them all”</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/index.html">mamba</a>: a drop in replacement for
conda that does installations faster.</p></li>
<li><p><a class="reference external" href="https://github.com/conda-forge/miniforge">miniforge &amp; mambaforge</a>: Miniconda alternatives with
conda-forge as the default channel and optionally mamba as the default installer.</p></li>
</ul>
<p>Other resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://scicomp.aalto.fi/scicomp/packaging-software/">https://scicomp.aalto.fi/scicomp/packaging-software/</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Install dependencies by first recording them in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and install using these files, then you have a trace.</p></li>
<li><p>Use isolated environments and avoid installing packages system-wide.</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../parallel-pi-multiprocessing/" class="btn btn-neutral float-left" title="Python multithreading solution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../binder/" class="btn btn-neutral float-right" title="Binder" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>