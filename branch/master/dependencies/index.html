

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Dependency management" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/dependencies/" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="What even is a dependency?: Dependency: Reliance on a external component. In this case, a separately installed software package such as numpy.. Exercise 1: PyPI (The Python Package Index) and conda..." />
<meta name="description" content="What even is a dependency?: Dependency: Reliance on a external component. In this case, a separately installed software package such as numpy.. Exercise 1: PyPI (The Python Package Index) and conda..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dependency management &mdash; Python for Scientific Computing  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../_static/logo-hexagons-02-compact.svg.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=35a8b989"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script src="../_static/tabs.js?v=3030b3cb"></script>
      <script data-domain="aaltoscicomp.github.io/python-for-scicomp" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Binder" href="../binder/" />
    <link rel="prev" title="Library ecosystem" href="../libraries/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Python for Scientific Computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python/">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy-advanced/">Advanced NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xarray/">Xarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-matplotlib/">Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-vega-altair/">Plotting with Vega-Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../work-with-data/">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling/">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../productivity/">Productivity tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/">Library ecosystem</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dependency management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-even-is-a-dependency">What even is a dependency?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pypi-the-python-package-index-and-conda-ecosystem">PyPI (The Python Package Index) and conda ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda-ecosystem-explained">Conda ecosystem explained</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-2">Exercise 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-environments">Python environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-python-environments">Creating Python environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-3">Exercise 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-more-packages-to-existing-environments">Adding more packages to existing environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pinning-package-versions">Pinning package versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exporting-package-versions-from-an-existing-environment">Exporting package versions from an existing environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-4">Exercise 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">How to communicate the dependencies as part of a report/thesis/publication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#version-pinning-for-package-creators">Version pinning for package creators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-issues">Common issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-tips-and-tricks">Additional tips and tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binder/">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/">Web APIs with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cython/">Extending Python with Cython</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-formats/">In depth analysis of some selected file formats</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Dependency management</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/dependencies.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dependency-management">
<span id="id1"></span><h1>Dependency management<a class="headerlink" href="#dependency-management" title="Link to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Do you expect your code to work in one year?  Five?  What if it
uses <code class="docutils literal notranslate"><span class="pre">numpy</span></code> or <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> or <code class="docutils literal notranslate"><span class="pre">random-github-package</span></code> ?</p></li>
<li><p>How can my collaborators easily install my code with all the necessary dependencies?</p></li>
<li><p>How can I make it easy for my others (and me in future) to reproduce my results?</p></li>
<li><p>How can I work on two (or more) projects with different and conflicting dependencies?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to record dependencies</p></li>
<li><p>Be able to communicate the dependencies as part of a report/thesis/publication</p></li>
<li><p>Learn how to use isolated environments for different projects</p></li>
<li><p>Simplify the use and reuse of scripts and projects</p></li>
</ul>
</div>
<section id="what-even-is-a-dependency">
<h2>What even is a dependency?<a class="headerlink" href="#what-even-is-a-dependency" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Dependency</strong>: Reliance on a external component.  In this case, a
separately installed software package such as <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p></li>
</ul>
</section>
<section id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h2>
<div class="admonition-dependencies-1-discuss-dependency-management-5-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Dependencies-1: Discuss dependency management (5 min)</p>
<p>Please discuss and answer via <strong>collaborative document</strong> the
following questions:</p>
<ul class="simple">
<li><p>How do you install Python packages (libraries) that you use in your work?
From PyPI using pip? From other places using pip? Using conda?</p></li>
<li><p>How do you track/record the dependencies? Do you write them into a file or README? Into
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>?</p></li>
<li><p>If you track dependencies in a file, why do you do this?</p></li>
<li><p>Have you ever experienced that a project needed a different version of a Python
library than the one on your computer? If yes, how did you solve it?</p></li>
</ul>
</div>
</section>
<section id="pypi-the-python-package-index-and-conda-ecosystem">
<span id="pypi"></span><h2>PyPI (The Python Package Index) and conda ecosystem<a class="headerlink" href="#pypi-the-python-package-index-and-conda-ecosystem" title="Link to this heading"></a></h2>
<p>PyPI (The Python Package Index) and conda are popular packaging/dependency
management tools:</p>
<ul class="simple">
<li><p>When you use <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">uv</span></code> you typically install from <a class="reference external" href="https://pypi.org/">PyPI</a>, but you can also install packages from
source code provided in repositories in e.g. Github.</p></li>
<li><p>When you use <code class="docutils literal notranslate"><span class="pre">conda</span></code> you typically install from <a class="reference external" href="https://anaconda.org/">Anaconda Cloud</a> where there are conda channels maintained
by Anaconda Inc. and by various communities.</p></li>
</ul>
<p>Why are there two ecosystems?</p>
<div class="admonition-pypi admonition">
<p class="admonition-title">PyPI</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a>, <a class="reference external" href="https://docs.astral.sh/uv/">uv</a></p></li>
<li><p><strong>Summary:</strong> PyPI is traditionally used for Python-only packages or
for Python interfaces to external libraries. There are also packages
that have bundled external libraries (such as numpy).</p></li>
<li><p><strong>Amount of packages:</strong> Huge number.</p></li>
<li><p><strong>How libraries are handled:</strong> If your code depends on external
libraries or tools, these things need to be either included in the
pip-package or provided via some other installation system (like
operating system installer or manual installation).</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Easy to use</p></li>
<li><p>Package creation is easy</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Installing packages that need external libraries can be complicated</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-conda admonition">
<p class="admonition-title">Conda</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a>, <a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a></p></li>
<li><p><strong>Summary:</strong> Conda aims to be a more general package distribution tool
and it tries to provide not only the Python packages, but also other
libraries and tools needed by the Python packages.</p></li>
<li><p><strong>Amount of packages:</strong> Huge number in conda-forge and in other community
channels. Curated versions in licensed channels. Other packages can be
installed via pip.</p></li>
<li><p><strong>How libraries are handled:</strong> Required libraries are installed as separate
conda packages.</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Quite easy to use</p></li>
<li><p>Easier to manage packages that need external libraries</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Package creation is harder</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="conda-ecosystem-explained">
<h2>Conda ecosystem explained<a class="headerlink" href="#conda-ecosystem-explained" title="Link to this heading"></a></h2>
<figure class="align-default" id="id2">
<img alt="Figure that shows non-free and free parts of the conda ecosystem. Non-free side has Anaconda Inc., Anaconda repository, Anaconda channels, Miniconda and Anaconda distribution. Free side has Community, conda-forge and Miniforge." src="../_images/conda-ecosystem.png" />
<figcaption>
<p><span class="caption-text">Figure 1: Conda ecosystem visualized</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-licensing-and-conda admonition">
<p class="admonition-title">Licensing and conda</p>
<p>Conda was originally created by Anaconda Inc. and they provide their
own licensed packages. At the same time a big open-source community
provides most of the packages. Thus it is good to know what is free
and open source and what is under licenses.</p>
<p>It is highly recommended to use Miniforge to create the environments
and to use conda-forge as the main channel for software. You can add
<cite>nodefaults</cite> to channel list to disable Anaconda’s repositories.</p>
<dl class="simple">
<dt><strong>Free:</strong></dt><dd><ul class="simple">
<li><p>conda and mamba (installation tools)</p></li>
<li><p>community channels (e.g. conda-forge)</p></li>
<li><p>Miniforge</p></li>
</ul>
</dd>
<dt><strong>Licensed:</strong></dt><dd><ul class="simple">
<li><p>Anaconda distribution</p></li>
<li><p>Anaconda repository (<a class="reference external" href="https://repo.anaconda.com">repo.anaconda.com</a>)</p></li>
<li><p>Anaconda’s channels in the community repository (anaconda.org)
are free in some cases.</p></li>
<li><p>Miniconda is free, when it does not download Anaconda’s packages.</p></li>
</ul>
</dd>
</dl>
<p>All of these are licensed under Anaconda Inc. and free in some cases. See
<a class="reference external" href="https://www.anaconda.com/legal/terms/academic">Academic Policy</a>,
<a class="reference external" href="https://www.anaconda.com/legal/terms/terms-of-service#WhenYouCanUseThePlatformForFree">Terms of Service</a>
and
<a class="reference external" href="https://www.anaconda.com/legal/terms/non-profit-research">Non-profit &amp; Research Policy</a>
for more information.</p>
</div>
<ul class="simple">
<li><p>Package repositories:</p>
<ul>
<li><p><a class="reference external" href="https://anaconda.org/">Anaconda Community Repository (anaconda.org)</a>
aka. Anaconda Cloud is a package cloud maintained by Anaconda Inc.
It is a repository that houses mirrors of Anaconda’s channels and
community maintained channels.</p></li>
<li><p><a class="reference external" href="https://repo.anaconda.com">Anaconda Repository (repo.anaconda.com)</a>
houses Anaconda’s own proprietary software channels.</p></li>
</ul>
</li>
<li><p>Major package channels:</p>
<ul>
<li><p>Anaconda’s proprietary channels: <code class="docutils literal notranslate"><span class="pre">main</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">msys2</span></code> and <code class="docutils literal notranslate"><span class="pre">anaconda</span></code>.
These are sometimes called <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p></li>
<li><p><a class="reference external" href="https://conda-forge.org/">conda-forge</a> is the largest open source
community channel. It has over 27,000 packages that include open-source
versions of packages in Anaconda’s channels.</p></li>
</ul>
</li>
<li><p>Package distributions and installers:</p>
<ul>
<li><p><a class="reference external" href="https://www.anaconda.com/">Anaconda</a> is a distribution of conda packages
made by Anaconda Inc.. When using Anaconda remember to check that your
situation abides with their licensing terms.</p></li>
<li><p><a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a> is a minimal installer
maintained by Anaconda Inc. that has conda and uses Anaconda’s channels
by default. Check licensing terms when using these packages.</p></li>
<li><p><a class="reference external" href="https://github.com/conda-forge/miniforge">Miniforge</a> is an open-source
Miniconda replacement that uses conda-forge as the default channel.
Contains mamba as well.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba</a>
is a tiny stand-alone version of the mamba package manager written in C++.
It can be used to create and manage environments without installing
base-environment and Python. It is very useful if you want to automate
environment creation or want a more lightweight tool.</p></li>
</ul>
</li>
<li><p>Package managers:</p>
<ul>
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a> is a package and environment management system
used by Anaconda. It is an open source project maintained by Anaconda Inc..</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a> is a drop in
replacement for conda with additional UI features.</p></li>
</ul>
</li>
</ul>
</section>
<section id="exercise-2">
<h2>Exercise 2<a class="headerlink" href="#exercise-2" title="Link to this heading"></a></h2>
<div class="admonition-dependencies-2-package-language-detective-5-min exercise important admonition" id="exercise-1">
<p class="admonition-title">Dependencies-2: Package language detective (5 min)</p>
<p>Think about the following sentences:</p>
<ol class="arabic simple">
<li><p>Yes, you can install my package with pip from GitHub.</p></li>
<li><p>I forgot to specify my channels, so my packages came from the defaults.</p></li>
<li><p>I have a Miniforge installation and I use mamba to create my environments.</p></li>
</ol>
<p>What hidden information is given in these sentences?</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ol class="arabic simple">
<li><p>The package is provided as a pip package. However, it is most likely
not uploaded to PyPI as it needs to be installed from a repository.</p></li>
<li><p>In this case the person saying the sentence is most likely using
Anaconda or Miniconda because these tools use the <code class="docutils literal notranslate"><span class="pre">defaults</span></code>-channel
as the default channel. They probably meant to install software from
conda-forge, but forgot to specify the channel.</p></li>
<li><p>Miniforge uses conda-forge as the default channel. So unless some
other channel has been specified, packages installed with these
tools come from conda-forge as well.</p></li>
</ol>
</div>
</div>
</section>
<section id="python-environments">
<h2>Python environments<a class="headerlink" href="#python-environments" title="Link to this heading"></a></h2>
<p>An <strong>environment</strong> is a basically a folder that contains a Python
interpreter and other Python packages in a folder structure similar
to the operating system’s folder structure.</p>
<p>These environments can be created by:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/venv.html">venv</a>-module in base Python</p></li>
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a></p></li>
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a> / <a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a>.</p></li>
<li><p>pip package called <a class="reference external" href="https://virtualenv.pypa.io/en/latest/">virtualenv</a></p></li>
</ul>
<p>Using these environments is highly recommended because they solve the
following problems:</p>
<ul class="simple">
<li><p>Installing packages in environments won’t modify system packages.</p></li>
<li><p>You can install specific versions of packages into them.</p></li>
<li><p>You can create an environment for each project and you won’t encounter any
problems if different projects require different versions of packages.</p></li>
<li><p>If you make some mistake and install something you did not want or need, you
can remove the environment and create a new one.</p></li>
<li><p>Others can replicate your environment by reusing the same specification
that you used to create the environment.</p></li>
</ul>
</section>
<section id="creating-python-environments">
<h2>Creating Python environments<a class="headerlink" href="#creating-python-environments" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" name="Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" role="tab" tabindex="0">Creating conda environment from environment.yml</button><button aria-controls="panel-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tab" tabindex="-1">Creating virtual environment from requirements.txt</button></div><div aria-labelledby="tab-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" class="sphinx-tabs-panel group-tab" id="panel-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" name="Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" role="tabpanel" tabindex="0"><p>Record channels and packages you need to a file called
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">name</span></code> describes the name of the environment,
<code class="docutils literal notranslate"><span class="pre">channels</span></code>-list tells which channels should be search for packages
(channel priority goes from top to bottom) and <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>-list
contains all packages that are needed.</p>
<p>Using this file you can now create an environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
<div class="admonition-you-can-also-use-mamba admonition">
<p class="admonition-title">You can also use mamba</p>
<p>If you have mamba installed, you can replace conda
with mamba in each command.</p>
</div>
<p>You can then activate the environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>my-environment
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>my-environment
</pre></div>
</div>
<div class="admonition-conda-activate-versus-source-activate callout admonition" id="callout-0">
<p class="admonition-title">conda activate versus source activate</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span></code> will only work if you have run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code>
in the past. Running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code> will make loading environments
easier as you will always have a conda environment loaded.</p>
<p>However, this can also cause problems as programs in the
main environment will be constantly loaded and they might be used
even when they’re not supposed to be used. A common example is
not having <code class="docutils literal notranslate"><span class="pre">pip</span></code> installed in a conda environment which results
<code class="docutils literal notranslate"><span class="pre">pip</span></code> from main environment to be used instead.</p>
</div>
<p>You can then check e.g. installed versions of Python and <code class="docutils literal notranslate"><span class="pre">numpy</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; import numpy; print(f&quot;Python version: {sys.version}\nNumPy version: {numpy.__version__}&quot;)&#39;</span>
<span class="go">Python version: 3.13.0 | packaged by conda-forge | (main, Oct  8 2024, 20:04:32) [GCC 13.3.0]</span>
<span class="go">NumPy version: 2.1.2</span>
</pre></div>
</div>
<p>To deactivate the environment, you can run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>deactivate
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tabpanel" tabindex="0"><p>Record packages you need to a file called
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>numpy
matplotlib
pandas
</pre></div>
</div>
<p>This is simply a text file that lists all of the packages that
you need. It is usually called <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>Now you can create a virtual environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>my-environment
</pre></div>
</div>
<p>You can then activate the environment by sourcing a file called
<code class="docutils literal notranslate"><span class="pre">activate</span></code>.</p>
<ul>
<li><p><strong>Linux/Mac OSX</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>my-environment/bin/activate
</pre></div>
</div>
</li>
<li><p><strong>Windows</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</pre></div>
</div>
</li>
</ul>
<p>Now the environment should be active. You can then install packages
listed in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>You can then check e.g. installed versions of Python and <code class="docutils literal notranslate"><span class="pre">numpy</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; import numpy; print(f&quot;Python version: {sys.version}\nNumPy version: {numpy.__version__}&quot;)&#39;</span>
<span class="go">Python version: 3.10.12 (main, Sep 11 2024, 15:47:36) [GCC 11.4.0]</span>
<span class="go">NumPy version: 2.1.2</span>
</pre></div>
</div>
<p>To deactivate the environment, you can run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>deactivate
</pre></div>
</div>
</div></div>
<div class="admonition-creating-environments-without-environment-yml-requirements-txt admonition">
<p class="admonition-title">Creating environments without environment.yml/requirements.txt</p>
<p>It is possible to create environments with manual commands, but this
is highly discouraged for continuous use.</p>
<p>Firstly, replicating the environment becomes much harder.</p>
<p>Secondly, running package installation commands manually in an
environment can result in unexpected behaviour such as:</p>
<ul class="simple">
<li><p>Package manager might remove an already installed packages or update them.</p></li>
<li><p>Package manager might not find a package that works with already
installed packages.</p></li>
</ul>
<p>The reason for this behavior is that package managers does not know what
commands you ran in the past. It only knows the state of your environment
and what you’re currently telling it to install.</p>
<p>These kinds of problems can be mitigated by recording dependencies in an
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and using the relevant
package manager to update / recreate the environment.</p>
</div>
</section>
<section id="exercise-3">
<h2>Exercise 3<a class="headerlink" href="#exercise-3" title="Link to this heading"></a></h2>
<div class="admonition-dependencies-3-create-a-python-environment-15-min exercise important admonition" id="exercise-2">
<p class="admonition-title">Dependencies-3: Create a Python environment (15 min)</p>
<p>Use conda or venv to create the environment presented in the
example.</p>
</div>
</section>
<section id="adding-more-packages-to-existing-environments">
<h2>Adding more packages to existing environments<a class="headerlink" href="#adding-more-packages-to-existing-environments" title="Link to this heading"></a></h2>
<p>Quite often when you’re creating a new environment you might forget
to add all relevant packages to <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>In these cases the best practice is to add missing packages to
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and to update the environment.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" role="tab" tabindex="0">Adding new packages to a conda environment</button><button aria-controls="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tab" tabindex="-1">Adding new packages to a virtual environment</button></div><div aria-labelledby="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" class="sphinx-tabs-panel group-tab" id="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" role="tabpanel" tabindex="0"><p>Add new packages that you want to install to
<code class="docutils literal notranslate"><span class="pre">dependencies</span></code> in
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>.</p>
<p>Afterwards, run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>update<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>to update the environment.</p>
</div><div aria-labelledby="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Add new packages that you want to install to
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>Afterwards, activate the environment and re-run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>to update the environment.</p>
</div></div>
<p>Sometimes the new packages are incompatible with the ones already
in the environment. Maybe they have different dependencies that are
not satisfied with the current versions, maybe the package you’re installing
is incompatible with the ones installed. In these cases the safest approach
is to re-create the environment. This will let the dependency solvers
to start from clean slate and with a full picture of what packages
need to be installed.</p>
</section>
<section id="pinning-package-versions">
<h2>Pinning package versions<a class="headerlink" href="#pinning-package-versions" title="Link to this heading"></a></h2>
<p>Sometimes your code will only work with a certain range of dependencies.
Maybe you use a function or a class that was introduced in a later version
or a newer version has modified its API.</p>
<p>In these situations, you’ll want to <strong>pin the package versions</strong>.</p>
<p>For example, there is usually a delay between doing research and that
research being published. During this time packages used in the research
might update and reviewers or interested researchers might not be able
to replicate your results or run your code if new versions are not
compatible.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" name="ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" role="tab" tabindex="0">environment.yml with pinned versions</button><button aria-controls="panel-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" name="cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" role="tab" tabindex="-1">requirements.txt with pinned versions</button></div><div aria-labelledby="tab-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" class="sphinx-tabs-panel group-tab" id="panel-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" name="ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" role="tabpanel" tabindex="0"><p>When pinning versions in <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> one can use a
variety of comparison operators:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Use python 3.11</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python=3.11</span>
<span class="w">  </span><span class="c1"># numpy that is bigger or equal than version 1, but less than version 2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy&gt;=1,&lt;2</span>
<span class="w">  </span><span class="c1"># matplotlib greater than 3.8.2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib&gt;3.8.2</span>
<span class="w">  </span><span class="c1"># pandas that is compatible with 2.1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas~=2.1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" name="cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" role="tabpanel" tabindex="0"><p>When pinning versions in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> one can use a
variety of comparison operators:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># numpy that is bigger or equal than version 1, but less than version 2
numpy&gt;=1,&lt;2
# matplotlib greater than 3.8.2
matplotlib&gt;3.8.2
# pandas that is compatible with 2.1
pandas~=2.1
</pre></div>
</div>
</div></div>
<p>For more information on all possible specifications, see
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/version-specifiers/">this page</a>
from Python’s packaging guide.</p>
<p>See also: <a class="reference external" href="https://coderefinery.github.io/reproducible-research/dependencies/">https://coderefinery.github.io/reproducible-research/dependencies/</a></p>
<div class="admonition-to-pin-or-not-to-pin-that-is-the-question admonition">
<p class="admonition-title">To pin or not to pin? That is the question.</p>
<p>Pinning versions means that you pin the environment to
<strong>that instance in time</strong> when these specific versions of the
dependencies were being used.</p>
<p>This can be good for single-use applications, like replicating a research
paper, but it is usually bad for the long-term maintainability of the software.</p>
<p>Pinning to major versions or to compatible versions is usually the best
practice as that allows your software to co-exist with other packages even
when they are updated.</p>
<p>Remember that at some point in time you <strong>will</strong> face a situation where
newer versions of the dependencies are no longer compatible with your
software. At this point you’ll have to update your software to use the newer
versions or to lock it into a place in time.</p>
</div>
</section>
<section id="exporting-package-versions-from-an-existing-environment">
<h2>Exporting package versions from an existing environment<a class="headerlink" href="#exporting-package-versions-from-an-existing-environment" title="Link to this heading"></a></h2>
<p>Sometimes you want to create a file that contains the exact versions
of packages in the environment. This is often called <em>exporting</em> or
<em>freezing</em> and environment.</p>
<p>Doing this will create a file that does describe the installed
packages, but it won’t tell which packages are <strong>the most important
ones</strong> and which ones are just dependencies for those packages.</p>
<p>Using manually created <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>
are in most cases better than automatically created ones because they
shows which packages are the important packages needed by the software.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" role="tab" tabindex="0">Exporting environment.yml from a conda environment</button><button aria-controls="panel-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tab" tabindex="-1">Exporting requirements.txt from a virtual environment</button></div><div aria-labelledby="tab-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" id="panel-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Once you have activated the environment, you can run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>If package build versions are not relevant for the use case,
one can also run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--no-builds<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>which leaves out the package build versions.</p>
<p>Alternatively one can also run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--from-history<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>which creates the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>-file based on
what packages were asked to be installed.</p>
<div class="admonition-conda-lock admonition">
<p class="admonition-title">conda-lock</p>
<p>For even more reproducibility, you should try out
<a class="reference external" href="https://github.com/conda/conda-lock">conda-lock</a>.
It turns your <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> into a <code class="docutils literal notranslate"><span class="pre">conda.lock</span></code>
that has all information needed to <strong>exactly</strong> create
the same environment. You can use <code class="docutils literal notranslate"><span class="pre">conda.lock</span></code>-files
in same way as <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> when you create
an environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--file<span class="w"> </span>conda.lock
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Once you have activated the environment, you can run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</pre></div>
</div>
</div></div>
</section>
<section id="exercise-4">
<h2>Exercise 4<a class="headerlink" href="#exercise-4" title="Link to this heading"></a></h2>
<div class="admonition-dependencies-4-export-an-environment-15-min exercise important admonition" id="exercise-3">
<p class="admonition-title">Dependencies-4: Export an environment (15 min)</p>
<p>Export the environment you previously created.</p>
</div>
</section>
<section id="how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">
<h2>How to communicate the dependencies as part of a report/thesis/publication<a class="headerlink" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication" title="Link to this heading"></a></h2>
<p>Each notebook or script or project which depends on libraries should come with
either a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>, unless you are creating
and distributing this project as Python package (see next section).</p>
<ul class="simple">
<li><p>Attach a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> to your thesis.</p></li>
<li><p>Even better: put <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> in your Git repository along your code.</p></li>
<li><p>Even better: also binderize your analysis pipeline (more about that in a later session).</p></li>
</ul>
</section>
<section id="version-pinning-for-package-creators">
<span id="version-pinning"></span><h2>Version pinning for package creators<a class="headerlink" href="#version-pinning-for-package-creators" title="Link to this heading"></a></h2>
<p>We will talk about packaging in a different session but when you create a library and package
projects, you express dependencies either in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> (or <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>)
(PyPI) or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> (conda).</p>
<p>These dependencies will then be used by either other libraries (who in turn
write their own <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>) or by
people directly (filling out <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>).</p>
<p>Now as a library creator you have a difficult choice. You can either pin versions very
narrowly like here (example taken from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy==1.19.2&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib==3.3.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas==1.1.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy==1.5.2&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>or you can define a range or keep them undefined like here (example taken from
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Should we pin the versions here or not?</p>
<ul class="simple">
<li><p>Pinning versions here would be good for reproducibility.</p></li>
<li><p>However pinning versions may make it difficult for this library to be used in a project alongside other
libraries with conflicting version dependencies.</p></li>
<li><p>Therefore <strong>as library creator make the version requirements as wide as possible</strong>.</p>
<ul>
<li><p>Set minimum version when you know of a reason: <code class="docutils literal notranslate"><span class="pre">&gt;=2.1</span></code></p></li>
<li><p>Sometimes set maximum version to next major version (<code class="docutils literal notranslate"><span class="pre">&lt;4</span></code>) (when
you currently use <code class="docutils literal notranslate"><span class="pre">3.x.y</span></code>) when you expect issues with next
major version.</p></li>
</ul>
</li>
<li><p>As the “end consumer” of libraries, define your dependencies as narrowly as possible.</p></li>
</ul>
</section>
<section id="common-issues">
<h2>Common issues<a class="headerlink" href="#common-issues" title="Link to this heading"></a></h2>
<p>Here are couple of common issues that arise for new users of environments.</p>
<ol class="arabic simple">
<li><p><strong>Global installs:</strong> Installing packages with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code>.
This installs packages to    your home directory and makes them globally
available. This can cause major problems because these packages override
packages installed in the environments.</p></li>
<li><p><strong>Environments using lots of storage space:</strong> Python packages that contain
libraries can take a lot of space, which can cause quota problems when
you’re installing Python environments in systems with limited storage
space. By default packages are cached to your home folder
(see these documentations for <a class="reference external" href="https://pip.pypa.io/en/stable/topics/caching/#where-is-the-cache-stored">pip</a>,
<a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/user-guide/configuration/custom-env-and-pkg-locations.html">conda</a>,
and <a class="reference external" href="https://docs.astral.sh/uv/concepts/cache/#cache-directory">uv</a>).
Conda and uv reuse packages across multiple environments (if you create
another environment with the same packages, it won’t take more space).
For these tools it is important that the cache and environments are
stored in the same filesystem. Pip only caches downloads and self-built
packages, it won’t reuse them across environments.</p></li>
<li><p><strong>Environments creating huge numbers of files:</strong> Python environments
can have huge numbers of files. Some systems (like shared HPC systems) do
not like that the are lots of small files in the storage system. You can
use <a class="reference external" href="https://coderefinery.github.io/hpc-containers/">containers</a> to put
the environement into a single file to solve these problems.</p></li>
</ol>
</section>
<section id="additional-tips-and-tricks">
<h2>Additional tips and tricks<a class="headerlink" href="#additional-tips-and-tricks" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tab" tabindex="0">Creating a conda environment from requirements.txt</button><button aria-controls="panel-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" name="QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" role="tab" tabindex="-1">Adding pip packages into conda environments</button><button aria-controls="panel-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" name="SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" role="tab" tabindex="-1">Installing pip packages from GitHub</button></div><div aria-labelledby="tab-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" class="sphinx-tabs-panel group-tab" id="panel-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tabpanel" tabindex="0"><blockquote>
<div><p>conda supports installing an environment from <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>my-environment<span class="w"> </span>--channel<span class="w"> </span>conda-forge<span class="w"> </span>--file<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>To create an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> from this environment that mimics
the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, activate it and run</p>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--from-history<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
</div><div aria-labelledby="tab-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" name="QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" role="tabpanel" tabindex="0"><p>conda supports installing pip packages in an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>.</p>
<p>Usually this is done to add those packages that are missing
from conda channels.</p>
<p>To do this you’ll want to install <code class="docutils literal notranslate"><span class="pre">pip</span></code> into the environment
and then add pip-installed packages to a list called <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>See this example <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
<p>One can even add a full <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> to the environment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-r</span><span class="nv"> </span><span class="s">requirements.txt&quot;</span>
</pre></div>
</div>
<p>Do note that in both methods the pip-packages come from PyPI
and not from conda channels. The installation of these packages
is done after conda environment is created and this can also
remove or update conda packages installed previously.</p>
</div><div aria-labelledby="tab-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" name="SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" role="tabpanel" tabindex="0"><p>Packages available in GitHub or other repositorios
can be given as a URL in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>For example, to install a development version of the
<a class="reference external" href="https://github.com/psf/black">black code formatter</a>, one can
write the following <code class="docutils literal notranslate"><span class="pre">requirement.txt</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>git+https://github.com/psf/black
</pre></div>
</div>
<p>or</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>https://github.com/psf/black/archive/master.zip
</pre></div>
</div>
<p>First one would use git to clone the repository, second would
download the zip archive of the repository.</p>
</div></div>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<p>Other tools for dependency management:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a>: Tool for managing multiple Python
versions and environments.</p></li>
<li><p><a class="reference external" href="https://python-poetry.org/">Poetry</a>: Environment and package creation
tool.</p></li>
<li><p><a class="reference external" href="https://pipenv.pypa.io/">Pipenv</a>: Environment creation tool.</p></li>
<li><p><a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>: Tool for installing multiple
different Python versions.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba</a>:
tiny version of Mamba as a static C++ executable. Does not need base
environment or Python for installing an environment.</p></li>
<li><p><a class="reference external" href="https://github.com/thoth-station/micropipenv">micropipenv</a>: Small tool
that can install dependencies from multiple different environment formats.</p></li>
<li><p><a class="reference external" href="https://pixi.sh">pixi</a> &amp; <a class="reference external" href="https://prefix.dev/">prefix.dev</a>: A package
ecosystem that install all sorts of packages using the conda ecosystem.</p></li>
</ul>
<p>Other resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://scicomp.aalto.fi/scicomp/packaging-software/">https://scicomp.aalto.fi/scicomp/packaging-software/</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>If somebody asks you what dependencies your code has, you should be able to answer this question <strong>with a file</strong>.</p></li>
<li><p>Install dependencies by first recording them in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and install using these files, then you have a trace.</p></li>
<li><p>Use isolated environments and avoid installing packages system-wide.</p></li>
</ul>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../libraries/" class="btn btn-neutral float-left" title="Library ecosystem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../binder/" class="btn btn-neutral float-right" title="Binder" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>