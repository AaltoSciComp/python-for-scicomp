

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Profiling" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/profiling/" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="Should we even optimize the code?: Classic quote to keep in mind: “Premature optimization is the root of all evil.” [Donald Knuth] Measure instead of guessing: Before doing code surgery to optimize..." />
<meta name="description" content="Should we even optimize the code?: Classic quote to keep in mind: “Premature optimization is the root of all evil.” [Donald Knuth] Measure instead of guessing: Before doing code surgery to optimize..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profiling &mdash; Python for Scientific Computing  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />

  
    <link rel="shortcut icon" href="../_static/logo-hexagons-02-compact.svg.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=35a8b989"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script data-domain="aaltoscicomp.github.io/python-for-scicomp" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Productivity tools" href="../productivity/" />
    <link rel="prev" title="Scripts" href="../scripts/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Python for Scientific Computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python/">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy-advanced/">Advanced NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xarray/">Xarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-matplotlib/">Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-vega-altair/">Plotting with Vega-Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../work-with-data/">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/">Scripts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Profiling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#should-we-even-optimize-the-code">Should we even optimize the code?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measure-instead-of-guessing">Measure instead of guessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#one-of-the-simplest-tools-is-to-insert-timers">One of the simplest tools is to insert timers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#many-tools-exist">Many tools exist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tracing-profilers-vs-sampling-profilers">Tracing profilers vs. sampling profilers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choosing-the-right-system-size">Choosing the right system size</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-resources">Additional resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../productivity/">Productivity tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/">Library ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependency management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binder/">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/">Web APIs with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-formats/">In depth analysis of some selected file formats</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Profiling</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/profiling.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="profiling">
<h1>Profiling<a class="headerlink" href="#profiling" title="Link to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand when improving code performance is worth the time and effort.</p></li>
<li><p>Knowing how to find performance bottlenecks in Python code.</p></li>
<li><p>Try <code class="docutils literal notranslate"><span class="pre">scalene</span></code> as one of many tools to profile Python code.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>Discussion: 20 min</p></li>
<li><p>Exercise: 20 min</p></li>
</ul>
</div>
<section id="should-we-even-optimize-the-code">
<h2>Should we even optimize the code?<a class="headerlink" href="#should-we-even-optimize-the-code" title="Link to this heading"></a></h2>
<p>Classic quote to keep in mind: “Premature optimization is the root of all evil.” [Donald Knuth]</p>
<div class="admonition-discussion discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion</p>
<p>It is important to ask ourselves whether it is worth it.</p>
<ul class="simple">
<li><p>Is it worth spending e.g. 2 days to make a program run 20% faster?</p></li>
<li><p>Is it worth optimizing the code so that it spends 90% less memory?</p></li>
</ul>
<p>Depends. What does it depend on?</p>
</div>
</section>
<section id="measure-instead-of-guessing">
<h2>Measure instead of guessing<a class="headerlink" href="#measure-instead-of-guessing" title="Link to this heading"></a></h2>
<p>Before doing code surgery to optimize the run time or lower the memory usage,
we should <strong>measure</strong> where the bottlenecks are. This is called <strong>profiling</strong>.</p>
<p>Analogy: Medical doctors don’t start surgery based on guessing. They first measure
(X-ray, MRI, …) to know precisely where the problem is.</p>
<p>Not only programming beginners can otherwise guess wrong, but also experienced
programmers can be surprised by the results of profiling.</p>
</section>
<section id="one-of-the-simplest-tools-is-to-insert-timers">
<h2>One of the simplest tools is to insert timers<a class="headerlink" href="#one-of-the-simplest-tools-is-to-insert-timers" title="Link to this heading"></a></h2>
<p>Below we will list some tools that can be used to profile Python code.
But even without these tools you can find <strong>time-consuming parts</strong> of your code
by inserting timers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">import</span> <span class="nn">time</span>
</span>

<span class="c1"># ...</span>
<span class="c1"># code before the function</span>


<span class="hll"><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class="n">result</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">()</span>
<span class="hll"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;some_function took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span>

<span class="c1"># code after the function</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="many-tools-exist">
<h2>Many tools exist<a class="headerlink" href="#many-tools-exist" title="Link to this heading"></a></h2>
<p>The list below here is probably not complete, but it gives an overview of the
different tools available for profiling Python code.</p>
<p>CPU profilers:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/profile.html">cProfile and profile</a></p></li>
<li><p><a class="reference external" href="https://kernprof.readthedocs.io/">line_profiler</a></p></li>
<li><p><a class="reference external" href="https://github.com/benfred/py-spy">py-spy</a></p></li>
<li><p><a class="reference external" href="https://github.com/sumerc/yappi">Yappi</a></p></li>
<li><p><a class="reference external" href="https://pyinstrument.readthedocs.io/">pyinstrument</a></p></li>
<li><p><a class="reference external" href="https://perfetto.dev/docs/analysis/trace-processor-python">Perfetto</a></p></li>
</ul>
<p>Memory profilers:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/memory-profiler/">memory_profiler</a> (not actively maintained)</p></li>
<li><p><a class="reference external" href="https://pympler.readthedocs.io/">Pympler</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/tracemalloc.html">tracemalloc</a></p></li>
<li><p><a class="reference external" href="https://github.com/zhuyifei1999/guppy3/">guppy/heapy</a></p></li>
</ul>
<p>Both CPU and memory:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/plasma-umass/scalene">Scalene</a></p></li>
</ul>
<p>In the exercise below, we will use Scalene to profile a Python program. Scalene
is a sampling profiler that can profile CPU, memory, and GPU usage of Python.</p>
</section>
<section id="tracing-profilers-vs-sampling-profilers">
<h2>Tracing profilers vs. sampling profilers<a class="headerlink" href="#tracing-profilers-vs-sampling-profilers" title="Link to this heading"></a></h2>
<p><strong>Tracing profilers</strong> record every function call and event in the program,
logging the exact sequence and duration of events.</p>
<ul class="simple">
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Provides detailed information on the program’s execution.</p></li>
<li><p>Deterministic: Captures exact call sequences and timings.</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Higher overhead, slowing down the program.</p></li>
<li><p>Can generate larger amount of data.</p></li>
</ul>
</li>
</ul>
<p><strong>Sampling profilers</strong> periodically samples the program’s state (where it is
and how much memory is used), providing a statistical view of where time is
spent.</p>
<ul class="simple">
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Lower overhead, as it doesn’t track every event.</p></li>
<li><p>Scales better with larger programs.</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Less precise, potentially missing infrequent or short calls.</p></li>
<li><p>Provides an approximation rather than exact timing.</p></li>
</ul>
</li>
</ul>
<div class="admonition-analogy-imagine-we-want-to-optimize-the-london-underground-subway-system discussion important admonition" id="discussion-1">
<p class="admonition-title">Analogy: Imagine we want to optimize the London Underground (subway) system</p>
<p>We wish to detect bottlenecks in the system to improve the service and for this we have
asked few passengers to help us by tracking their journey.</p>
<ul class="simple">
<li><p><strong>Tracing</strong>: We follow every train and passenger, recording every stop
and delay. When passengers enter and exit the train, we record the exact time
and location.</p></li>
<li><p><strong>Sampling</strong>: Every 5 minutes the phone notifies the passenger to note
down their current location. We then use this information to estimate
the most crowded stations and trains.</p></li>
</ul>
</div>
</section>
<section id="choosing-the-right-system-size">
<h2>Choosing the right system size<a class="headerlink" href="#choosing-the-right-system-size" title="Link to this heading"></a></h2>
<p>Sometimes we can configure the system size (for instance the time step in a simulation
or the number of time steps or the matrix dimensions) to make the program finish sooner.</p>
<p>For profiling, we should choose a system size that is <strong>representative of the real-world</strong>
use case. If we profile a program with a small input size, we might not see the same
bottlenecks as when running the program with a larger input size.</p>
<p>Often, when we scale up the system size, or scale the number of processors, new bottlenecks
might appear which we didn’t see before. This brings us back to: “measure instead of guessing”.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h2>
<div class="admonition-exercise-practicing-profiling exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise: Practicing profiling</p>
<p>In this exercise we will use the Scalene profiler to find out where most of the time is spent
and most of the memory is used in a given code example.</p>
<p>Please try to go through the exercise in the following steps:</p>
<ol class="arabic">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">scalene</span></code> is installed in your environment (if you have followed
this course from the start and installed the recommended software
environment, then it is).</p></li>
<li><p>Download Leo Tolstoy’s “War and Peace” from the following link (the text is
provided by <a class="reference external" href="https://www.gutenberg.org/">Project Gutenberg</a>):
<a class="reference external" href="https://www.gutenberg.org/cache/epub/2600/pg2600.txt">https://www.gutenberg.org/cache/epub/2600/pg2600.txt</a>
(right-click and “save as” to download the file and <strong>save it as “book.txt”</strong>).</p></li>
<li><p><strong>Before</strong> you run the profiler, try to predict in which function the code
(the example code is below)
will spend most of the time and in which function it will use most of the
memory.</p></li>
<li><p>Save the example code as <code class="docutils literal notranslate"><span class="pre">example.py</span></code> and
run the <code class="docutils literal notranslate"><span class="pre">scalene</span></code> profiler on the following code example and browse the
generated HTML report to find out where most of the time is spent and where
most of the memory is used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scalene<span class="w"> </span>example.py
</pre></div>
</div>
<p>Alternatively you can do this (and then open the generated file in a browser):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scalene<span class="w"> </span>example.py<span class="w"> </span>--html<span class="w"> </span>&gt;<span class="w"> </span>profile.html
</pre></div>
</div>
<p>You can find an example of the generated HTML report in the solution below.</p>
</li>
<li><p>Does the result match your prediction? Can you explain the results?</p></li>
</ol>
<p>Example code (<code class="docutils literal notranslate"><span class="pre">example.py</span></code>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The code below reads a text file and counts the number of unique words in it</span>
<span class="sd">(case-insensitive).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">count_unique_words1</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">count_unique_words2</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_words</span><span class="p">:</span>
                    <span class="n">unique_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">count_unique_words3</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">unique_words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># book.txt is downloaded from https://www.gutenberg.org/cache/epub/2600/pg2600.txt</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words1</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words2</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words3</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../_images/exercise1.png"><img alt="Result of the profiling run for the above code example." src="../_images/exercise1.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Result of the profiling run for the above code example. You can click on the image to make it larger.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Results:</p>
<ul class="simple">
<li><p>Most time is spent in the <code class="docutils literal notranslate"><span class="pre">count_unique_words2</span></code> function.</p></li>
<li><p>Most memory is used in the <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> function.</p></li>
</ul>
<p>Explanation:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words2</span></code> function is the slowest because it <strong>uses a list</strong>
to store unique words and checks if a word is already in the list before
adding it.
Checking whether a list contains an element might require traversing the
whole list, which is an O(n) operation. As the list grows in size,
the lookup time increases with the size of the list.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> and <code class="docutils literal notranslate"><span class="pre">count_unique_words3</span></code> functions are faster
because they <strong>use a set</strong> to store unique words.
Checking whether a set contains an element is an O(1) operation.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> function uses the most memory because it <strong>creates
a list of all words</strong> in the text file and then <strong>creates a set</strong> from that
list.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words3</span></code> function uses less memory because it traverses
the text file line by line instead of reading the whole file into memory.</p></li>
</ul>
<p>What we can learn from this exercise:</p>
<ul class="simple">
<li><p>When processing large files, it can be good to read them line by line
or in batches
instead of reading the whole file into memory.</p></li>
<li><p>It is good to get an overview over standard data structures and their
advantages and disadvantages (e.g. adding an element to a list is fast but checking whether
it already contains the element can be slow).</p></li>
</ul>
</div>
</div>
</section>
<section id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://enccs.github.io/python-perf/profile/">Python performance workshop (by ENCCS)</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../scripts/" class="btn btn-neutral float-left" title="Scripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../productivity/" class="btn btn-neutral float-right" title="Productivity tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>