<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Pandas" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/pandas/" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="Pandas is a Python package that provides high-performance and easy to use data structures and data analysis tools. This page provides a brief overview of pandas, but the open source community devel..." />
<meta name="description" content="Pandas is a Python package that provides high-performance and easy to use data structures and data analysis tools. This page provides a brief overview of pandas, but the open source community devel..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pandas &mdash; Python for Scientific Computing  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/logo-hexagons-02-compact.svg.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Data visualization with Matplotlib" href="../data-visualization/" />
    <link rel="prev" title="Advanced NumPy" href="../numpy-advanced/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Python for Scientific Computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python/">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy-advanced/">Advanced NumPy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-quick-pandas-preview">A quick Pandas preview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-in-a-dataframe">What’s in a dataframe?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-1">Exercises 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tidy-data">Tidy data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-dataframes">Working with dataframes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-2">Exercises 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#time-series-superpowers">Time series superpowers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises-3">Exercises 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beyond-the-basics">Beyond the basics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data-visualization/">Data visualization with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-formats/">Data formats with Pandas and Numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../productivity/">Productivity tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/">Library ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependency management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binder/">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/">Web APIs with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pandas</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/pandas.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pandas">
<h1>Pandas<a class="headerlink" href="#pandas" title="Permalink to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How do I learn a new Python package?</p></li>
<li><p>How can I use pandas dataframes in my research?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn simple and some more advanced usage of pandas dataframes</p></li>
<li><p>Get a feeling for when pandas is useful and know where to find more information</p></li>
<li><p>Understand enough of pandas to be able to read its documentation.</p></li>
</ul>
</div>
<p>Pandas is a Python package that provides high-performance and easy to use
data structures and data analysis tools.
This page provides a brief overview of pandas, but the open source community
developing the pandas package has also created excellent documentation and training
material, including:</p>
<ul class="simple">
<li><p>a  <a class="reference external" href="https://pandas.pydata.org/getting_started.html">Getting started guide</a>
(including tutorials and a 10 minute flash intro)</p></li>
<li><p>a <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/10min.html#min">“10 minutes to pandas”</a>
tutorial</p></li>
<li><p>thorough <a class="reference external" href="https://pandas.pydata.org/docs/">Documentation</a> containing a user guide,
API reference and contribution guide</p></li>
<li><p>a <a class="reference external" href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">cheatsheet</a></p></li>
<li><p>a <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/cookbook.html#cookbook">cookbook</a>.</p></li>
</ul>
<section id="a-quick-pandas-preview">
<h2>A quick Pandas preview<a class="headerlink" href="#a-quick-pandas-preview" title="Permalink to this heading"></a></h2>
<p>Let’s get a flavor of what we can do with pandas (you won’t be able to follow everything yet). We will be working with an example dataset containing the passenger list from the Titanic, which is often used in Kaggle competitions and data science tutorials. First step is to load pandas:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>We can download the data from <a class="reference external" href="https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv">this GitHub repository</a>
by visiting the page and saving it to disk, or by directly reading into
a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now view the dataframe to get an idea of what it contains and
print some summary statistics of its numerical data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the first 5 lines of the dataframe</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print summary statistics for each column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<p>Ok, so we have information on passenger names, survival (0 or 1), age,
ticket fare, number of siblings/spouses, etc. With the summary statistics we see that the average age is 29.7 years, maximum ticket price is 512 USD, 38% of passengers survived, etc.</p>
<p>Let’s say we’re interested in the survival probability of different
age groups. With two one-liners, we can find the average age of those
who survived or didn’t survive, and plot corresponding histograms of
the age distribution (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.groupby()</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.hist()</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Survived&quot;</span><span class="p">)[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
             <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">);</span>
</pre></div>
</div>
<p>Clearly, pandas dataframes allows us to do advanced analysis with very few commands, but it takes a while to get used to how dataframes work so let’s get back to basics.</p>
<div class="admonition-getting-help callout admonition" id="callout-0">
<p class="admonition-title">Getting help</p>
<p>Series and DataFrames have a lot functionality, but
how can we find out what methods are available and how they work? One way is to visit
the <a class="reference external" href="https://pandas.pydata.org/docs/reference/frame.html">API reference</a>
and reading through the list.
Another way is to use the autocompletion feature in Jupyter and type e.g.
<code class="docutils literal notranslate"><span class="pre">titanic[&quot;Age&quot;].</span></code> in a notebook and then hit <code class="docutils literal notranslate"><span class="pre">TAB</span></code> twice - this should open
up a list menu of available methods and attributes.</p>
<p>Jupyter also offers quick access to help pages (docstrings) which can be
more efficient than searching the internet. Two ways exist:</p>
<ul class="simple">
<li><p>Write a function name followed by question mark and execute the cell, e.g.
write <code class="docutils literal notranslate"><span class="pre">titanic.hist?</span></code> and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">ENTER</span></code>.</p></li>
<li><p>Write the function name and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">TAB</span></code>.</p></li>
<li><p>Right click and select “Show contextual help”.  This tab will
update with help for anything you click.</p></li>
</ul>
</div>
</section>
<section id="what-s-in-a-dataframe">
<h2>What’s in a dataframe?<a class="headerlink" href="#what-s-in-a-dataframe" title="Permalink to this heading"></a></h2>
<p>As we saw above, pandas dataframes are a powerful tool for working with tabular data.
A pandas
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a>
is composed of rows and columns:</p>
<img alt="../_images/01_table_dataframe.svg" src="../_images/01_table_dataframe.svg" /><p>Each column of a dataframe is a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v2.1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Series</span></code></a> object
- a dataframe is thus a collection of series:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print some information about the columns</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<p>Unlike a NumPy array, a dataframe can combine multiple data types, such as
numbers and text, but the data in each column is of the same type. So we say a
column is of type <code class="docutils literal notranslate"><span class="pre">int64</span></code> or of type <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
<p>Let’s inspect one column of the Titanic passanger list data (first downloading
and reading the titanic.csv datafile into a dataframe if needed, see above):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">Age</span>          <span class="c1"># same as above</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">])</span> <span class="c1"># a pandas Series object</span>
</pre></div>
</div>
<p>The columns have names. Here’s how to get them (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.columns.html#pandas.DataFrame.columns" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">columns</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<p>However, the rows also have names! This is what Pandas calls the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.index.html#pandas.DataFrame.index" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">index</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
<p>We saw above how to select a single column, but there are many ways of
selecting (and setting) single or multiple rows, columns and
values. We can refer to columns and rows either by their name
(<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loc</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html#pandas.DataFrame.at" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">at</span></code></a>) or by
their index (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html#pandas.DataFrame.iloc" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iloc</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iat.html#pandas.DataFrame.iat" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iat</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>          <span class="c1"># select single value by row and column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Survived&quot;</span><span class="p">:</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>  <span class="c1"># slice the dataframe by row and column *names*</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>                      <span class="c1"># same slice as above by row and column *numbers*</span>

<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>      <span class="c1"># set single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>           <span class="c1"># select single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>                           <span class="c1"># select same value by row and column *number* (fast)</span>

<span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;is_passenger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># set a whole column</span>
</pre></div>
</div>
<p>Dataframes also support boolean indexing, just like we saw for <code class="docutils literal notranslate"><span class="pre">numpy</span></code>
arrays:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">]</span>
<span class="c1"># &quot;.str&quot; creates a string object from a column</span>
<span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Margaret&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>What if your dataset has missing data? Pandas uses the value <a class="reference external" href="https://numpy.org/doc/stable/reference/constants.html#numpy.nan" title="(in NumPy v1.26)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.nan</span></code></a>
to represent missing data, and by default does not include it in any computations.
We can find missing values, drop them from our dataframe, replace them
with any value we like or do forward or backward filling:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>                    <span class="c1"># returns boolean mask of NaN values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>                  <span class="c1"># drop missing values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>         <span class="c1"># or how=&quot;all&quot;</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabin&quot;</span><span class="p">])</span>  <span class="c1"># only drop NaNs from one column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                 <span class="c1"># replace NaNs with zero</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>    <span class="c1"># forward-fill NaNs</span>
</pre></div>
</div>
</section>
<section id="exercises-1">
<h2>Exercises 1<a class="headerlink" href="#exercises-1" title="Permalink to this heading"></a></h2>
<div class="admonition-exploring-dataframes exercise important admonition" id="exercise-0">
<p class="admonition-title">Exploring dataframes</p>
<blockquote>
<div><ul class="simple">
<li><p>Have a look at the available methods and attributes using the
<a class="reference external" href="https://pandas.pydata.org/docs/reference/frame.html">API reference</a>
or the autocomplete feature in Jupyter.</p></li>
<li><p>Try out a few methods using the Titanic dataset and have a look at
the docstrings (help pages) of methods that pique your interest</p></li>
<li><p>Compute the mean age of the first 10 passengers by slicing and the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mean.html#pandas.DataFrame.mean" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.mean()</span></code></a> method</p></li>
<li><p>(Advanced) Using boolean indexing, compute the survival rate
(mean of “Survived” values) among passengers over and under the average age.</p></li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ul>
<li><p>Mean age of the first 10 passengers:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,:][</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s2">&quot;Nasser, Mrs. Nicholas (Adele Achem)&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Survival rate among passengers over and under average age:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()][</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()][</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</section>
<section id="tidy-data">
<h2>Tidy data<a class="headerlink" href="#tidy-data" title="Permalink to this heading"></a></h2>
<p>The above analysis was rather straightforward thanks to the fact
that the dataset is <em>tidy</em>.</p>
<img alt="../_images/tidy_data.png" src="../_images/tidy_data.png" />
<p>In short, columns should be variables and rows should be measurements,
and adding measurements (rows) should then not require any changes to code
that reads the data.</p>
<p>What would untidy data look like? Here’s an example from
some run time statistics from a 1500 m running event:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 1&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">240</span><span class="p">},</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 2&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 3&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">360</span><span class="p">},</span>
          <span class="p">])</span>
</pre></div>
</div>
<p>What makes this data untidy is that the column names <cite>400, 800, 1200, 1500</cite>
indicate the distance ran. In a tidy dataset, this distance would be a variable
on its own, making each runner-distance pair a separate observation and hence a
separate row.</p>
<p>To make untidy data tidy, a common operation is to “melt” it,
which is to convert it from wide form to a long form:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">runners</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Runner&quot;</span><span class="p">,</span>
              <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span>
              <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span>
              <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span>
          <span class="p">)</span>
</pre></div>
</div>
<p>In this form it’s easier to <strong>filter</strong>, <strong>group</strong>, <strong>join</strong>
and <strong>aggregate</strong> the data, and it’s also easier to model relationships
between variables.</p>
<p>The opposite of melting is to <em>pivot</em> data, which can be useful to
view data in different ways as we’ll see below.</p>
<p>For a detailed exposition of data tidying, have a look at
<a class="reference external" href="http://vita.had.co.nz/papers/tidy-data.pdf">this article</a>.</p>
</section>
<section id="working-with-dataframes">
<h2>Working with dataframes<a class="headerlink" href="#working-with-dataframes" title="Permalink to this heading"></a></h2>
<p>We saw above how we can read in data into a dataframe using the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv" title="(in pandas v2.1.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> function.
Pandas also understands multiple other formats, for example using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html#pandas.read_excel" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_excel</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_hdf.html#pandas.read_hdf" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_hdf</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_json.html#pandas.read_json" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_json</span></code></a>, etc. (and corresponding methods to write to file:
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_csv</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html#pandas.DataFrame.to_excel" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_excel</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_hdf.html#pandas.DataFrame.to_hdf" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_hdf</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_json.html#pandas.DataFrame.to_json" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_json</span></code></a>, etc.)</p>
<p>But sometimes you would want to create a dataframe from scratch. Also this can be done
in multiple ways, for example starting with a numpy array (see
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> docs):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
<p>or a dictionary (see same docs):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                   <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
                   <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)})</span>
<span class="n">df</span>
</pre></div>
</div>
<p>There are many ways to operate on dataframes. Let’s look at a
few examples in order to get a feeling of what’s possible
and what the use cases can be.</p>
<p>We can easily split and <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html#pandas.concat" title="(in pandas v2.1.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">concatenate</span></code></a> dataframes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">,</span> <span class="n">sub3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">,</span> <span class="n">sub3</span><span class="p">])</span>
</pre></div>
</div>
<p>When pulling data from multiple dataframes, a powerful <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas.DataFrame.merge" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.DataFrame.merge</span></code></a> method is
available that acts similarly to merging in SQL. Say we have a dataframe containing the age of some athletes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 4&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">},</span>
<span class="p">])</span>
</pre></div>
</div>
<p>We now want to use this table to annotate the original <code class="docutils literal notranslate"><span class="pre">runners</span></code> table from
before with their age. Note that the <code class="docutils literal notranslate"><span class="pre">runners</span></code> and <code class="docutils literal notranslate"><span class="pre">age</span></code> dataframes have a
different ordering to it, and <code class="docutils literal notranslate"><span class="pre">age</span></code> has an entry for <code class="docutils literal notranslate"><span class="pre">Dave</span></code> which is not
present in the <code class="docutils literal notranslate"><span class="pre">runners</span></code> table. We can let Pandas deal with all of it using
the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas.DataFrame.merge" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">merge</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the age for each runner</span>
<span class="n">runners</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Runner&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In fact, much of what can be done in SQL
<a class="reference external" href="https://pandas.pydata.org/docs/getting_started/comparison/comparison_with_sql.html">is also possible with pandas</a>.</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">groupby</span></code></a> is a powerful method which splits a dataframe and aggregates data
in groups. To see what’s possible, let’s return to the Titanic dataset. Let’s
test the old saying “Women and children first”. We start by creating a new
column <code class="docutils literal notranslate"><span class="pre">Child</span></code> to indicate whether a passenger was a child or not, based on
the existing <code class="docutils literal notranslate"><span class="pre">Age</span></code> column. For this example, let’s assume that you are a
child when you are younger than 12 years:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Now we can test the saying by grouping the data on <code class="docutils literal notranslate"><span class="pre">Sex</span></code> and then creating further sub-groups based on <code class="docutils literal notranslate"><span class="pre">Child</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span> <span class="s2">&quot;Child&quot;</span><span class="p">])[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we chose to summarize the data by its mean, but many other common
statistical functions are available as dataframe methods, like
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.std.html#pandas.DataFrame.std" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">std</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.min.html#pandas.DataFrame.min" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">min</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.max.html#pandas.DataFrame.max" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">max</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cumsum</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.median.html#pandas.DataFrame.median" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">median</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.skew.html#pandas.DataFrame.skew" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">skew</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.var.html#pandas.DataFrame.var" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">var</span></code></a> etc.</p>
</section>
<section id="exercises-2">
<h2>Exercises 2<a class="headerlink" href="#exercises-2" title="Permalink to this heading"></a></h2>
<div class="admonition-analyze-the-titanic-passenger-list-dataset exercise important admonition" id="exercise-1">
<p class="admonition-title">Analyze the Titanic passenger list dataset</p>
<blockquote>
<div><p>In the Titanic passenger list dataset,
investigate the family size of the passengers (i.e. the “SibSp” column).</p>
<ul class="simple">
<li><p>What different family sizes exist in the passenger list? Hint: try the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.unique.html#pandas.Series.unique" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unique()</span></code></a> method</p></li>
<li><p>What are the names of the people in the largest family group?</p></li>
<li><p>(Advanced) Create histograms showing the distribution of family sizes for
passengers split by the fare, i.e. one group of high-fare passengers (where
the fare is above average) and one for low-fare passengers
(Hint: instead of an existing column name, you can give a lambda function
as a parameter to <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hist()</span></code></a> to compute a value on the fly. For example
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">df[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">df[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;</span></code>).</p></li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<ul>
<li><p>Existing family sizes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;SibSp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>We get 8 from above.  There is no <code class="docutils literal notranslate"><span class="pre">Name</span></code> column, since we
made <code class="docutils literal notranslate"><span class="pre">Name</span></code> the index when we loaded the dataframe with
<code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, so we use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.index.html#pandas.DataFrame.index" title="(in pandas v2.1.2)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pandas.DataFrame.index</span></code></a> to get
the names.  So, names of members of largest family(ies):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;SibSp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</li>
<li><p>Histogram of family size based on fare class:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">&quot;SibSp&quot;</span><span class="p">,</span>
             <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Poor&quot;</span> <span class="k">if</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Rich&quot;</span><span class="p">,</span>
             <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</section>
<section id="time-series-superpowers">
<h2>Time series superpowers<a class="headerlink" href="#time-series-superpowers" title="Permalink to this heading"></a></h2>
<p>An introduction of pandas wouldn’t be complete without mention of its
special abilities to handle time series. To show just a few examples,
we will use a new dataset of Nobel prize laureates available through
an API of the Nobel prize organisation at
<a class="reference external" href="https://api.nobelprize.org/v1/laureate.csv">https://api.nobelprize.org/v1/laureate.csv</a> .</p>
<p>Unfortunately this API does not allow “non-browser requests”, so
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.read_csv</span></code></a> will not work directly on it. Instead, we put a
local copy on Github which we can access (the original data is CC-0,
so we are allowed to do this).  (Aside: if you do JupyterLab →
File → Open from URL → paste the URL above, it will open it in
JupyterLab <em>and</em> download a copy for your use.)</p>
<p>We can then load and explore the data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/AaltoSciComp/python-for-scicomp/raw/master/resources/data/laureate.csv&quot;</span><span class="p">)</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>This dataset has three columns for time, “born”/”died” and “year”.
These are represented as strings and integers, respectively, and
need to be converted to datetime format.  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html#pandas.to_datetime" title="(in pandas v2.1.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.to_datetime()</span></code></a>
makes this easy:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the errors=&#39;coerce&#39; argument is needed because the dataset is a bit messy</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas knows a lot about dates (using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#dt-accessor" title="(in pandas v2.1.2)"><span>.dt accessor</span></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span>
</pre></div>
</div>
<p>We can add a column containing the (approximate) lifespan in years rounded
to one decimal:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;lifespan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>and then plot a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">histogram</span></code></a> of lifespans:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;lifespan&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, let’s see one more example of an informative plot (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.boxplot.html#pandas.DataFrame.boxplot" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">boxplot()</span></code></a>)
produced by a single line of code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;lifespan&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises-3">
<h2>Exercises 3<a class="headerlink" href="#exercises-3" title="Permalink to this heading"></a></h2>
<div class="admonition-analyze-the-nobel-prize-dataset exercise important admonition" id="exercise-2">
<p class="admonition-title">Analyze the Nobel prize dataset</p>
<blockquote>
<div><ul class="simple">
<li><p>What country has received the largest number of Nobel prizes, and how many?
How many countries are represented in the dataset? Hint: use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">describe</span></code></a> method
on the <code class="docutils literal notranslate"><span class="pre">bornCountryCode</span></code> column.</p></li>
<li><p>Create a histogram of the age when the laureates received their Nobel prizes.
Hint: follow the above steps we performed for the lifespan.</p></li>
<li><p>List all the Nobel laureates from your country.</p></li>
</ul>
<p>Now more advanced steps:</p>
<ul>
<li><p>Now define an array of 4 countries of your choice and extract
only laureates from these countries (you need to look at the
data and find how countries are written, and replace <code class="docutils literal notranslate"><span class="pre">COUNTRY</span></code>
with those strings):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">COUNTRY1</span><span class="p">,</span> <span class="n">COUNTRY2</span><span class="p">,</span> <span class="n">COUNTRY3</span><span class="p">,</span> <span class="n">COUNTRY4</span><span class="p">])</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p>Use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">groupby()</span></code></a> to compute how many nobel prizes each country received in
each category. The <code class="xref py py-meth docutils literal notranslate"><span class="pre">size()</span></code> method tells us how many rows, hence nobel
prizes, are in each group:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>(Optional) Create a pivot table to view a spreadsheet like structure, and view it</p>
<blockquote>
<div><ul>
<li><p>First add a column “number” to the nobel dataframe containing 1’s
(to enable the counting below).  We need to make a copy of
<code class="docutils literal notranslate"><span class="pre">subset</span></code>, because right now it is only a view:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Then create the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html#pandas.DataFrame.pivot_table" title="(in pandas v2.1.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pivot_table()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p>(Optional) Install the <strong>seaborn</strong> visualization library if you don’t
already have it, and create a heatmap of your table:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Play around with other nice looking plots:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="s2">&quot;stick&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset_physchem</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;physics&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;chemistry&#39;</span><span class="p">]))]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset_physchem</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;swarm&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset_physchem</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>Below is solutions for the basic steps, advanced steps are
inline above.</p>
<p>We use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">describe()</span></code> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">bornCountryCode</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># count     956</span>
<span class="c1"># unique     81</span>
<span class="c1"># top        US</span>
<span class="c1"># freq      287</span>
</pre></div>
</div>
<p>We see that the US has received the largest number of Nobel prizes,
and 81 countries are represented.</p>
<p>To calculate the age at which laureates receive their prize, we need
to ensure that the “year” and “born” columns are in datetime format:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we add a column with the age at which Nobel prize was received
and plot a histogram:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age_nobel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age_nobel&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>We can print names of all laureates from a given country, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span><span class="s2">&quot;surname&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="beyond-the-basics">
<h2>Beyond the basics<a class="headerlink" href="#beyond-the-basics" title="Permalink to this heading"></a></h2>
<p>Larger DataFrame operations might be faster using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.eval.html#pandas.eval" title="(in pandas v2.1.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> with string expressions, <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/03.12-performance-eval-and-query.html">see</a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># Make some really big dataframes</span>
<span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">100</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Adding dataframes the pythonic way yields:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span> <span class="o">+</span> <span class="n">df3</span> <span class="o">+</span> <span class="n">df4</span>
<span class="c1"># 80ms</span>
</pre></div>
</div>
<p>And by using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.eval.html#pandas.eval" title="(in pandas v2.1.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;df1 + df2 + df3 + df4&#39;</span><span class="p">)</span>
<span class="c1"># 40ms</span>
</pre></div>
</div>
<p>We can assign function return lists as dataframe columns:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Fibonacci numbers. Here we skip the overhead from the</span>
<span class="sd">    recursive function calls by using a list. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Not defined for negative values&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="n">memo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">memo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">memo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">memo</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Generation&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Rabbits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fibo</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>  <span class="c1"># Assigns list to column</span>
</pre></div>
</div>
<p>There is much more to Pandas than what we covered in this lesson. Whatever your
needs are, chances are good there is a function somewhere in its <a class="reference external" href="https://pandas.pydata.org/docs/">API</a>.  You should try to get good at
searching the web for an example showing what you can do. And when
there is not, you can always
apply your own functions to the data using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="(in pandas v2.1.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Fibonacci numbers. The @lru_cache remembers values we</span>
<span class="sd">    computed before, which speeds up this function a lot.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Not defined for negative values&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Generation&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Rabbits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Generation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the numpy precisision for integers caps at int64 while python ints are unbounded –
limited by memory size. Thus, the result from fibonacci(99) would be erroneous when
using numpy ints. The type of df[‘Number of Rabbits’][99] given by both functions above
is in fact &lt;class ‘int’&gt;.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>pandas dataframes are a good data structure for tabular data</p></li>
<li><p>Dataframes allow both simple and advanced analysis in very compact form</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../numpy-advanced/" class="btn btn-neutral float-left" title="Advanced NumPy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../data-visualization/" class="btn btn-neutral float-right" title="Data visualization with Matplotlib" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>