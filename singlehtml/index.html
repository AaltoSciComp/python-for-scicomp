

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Python for Scientific Computing  documentation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/#document-index" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="Python for Scientific Computing: Python is a modern, object-oriented programming language, which has become popular in several areas of software development. This course discusses how Python can be..." />
<meta name="description" content="Python for Scientific Computing: Python is a modern, object-oriented programming language, which has become popular in several areas of software development. This course discusses how Python can be..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python for Scientific Computing documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css" />

  
    <link rel="shortcut icon" href="_static/logo-hexagons-02-compact.svg.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="_static/sphinx-thebe.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="_static/tabs.js"></script>
      <script data-domain="aaltoscicomp.github.io/python-for-scicomp" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Python for Scientific Computing
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-python">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-jupyter">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-numpy">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-numpy-advanced">Advanced NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-pandas">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-xarray">Xarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-plotting-matplotlib">Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-plotting-vega-altair">Plotting with Vega-Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-work-with-data">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-scripts">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-profiling">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-productivity">Productivity tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-scipy">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-libraries">Library ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-dependencies">Dependency management</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-binder">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-parallel">Parallel programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-packaging">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-web-apis">Web APIs with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-cython">Extending Python with Cython</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-installation">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-quick-reference">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-exercises">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-guide">Instructor’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-data-formats">In depth analysis of some selected file formats</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Python for Scientific Computing  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python-for-scientific-computing">
<h1>Python for Scientific Computing<a class="headerlink" href="#python-for-scientific-computing" title="Link to this heading"></a></h1>
<div class="admonition-attending-the-course-25-27-november-2025 admonition">
<p class="admonition-title">Attending the course 25-27 November, 2025?</p>
<p><a class="reference external" href="https://scicomp.aalto.fi/training/scip/python-for-scicomp-2025/">See the course page here</a>
and watch at <a class="reference external" href="https://twitch.tv/coderefinery">https://twitch.tv/coderefinery</a>.
Whether you are or aren’t, the course material is below.  Videos
will appear in <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nMWEKWtagJ6h0q9BrFO49tn">this playlist</a> (Last year’s videos: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nNI3oQEqSJW6yXltOAZnkpa">playlist</a>).</p>
</div>
<p>Python is a modern, object-oriented programming language, which has
become popular in several areas of software development. This course
discusses how Python can be utilized in scientific computing. The
course starts by introducing some of the main Python tools for
computing: Jupyter for interactive analysis, NumPy and SciPy for
numerical analysis, Matplotlib for visualization, and so on.  In
addition, it talks about <em>how</em> python is used:
related scientific libraries, reproducibility, and the broader
ecosystem of science in Python, because your work is more than the raw
code you write.</p>
<p>This course (like any course) can’t teach you Python… it can show
your some examples, let you see how experts do things, and prepare you
to learn yourself as you need to.</p>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<span id="prerequisites"></span><p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Knowing basic Python syntax.  We assume that you can do some
Python programming, but not much more that that.  We don’t cover
standard Python programming. <a class="reference external" href="https://coderefinery.github.io/data-visualization-python/python-basics/">Here a short course on basic Python
syntax, with further references</a>.</p></li>
<li><p>Watch or read the <a class="reference external" href="https://scicomp.aalto.fi/scicomp/shell/">command line crash course</a>, if you aren’t
familiar.</p></li>
<li><p>You should be able to use a text editor to edit files some.</p></li>
<li><p>The <a class="reference internal" href="#document-installation"><span class="doc">software installation</span></a> described below
(basically, anaconda).</p></li>
</ul>
<p>These are not prerequisites:</p>
<ul class="simple">
<li><p>Any external libraries, e.g. numpy</p></li>
<li><p>Knowing how to make scripts or use Jupyter</p></li>
</ul>
</div>
<div class="admonition-videos-and-archived-q-a admonition">
<p class="admonition-title">Videos and archived Q&amp;A</p>
<p>Videos and material from past instances:</p>
<ul class="simple">
<li><p>2021: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nOS7bHNmbcDoyTnMYaz_TJW">this YouTube playlist</a>.</p></li>
<li><p>2022: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nOm3xkYuInBWPUvS93sAUlk">here</a>,
Q&amp;A: <a class="reference external" href="https://hackmd.io/&#64;coderefinery/python2022archive">days 1-2</a>, <a class="reference external" href="https://hackmd.io/&#64;coderefinery/python2022archive2">days 3-4</a></p></li>
<li><p>2023: <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nNI3oQEqSJW6yXltOAZnkpa">Videos</a></p></li>
<li><p>2024 (Please contact us if you would like to help to process the videos): <a class="reference external" href="https://www.youtube.com/playlist?list=PLZLVmS9rf3nMWEKWtagJ6h0q9BrFO49tn">Videos</a></p></li>
</ul>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>(prereq)</p></td>
<td><p><a class="reference internal" href="#document-python"><span class="doc">Introduction to Python</span></a></p></td>
</tr>
<tr class="row-even"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-jupyter"><span class="doc">Jupyter</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-numpy"><span class="doc">NumPy</span></a> or <a class="reference internal" href="#document-numpy-advanced"><span class="doc">Advanced NumPy</span></a></p></td>
</tr>
<tr class="row-even"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-pandas"><span class="doc">Pandas</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-xarray"><span class="doc">Xarray</span></a></p></td>
</tr>
<tr class="row-even"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-plotting-matplotlib"><span class="doc">Plotting with Matplotlib</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-plotting-vega-altair"><span class="doc">Plotting with Vega-Altair</span></a></p></td>
</tr>
<tr class="row-even"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-work-with-data"><span class="doc">Working with Data</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-scripts"><span class="doc">Scripts</span></a></p></td>
</tr>
<tr class="row-even"><td><p>40 min</p></td>
<td><p><a class="reference internal" href="#document-profiling"><span class="doc">Profiling</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>20 min</p></td>
<td><p><a class="reference internal" href="#document-productivity"><span class="doc">Productivity tools</span></a></p></td>
</tr>
<tr class="row-even"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-web-apis"><span class="doc">Web APIs with Python</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>15 min</p></td>
<td><p><a class="reference internal" href="#document-scipy"><span class="doc">SciPy</span></a></p></td>
</tr>
<tr class="row-even"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-libraries"><span class="doc">Library ecosystem</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>45 min</p></td>
<td><p><a class="reference internal" href="#document-parallel"><span class="doc">Parallel programming</span></a></p></td>
</tr>
<tr class="row-even"><td><p>45 min</p></td>
<td><p><a class="reference internal" href="#document-dependencies"><span class="doc">Dependency management</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-binder"><span class="doc">Binder</span></a></p></td>
</tr>
<tr class="row-even"><td><p>60 min</p></td>
<td><p><a class="reference internal" href="#document-packaging"><span class="doc">Packaging</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-cython"><span class="doc">Extending Python with Cython</span></a></p></td>
</tr>
</tbody>
</table>
<div class="toctree-wrapper compound">
<span id="document-python"></span><section id="introduction-to-python">
<h2>Introduction to Python<a class="headerlink" href="#introduction-to-python" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>What are the basic blocks of Python language?</p></li>
<li><p>How are functions and classes defined in Python?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Get a <em>very</em> short introduction to Python types and syntax</p></li>
<li><p>Be able to follow the rest of the examples in the course, even if you don’t understand everything perfectly.</p></li>
</ul>
<p>We expect everyone to be able to know the following basic material
to follow the course (though it is not <em>everything</em> you need to
know about Python).</p>
</div>
<p>If you are not familiar with Python, here is a <em>very</em> short
introduction.  It will not be enough to do everything in this course,
but you will be able to follow along a bit more than you would otherwise.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This page contains an overview of the basics of Python.  You can
also refer to <a class="reference external" href="https://coderefinery.github.io/data-visualization-python/python-basics/">This Python overview from a different lesson</a>
which is slightly more engaging.</p>
</div>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Link to this heading"></a></h3>
<p>Scalar types, that is, single elements of various types:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">42</span>       <span class="c1"># integer</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">77</span>    <span class="c1"># Integers have arbitrary precision</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">3.14</span>     <span class="c1"># floating point number</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="n">j</span>   <span class="c1"># Complex number</span>
<span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>     <span class="c1"># boolean</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Hello!&quot;</span> <span class="c1"># String (Unicode)</span>
<span class="n">q</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Hello&#39;</span> <span class="c1"># bytes (8-bit values)</span>
</pre></div>
</div>
<p>Read more: <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
</section>
<section id="collections">
<h3>Collections<a class="headerlink" href="#collections" title="Link to this heading"></a></h3>
<p>Collections are data structures capable of storing multiple values.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>                      <span class="c1"># list</span>
<span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                               <span class="c1"># lists are indexed by int</span>
<span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>                        <span class="c1"># list elements can be any type</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Janne&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;Richard&quot;</span><span class="p">:</span> <span class="mi">456</span><span class="p">}</span> <span class="c1"># dictionary</span>
<span class="n">d</span><span class="p">[</span><span class="s2">&quot;Janne&quot;</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;cherry&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">))</span> <span class="c1"># Set of unique values</span>
<span class="n">s</span>
</pre></div>
</div>
<p>Read more: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a>.</p>
</section>
<section id="control-structures">
<h3>Control structures<a class="headerlink" href="#control-structures" title="Link to this heading"></a></h3>
<p>Python has the usual control structures, that is conditional
statements and loops.  For example, the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#if" title="(in Python v3.14)"><span>The if statement</span></a> statement:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x is 3&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x is 2&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x is something else&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#while" title="(in Python v3.14)"><span class="xref std std-ref">While</span></a> loops loop until some condition is met:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">42</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x is &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mf">0.2</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#for" title="(in Python v3.14)"><span class="xref std std-ref">For</span></a> loops loop over some collection of values:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Often you want to loop over a sequence of integers, in that case the
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#range" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> function is useful:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Another common need is to iterate over a collection, but at the same
time also have an index number. For this there is the <a class="reference external" href="https://docs.python.org/3/library/functions.html#enumerate" title="(in Python v3.14)"><code class="xref py py-func docutils literal notranslate"><span class="pre">enumerate()</span></code></a>
function:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="functions-and-classes">
<h3>Functions and classes<a class="headerlink" href="#functions-and-classes" title="Link to this heading"></a></h3>
<p>Python functions are defined by the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#def" title="(in Python v3.14)"><span>Function definitions</span></a> keyword. They take a
number of arguments, and return a number of return values.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Say hello to the person given by the argument&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>

<span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Anne&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Classes are defined by the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#class" title="(in Python v3.14)"><span>Class definitions</span></a> keyword:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Hello</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">Hello</span><span class="p">(</span><span class="s2">&quot;Richard&quot;</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">say</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="python-type-system">
<h3>Python type system<a class="headerlink" href="#python-type-system" title="Link to this heading"></a></h3>
<p>Python is strongly and dynamically typed.</p>
<p>Strong here means, roughly, that it’s not possible to circumvent the
type system (at least, not easily, and not without invoking undefined
behavior).</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;hello&quot;</span>
</pre></div>
</div>
<p>Dynamic typing means that types are determined at runtime, and a
variable can be redefined to refer to an instance of another type:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
</pre></div>
</div>
<p><em>Jargon</em>: Types are associated with rvalues, not lvalues. In
statically typed language, types are associated with lvalues, and are
(typically) reified during compilation.</p>
<p>??? (lesson here)</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Python offers a nice set of basic types as many other programming languages</p></li>
<li><p>Python is strongly typed and dynamically typed</p></li>
</ul>
</div>
</section>
</section>
<span id="document-jupyter"></span><section id="jupyter">
<h2>Jupyter<a class="headerlink" href="#jupyter" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>What is the purpose of a “Computational narrative”?</p></li>
<li><p>What role does Jupyter play in development?</p></li>
<li><p>When is Jupyter not a good tool?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<p>This part will be too easy for some people, and slow for others.  Still, we need to take some time to get everyone on the same page.</p>
<ul class="simple">
<li><p>Be able to use Jupyter to run examples for the rest of the course.</p></li>
<li><p>Be able to run Jupyter in a directory do your own work.</p></li>
<li><p>You won’t be a Jupyter expert after this, but should be able to do the rest of the course.</p></li>
</ul>
</div>
<section id="what-is-jupyter">
<h3>What is Jupyter?<a class="headerlink" href="#what-is-jupyter" title="Link to this heading"></a></h3>
<p>Jupyter is a web-based interactive computing system.  It is most well known for having the <em>notebook file format</em> and Jupyter Notebook / Jupyter Lab.  A notebook format contains both the input and the output of the code along documentation, all interleaved to create what is called a <em>computational narrative</em>.</p>
<p>Jupyter is good for data exploration and interactive work.</p>
<p><strong>We use Jupyter a lot in this course because it is a good way that everyone can follow along, and minimizes the differences between operating systems.</strong></p>
</section>
<section id="getting-started-with-jupyter">
<h3>Getting started with Jupyter<a class="headerlink" href="#getting-started-with-jupyter" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Start JupyterLab: there are different ways, depending on how you installed it.  See the <a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/installation/">installation instructions</a>.  If JupyterLab isn’t working yet, you have some time to try to follow the installation instructions now.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-0-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button><button aria-controls="panel-0-T3RoZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-T3RoZXI=" name="T3RoZXI=" role="tab" tabindex="-1">Other</button></div><div aria-labelledby="tab-0-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-0-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><p>This is the command line method we went though in our installation instructions.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TGludXggLyBNYWNPUw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tab" tabindex="0">Linux / MacOS</button><button aria-controls="panel-1-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-1-TGludXggLyBNYWNPUw==" class="sphinx-tabs-panel group-tab" id="panel-1-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>~/miniforge3/bin/activate
<span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
<span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
</div><div aria-labelledby="tab-1-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>Start the Miniforge Prompt applicaiton first, then:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
<span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
</div></div>
</div><div aria-labelledby="tab-0-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p>If you install the full Anaconda distribution, start the Anaconda Navigator. Make sure the <code class="docutils literal notranslate"><span class="pre">python-for-scicomp</span></code> environment is selected and you can start JupyterLab.</p>
</div><div aria-labelledby="tab-0-T3RoZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-T3RoZXI=" name="T3RoZXI=" role="tabpanel" tabindex="0"><p>If you have installed Python and the workshop’s requiremnts some other way, you hopefully know how to activate that Python and the Python for SciComp software environment and start JupyterLab.</p>
<p>If not, see the <a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/installation/">installation instructions</a>.</p>
</div></div>
<p>For practical purposes, JupyterLab is an integrated development environment that combines file browsing, notebooks, and code editing.  There are many extensions that let you do whatever you may need.</p>
<p>Here, we see a tour of the JupyterLab interface:</p>
<p><img alt="Main UI tour" src="_images/main-ui.png" /></p>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-exercises-jupyter-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercises: Jupyter-1</p>
<p>If you aren’t set up with JupyterLab yet or these things don’t work, use this time to see the <a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/installation/">installation instructions</a> and ask us any questions you may have.</p>
<ol class="arabic simple">
<li><p>Start Jupyter in the directory you want to use for this course.</p>
<ul class="simple">
<li><p>If you are using Miniforge from the command line, you can navigate with <code class="docutils literal notranslate"><span class="pre">cd</span></code> to a directory of your choice.</p></li>
<li><p>If you are starting from the Anaconda Navigator, change to the directory you want to use.</p></li>
</ul>
</li>
<li><p>Create a Python 3 notebook file.  Save it.  In the next section, you will add stuff to it.</p></li>
<li><p>(optional, but will be done in future lessons) Explore the file browser, try making some non-notebook text/py/md files and get used to that.</p></li>
<li><p>(optional, advanced) Look at the notebook file in a text
editor.  How does it work?</p></li>
</ol>
<p>If everything works for you, this will end very quickly.  You can begin reading the next sections independently.</p>
</div>
</section>
<section id="running-code-in-jupyter">
<h3>Running code in Jupyter<a class="headerlink" href="#running-code-in-jupyter" title="Link to this heading"></a></h3>
<p>A notebook is divided into <strong>cells</strong>.  Each cell has some <strong>input</strong>, and when it is executed an <strong>output</strong> appears right below it.</p>
<p>There are different types of cells: primarily <strong>code</strong> cells and <strong>markdown</strong> cells.  You can switch between them with the menu bar above.  Code cells run whatever language your notebook uses.  Markdown is a lightweight way of giving <em>style</em> to <code class="docutils literal notranslate"><span class="pre">text</span></code> - you can check out <a class="reference external" href="https://commonmark.org/help/">this reference</a>. For example the previous sentence is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Markdown is a lightweight way of giving *style* to `text` - you 
can check out [this reference](https://commonmark.org/help/).
</pre></div>
</div>
<p><img alt="notebook UI" src="_images/notebook-ui.png" /></p>
<p>When using keyboard shortcuts, you can switch between edit mode and command mode with <code class="docutils literal notranslate"><span class="pre">Enter</span></code> and <code class="docutils literal notranslate"><span class="pre">Esc</span></code>.</p>
<p>You enter code in a cell, and push the run button to run it.  There are also some important shortcut keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Ctrl-Enter</span></code>: Run cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Shift-Enter</span></code>: Run cell and select cell below</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Alt-Enter</span></code>: Run cell and insert new cell below</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> / <code class="docutils literal notranslate"><span class="pre">b</span></code>: insert new cell above/below</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code> / <code class="docutils literal notranslate"><span class="pre">y</span></code>: markdown cell / code cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code>: cut cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>: copy cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v</span></code>: paste cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d,</span> <span class="pre">d</span></code>: delete cell</p></li>
</ul>
<p>Now, let’s look at some code samples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
1
2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>By convention, if the last thing in a cell is an object, that object gets printed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>45
</pre></div>
</div>
</div>
</div>
<p>In addition to raw cells, there are <strong>magics</strong>, which exist outside of Python.  They are a property of the runtime itself (in Python’s case, they come from <strong>IPython</strong>.  For example, the following cell magic <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit">%%timeit</a> will use the <a class="reference external" href="https://docs.python.org/3/library/timeit.html#module-timeit" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">timeit</span></code></a> module to time a cell by running it multiple times):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%timeit</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
    <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>54.1 ms ± 993 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<p>Another example is <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#cellmagic-bash">%%bash</a> which will turn the cell into a shell script (This will only work on operating systems with the Bash shell installed - MacOS and Linux at least):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
for x in $(seq 3) ; do
    echo $x
done
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
2
3
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>A <strong>cell magic</strong> starts with <code class="docutils literal notranslate"><span class="pre">%%</span></code>, goes on the first line of a cell, and applies to the whole cell</p></li>
<li><p>A <strong>line magic</strong> starts with <code class="docutils literal notranslate"><span class="pre">%</span></code>, goes on any line, and applies to that line.</p></li>
</ul>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-exercises-jupyter-2 exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercises: Jupyter-2</p>
<ol class="arabic simple">
<li><p>Run some trivial code, such as <code class="docutils literal notranslate"><span class="pre">print(1)</span></code>.</p></li>
<li><p>Run some slightly less trivial code, like print out the first
ten <a class="reference external" href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci numbers</a>.</p></li>
<li><p>Make a Markdown cell above your code cell and give it a title and some description of your function.  Use the <a class="reference external" href="https://commonmark.org/help/">reference</a> to add a heading, bullet list, and some (bold, italic, or inline code)</p></li>
<li><p>Use the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit">%%timeit</a> magic function to time your Fibonacci
function.</p></li>
<li><p>Again using <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code>, figure out the fastest way to sum the
numbers 0 to 1000000.</p></li>
<li><p>Once you are done, close your notebooks and other tabs you don’t need.  Check the running sessions (hint: thin left sidebar) and shut down these kernels.</p></li>
</ol>
</div>
<div class="admonition-solutions-jupyter-2 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solutions: Jupyter-2</p>
<ol class="arabic">
<li><p>–</p></li>
<li><p>Simple fibonacci code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
</pre></div>
</div>
</li>
<li><p>Markdown description</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh"># Fibonacci</span>
<span class="k">*</span><span class="w"> </span>Start with two variables <span class="sb">`a`</span> and <span class="sb">`b`</span>
<span class="k">*</span><span class="w"> </span>Repeat 10 times
<span class="w">    </span><span class="k">*</span><span class="w"> </span>Print old <span class="sb">`a`</span>, then increment both
<span class="k">*</span><span class="w"> </span>Makes use of the Python <span class="ge">*tuple assignment*</span>: <span class="sb">`a, b = new_a, new_b`</span>
</pre></div>
</div>
</li>
<li><p>In this case, the print() statements get out of hand, so we comment that out.  In general, writing output usually takes a lot of time reletive to the computation, so we don’t want to time that (unless output is the main point of the code, then we do have to time it!</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="o">%%timeit</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1">#print(a)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>395 ns ± 10.2 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</li>
<li><p>–</p></li>
<li><p>–</p></li>
</ol>
</div>
</section>
<section id="why-jupyter">
<h3>Why Jupyter?<a class="headerlink" href="#why-jupyter" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Being able to <strong>edit, check, re-edit</strong> quickly is great for <strong>prototyping and testing new ideas</strong></p>
<ul>
<li><p>Tends to be best either at the very beginning (getting started) or data analysis/plotting phases.</p></li>
</ul>
</li>
<li><p>You can make a <strong>complete story</strong> - in one place.  No more having code, figures, and description in different places.</p>
<ul>
<li><p>Instead of sending plots to your advisor, send plots, the text there, and possibility of checking the code, too.</p></li>
</ul>
</li>
<li><p>Notebook as an interactive publication itself - for example the discovery of gravitational waves data is <a class="reference external" href="https://www.gw-openscience.org/tutorials/">released as a notebook</a>.</p></li>
<li><p>Jupyter Notebooks display on Github - low-barrier way to share your analysis.</p></li>
<li><p>Teaching - great for getting difficult software distribution out of the way.</p></li>
</ul>
</section>
<section id="why-not-jupyter">
<h3>Why not Jupyter?<a class="headerlink" href="#why-not-jupyter" title="Link to this heading"></a></h3>
<p>Jupyter is great for many things, but there are some problems if not used well:</p>
<ul class="simple">
<li><p>They <strong>don’t promote modularity</strong>, and once you get started in a
notebook it can be hard to migrate to modules.</p></li>
<li><p>They are <strong>difficult to test</strong>.  There are things to run notebooks as
unit tests like <a class="reference external" href="https://nbval.readthedocs.io/">nbval</a>, but it’s not
perfect.</p></li>
<li><p>Notebooks can be <strong>version controlled</strong>
(<a class="reference external" href="https://nbdime.readthedocs.io/">nbdime</a> helps with that), but
there are <strong>still limitations</strong>.</p></li>
<li><p>You can <strong>change code after you run it</strong> and run code out of order.
This can make debugging hard and results irreproducible if you
aren’t careful.</p></li>
<li><p>Notebooks <strong>aren’t named by default</strong> and tend to <strong>acquire a bunch of
unrelated stuff</strong>.  Be careful with organization!</p></li>
<li><p>Once lots of code is in notebooks, it can be <strong>hard to change to
proper programs that can be scripted</strong>.</p></li>
</ul>
<p>You can read more about these downsides <a class="reference external" href="https://scicomp.aalto.fi/scicomp/jupyter-pitfalls/">https://scicomp.aalto.fi/scicomp/jupyter-pitfalls/</a>.</p>
<p><strong>But these downsides aren’t specific to Jupyter!</strong>  They can easily happen in other sources, too.  By studying these, you can make any code better, and find the right balance for what you do.</p>
</section>
<section id="exercises-3">
<h3>Exercises 3<a class="headerlink" href="#exercises-3" title="Link to this heading"></a></h3>
<div class="admonition-exercises-jupyter-3 exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercises: Jupyter-3</p>
<p>(optional) Discuss the following in groups:</p>
<ol class="arabic simple">
<li><p>Have any of you used Jupyter in a way that became impossible to
maintain: too many files, code all spread out, not able to find
your code and run it in the right order.  How did you solve that?</p></li>
<li><p>On the other hand, what are your successes with Jupyter?</p></li>
<li><p>How can you prevent these problems by better development strategies?</p></li>
</ol>
</div>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The <a class="reference external" href="https://coderefinery.github.io/jupyter/">CodeRefinery Jupyter lesson</a> has much more, and the source of some of the content above.</p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Jupyter is powerful and can be used for interactive work</p></li>
<li><p>… but not the end solution when you need to scale up.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-numpy"></span><section id="numpy">
<span id="id1"></span><h2>NumPy<a class="headerlink" href="#numpy" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Why use NumPy instead of pure python?</p></li>
<li><p>How to use basic NumPy?</p></li>
<li><p>What is vectorization?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand the Numpy array object</p></li>
<li><p>Be able to use basic NumPy functionality</p></li>
<li><p>Understand enough of NumPy to seach for answers to the rest of your questions ;)</p></li>
</ul>
<p>We expect most people to be able to do all the basic exercises
here.  It is probably quite easy for many people; we have advanced
exercises at the end in that case.</p>
</div>
<p>NumPy is the most used library for scientific computing.
Even if you are not using it directly, chances are high that some library uses it in the background.
NumPy provides the high-performance multidimensional array object and tools to use it.</p>
<section id="what-is-an-array">
<h3>What is an array?<a class="headerlink" href="#what-is-an-array" title="Link to this heading"></a></h3>
<p>So, we already know about python lists, and that we can put different types of
data in the same list. For example, consider
<code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2.5,</span> <span class="pre">'asdf',</span> <span class="pre">False,</span> <span class="pre">[1.5,</span> <span class="pre">True]]</span></code>.
This is a Python list but it has different types for every element.
This makes them very flexible, but this comes at a cost: if we want to do
something to each element in the list, for example “add 1”, we need to consider
each element one-by-one, because “add 1” means something different if the item
is a number then when it is a string, or a sub-list. In scientific usage, we
want to be able to quickly perform operations on large groups of elements at
once, which is what NumPy arrays are optimized for.</p>
<p>An array is a ‘grid’ of values, with all the same type. It is indexed by tuples of
non negative indices and provides the framework for multiple
dimensions.  An array has:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.dtypes.html#arrays-dtypes" title="(in NumPy v2.3)"><span class="xref std std-ref">dtype</span></a> - data type.  Arrays always contain one type</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/glossary.html#term-shape" title="(in NumPy v2.3)"><span class="xref std std-term">shape</span></a> - shape of the data, for example <code class="docutils literal notranslate"><span class="pre">3×2</span></code> or <code class="docutils literal notranslate"><span class="pre">3×2×500</span></code> or even
<code class="docutils literal notranslate"><span class="pre">500</span></code> (one dimensional) or <code class="docutils literal notranslate"><span class="pre">()</span></code> (zero dimensional).</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.data.html#numpy.ndarray.data" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a> - raw data storage in memory.  This can be passed to C or
Fortran code for efficient calculations.</p></li>
</ul>
<p>To test the performance of pure Python vs NumPy we can write in our jupyter notebook:</p>
<p>Create one list and one ‘empty’ list, to store the result in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>In a new cell starting with <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code>, loop through the list <code class="docutils literal notranslate"><span class="pre">a</span></code> and fill the second list <code class="docutils literal notranslate"><span class="pre">b</span></code> with <code class="docutils literal notranslate"><span class="pre">a</span></code> squared</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
  <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>That looks and feels quite fast. But let’s take a look at how NumPy performs for the same task.</p>
<p>So for the NumPy example, create one array and one ‘empty’ array to store the result in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>In a new cell starting with <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code>, fill <code class="docutils literal notranslate"><span class="pre">b</span></code> with <code class="docutils literal notranslate"><span class="pre">a</span></code> squared</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>We see that compared to working with numpy arrays, working with traditional python lists is actually slow.</p>
</section>
<section id="creating-arrays">
<h3>Creating arrays<a class="headerlink" href="#creating-arrays" title="Link to this heading"></a></h3>
<p>There are different ways of creating arrays (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.array()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray.shape</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.size.html#numpy.ndarray.size" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray.size</span></code></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>               <span class="c1"># 1-dimensional array (rank 1)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>     <span class="c1"># 2-dimensional array (rank 2)</span>

<span class="n">b</span><span class="o">.</span><span class="n">shape</span>                             <span class="c1"># the shape (rows,columns)</span>
<span class="n">b</span><span class="o">.</span><span class="n">size</span>                              <span class="c1"># number of elements</span>
</pre></div>
</div>
<p>In addition to above ways of creating arrays, there are many other ways of creating arrays depending on content (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.zeros()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ones.html#numpy.ones" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.ones()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.full.html#numpy.full" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.full()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.eye()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.arange.html#numpy.arange" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.arange()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.linspace()</span></code></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>             <span class="c1"># 2x3 array with all elements 0</span>
<span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>               <span class="c1"># 1x2 array with all elements 1</span>
<span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>             <span class="c1"># 2x2 array with all elements 7</span>
<span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                    <span class="c1"># 2x2 identity matrix</span>

<span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>                <span class="c1"># Evenly spaced values in an interval</span>
<span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>          <span class="c1"># same as above, see exercise</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;bool&#39;</span><span class="p">)</span>  <span class="c1"># 3x2 boolean array</span>
</pre></div>
</div>
<p>Arrays can also be stored and read from a (.npy) file (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.save()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.load.html#numpy.load" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.load()</span></code></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;x.npy&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>           <span class="c1"># save the array a to a .npy file</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;x.npy&#39;</span><span class="p">)</span>          <span class="c1"># load an array from a .npy file and store it in variable x</span>
</pre></div>
</div>
<p>In many occasions (especially when something goes different than expected) it is useful to check and control the datatype of the array (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.dtype.html#numpy.ndarray.dtype" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray.dtype</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.astype.html#numpy.ndarray.astype" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.ndarray.astype()</span></code></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">dtype</span>                    <span class="c1"># datatype of the array</span>
<span class="n">d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>            <span class="c1"># change datatype from boolean to integer</span>
</pre></div>
</div>
<p>In the last example, <code class="docutils literal notranslate"><span class="pre">.astype('int')</span></code>, it will make a <strong>copy</strong> of the
array, and re-allocate data - unless the dtype is exactly the same as
before.  Understanding and minimizing copies is one of the most
important things to do for speed.</p>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercises: Numpy-1</p>
<ol class="arabic simple">
<li><p><strong>Datatypes</strong> Try out <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.arange.html#numpy.arange" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.arange(10)</span></code></a> and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.linspace(0,9,10)</span></code></a>, what is the difference? Can you adjust one to do the same as the other?</p></li>
<li><p><strong>Datatypes</strong> Create a 3x2 array of random float numbers (check <a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.random.html#numpy.random.random" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.random.random()</span></code></a>) between 0 and 1. Now change the arrays datatype to int (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.astype.html#numpy.ndarray.astype" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.astype</span></code></a>). How does the array look like?</p></li>
<li><p><strong>Reshape</strong> Create a 3x2 array of random integer numbers between 0 and 10. Change the shape of the array (check <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.reshape.html#numpy.ndarray.reshape" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.reshape</span></code></a>) in any way possible. What is not possible?</p></li>
<li><p><strong>NumPyI/O</strong> Save above array to .npy file (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.save()</span></code></a>) and read it in again.</p></li>
</ol>
</div>
<div class="admonition-solutions-numpy-1 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solutions: Numpy-1</p>
<ol class="arabic simple">
<li><p><strong>Datatypes</strong></p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">np.arange(10)</span></code> results in <code class="docutils literal notranslate"><span class="pre">array([0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5,</span> <span class="pre">6,</span> <span class="pre">7,</span> <span class="pre">8,</span> <span class="pre">9])</span></code> with dtype <strong>int64</strong>,</p></li>
<li><p>while <code class="docutils literal notranslate"><span class="pre">np.linspace(0,9,10)</span></code> results in <code class="docutils literal notranslate"><span class="pre">array([0.,</span> <span class="pre">1.,</span> <span class="pre">2.,</span> <span class="pre">3.,</span> <span class="pre">4.,</span> <span class="pre">5.,</span> <span class="pre">6.,</span> <span class="pre">7.,</span> <span class="pre">8.,</span> <span class="pre">9.])</span></code> with dtype <strong>float64</strong>.</p></li>
</ul>
<p>Both <code class="docutils literal notranslate"><span class="pre">np.linspace</span></code> and <code class="docutils literal notranslate"><span class="pre">np.arange</span></code> take dtype as an argument and can be adjusted to match each other in that way.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Datatypes</strong> eg <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">np.random.random((3,2))</span></code>. <code class="docutils literal notranslate"><span class="pre">a.astype('int')</span></code> results in an all zero array, not as maybe expected the rounded int (all numbers [0, 1) are cast to 0).</p></li>
<li><p><strong>Reshape</strong> eg <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">np.random.randint(0,10,(3,2))</span></code>.</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">b.reshape((6,1))</span></code> and <code class="docutils literal notranslate"><span class="pre">b.reshape((2,3))</span></code> possible.</p>
<p>It is not possible to reshape to shapes using more or less elements than <code class="docutils literal notranslate"><span class="pre">b.size</span> <span class="pre">=</span> <span class="pre">6</span></code>, so for example <code class="docutils literal notranslate"><span class="pre">b.reshape((12,1))</span></code> gives an error.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p><strong>NumPyI/O</strong> <code class="docutils literal notranslate"><span class="pre">np.save('x.npy',</span> <span class="pre">b)</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">np.load('x.npy')</span></code></p></li>
</ol>
</div>
</section>
<section id="array-maths-and-vectorization">
<h3>Array maths and vectorization<a class="headerlink" href="#array-maths-and-vectorization" title="Link to this heading"></a></h3>
<p>Clearly, you can do math on arrays.  Math in NumPy is very fast because it is
implemented in C or Fortran - just like most other high-level languages such as
R, Matlab, etc do.</p>
<p>By default, basic arithmetic (<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>) in NumPy is
element-by-element.  That is, the operation is performed for each element in the
array without you having to write a loop.  We say an operation is “vectorized”
when the looping over elements is carried out by NumPy internally, which uses
specialized CPU instructions for this that greatly outperform a regular Python
loop.</p>
<p>Note that unlike Matlab, where <code class="docutils literal notranslate"><span class="pre">*</span></code> means matrix multiplication, NumPy uses
<code class="docutils literal notranslate"><span class="pre">*</span></code> to perform element-by-element multiplication and uses the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol to
perform matrix multiplication:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]])</span>

<span class="c1"># Addition</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># Matrix multiplication</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">@</span> <span class="n">b</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>Other common mathematical operations include: <code class="docutils literal notranslate"><span class="pre">-</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.subtract.html#numpy.subtract" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.subtract</span></code></a>), <code class="docutils literal notranslate"><span class="pre">*</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.multiply.html#numpy.multiply" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.multiply</span></code></a>), <code class="docutils literal notranslate"><span class="pre">/</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.divide.html#numpy.divide" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.divide</span></code></a>), <code class="docutils literal notranslate"><span class="pre">.T</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.transpose.html#numpy.transpose" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.transpose()</span></code></a>), <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.sqrt.html#numpy.sqrt" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.sqrt</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.sum.html#numpy.sum" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.sum()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.mean()</span></code></a>, …</p>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-2 exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercises: Numpy-2</p>
<p>Create the following arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1-dimensional arrays</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="c1"># TODO: similar to `x`, create another 1-dimensional array with shape (3,)</span>
<span class="c1"># y = np.array(...)</span>

<span class="c1"># 2-dimensional arrays</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="c1"># TODO: similar to `a`, create another 2-dimensional array with shape (2, 2)</span>
<span class="c1"># b = np.array(...)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Matrix multiplication</strong> What is the difference between <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.multiply.html#numpy.multiply" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.multiply</span></code></a> and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.dot.html#numpy.dot" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.dot()</span></code></a> ? Try calling these functions
with either <code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y</span></code> (1D arrays) or <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b</span></code> (2D arrays) as input and observe the behaviour.</p></li>
<li><p><strong>Axis</strong> What is the difference between <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.sum.html#numpy.sum" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.sum(a,</span> <span class="pre">axis=1)</span></code></a> vs
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.sum.html#numpy.sum" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.sum(a,</span> <span class="pre">axis=0)</span></code></a> on a two-dimensional array? What if you leave out the axis parameter?</p></li>
</ul>
</div>
<div class="admonition-solutions-numpy-2 solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solutions: Numpy-2</p>
<ul class="simple">
<li><p><strong>Matrix multiplication</strong> <code class="docutils literal notranslate"><span class="pre">np.multiply</span></code> does elementwise multiplication on two arrays. The function <code class="docutils literal notranslate"><span class="pre">np.dot</span></code> enables:
- <em>dot product</em> and returns a scalar, when both input arrays are 1 dimensional
- <em>matrix multiplication</em> and returns back a 2-dimensional array, when both the input arrays are 2 dimensional
However, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&#64;</span> <span class="pre">b</span></code> is preferred over <code class="docutils literal notranslate"><span class="pre">np.dot(a,</span> <span class="pre">b)</span></code> to express matrix multiplication.</p></li>
<li><p><strong>Axis</strong> <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> does the operation (here: <code class="docutils literal notranslate"><span class="pre">np.sum</span></code>) over each row, while axis=0 does it over each column. If axis is left out, the sum of the full array is given.</p></li>
</ul>
</div>
</section>
<section id="indexing-and-slicing">
<h3>Indexing and Slicing<a class="headerlink" href="#indexing-and-slicing" title="Link to this heading"></a></h3>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://numpy.org/doc/stable/user/basics.indexing.html#basics-indexing" title="(in NumPy v2.3)"><span class="xref std std-ref">Numpy basic indexing docs</span></a></p>
</div>
<p>NumPy has many ways to extract values out of arrays:</p>
<ul class="simple">
<li><p>You can select a single element</p></li>
<li><p>You can select rows or columns</p></li>
<li><p>You can select ranges where a condition is true.</p></li>
</ul>
<p>Clever and efficient use of these operations is a key to NumPy’s
speed: you should try to cleverly use these selectors (written in C)
to extract data to be used with other NumPy functions written in C or
Fortran.  This will give you the benefits of Python with most of the
speed of C.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># 4x4 matrix from 0 to 15</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                             <span class="c1"># first row</span>
<span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>                           <span class="c1"># first column</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>                       <span class="c1"># middle 2x2 array</span>

<span class="n">a</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>                <span class="c1"># second element of first and second row as array</span>
</pre></div>
</div>
<p>Boolean indexing on above created array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>      <span class="c1"># creates boolean matrix of same size as a</span>
<span class="n">a</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>             <span class="c1"># array with matching values of above criterion</span>

<span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>           <span class="c1"># same as above in one line</span>
</pre></div>
</div>
</section>
<section id="exercises-3">
<h3>Exercises 3<a class="headerlink" href="#exercises-3" title="Link to this heading"></a></h3>
<div class="admonition-exercise-numpy-3 exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercise: Numpy-3</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Try out the above code.</p>
<ul class="simple">
<li><p>How does <code class="docutils literal notranslate"><span class="pre">a</span></code> look like before <code class="docutils literal notranslate"><span class="pre">b</span></code> has changed and after?</p></li>
<li><p>How could it be avoided?</p></li>
</ul>
</div>
<div class="admonition-solution-numpy-3 solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution: Numpy-3</p>
<p><strong>View vs copy</strong>: The change in <code class="docutils literal notranslate"><span class="pre">b</span></code> has also changed the array <code class="docutils literal notranslate"><span class="pre">a</span></code>!
This is because <code class="docutils literal notranslate"><span class="pre">b</span></code> is merely a <em>view</em> or a <em>shallow copy</em> of a part of array <code class="docutils literal notranslate"><span class="pre">a</span></code>.  Both
variables point to the same memory. Hence, if one is changed, the other
one also changes.</p>
<p>In this example, if you need to keep the original array as is, use
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.copy.html#numpy.copy" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.copy(a)</span></code></a> or <code class="docutils literal notranslate"><span class="pre">np.copy(a[:,</span> <span class="pre">0])</span></code>
to create a new <em>deep copy</em> of the whole or a slice of array respectively,
before updating <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>NumPy’s documentation on <a class="reference external" href="https://numpy.org/doc/stable/user/quickstart.html#quickstart-copies-and-views" title="(in NumPy v2.3)"><span>Copies and views</span></a></p>
</div>
</div>
</section>
<section id="types-of-operations">
<h3>Types of operations<a class="headerlink" href="#types-of-operations" title="Link to this heading"></a></h3>
<p>There are different types of standard operations in NumPy:</p>
<p><strong>ufuncs</strong>, “<a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html#ufuncs" title="(in NumPy v2.3)"><span class="xref std std-ref">universal functions</span></a>”: These are element-by-element
functions with standardized arguments:</p>
<ul>
<li><p>One, two, or three input arguments</p></li>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code> is similar to <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.add.html#numpy.add" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">np.add(a,</span> <span class="pre">b)</span></code></a> but the ufunc
has more control.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out=</span></code> output argument, store output in this array (rather than
make a new array) - saves copying data!</p></li>
<li><p>See the <a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html">full reference</a></p></li>
<li><p>They also do <strong>broadcasting</strong> (<a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html#basics-broadcasting" title="(in NumPy v2.3)"><span class="xref std std-ref">ref</span></a>).  Can you add a 1-dimensional array of shape <cite>(3)</cite>
to an 2-dimensional array of shape <cite>(3, 2)</cite>?   With broadcasting you
can!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">a</span> <span class="o">+</span> <span class="n">b</span>                       <span class="c1"># array([[11, 12, 13],</span>
                            <span class="c1">#        [14, 15, 16]])</span>
</pre></div>
</div>
<p>Broadcasting is smart and consistent about what it does, which I’m
not clever enough to explain quickly here: <a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">the manual page on
broadcasting</a>.
The basic idea is that it expands dimensions of the smaller array so
that they are compatible in shape.</p>
</li>
</ul>
<p><strong>Array methods</strong> do something to one array:</p>
<ul>
<li><p>Some of these are the same as ufuncs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">x</span>                    <span class="c1">#  array([[ 0,  1,  2,  3],</span>
                     <span class="c1">#         [ 4,  5,  6,  7],</span>
                     <span class="c1">#         [ 8,  9, 10, 11]])</span>
<span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>              <span class="c1">#  11</span>
<span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>        <span class="c1">#  array([ 8,  9, 10, 11])</span>
<span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>        <span class="c1">#  array([ 3,  7, 11])</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Other functions</strong>: there are countless other functions covering
linear algebra, scientific functions, etc.</p>
</section>
<section id="exercises-4">
<h3>Exercises 4<a class="headerlink" href="#exercises-4" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-4 exercise important admonition" id="exercise-3">
<p class="admonition-title">Exercises: Numpy-4</p>
<ul class="simple">
<li><p><strong>In-place addition</strong>: Create an array, add it to itself using a
ufunc.</p></li>
<li><p><strong>In-place addition</strong> (advanced): Create an array of
<code class="docutils literal notranslate"><span class="pre">dtype='float'</span></code>, and an array of <code class="docutils literal notranslate"><span class="pre">dtype='int'</span></code>.  Try to use the
int array as the output argument of the first two arrays.</p></li>
<li><p><strong>Output arguments and timing</strong> Repeat the initial <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">**</span>
<span class="pre">2</span></code> example using a ufunc and time it.  Can you make
it even faster using the output argument?</p></li>
</ul>
</div>
<div class="admonition-solution-numpy-4 solution important dropdown admonition" id="solution-3">
<p class="admonition-title">Solution: Numpy-4</p>
<ul>
<li><p><strong>in-place addition</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                        <span class="c1"># get the memory-ID of x</span>
<span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>          <span class="c1"># Third argument is output array</span>
<span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>                        <span class="c1"># get the memory-ID of x</span>
                             <span class="c1"># - notice  it is the same</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">np.add()</span></code> writes the result to the output array (<code class="docutils literal notranslate"><span class="pre">out=</span></code>)
<em>and</em> the function returns that same array.</p>
</li>
<li><p><strong>Output arguments and timing</strong> In this case, on my computer, it was
actually slower (this is due to it being such a small array!):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a good example of why you always need to time things
before deciding what is best.</p>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">_</span></code> inside numbers is just for human readability and is
ignored by python.</p>
</li>
</ul>
</div>
</section>
<section id="linear-algebra-and-other-advanced-math">
<h3>Linear algebra and other advanced math<a class="headerlink" href="#linear-algebra-and-other-advanced-math" title="Link to this heading"></a></h3>
<p>In general, you use <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays</span></code></a> (n-dimensions), not <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.matrix.html#numpy.matrix" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">matrixes</span></code></a>
(specialized 2-dimensional) in NumPy.</p>
<p>Internally, NumPy doesn’t invent its own math routines: it relies on
<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">BLAS</a>
and <a class="reference external" href="https://en.wikipedia.org/wiki/LAPACK">LAPACK</a> to do this kind
of math - the same as many other languages.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/routines.linalg.html">Linear algebra in numpy</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/routines.html">Many, many other array functions</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">Scipy</a> has even
more functions</p></li>
<li><p>Many other libraries use NumPy arrays as the standard data
structure: they take data in this format, and return it similarly.
Thus, all the other packages you may want to use are compatible</p></li>
<li><p>If you need to write your own fast code in C, NumPy arrays can be
used to pass data.  This is known as <a class="reference external" href="https://docs.python.org/3/extending/">extending Python</a>.</p></li>
</ul>
</section>
<section id="additional-exercises">
<h3>Additional exercises<a class="headerlink" href="#additional-exercises" title="Link to this heading"></a></h3>
<div class="admonition-numpy-5 exercise important admonition" id="exercise-4">
<p class="admonition-title">Numpy-5</p>
<p>If you have extra time, try these out.  These are advanced and
optional, and will not be done in most courses.</p>
<ol class="arabic simple">
<li><p>Reverse a vector. Given a vector, reverse it such that the last
element becomes the first, e.g. <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">2,</span> <span class="pre">1]</span></code></p></li>
<li><p>Create a 2D array with zeros on the borders and 1 inside.</p></li>
<li><p>Create a random array with elements [0, 1), then add 10 to all
elements in the range [0.2, 0.7).</p></li>
<li><p>What is <code class="xref py py-func docutils literal notranslate"><span class="pre">np.round(0.5)</span></code>? What is <code class="docutils literal notranslate"><span class="pre">np.round(1.5)</span></code>? Why?</p></li>
<li><p>In addition to <code class="docutils literal notranslate"><span class="pre">np.round</span></code>, explore <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ceil.html#numpy.ceil" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.ceil</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.floor.html#numpy.floor" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.floor</span></code></a>,
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.trunc.html#numpy.trunc" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.trunc</span></code></a>. In particular, take note of how they behave with
negative numbers.</p></li>
<li><p>Recall the identity <span class="math notranslate nohighlight">\(\sin^2(x) + \cos^2(x) = 1\)</span>. Create a
random 4x4 array with values in the range [0, 10). Now test the
equality with <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.equal.html#numpy.equal" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.equal</span></code></a>. What result do you get with
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.allclose.html#numpy.allclose" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.allclose()</span></code></a> instead of <code class="docutils literal notranslate"><span class="pre">np.equal</span></code>?</p></li>
<li><p>Create a 1D array with 10 random elements. Sort it.</p></li>
<li><p>What’s the difference between <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.sort.html#numpy.ndarray.sort" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">np_array.sort()</span></code></a> and
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.sort.html#numpy.sort" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">np.sort(np_array)</span></code></a>?</p></li>
<li><p>For the random array in question 8, instead of sorting it, perform
an indirect sort. That is, return the list of indices which would
index the array in sorted order.</p></li>
<li><p>Create a 4x4 array of zeros, and another 4x4 array of ones. Next
combine them into a single 8x4 array with the content of the zeros
array on top and the ones on the bottom.  Finally, do the same,
but create a 4x8 array with the zeros on the left and the ones on
the right.</p></li>
<li><p>NumPy functionality Create two 2D arrays and do matrix multiplication
first manually (for loop), then using the np.dot function. Use %%timeit
to compare execution times. What is happening?</p></li>
</ol>
</div>
<div class="admonition-solution-numpy-5 solution important dropdown admonition" id="solution-4">
<p class="admonition-title">Solution Numpy-5</p>
<ol class="arabic">
<li><p>One solution is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>One solution is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">b</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span>
<span class="n">b</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],:]</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>A possible solution is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>For values exactly halfway between rounded decimal values, NumPy rounds to the nearest even value.</p></li>
<li><p>Let’s test those functions with few negative and positive values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># [-3. -2. -2. -1. -0.  0.  1.  2.  2.  3.]</span>
<span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># [-3. -2. -1. -0. -0.  1.  1.  2.  3.  3.]</span>
<span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># [-4. -3. -2. -1. -1.  0.  0.  1.  2.  3.]</span>
<span class="n">np</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># [-3. -2. -1. -0. -0.  0.  0.  1.  2.  3.]</span>
</pre></div>
</div>
</li>
<li><p>One solution is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">oo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">s2c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span><span class="n">s2c2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span><span class="n">s2c2</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Sorting the array itself, without copying it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>NumPy.sort() returns a sorted copy of an array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">np.argsort(x)</span></code></p></li>
<li><p>One solution is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">z</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">z</span><span class="p">,</span><span class="n">o</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Using numpy without numpy functionality (np.dot) in this case, is still slow.</p></li>
</ol>
</div>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/">NumPy manual</a></p>
<ul>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.html">Basic array class reference</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.indexing.html">Indexing</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html">ufuncs</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.nature.com/articles/s41586-020-2649-2">2020 Nature paper on NumPy’s role and basic concepts</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>NumPy is a powerful library every scientist using python should know about, since many other libraries also use it internally.</p></li>
<li><p>Be aware of some NumPy specific peculiarities</p></li>
</ul>
</div>
</section>
</section>
<span id="document-numpy-advanced"></span><section id="advanced-numpy">
<h2>Advanced NumPy<a class="headerlink" href="#advanced-numpy" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How can NumPy be so fast?</p></li>
<li><p>Why are some things fast and some things slow?</p></li>
<li><p>How can I control whether NumPy makes a copy or operates in-place?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand why NumPy has so many specialized functions for specific operations</p></li>
<li><p>Understand the underlying machinery of the Numpy <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> object</p></li>
<li><p>Understand when and why NumPy makes a copy of the data rather than a view</p></li>
</ul>
<p>This is intended as a follow-up to the <a class="reference internal" href="#document-numpy"><span class="doc">basic NumPy lesson</span></a>.  The intended
audience for this advanced lesson is those who have used NumPy before and
now want to learn how to get the most out of this amazing package.</p>
</div>
<p>Python, being an interpreted programming language, is quite slow. Manipulating
large amounts of numbers using Python’s build-in lists would be impractically
slow for any serious data analysis. Yet, the NumPy package can be really
fast. How does it do that? We will dive into how NumPy works behind the scenes
and use this knowledge to our advantage. This lesson also serves as an
introduction to reading the definitive work on this topic:
<a class="reference external" href="http://web.mit.edu/dvp/Public/numpybook.pdf">Guide to NumPy</a> by
Travis E. Oliphant, its initial creator.</p>
<section id="numpy-can-be-really-fast">
<h3>NumPy can be really fast<a class="headerlink" href="#numpy-can-be-really-fast" title="Link to this heading"></a></h3>
<p>Python, being an interpreted programming language, is quite slow. Manipulating
large amounts of numbers using Python’s build-in lists would be impractically
slow for any serious data analysis. Yet, the numpy package can be really fast.</p>
<p>How fast can NumPy be? Let’s race NumPy against C. The contest will be to sum
together 100 000 000 random numbers. We will give the C version below, you get
to write the NumPy version:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#define N_ELEMENTS 100000000</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N_ELEMENTS</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">N_ELEMENTS</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">rand</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RAND_MAX</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">N_ELEMENTS</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-advanced-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercises: Numpy-Advanced-1</p>
<p>Write a Python script that uses NumPy to generate 100 million (100000000)
random numbers and add them all together. Time how long it takes to execute.
Can you beat the C version?</p>
<p>If you are having trouble with this, we recommend completing the
<a class="reference internal" href="index.html#numpy"><span class="std std-ref">basic NumPy lesson</span></a> before continuing with this
advanced lesson.  If you are taking a live course - don’t
worry, watch and learn and explore some during the exercises!</p>
</div>
<div class="admonition-solutions-numpy-advanced-1 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solutions: Numpy-Advanced-1</p>
<p>The script can be implemented like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="w"> </span><span class="n">numpy</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">np</span>
<span class="n">print</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="n">_000_000</span><span class="p">).</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="the-libraries-behind-the-curtain-mkl-and-blas">
<h3>The libraries behind the curtain: MKL and BLAS<a class="headerlink" href="#the-libraries-behind-the-curtain-mkl-and-blas" title="Link to this heading"></a></h3>
<p>NumPy is fast because it outsources most of its heavy lifting to heavily
optimized math libraries, such as Intel’s <a class="reference external" href="https://www.intel.com/content/www/us/en/develop/documentation/oneapi-programming-guide/top/api-based-programming/intel-oneapi-math-kernel-library-onemkl.html">Math Kernel Library (MKL)</a>,
which are in turn derived from a Fortran library called
<a class="reference external" href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">Basic Linear Algebra Subprograms (BLAS)</a>.
BLAS for Fortran was <a class="reference external" href="https://doi.org/10.1145/355841.355847">published in 1979</a>
and is a collection of algorithms for common mathematical operations that are
performed on arrays of numbers. Algorithms such as matrix multiplication,
computing the vector length, etc. The API of the BLAS library was later
standardized, and today there are many modern implementations available. These
libraries represent over 40 years of optimizing efforts and make use of
<a class="reference external" href="https://www.youtube.com/watch?v=Pc8DfEyAxzg&amp;list=PLzLzYGEbdY5lrUYSssHfk5ahwZERojgid">specialized CPU instructions for manipulating arrays</a>.
In other words, they are <em>fast</em>.</p>
<p>One of the functions inside the BLAS library is a
<a class="reference external" href="https://www.intel.com/content/www/us/en/develop/documentation/onemkl-developer-reference-c/top/blas-and-sparse-blas-routines/blas-routines/blas-level-1-routines-and-functions/cblas-nrm2.html#cblas-nrm2">function</a>
to compute the “norm” of a vector, which is the same as computing its length, using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Pythagorean_theorem">Pythagorean theorem</a>:
<span class="math notranslate nohighlight">\(\sqrt(a[0]^2 + a[1]^2 + \ldots)\)</span>.</p>
<p>Let’s race the BLAS function versus a naive “manual” version of computing the vector norm.
We start by creating a decently long vector filled with random numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100_000_000</span><span class="p">)</span>
</pre></div>
</div>
<p>We now implement the Pythagorean theorem using basic NumPy functionality and
use <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> to record how long it takes to execute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<p>And here is the version using the specialized BLAS function <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">norm()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="numpy-tries-to-avoid-copying-data">
<h3>NumPy tries to avoid copying data<a class="headerlink" href="#numpy-tries-to-avoid-copying-data" title="Link to this heading"></a></h3>
<p>Understanding the kind of operations that are expensive (take a long time) and
which ones are cheap can be surprisingly hard when it comes to NumPy. A big
part of data processing speed is memory management. Copying big arrays takes
time, so the less of that we do, the faster our code runs. The rules of when
NumPy copies data are not trivial and it is worth your while to take a closer
look at them. This involves developing an understanding of how NumPy’s
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> datastructure works behind the scenes.</p>
<section id="an-example-matrix-transpose">
<h4>An example: matrix transpose<a class="headerlink" href="#an-example-matrix-transpose" title="Link to this heading"></a></h4>
<p>Transposing a matrix means that all rows become columns and all columns become
rows. All off-diagonal values change places. Let’s see how long NumPy’s
transpose function takes, by transposing a huge (10 000 ✕ 20 000)
<a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.rand.html#numpy.random.rand" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">rand()</span></code></a> matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">20_000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matrix `a` takes up </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">nbytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="si">}</span><span class="s1"> MB&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s time the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.transpose.html#numpy.ndarray.transpose" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transpose()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
<p>It takes mere nanoseconds to transpose 1600 MB of data! How?</p>
</section>
<section id="the-ndarray-exposed">
<h4>The ndarray exposed<a class="headerlink" href="#the-ndarray-exposed" title="Link to this heading"></a></h4>
<p>The first thing you need to know about <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> is that the
memory backing it up is always a flat 1D array. For example, a 2D matrix is
stored with all the rows concatenated as a single long vector.</p>
<img alt="_images/01_memory_layout.svg" src="_images/01_memory_layout.svg" />
<p>NumPy is faking the second dimension behind the scenes! When we request the
element at say, <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3]</span></code>, NumPy converts this to the correct index in the
long 1D array <code class="docutils literal notranslate"><span class="pre">[11]</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Converting <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3]</span></code> → <code class="docutils literal notranslate"><span class="pre">[11]</span></code> is called “raveling”</p></li>
<li><p>The reverse, converting <code class="docutils literal notranslate"><span class="pre">[11]</span></code> → <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3]</span></code> is called “unraveling”</p></li>
</ul>
</div></blockquote>
<p>The implications of this are many, so take let’s take some time to understand
it properly by writing our own <code class="docutils literal notranslate"><span class="pre">ravel()</span></code> function.</p>
</section>
</section>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-advanced-2 exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercises: Numpy-Advanced-2</p>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">ravel()</span></code> that takes the row and column of an
element in a 2D matrix and produces the appropriate index in an 1D array,
where all the rows are concatenated. See the image above to remind yourself
how each row of the 2D matrix ends up in the 1D array.</p>
<p>The function takes these inputs:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">row</span></code> The row of the requested element in the matrix as integer index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col</span></code> The column of the requested element in the matrix as integer index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_rows</span></code> The total number of rows of the matrix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_cols</span></code> The total number of columns of the matrix.</p></li>
</ul>
</div></blockquote>
<p>Here are some examples of input and desired output:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ravel(2,</span> <span class="pre">3,</span> <span class="pre">n_rows=4,</span> <span class="pre">n_cols=4)</span></code> → <code class="docutils literal notranslate"><span class="pre">11</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ravel(2,</span> <span class="pre">3,</span> <span class="pre">n_rows=4,</span> <span class="pre">n_cols=8)</span></code> → <code class="docutils literal notranslate"><span class="pre">19</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ravel(0,</span> <span class="pre">0,</span> <span class="pre">n_rows=1,</span> <span class="pre">n_cols=1)</span></code> → <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ravel(3,</span> <span class="pre">3,</span> <span class="pre">n_rows=4,</span> <span class="pre">n_cols=4)</span></code> → <code class="docutils literal notranslate"><span class="pre">15</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ravel(3_465,</span> <span class="pre">18_923,</span> <span class="pre">n_rows=10_000,</span> <span class="pre">n_cols=20_000)</span></code> → <code class="docutils literal notranslate"><span class="pre">69_318_923</span></code></p></li>
</ul>
</div></blockquote>
</div>
<div class="admonition-solutions-numpy-advanced-2 solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solutions: Numpy-Advanced-2</p>
<p>The function can be implemented like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ravel</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">row</span> <span class="o">*</span> <span class="n">n_cols</span> <span class="o">+</span> <span class="n">col</span>
</pre></div>
</div>
</div>
</section>
<section id="strides">
<h3>Strides<a class="headerlink" href="#strides" title="Link to this heading"></a></h3>
<p>As seen in the exercise, to get to the next row, we have to skip over
<code class="docutils literal notranslate"><span class="pre">n_cols</span></code> indices. To get to the next column, we can just add 1. To generalize
this code to work with an arbitrary number of dimensions, NumPy has the concept
of “strides”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">strides</span>           <span class="c1"># (64, 8)</span>
<span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">strides</span>  <span class="c1"># (13440, 2688, 448, 64, 8)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a> attribute contains for each dimension, the number of <em>bytes</em> (not array indexes) we
have to skip over to get to the next element along that dimension. For example,
the result above tells us that to get to the next row in a 4 ✕ 8 matrix, we
have to skip ahead 64 bytes. 64? Yes! We have created a matrix consisting of
double-precision floating point numbers. Each one of those bad boys takes up 8
bytes, so all the indices are multiplied by 8 to get to the proper byte in the
memory array. To move to the next column in the matrix, we skip ahead 8 bytes.</p>
<p>So now we know the mystery behind the speed of <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.transpose.html#numpy.ndarray.transpose" title="(in NumPy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transpose()</span></code></a>.  NumPy can avoid
copying any data by just modifying the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a> of the array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">20_000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span>  <span class="c1"># (160000, 8)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span>  <span class="c1"># (8, 160000)</span>
</pre></div>
</div>
<section id="another-example-reshaping">
<h4>Another example: reshaping<a class="headerlink" href="#another-example-reshaping" title="Link to this heading"></a></h4>
<p>Modifying the shape of an array through <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.reshape.html#numpy.reshape" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.reshape()</span></code></a> is also
accomplished without any copying of data by modifying the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># (80000, 8)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">strides</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># (40000, 8)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">20_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">strides</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># (80000, 16, 8)</span>
</pre></div>
</div>
</section>
</section>
<section id="exercises-3">
<h3>Exercises 3<a class="headerlink" href="#exercises-3" title="Link to this heading"></a></h3>
<div class="admonition-exercises-numpy-advanced-3 exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercises: Numpy-Advanced-3</p>
<p>A little known feature of NumPy is the <code class="docutils literal notranslate"><span class="pre">numpy.stride_tricks</span></code> module
that allows you to modify the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a> attribute directly. Playing
around with this is very educational.</p>
<ol class="arabic">
<li><p>Create your own <code class="docutils literal notranslate"><span class="pre">transpose()</span></code> function that will transpose a 2D matrix
by reversing its <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shape</span></code></a> and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a> attributes using
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.lib.stride_tricks.as_strided.html#numpy.lib.stride_tricks.as_strided" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.lib.stride_tricks.as_strided()</span></code></a>.</p></li>
<li><p>Create a (5 ✕ 100 000 000 000) array containing on the first row all
1’s, the second row all 2’s, and so on.  Start with an 1D array
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">np.array([1.,</span> <span class="pre">2.,</span> <span class="pre">3.,</span> <span class="pre">4.,</span> <span class="pre">5.])</span></code>
and modify its <code class="docutils literal notranslate"><span class="pre">shape</span></code> and <code class="docutils literal notranslate"><span class="pre">strides</span></code> attributes using
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.lib.stride_tricks.as_strided.html#numpy.lib.stride_tricks.as_strided" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.lib.stride_tricks.as_strided()</span></code></a> to obtain the desired 2D
matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]])</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="admonition-solutions-numpy-advanced-3 solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solutions: Numpy-Advanced-3</p>
<ol class="arabic">
<li><p>The <code class="docutils literal notranslate"><span class="pre">transpose()</span></code> function can be implemented like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">numpy.lib.stride_tricks</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_strided</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transpose</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">as_strided</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Testing the function on a small matrix</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before transpose:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After transpose:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><ol class="arabic" start="2">
<li><p>By setting one of the <code class="docutils literal notranslate"><span class="pre">.strides</span></code> to <cite>0</cite>, we can repeat a value
infinitely many times without using any additional memory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">numpy.lib.stride_tricks</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_strided</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">])</span>
<span class="n">as_strided</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100_000_000_000</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
</section>
<section id="a-fast-thing-a-fast-thing-a-fast-thing">
<h3>A fast thing + a fast thing = a fast thing?<a class="headerlink" href="#a-fast-thing-a-fast-thing-a-fast-thing" title="Link to this heading"></a></h3>
<p>If <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.transpose.html#numpy.transpose" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.transpose()</span></code></a> is fast, and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.reshape.html#numpy.reshape" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.reshape()</span></code></a> is fast, then
doing them both must be fast too, right?:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a large array</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">20_000</span><span class="p">)</span>
</pre></div>
</div>
<p>Measuring the time it takes to first transpose and then reshape:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="o">-</span><span class="n">r</span> <span class="mi">1</span>
<span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">40_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, the data actually had to be copied and it’s super slow (it takes
seconds instead of nanoseconds). When the array is first created, it is laid
out in memory row-by-row (see image above). The transpose left the data laid
out in memory column-by-column. To see why the copying of data was inevitable,
look at what happens to this smaller (2 ✕ 3) matrix after transposition and
reshaping. You can verify for yourself there is no way to get the final array
based on the first array and some clever setting of the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original array:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Transposed:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Transposed and then reshaped:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="copy-versus-view">
<h3>Copy versus view<a class="headerlink" href="#copy-versus-view" title="Link to this heading"></a></h3>
<p>Whenever NumPy constructs a new array by modifying the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.strides.html#numpy.ndarray.strides" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a> instead of
copying data, we create a “view”. This also happens when we select only
a portion of an existing matrix. Whenever a view is created, the
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> object will have a reference to the original array in
its <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.base.html#numpy.ndarray.base" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">base</span></code></a> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>  <span class="c1"># None</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (5, 5)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you create a large array and select only a portion of it, the large
array will stay in memory if a view was created!</p>
</div>
<p>The new array <code class="docutils literal notranslate"><span class="pre">b</span></code> object has a pointer to the same memory buffer as the array
it has been derived from:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Views are created by virtue of modifying the value of the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shape</span></code></a> attribute
and, if necessary, apply an offset to the pointer into the memory buffer so it
no longer points to the start of the buffer, but somewhere in the middle:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>   <span class="c1"># This view does not start at the beginning</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Offset:&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">)</span>  <span class="c1"># Offset: 48 bytes</span>
</pre></div>
</div>
<img alt="_images/02_views.svg" src="_images/02_views.svg" />
<p>Since the base array and its derived view share the same memory, any changes to
the data in a view also affects the data in the base array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># Original matrix was modified</span>
</pre></div>
</div>
<p>Whenever you index an array, NumPy will attempt to create a view. Whether or
not that succeeds depends on the memory layout of the array and what kind of
indexing operation was done. If no view can be created, NumPy will create a new
array and copy over the selected data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>  <span class="c1"># Select rows 0 and 2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>  <span class="c1"># None. So not a view.</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://web.mit.edu/dvp/Public/numpybook.pdf">Guide to Numpy</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/">NumPy manual</a></p>
<ul>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.html">Basic array class reference</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.indexing.html">Indexing</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html">ufuncs</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/advanced-numpy-master-stride-tricks-with-25-illustrated-exercises-923a9393ab20">Advanced NumPy: Master stride tricks with 25 illustrated exercises</a></p></li>
</ul>
</li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>The best way to make your code more efficient is to learn more about the
NumPy API and use specialized functions whenever possible.</p></li>
<li><p>NumPy will avoid copying data whenever it can. Whether it can depends on
what kind of layout the data is currently in.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-pandas"></span><section id="pandas">
<span id="id1"></span><h2>Pandas<a class="headerlink" href="#pandas" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How do I learn a new Python package?</p></li>
<li><p>How can I use pandas dataframes in my research?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn simple and some more advanced usage of pandas dataframes</p></li>
<li><p>Get a feeling for when pandas is useful and know where to find more information</p></li>
<li><p>Understand enough of pandas to be able to read its documentation.</p></li>
</ul>
</div>
<p>Pandas is a Python package that provides high-performance and easy to use
data structures and data analysis tools.
This page provides a brief overview of pandas, but the open source community
developing the pandas package has also created excellent documentation and training
material, including:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://pandas.pydata.org/getting_started.html">Getting started guide</a>
(including tutorials and a 10 minute flash intro)</p></li>
<li><p>A <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/10min.html#min">“10 minutes to Pandas”</a>
tutorial</p></li>
<li><p>Thorough <a class="reference external" href="https://pandas.pydata.org/docs/">Documentation</a> containing a user guide,
API reference and contribution guide</p></li>
<li><p>A <a class="reference external" href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">cheatsheet</a></p></li>
<li><p>A <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/cookbook.html#cookbook">cookbook</a></p></li>
</ul>
<section id="a-quick-pandas-preview">
<h3>A quick Pandas preview<a class="headerlink" href="#a-quick-pandas-preview" title="Link to this heading"></a></h3>
<button title="Run code" class="thebelab-button thebe-launch-button" onclick="initThebe()">Run code</button><p>Let’s get a flavor of what we can do with pandas (you won’t be able to follow everything yet). We will be working with an example dataset containing the passenger list from the Titanic, which is often used in Kaggle competitions and data science tutorials. First step is to load pandas:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
<p>We can download the data from <a class="reference external" href="https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv">this GitHub repository</a>
by visiting the page and saving it to disk, or by directly reading into
a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now view the dataframe to get an idea of what it contains and
print some summary statistics of its numerical data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the first 5 lines of the dataframe</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print summary statistics for each column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<p>Ok, so we have information on passenger names, survival (0 or 1), age,
ticket fare, number of siblings/spouses, etc. With the summary statistics we see that the average age is 29.7 years, maximum ticket price is 512 USD, 38% of passengers survived, etc.</p>
<p>Let’s say we’re interested in the survival probability of different
age groups. With two one-liners, we can find the average age of those
who survived or didn’t survive, and plot corresponding histograms of
the age distribution (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.groupby()</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.hist()</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Survived&quot;</span><span class="p">)[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
             <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">);</span>
</pre></div>
</div>
<p>Clearly, pandas dataframes allows us to do advanced analysis with very few commands, but it takes a while to get used to how dataframes work so let’s get back to basics.</p>
<div class="admonition-getting-help callout admonition" id="callout-0">
<p class="admonition-title">Getting help</p>
<p>Series and DataFrames have a lot functionality, but
how can we find out what methods are available and how they work? One way is to visit
the <a class="reference external" href="https://pandas.pydata.org/docs/reference/frame.html">API reference</a>
and reading through the list.
Another way is to use the autocompletion feature in Jupyter and type e.g.
<code class="docutils literal notranslate"><span class="pre">titanic[&quot;Age&quot;].</span></code> in a notebook and then hit <code class="docutils literal notranslate"><span class="pre">TAB</span></code> twice - this should open
up a list menu of available methods and attributes.</p>
<p>Jupyter also offers quick access to help pages (docstrings) which can be
more efficient than searching the internet. Two ways exist:</p>
<ul class="simple">
<li><p>Write a function name followed by question mark and execute the cell, e.g.
write <code class="docutils literal notranslate"><span class="pre">titanic.hist?</span></code> and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">ENTER</span></code>.</p></li>
<li><p>Write the function name and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">TAB</span></code>.</p></li>
<li><p>Right click and select “Show contextual help”.  This tab will
update with help for anything you click.</p></li>
</ul>
</div>
</section>
<section id="what-s-in-a-dataframe">
<h3>What’s in a dataframe?<a class="headerlink" href="#what-s-in-a-dataframe" title="Link to this heading"></a></h3>
<p>As we saw above, pandas dataframes are a powerful tool for working with tabular data.
A pandas
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a>
is composed of rows and columns:</p>
<img alt="_images/01_table_dataframe.svg" src="_images/01_table_dataframe.svg" />
<p>Each column of a dataframe is a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v2.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Series</span></code></a> object
- a dataframe is thus a collection of series:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print some information about the columns</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<p>Unlike a NumPy array, a dataframe can combine multiple data types, such as
numbers and text, but the data in each column is of the same type. So we say a
column is of type <code class="docutils literal notranslate"><span class="pre">int64</span></code> or of type <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
<p>Let’s inspect one column of the Titanic passenger list data (first downloading
and reading the titanic.csv datafile into a dataframe if needed, see above):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">Age</span>          <span class="c1"># same as above</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">])</span> <span class="c1"># a pandas Series object</span>
</pre></div>
</div>
<p>The columns have names. Here’s how to get them (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.columns.html#pandas.DataFrame.columns" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">columns</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<p>However, the rows also have names! This is what Pandas calls the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.index.html#pandas.DataFrame.index" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">index</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
<p>We saw above how to select a single column, but there are many ways of
selecting (and setting) single or multiple rows, columns and
values. We can refer to columns and rows either by their name
(<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">loc</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html#pandas.DataFrame.at" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">at</span></code></a>) or by
their index (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html#pandas.DataFrame.iloc" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iloc</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iat.html#pandas.DataFrame.iat" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iat</span></code></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>          <span class="c1"># select single value by row and column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Survived&quot;</span><span class="p">:</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>  <span class="c1"># slice the dataframe by row and column *names*</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>                      <span class="c1"># same slice as above by row and column *numbers*</span>

<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>      <span class="c1"># set single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Lam, Mr. Ali&#39;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span>           <span class="c1"># select single value by row and column *name* (fast)</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>                           <span class="c1"># select same value by row and column *number* (fast)</span>

<span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;is_passenger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># set a whole column</span>
</pre></div>
</div>
<p>Dataframes also support boolean indexing, just like we saw for <code class="docutils literal notranslate"><span class="pre">numpy</span></code>
arrays:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">]</span>
<span class="c1"># &quot;.str&quot; creates a string object from a column</span>
<span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Margaret&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>What if your dataset has missing data? Pandas uses the value <a class="reference external" href="https://numpy.org/doc/stable/reference/constants.html#numpy.nan" title="(in NumPy v2.3)"><code class="xref py py-data docutils literal notranslate"><span class="pre">numpy.nan</span></code></a>
to represent missing data, and by default does not include it in any computations.
We can find missing values, drop them from our dataframe, replace them
with any value we like or do forward or backward filling:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>                    <span class="c1"># returns boolean mask of NaN values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>                  <span class="c1"># drop missing values</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>         <span class="c1"># or how=&quot;all&quot;</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabin&quot;</span><span class="p">])</span>  <span class="c1"># only drop NaNs from one column</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                 <span class="c1"># replace NaNs with zero</span>
<span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>    <span class="c1"># forward-fill NaNs</span>
</pre></div>
</div>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-exploring-dataframes exercise important admonition" id="exercise-0">
<p class="admonition-title">Exploring dataframes</p>
<blockquote>
<div><ul class="simple">
<li><p>Have a look at the available methods and attributes using the
<a class="reference external" href="https://pandas.pydata.org/docs/reference/frame.html">API reference</a>
or the autocomplete feature in Jupyter.</p></li>
<li><p>Try out a few methods using the Titanic dataset and have a look at
the docstrings (help pages) of methods that pique your interest</p></li>
<li><p>Compute the mean age of the first 10 passengers by slicing and the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mean.html#pandas.DataFrame.mean" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.mean()</span></code></a> method</p></li>
<li><p>(Advanced) Using boolean indexing, compute the survival rate
(mean of “Survived” values) among passengers over and under the average age.</p></li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ul>
<li><p>Mean age of the first 10 passengers:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,:][</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s2">&quot;Nasser, Mrs. Nicholas (Adele Achem)&quot;</span><span class="p">,</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Survival rate among passengers over and under average age:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()][</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()][</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</section>
<section id="tidy-data">
<h3>Tidy data<a class="headerlink" href="#tidy-data" title="Link to this heading"></a></h3>
<p>The above analysis was rather straightforward thanks to the fact
that the dataset is <em>tidy</em>.</p>
<img alt="_images/tidy_data.png" src="_images/tidy_data.png" />
<p>In short, columns should be variables and rows should be measurements,
and adding measurements (rows) should then not require any changes to code
that reads the data.</p>
<p>What would untidy data look like? Here’s an example from
some run time statistics from a 1500 m running event:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 1&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">240</span><span class="p">},</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 2&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
              <span class="p">{</span><span class="s1">&#39;Runner&#39;</span><span class="p">:</span> <span class="s1">&#39;Runner 3&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">800</span><span class="p">:</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">1200</span><span class="p">:</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">1500</span><span class="p">:</span> <span class="mi">360</span><span class="p">},</span>
          <span class="p">])</span>
</pre></div>
</div>
<p>What makes this data untidy is that the column names <cite>400, 800, 1200, 1500</cite>
indicate the distance ran. In a tidy dataset, this distance would be a variable
on its own, making each runner-distance pair a separate observation and hence a
separate row.</p>
<p>To make untidy data tidy, a common operation is to “melt” it,
which is to convert it from wide form to a long form:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runners</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">runners</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Runner&quot;</span><span class="p">,</span>
              <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span>
              <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span>
              <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span>
          <span class="p">)</span>
</pre></div>
</div>
<p>In this form it’s easier to <strong>filter</strong>, <strong>group</strong>, <strong>join</strong>
and <strong>aggregate</strong> the data, and it’s also easier to model relationships
between variables.</p>
<p>The opposite of melting is to <em>pivot</em> data, which can be useful to
view data in different ways as we’ll see below.</p>
<p>For a detailed exposition of data tidying, have a look at
<a class="reference external" href="http://vita.had.co.nz/papers/tidy-data.pdf">this article</a>.</p>
</section>
<section id="working-with-dataframes">
<h3>Working with dataframes<a class="headerlink" href="#working-with-dataframes" title="Link to this heading"></a></h3>
<p>We saw above how we can read in data into a dataframe using the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> function.
Pandas also understands multiple other formats, for example using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html#pandas.read_excel" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_excel</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_hdf.html#pandas.read_hdf" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_hdf</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_json.html#pandas.read_json" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_json</span></code></a>, etc. (and corresponding methods to write to file:
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_csv</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html#pandas.DataFrame.to_excel" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_excel</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_hdf.html#pandas.DataFrame.to_hdf" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_hdf</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_json.html#pandas.DataFrame.to_json" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_json</span></code></a>, etc.)</p>
<p>But sometimes you would want to create a dataframe from scratch. Also this can be done
in multiple ways, for example starting with a numpy array (see
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> docs):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
<p>or a dictionary (see same docs):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                   <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
                   <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)})</span>
<span class="n">df</span>
</pre></div>
</div>
<p>There are many ways to operate on dataframes. Let’s look at a
few examples in order to get a feeling of what’s possible
and what the use cases can be.</p>
<p>We can easily split and <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html#pandas.concat" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">concatenate</span></code></a> dataframes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">,</span> <span class="n">sub3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">,</span> <span class="n">sub3</span><span class="p">])</span>
</pre></div>
</div>
<p>When pulling data from multiple dataframes, a powerful <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas.DataFrame.merge" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.DataFrame.merge</span></code></a> method is
available that acts similarly to merging in SQL. Say we have a dataframe containing the age of some athletes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 4&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;Runner&quot;</span><span class="p">:</span> <span class="s2">&quot;Runner 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">},</span>
<span class="p">])</span>
</pre></div>
</div>
<p>We now want to use this table to annotate the original <code class="docutils literal notranslate"><span class="pre">runners</span></code> table from
before with their age. Note that the <code class="docutils literal notranslate"><span class="pre">runners</span></code> and <code class="docutils literal notranslate"><span class="pre">age</span></code> dataframes have a
different ordering to it, and <code class="docutils literal notranslate"><span class="pre">age</span></code> has an entry for <code class="docutils literal notranslate"><span class="pre">Dave</span></code> which is not
present in the <code class="docutils literal notranslate"><span class="pre">runners</span></code> table. We can let Pandas deal with all of it using
the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html#pandas.DataFrame.merge" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">merge</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the age for each runner</span>
<span class="n">runners</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Runner&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In fact, much of what can be done in SQL
<a class="reference external" href="https://pandas.pydata.org/docs/getting_started/comparison/comparison_with_sql.html">is also possible with pandas</a>.</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">groupby</span></code></a> is a powerful method which splits a dataframe and aggregates data
in groups. To see what’s possible, let’s return to the Titanic dataset. Let’s
test the old saying “Women and children first”. We start by creating a new
column <code class="docutils literal notranslate"><span class="pre">Child</span></code> to indicate whether a passenger was a child or not, based on
the existing <code class="docutils literal notranslate"><span class="pre">Age</span></code> column. For this example, let’s assume that you are a
child when you are younger than 12 years:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Now we can test the saying by grouping the data on <code class="docutils literal notranslate"><span class="pre">Sex</span></code> and then creating further sub-groups based on <code class="docutils literal notranslate"><span class="pre">Child</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span> <span class="s2">&quot;Child&quot;</span><span class="p">])[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we chose to summarize the data by its mean, but many other common
statistical functions are available as dataframe methods, like
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.std.html#pandas.DataFrame.std" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">std</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.min.html#pandas.DataFrame.min" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">min</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.max.html#pandas.DataFrame.max" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">max</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cumsum</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.median.html#pandas.DataFrame.median" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">median</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.skew.html#pandas.DataFrame.skew" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">skew</span></code></a>,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.var.html#pandas.DataFrame.var" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">var</span></code></a> etc.</p>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-analyze-the-titanic-passenger-list-dataset exercise important admonition" id="exercise-1">
<p class="admonition-title">Analyze the Titanic passenger list dataset</p>
<blockquote>
<div><p>In the Titanic passenger list dataset,
investigate the family size of the passengers (i.e. the “SibSp” column).</p>
<ul class="simple">
<li><p>What different family sizes exist in the passenger list? Hint: try the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.unique.html#pandas.Series.unique" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unique()</span></code></a> method</p></li>
<li><p>What are the names of the people in the largest family group?</p></li>
<li><p>(Advanced) Create histograms showing the distribution of family sizes for
passengers split by the fare, i.e. one group of high-fare passengers (where
the fare is above average) and one for low-fare passengers
(Hint: instead of an existing column name, you can give a lambda function
as a parameter to <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hist()</span></code></a> to compute a value on the fly. For example
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">df[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">df[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;</span></code>).</p></li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<ul>
<li><p>Existing family sizes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;SibSp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>We get 8 from above.  There is no <code class="docutils literal notranslate"><span class="pre">Name</span></code> column, since we
made <code class="docutils literal notranslate"><span class="pre">Name</span></code> the index when we loaded the dataframe with
<code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, so we use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.index.html#pandas.DataFrame.index" title="(in pandas v2.3.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pandas.DataFrame.index</span></code></a> to get
the names.  So, names of members of largest family(ies):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;SibSp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</li>
<li><p>Histogram of family size based on fare class:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s2">&quot;SibSp&quot;</span><span class="p">,</span>
             <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Poor&quot;</span> <span class="k">if</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;Rich&quot;</span><span class="p">,</span>
             <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</section>
<section id="time-series-superpowers">
<h3>Time series superpowers<a class="headerlink" href="#time-series-superpowers" title="Link to this heading"></a></h3>
<p>An introduction of pandas wouldn’t be complete without mention of its
special abilities to handle time series. To show just a few examples,
we will use a new dataset of Nobel prize laureates available through
an API of the Nobel prize organisation at
<a class="reference external" href="https://api.nobelprize.org/v1/laureate.csv">https://api.nobelprize.org/v1/laureate.csv</a> .</p>
<p>Unfortunately this API does not allow “non-browser requests”, so
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pandas.read_csv</span></code></a> will not work directly on it. Instead, we put a
local copy on Github which we can access (the original data is CC-0,
so we are allowed to do this).  (Aside: if you do JupyterLab →
File → Open from URL → paste the URL above, it will open it in
JupyterLab <em>and</em> download a copy for your use.)</p>
<p>We can then load and explore the data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/AaltoSciComp/python-for-scicomp/raw/master/resources/data/laureate.csv&quot;</span><span class="p">)</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>This dataset has three columns for time, “born”/”died” and “year”.
These are represented as strings and integers, respectively, and
need to be converted to datetime format.  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html#pandas.to_datetime" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.to_datetime()</span></code></a>
makes this easy:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the errors=&#39;coerce&#39; argument is needed because the dataset is a bit messy</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas knows a lot about dates (using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#dt-accessor" title="(in pandas v2.3.3)"><span>.dt accessor</span></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span>
</pre></div>
</div>
<p>We can add a column containing the (approximate) lifespan in years rounded
to one decimal:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;lifespan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;died&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>and then plot a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.hist.html#pandas.DataFrame.hist" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">histogram</span></code></a> of lifespans:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;lifespan&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, let’s see one more example of an informative plot (<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.boxplot.html#pandas.DataFrame.boxplot" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">boxplot()</span></code></a>)
produced by a single line of code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;lifespan&quot;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises-3">
<h3>Exercises 3<a class="headerlink" href="#exercises-3" title="Link to this heading"></a></h3>
<div class="admonition-analyze-the-nobel-prize-dataset exercise important admonition" id="exercise-2">
<p class="admonition-title">Analyze the Nobel prize dataset</p>
<blockquote>
<div><ul class="simple">
<li><p>What country has received the largest number of Nobel prizes, and how many?
How many countries are represented in the dataset? Hint: use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">describe</span></code></a> method
on the <code class="docutils literal notranslate"><span class="pre">bornCountryCode</span></code> column.</p></li>
<li><p>Create a histogram of the age when the laureates received their Nobel prizes.
Hint: follow the above steps we performed for the lifespan.</p></li>
<li><p>List all the Nobel laureates from your country.</p></li>
</ul>
<p>Now more advanced steps:</p>
<ul>
<li><p>Now define an array of 4 countries of your choice and extract
only laureates from these countries (you need to look at the
data and find how countries are written, and replace <code class="docutils literal notranslate"><span class="pre">COUNTRY</span></code>
with those strings):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">COUNTRY1</span><span class="p">,</span> <span class="n">COUNTRY2</span><span class="p">,</span> <span class="n">COUNTRY3</span><span class="p">,</span> <span class="n">COUNTRY4</span><span class="p">])</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p>Use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html#pandas.DataFrame.groupby" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">groupby()</span></code></a> to compute how many nobel prizes each country received in
each category. The <code class="xref py py-meth docutils literal notranslate"><span class="pre">size()</span></code> method tells us how many rows, hence nobel
prizes, are in each group:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><strong>(Optional)</strong> Create a pivot table to view a spreadsheet like structure, and view it</p>
<blockquote>
<div><ul>
<li><p>First add a column “number” to the nobel dataframe containing 1’s
(to enable the counting below).  We need to make a copy of
<code class="docutils literal notranslate"><span class="pre">subset</span></code>, because right now it is only a view:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Then create the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html#pandas.DataFrame.pivot_table" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pivot_table()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p><strong>(Optional)</strong> Install the <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> visualization library if you don’t
already have it, and create a heatmap of your table:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p><strong>(Optional)</strong> Play around with other nice looking plots:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="s2">&quot;stick&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset_physchem</span> <span class="o">=</span> <span class="n">nobel</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;bornCountry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;physics&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="n">nobel</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;chemistry&#39;</span><span class="p">])</span>
    <span class="p">)</span>
<span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset_physchem</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;swarm&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bornCountry&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">subset_physchem</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>Below is solutions for the basic steps, advanced steps are
inline above.</p>
<p>We use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">describe()</span></code> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="o">.</span><span class="n">bornCountryCode</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># count     969</span>
<span class="c1"># unique     82</span>
<span class="c1"># top        US</span>
<span class="c1"># freq      292</span>
</pre></div>
</div>
<p>We see that the US has received the largest number of Nobel prizes,
and 82 countries are represented.</p>
<p>To calculate the age at which laureates receive their prize, we need
to ensure that the “year” and “born” columns are in datetime format:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we add a column with the age at which Nobel prize was received
and plot a histogram:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;age_nobel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;born&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nobel</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;age_nobel&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
<p>We can print names of all laureates from a given country, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nobel</span><span class="p">[</span><span class="n">nobel</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span><span class="s2">&quot;surname&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="beyond-the-basics">
<h3>Beyond the basics<a class="headerlink" href="#beyond-the-basics" title="Link to this heading"></a></h3>
<section id="faster-expression-evaluation-with-eval">
<h4>Faster expression evaluation with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.eval.html#pandas.eval" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a><a class="headerlink" href="#faster-expression-evaluation-with-eval" title="Link to this heading"></a></h4>
<p>Larger DataFrame operations might be faster using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.eval.html#pandas.eval" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> with string expressions (<a class="reference external" href="https://pandas.pydata.org/docs/user_guide/enhancingperf.html#eval-performance-comparison">see
here</a>).
To do so, we start by installing <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> a Python library which optimizes such expressions:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">conda</span> <span class="n">install</span> <span class="n">numexpr</span>
</pre></div>
</div>
<p>You may need to restart the kernel in Jupyter for this to be. Then:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Make some really big dataframes</span>
<span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">100</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Adding dataframes the pythonic way yields:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">df1</span> <span class="o">+</span> <span class="n">df2</span> <span class="o">+</span> <span class="n">df3</span> <span class="o">+</span> <span class="n">df4</span>
<span class="c1"># 80ms</span>
</pre></div>
</div>
<p>And by using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.eval.html#pandas.eval" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;df1 + df2 + df3 + df4&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;numexpr&#39;</span><span class="p">)</span>
<span class="c1"># 40ms</span>
</pre></div>
</div>
</section>
<section id="assigning-columns-with-apply">
<h4>Assigning columns with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a><a class="headerlink" href="#assigning-columns-with-apply" title="Link to this heading"></a></h4>
<p>We can assign function return lists as dataframe columns:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fibo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Fibonacci numbers. Here we skip the overhead from the</span>
<span class="sd">    recursive function calls by using a list. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Not defined for negative values&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="n">memo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">memo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">memo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">memo</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">memo</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Generation&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Rabbits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fibo</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>  <span class="c1"># Assigns list to column</span>
</pre></div>
</div>
<p>There is much more to Pandas than what we covered in this lesson. Whatever your
needs are, chances are good there is a function somewhere in its <a class="reference external" href="https://pandas.pydata.org/docs/">API</a>.  You should try to get good at
searching the web for an example showing what you can do. And when
there is not, you can always
apply your own functions to the data using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="(in pandas v2.3.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fib</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Fibonacci numbers. The @lru_cache remembers values we</span>
<span class="sd">    computed before, which speeds up this function a lot.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Not defined for negative values&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Generation&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Number of Rabbits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Generation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the numpy precision for integers caps at int64 while python ints are unbounded –
limited by memory size. Thus, the result from <code class="docutils literal notranslate"><span class="pre">fibonacci(99)</span></code> would be erroneous when
using numpy ints. The type of <code class="docutils literal notranslate"><span class="pre">df['Number</span> <span class="pre">of</span> <span class="pre">Rabbits'][99]</span></code> given by both functions above
is in fact <code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'int'&gt;</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tomaugspurger.net/posts/modern-1-intro/">Modern Pandas</a> (2020) – a blog series
on writing modern idiomatic pandas.</p></li>
<li><p><a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/index.html">Python Data Science Handbook</a> (2016) –
which contains a chapter on <cite>Data Manipulation with Pandas</cite>.</p></li>
</ul>
</div>
</section>
</section>
<section id="alternatives-to-pandas">
<h3>Alternatives to Pandas<a class="headerlink" href="#alternatives-to-pandas" title="Link to this heading"></a></h3>
<p><strong>Polars</strong></p>
<p><a class="reference external" href="https://pola.rs/">Polars</a> is a DataFrame library designed to processing data with a fast lighting time. Polars is implemented in Rust Programming language and uses <a class="reference external" href="https://arrow.apache.org/docs/format/Columnar.html">Apache Arrow</a> as its memory format.</p>
<p><strong>Dask</strong></p>
<p><a class="reference external" href="https://www.dask.org/">Dask</a> is a Python package for parallel computing in Python and uses parallel data-frames for dealing with very large arrays.</p>
<p><strong>Vaex</strong></p>
<p><a class="reference external" href="https://github.com/vaexio/vaex">Vaex</a> is a high performance Python library for lazy Out-of-Core DataFrames, to visualize and explore big tabular datasets.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>pandas dataframes are a good data structure for tabular data</p></li>
<li><p>Dataframes allow both simple and advanced analysis in very compact form</p></li>
</ul>
</div>
</section>
</section>
<span id="document-xarray"></span><section id="xarray">
<span id="id1"></span><h2>Xarray<a class="headerlink" href="#xarray" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How shall we deal with real-world datasets that are usually more than just raw numbers?</p></li>
<li><p>What is the advantage of using labelled multidimensional arrays?</p></li>
<li><p>What does Xarray add to Numpy and Pandas to address these questions?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to apply operations over dimensions and select values by label</p></li>
<li><p>Understand Xarray’s DataArrays and Datasets</p></li>
<li><p>Learn how to easily plot data in Xarray</p></li>
<li><p>Learn how to turn your own data into an Xarray Dataset</p></li>
</ul>
</div>
<p>We have already seen how Pandas simplifies working with tabular NumPy data by adding labels to columns and rows. In this lesson, we take a look at how xarray can be used to add the same functionality to multidimensional data. Let’s consider the following example:</p>
<p>Imagine we have a dataset representing temperature measurements across different heights, latitudes, and longitudes. We can store the temperature data as a 3D NumPy array where each axis corresponds to one of these dimensions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># Create a 3D numpy array: height x latitude x longitude</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 10 heights, 5 latitudes, 5 longitudes</span>
</pre></div>
</div>
<p>Let’s assume now we want to take a look at a specific value in the dataset at a certain height, latitude, and longitude. We could do this by indexing the array with the corresponding indices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the temperature at height 3, latitude 2, longitude 4</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>OK, we got a value, but how do we know whether this value corresponds to the correct height, latitude and longitude? Are we sure that latitude was the second dimension in the dataset? Was it the second or third index that corresponds to the correct position? In pure NumPy, we are mostly left in the dark and need to manually keep track of these things.</p>
<p>Unfortunately, Pandas isn’t of much help either since it is not designed for data with more than 2 dimensions. Fortunately, <a class="reference external" href="https://github.com/pydata/xarray/graphs/contributors">some clever climate scientists</a> have come up with a solution to this problem and created Xarray.</p>
<section id="what-is-xarray">
<h3>What is Xarray?<a class="headerlink" href="#what-is-xarray" title="Link to this heading"></a></h3>
<p>Xarray is a powerful Python library that introduces labelled multidimensional arrays. This means the axes have labels (=dimensions), each row/column has a label (coordinates), and labels can even have units of measurement. This makes it much easier to follow what the data in an array means and select specific portions of data.</p>
<p>We will first download a dataset similar to the example above to illustrate the advantages of Xarray. We will cover how to transform your own data into an Xarray Dataset later in this lecture.</p>
<p>Let us open a python shell and download a public dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pythia_datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">DATASETS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath</span> <span class="o">=</span> <span class="n">DATASETS</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;NARR_19930313_0000.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now import xarray and open the dataset. Le’ts take a look at what it contains:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span><span class="o">&gt;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">15</span><span class="n">MB</span>
<span class="n">Dimensions</span><span class="p">:</span>                       <span class="p">(</span><span class="n">time1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="mi">268</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">time1</span>                         <span class="p">(</span><span class="n">time1</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">1993</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
  <span class="o">*</span> <span class="n">isobaric1</span>                     <span class="p">(</span><span class="n">isobaric1</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">116</span><span class="n">B</span> <span class="mf">100.0</span> <span class="mf">125.0</span> <span class="o">...</span> <span class="mf">1e+03</span>
  <span class="o">*</span> <span class="n">y</span>                             <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">476</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.117e+03</span> <span class="o">...</span> <span class="mf">714.1</span>
  <span class="o">*</span> <span class="n">x</span>                             <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">1</span><span class="n">kB</span> <span class="o">-</span><span class="mf">3.324e+03</span> <span class="o">...</span> <span class="mf">5.343e+03</span>
<span class="n">Data</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">u</span><span class="o">-</span><span class="n">component_of_wind_isobaric</span>  <span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">4</span><span class="n">MB</span> <span class="o">...</span>
    <span class="n">LambertConformal_Projection</span>   <span class="n">int32</span> <span class="mi">4</span><span class="n">B</span> <span class="o">...</span>
    <span class="n">lat</span>                           <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float64</span> <span class="mi">255</span><span class="n">kB</span> <span class="o">...</span>
    <span class="n">lon</span>                           <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float64</span> <span class="mi">255</span><span class="n">kB</span> <span class="o">...</span>
    <span class="n">Geopotential_height_isobaric</span>  <span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">4</span><span class="n">MB</span> <span class="o">...</span>
    <span class="n">v</span><span class="o">-</span><span class="n">component_of_wind_isobaric</span>  <span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">4</span><span class="n">MB</span> <span class="o">...</span>
    <span class="n">Temperature_isobaric</span>          <span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">4</span><span class="n">MB</span> <span class="o">...</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">Originating_or_generating_Center</span><span class="p">:</span>     <span class="n">US</span> <span class="n">National</span> <span class="n">Weather</span> <span class="n">Service</span><span class="p">,</span> <span class="n">Nation</span><span class="o">...</span>
    <span class="n">Originating_or_generating_Subcenter</span><span class="p">:</span>  <span class="n">North</span> <span class="n">American</span> <span class="n">Regional</span> <span class="n">Reanalysis</span> <span class="o">...</span>
    <span class="n">GRIB_table_version</span><span class="p">:</span>                   <span class="mi">0</span><span class="p">,</span><span class="mi">131</span>
    <span class="n">Generating_process_or_model</span><span class="p">:</span>          <span class="n">North</span> <span class="n">American</span> <span class="n">Regional</span> <span class="n">Reanalysis</span> <span class="o">...</span>
    <span class="n">Conventions</span><span class="p">:</span>                          <span class="n">CF</span><span class="o">-</span><span class="mf">1.6</span>
    <span class="n">history</span><span class="p">:</span>                              <span class="n">Read</span> <span class="n">using</span> <span class="n">CDM</span> <span class="n">IOSP</span> <span class="n">GribCollection</span> <span class="n">v3</span>
    <span class="n">featureType</span><span class="p">:</span>                          <span class="n">GRID</span>
    <span class="n">History</span><span class="p">:</span>                              <span class="n">Translated</span> <span class="n">to</span> <span class="n">CF</span><span class="o">-</span><span class="mf">1.0</span> <span class="n">Conventions</span> <span class="n">by</span><span class="o">...</span>
    <span class="n">geospatial_lat_min</span><span class="p">:</span>                   <span class="mf">10.753308882144761</span>
    <span class="n">geospatial_lat_max</span><span class="p">:</span>                   <span class="mf">46.8308828962289</span>
    <span class="n">geospatial_lon_min</span><span class="p">:</span>                   <span class="o">-</span><span class="mf">153.88242040519995</span>
    <span class="n">geospatial_lon_max</span><span class="p">:</span>                   <span class="o">-</span><span class="mf">42.666108129242815</span>
</pre></div>
</div>
<p>That was a lot of information at once, but let’s break it down.</p>
<blockquote>
<div><ul class="simple">
<li><p>Close to the top of the output we see the <code class="docutils literal notranslate"><span class="pre">Dimensions</span></code> of the dataset: <code class="docutils literal notranslate"><span class="pre">time1</span></code>, <code class="docutils literal notranslate"><span class="pre">isobaric1</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p>Below the dimensions, we see the <code class="docutils literal notranslate"><span class="pre">Coordinates</span></code> of the dataset. These are for each dimension the labels for each value along that dimension. For example, we have a timestamp of each value along the first dimension (<code class="docutils literal notranslate"><span class="pre">time1</span></code>).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">variables</span></code> are the actual data stored in the dataset. We see that the dataset contains a bunch of arrays, most of which are 4-dimensional, where each dimension corresponds to one of the <code class="docutils literal notranslate"><span class="pre">Dimensions</span></code> described above. There are also some 2-dimensional arrays that only have some of the <code class="docutils literal notranslate"><span class="pre">Dimensions</span></code> described above.</p></li>
<li><p>At the bottom, we see the <code class="docutils literal notranslate"><span class="pre">Attributes</span></code> of the dataset. This is a dictionary that stores metadata about the dataset.</p></li>
</ul>
</div></blockquote>
<p>The following image shows the structure of this particular Xarray Dataset:</p>
<blockquote>
<div><img alt="_images/xarray_dataset_image.png" src="_images/xarray_dataset_image.png" />
</div></blockquote>
</section>
<section id="accessing-and-manipulating-data-in-xarray">
<h3>Accessing and manipulating data in Xarray<a class="headerlink" href="#accessing-and-manipulating-data-in-xarray" title="Link to this heading"></a></h3>
<p>An xarray <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> typically consists of multiple <code class="docutils literal notranslate"><span class="pre">DataArrays</span></code>. Our example dataset has 7 of them (<code class="docutils literal notranslate"><span class="pre">u-component_of_wind_isobaric</span></code>, <code class="docutils literal notranslate"><span class="pre">LambertConformal_Projection</span></code>, <code class="docutils literal notranslate"><span class="pre">lat</span></code>, <code class="docutils literal notranslate"><span class="pre">lon</span></code>, <code class="docutils literal notranslate"><span class="pre">Geopotential_height_isobaric</span></code>, <code class="docutils literal notranslate"><span class="pre">v-component_of_wind_isobaric</span></code>, <code class="docutils literal notranslate"><span class="pre">Temperature_isobaric</span></code>).
We can select a single <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> from the dataset using a dictionary-like syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">temperature_data</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temperature_data</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Temperature_isobaric&#39;</span> <span class="p">(</span><span class="n">time1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span>
                                          <span class="n">x</span><span class="p">:</span> <span class="mi">268</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">4</span><span class="n">MB</span>
<span class="p">[</span><span class="mi">924868</span> <span class="n">values</span> <span class="k">with</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">]</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">time1</span>      <span class="p">(</span><span class="n">time1</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">1993</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
  <span class="o">*</span> <span class="n">isobaric1</span>  <span class="p">(</span><span class="n">isobaric1</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">116</span><span class="n">B</span> <span class="mf">100.0</span> <span class="mf">125.0</span> <span class="mf">150.0</span> <span class="o">...</span> <span class="mf">950.0</span> <span class="mf">975.0</span> <span class="mf">1e+03</span>
  <span class="o">*</span> <span class="n">y</span>          <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">476</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.117e+03</span> <span class="o">-</span><span class="mf">3.084e+03</span> <span class="o">-</span><span class="mf">3.052e+03</span> <span class="o">...</span> <span class="mf">681.6</span> <span class="mf">714.1</span>
  <span class="o">*</span> <span class="n">x</span>          <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">1</span><span class="n">kB</span> <span class="o">-</span><span class="mf">3.324e+03</span> <span class="o">-</span><span class="mf">3.292e+03</span> <span class="o">...</span> <span class="mf">5.311e+03</span> <span class="mf">5.343e+03</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">long_name</span><span class="p">:</span>           <span class="n">Temperature</span> <span class="o">@</span> <span class="n">Isobaric</span> <span class="n">surface</span>
    <span class="n">units</span><span class="p">:</span>               <span class="n">K</span>
    <span class="n">description</span><span class="p">:</span>         <span class="n">Temperature</span>
    <span class="n">grid_mapping</span><span class="p">:</span>        <span class="n">LambertConformal_Projection</span>
    <span class="n">Grib_Variable_Id</span><span class="p">:</span>    <span class="n">VAR_7</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">131</span><span class="o">-</span><span class="mi">11</span><span class="n">_L100</span>
    <span class="n">Grib1_Center</span><span class="p">:</span>        <span class="mi">7</span>
    <span class="n">Grib1_Subcenter</span><span class="p">:</span>     <span class="mi">15</span>
    <span class="n">Grib1_TableVersion</span><span class="p">:</span>  <span class="mi">131</span>
    <span class="n">Grib1_Parameter</span><span class="p">:</span>     <span class="mi">11</span>
    <span class="n">Grib1_Level_Type</span><span class="p">:</span>    <span class="mi">100</span>
    <span class="n">Grib1_Level_Desc</span><span class="p">:</span>    <span class="n">Isobaric</span> <span class="n">surface</span>
</pre></div>
</div>
<p>Xarray uses Numpy(-like) arrays under the hood, we can always access the underlying Numpy array using the <code class="docutils literal notranslate"><span class="pre">.values</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">temperature_numpy</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temperature_numpy</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[[[</span><span class="mf">201.88957</span><span class="p">,</span> <span class="mf">202.2177</span> <span class="p">,</span> <span class="mf">202.49895</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">195.10832</span><span class="p">,</span> <span class="mf">195.23332</span><span class="p">,</span>
          <span class="mf">195.37395</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">201.68645</span><span class="p">,</span> <span class="mf">202.0302</span> <span class="p">,</span> <span class="mf">202.3427</span> <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">195.24895</span><span class="p">,</span> <span class="mf">195.38957</span><span class="p">,</span>
          <span class="mf">195.51457</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">201.5302</span> <span class="p">,</span> <span class="mf">201.87395</span><span class="p">,</span> <span class="mf">202.20207</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">195.37395</span><span class="p">,</span> <span class="mf">195.51457</span><span class="p">,</span>
          <span class="mf">195.63957</span><span class="p">],</span>
         <span class="o">...</span><span class="p">,</span>
         <span class="p">[</span><span class="mf">276.735</span>  <span class="p">,</span> <span class="mf">276.70374</span><span class="p">,</span> <span class="mf">276.6881</span> <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">289.235</span>  <span class="p">,</span> <span class="mf">289.1725</span> <span class="p">,</span>
          <span class="mf">289.07874</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">276.86</span>   <span class="p">,</span> <span class="mf">276.84436</span><span class="p">,</span> <span class="mf">276.78186</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">289.1881</span> <span class="p">,</span> <span class="mf">289.11</span>   <span class="p">,</span>
          <span class="mf">289.01624</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">277.01624</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">289.14124</span><span class="p">,</span> <span class="mf">289.0475</span> <span class="p">,</span>
          <span class="mf">288.96936</span><span class="p">]]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>Xarray allows you to select data using the <code class="docutils literal notranslate"><span class="pre">.sel()</span></code> method, which uses the labels of the dimensions to extract data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;-3292.0078&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, you need to enter the exact coordinate, but often we want to select the closest value to some number. For this, you can use <code class="docutils literal notranslate"><span class="pre">method='nearest'</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;-3292&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Temperature_isobaric&#39;</span> <span class="p">(</span><span class="n">time1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">119</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">14</span><span class="n">kB</span>
<span class="n">array</span><span class="p">([[[</span><span class="mf">202.2177</span> <span class="p">,</span> <span class="mf">202.0302</span> <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">219.67082</span><span class="p">,</span> <span class="mf">219.74895</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">202.58566</span><span class="p">,</span> <span class="mf">202.58566</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">219.16379</span><span class="p">,</span> <span class="mf">219.28879</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">292.1622</span> <span class="p">,</span> <span class="mf">292.14658</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">275.05283</span><span class="p">,</span> <span class="mf">275.11533</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">294.1256</span> <span class="p">,</span> <span class="mf">294.14124</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">276.84436</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">time1</span>      <span class="p">(</span><span class="n">time1</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">1993</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
  <span class="o">*</span> <span class="n">isobaric1</span>  <span class="p">(</span><span class="n">isobaric1</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">116</span><span class="n">B</span> <span class="mf">100.0</span> <span class="mf">125.0</span> <span class="mf">150.0</span> <span class="o">...</span> <span class="mf">950.0</span> <span class="mf">975.0</span> <span class="mf">1e+03</span>
  <span class="o">*</span> <span class="n">y</span>          <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">476</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.117e+03</span> <span class="o">-</span><span class="mf">3.084e+03</span> <span class="o">-</span><span class="mf">3.052e+03</span> <span class="o">...</span> <span class="mf">681.6</span> <span class="mf">714.1</span>
    <span class="n">x</span>          <span class="n">float32</span> <span class="mi">4</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.292e+03</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">long_name</span><span class="p">:</span>           <span class="n">Temperature</span> <span class="o">@</span> <span class="n">Isobaric</span> <span class="n">surface</span>
    <span class="n">units</span><span class="p">:</span>               <span class="n">K</span>
    <span class="n">description</span><span class="p">:</span>         <span class="n">Temperature</span>
    <span class="n">grid_mapping</span><span class="p">:</span>        <span class="n">LambertConformal_Projection</span>
    <span class="n">Grib_Variable_Id</span><span class="p">:</span>    <span class="n">VAR_7</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">131</span><span class="o">-</span><span class="mi">11</span><span class="n">_L100</span>
    <span class="n">Grib1_Center</span><span class="p">:</span>        <span class="mi">7</span>
    <span class="n">Grib1_Subcenter</span><span class="p">:</span>     <span class="mi">15</span>
    <span class="n">Grib1_TableVersion</span><span class="p">:</span>  <span class="mi">131</span>
    <span class="n">Grib1_Parameter</span><span class="p">:</span>     <span class="mi">11</span>
    <span class="n">Grib1_Level_Type</span><span class="p">:</span>    <span class="mi">100</span>
    <span class="n">Grib1_Level_Desc</span><span class="p">:</span>    <span class="n">Isobaric</span> <span class="n">surface</span>
</pre></div>
</div>
<p>We can also access the same data by index using the <code class="docutils literal notranslate"><span class="pre">.isel()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Temperature_isobaric&#39;</span> <span class="p">(</span><span class="n">time1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">isobaric1</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">119</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">14</span><span class="n">kB</span>
<span class="n">array</span><span class="p">([[[</span><span class="mf">202.2177</span> <span class="p">,</span> <span class="mf">202.0302</span> <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">219.67082</span><span class="p">,</span> <span class="mf">219.74895</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">202.58566</span><span class="p">,</span> <span class="mf">202.58566</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">219.16379</span><span class="p">,</span> <span class="mf">219.28879</span><span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">292.1622</span> <span class="p">,</span> <span class="mf">292.14658</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">275.05283</span><span class="p">,</span> <span class="mf">275.11533</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">294.1256</span> <span class="p">,</span> <span class="mf">294.14124</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">276.84436</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">time1</span>      <span class="p">(</span><span class="n">time1</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">1993</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
  <span class="o">*</span> <span class="n">isobaric1</span>  <span class="p">(</span><span class="n">isobaric1</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">116</span><span class="n">B</span> <span class="mf">100.0</span> <span class="mf">125.0</span> <span class="mf">150.0</span> <span class="o">...</span> <span class="mf">950.0</span> <span class="mf">975.0</span> <span class="mf">1e+03</span>
  <span class="o">*</span> <span class="n">y</span>          <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">476</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.117e+03</span> <span class="o">-</span><span class="mf">3.084e+03</span> <span class="o">-</span><span class="mf">3.052e+03</span> <span class="o">...</span> <span class="mf">681.6</span> <span class="mf">714.1</span>
    <span class="n">x</span>          <span class="n">float32</span> <span class="mi">4</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.292e+03</span>
<span class="n">Attributes</span><span class="p">:</span>
    <span class="n">long_name</span><span class="p">:</span>           <span class="n">Temperature</span> <span class="o">@</span> <span class="n">Isobaric</span> <span class="n">surface</span>
    <span class="n">units</span><span class="p">:</span>               <span class="n">K</span>
    <span class="n">description</span><span class="p">:</span>         <span class="n">Temperature</span>
    <span class="n">grid_mapping</span><span class="p">:</span>        <span class="n">LambertConformal_Projection</span>
    <span class="n">Grib_Variable_Id</span><span class="p">:</span>    <span class="n">VAR_7</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">131</span><span class="o">-</span><span class="mi">11</span><span class="n">_L100</span>
    <span class="n">Grib1_Center</span><span class="p">:</span>        <span class="mi">7</span>
    <span class="n">Grib1_Subcenter</span><span class="p">:</span>     <span class="mi">15</span>
    <span class="n">Grib1_TableVersion</span><span class="p">:</span>  <span class="mi">131</span>
    <span class="n">Grib1_Parameter</span><span class="p">:</span>     <span class="mi">11</span>
    <span class="n">Grib1_Level_Type</span><span class="p">:</span>    <span class="mi">100</span>
    <span class="n">Grib1_Level_Desc</span><span class="p">:</span>    <span class="n">Isobaric</span> <span class="n">surface</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> provides a lot of the functionality we expect from Numpy arrays,  such as <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">mean()</span></code>, <code class="docutils literal notranslate"><span class="pre">median()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, and <code class="docutils literal notranslate"><span class="pre">max()</span></code> that we can use these methods to aggregate data over one or multiple dimensions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate the mean over the &#39;isobaric1&#39; dimension</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;isobaric1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="s1">&#39;Temperature_isobaric&#39;</span> <span class="p">(</span><span class="n">time1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="mi">268</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">128</span><span class="n">kB</span>
<span class="n">array</span><span class="p">([[[</span><span class="mf">259.88446</span><span class="p">,</span> <span class="mf">259.90222</span><span class="p">,</span> <span class="mf">259.91678</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">262.61667</span><span class="p">,</span> <span class="mf">262.6285</span> <span class="p">,</span>
         <span class="mf">262.65167</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">259.74866</span><span class="p">,</span> <span class="mf">259.76752</span><span class="p">,</span> <span class="mf">259.78638</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">262.5757</span> <span class="p">,</span> <span class="mf">262.58218</span><span class="p">,</span>
         <span class="mf">262.57516</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">259.6156</span> <span class="p">,</span> <span class="mf">259.63498</span><span class="p">,</span> <span class="mf">259.65115</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">262.52075</span><span class="p">,</span> <span class="mf">262.51215</span><span class="p">,</span>
         <span class="mf">262.4976</span> <span class="p">],</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">249.8796</span> <span class="p">,</span> <span class="mf">249.83649</span><span class="p">,</span> <span class="mf">249.79501</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">254.43617</span><span class="p">,</span> <span class="mf">254.49059</span><span class="p">,</span>
         <span class="mf">254.54985</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">249.8505</span> <span class="p">,</span> <span class="mf">249.80202</span><span class="p">,</span> <span class="mf">249.75244</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">254.37044</span><span class="p">,</span> <span class="mf">254.42378</span><span class="p">,</span>
         <span class="mf">254.47711</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">249.82195</span><span class="p">,</span> <span class="mf">249.75998</span><span class="p">,</span> <span class="mf">249.71204</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">254.30956</span><span class="p">,</span> <span class="mf">254.35805</span><span class="p">,</span>
         <span class="mf">254.41139</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">time1</span>    <span class="p">(</span><span class="n">time1</span><span class="p">)</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">1993</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span>
  <span class="o">*</span> <span class="n">y</span>        <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">476</span><span class="n">B</span> <span class="o">-</span><span class="mf">3.117e+03</span> <span class="o">-</span><span class="mf">3.084e+03</span> <span class="o">-</span><span class="mf">3.052e+03</span> <span class="o">...</span> <span class="mf">681.6</span> <span class="mf">714.1</span>
  <span class="o">*</span> <span class="n">x</span>        <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">float32</span> <span class="mi">1</span><span class="n">kB</span> <span class="o">-</span><span class="mf">3.324e+03</span> <span class="o">-</span><span class="mf">3.292e+03</span> <span class="o">...</span> <span class="mf">5.311e+03</span> <span class="mf">5.343e+03</span>
</pre></div>
</div>
<p>Let’s take a look at a concrete example and compare it to NumPy. We will calculate the max temperature over the ‘isobaric1’ dimension at a specific value for x:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Xarray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;-3259.5447&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;isobaric1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mf">294.11</span>   <span class="p">,</span> <span class="mf">294.14124</span><span class="p">,</span> <span class="mf">294.1256</span> <span class="p">,</span> <span class="mf">294.0475</span> <span class="p">,</span> <span class="mf">293.90686</span><span class="p">,</span> <span class="mf">293.6256</span> <span class="p">,</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="mf">276.46936</span><span class="p">,</span> <span class="mf">276.59436</span><span class="p">,</span> <span class="mf">276.6881</span> <span class="p">,</span> <span class="mf">276.78186</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">]],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>In comparison, if we were to use plain Numpy, this would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># NumPy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">temperature_numpy</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span> <span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mf">294.11</span>   <span class="p">,</span> <span class="mf">294.14124</span><span class="p">,</span> <span class="mf">294.1256</span> <span class="p">,</span> <span class="mf">294.0475</span> <span class="p">,</span> <span class="mf">293.90686</span><span class="p">,</span> <span class="mf">293.6256</span> <span class="p">,</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="mf">276.46936</span><span class="p">,</span> <span class="mf">276.59436</span><span class="p">,</span> <span class="mf">276.6881</span> <span class="p">,</span> <span class="mf">276.78186</span><span class="p">,</span> <span class="mf">276.82874</span><span class="p">]],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the Xarray code is much more readable and we didn’t need to keep track of the right indices and order of the dimensions.</p>
</section>
<section id="plotting-data-in-xarray">
<h3>Plotting data in Xarray<a class="headerlink" href="#plotting-data-in-xarray" title="Link to this heading"></a></h3>
<p>Like Pandas, Xarray comes with basic plotting capabilities. We can easily plot data in 1D and 2D using the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method. Xarray uses a widely used plotting library called matplotlib for this. When calling the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method, Xarray checks the dimensionality of the data and plots it accordingly. Let’s import matplotlib and plot the data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>For a 2D DataArray the plot would resemble this example:</p>
<blockquote>
<div><img alt="_images/xarray_2d_plot.png" src="_images/xarray_2d_plot.png" />
</div></blockquote>
<p>Note, that we didn’t specify the axes labels, Xarray automatically used the coordinates of the DataArray for the plot. This plot might not be one you include directly in a paper, but it is a great way to quickly visualize your data.</p>
<p>Let’s have a look at a dataslice of 1D data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The resulting plot detects the dimentionality of the data and plots it accordingly:</p>
<blockquote>
<div><img alt="_images/xarray_1d_plot.png" src="_images/xarray_1d_plot.png" />
</div></blockquote>
<p>If the data has more than two dimensions, Xarray will plot a histogram of the data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The resulting plot would look like this:</p>
<blockquote>
<div><img alt="_images/xarray_hist.png" src="_images/xarray_hist.png" />
</div></blockquote>
<p>We can modify the plots by passing additional arguments to the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method. Since we haven’t discussed the plotting library matplotlib in this course, we will not go into further detail here. You can find more information in the <a class="reference external" href="https://xarray.pydata.org/en/stable/plotting.html">Xarray documentation</a>.</p>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-exercises-xarray-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercises: Xarray-1</p>
<p>Download the <code class="docutils literal notranslate"><span class="pre">NARR_19930313_0000.nc</span></code> dataset have a look at all Data variables. Calculate the geopotential height at <code class="docutils literal notranslate"><span class="pre">x=5148.3726</span></code> averaged over <code class="docutils literal notranslate"><span class="pre">y</span></code> and return the median value. You can use the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method to check on the way whether you use the correct dimensions and indices.</p>
</div>
<div class="admonition-solutions-xarray-1 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solutions: Xarray-1</p>
<p>One way of calculating this is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pythia_datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">DATASETS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filepath</span> <span class="o">=</span> <span class="n">DATASETS</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;NARR_19930313_0000.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Geopotential_height_isobaric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">5148.3726</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="go">&lt;xarray.DataArray &#39;Geopotential_height_isobaric&#39; ()&gt; Size: 4B</span>
<span class="go">array(4395.487, dtype=float32)</span>
<span class="go">Coordinates:</span>
<span class="go">    x        float32 4B 5.148e+03</span>
</pre></div>
</div>
</div>
</section>
<section id="creating-your-own-xarray-dataset">
<h3>Creating your own Xarray Dataset<a class="headerlink" href="#creating-your-own-xarray-dataset" title="Link to this heading"></a></h3>
<p>Creating your own Xarray Dataset is quite simple. We can create a Dataset from scratch using basic Python data structures. Let’s create a simple weather dataset with pressure and humidity data with the following script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Define coordinates using basic Python lists</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2023-01-05&#39;</span><span class="p">]</span>
<span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Location1&#39;</span><span class="p">,</span> <span class="s1">&#39;Location2&#39;</span><span class="p">,</span> <span class="s1">&#39;Location3&#39;</span><span class="p">]</span>

<span class="c1"># Define data variables as numpy arrays</span>
<span class="n">pressure_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Random pressure data in hPa</span>
<span class="n">humidity_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># Random humidity data</span>

<span class="c1"># Put everything together to create the Dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="n">data_vars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">],</span> <span class="n">pressure_data</span><span class="p">),</span>
        <span class="s2">&quot;humidity&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">],</span> <span class="n">humidity_data</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span>
    <span class="p">},</span>
    <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Weather data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;creation_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-01-01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Data Scientist&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="converting-xarray-objects-to-numpy-pandas-and-netcdf">
<h3>Converting Xarray objects to NumPy, Pandas and NetCDF<a class="headerlink" href="#converting-xarray-objects-to-numpy-pandas-and-netcdf" title="Link to this heading"></a></h3>
<p>Another handy feature of Xarray is the simple conversion between Xarray objects, NumPy arrays, Pandas DataFrames and even NetCDF files.</p>
<p>To convert an xarray DataArray to a NumPy array, you can use the <code class="docutils literal notranslate"><span class="pre">.values</span></code> attribute or the <code class="docutils literal notranslate"><span class="pre">.to_numpy()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the &#39;pressure&#39; DataArray to a NumPy array</span>
<span class="n">pressure_numpy</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># or</span>
<span class="n">pressure_numpy</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
<p>To convert the entire Dataset or individual DataArrays to pandas DataFrames, use the <code class="docutils literal notranslate"><span class="pre">.to_dataframe()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the entire Dataset to a DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="c1"># Convert a single DataArray to DataFrame</span>
<span class="n">pressure_df</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</pre></div>
</div>
<p>To save the dataset as a NetCDF file, use the <code class="docutils literal notranslate"><span class="pre">.to_netcdf()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the Dataset as a NetCDF file</span>
<span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;weather_data.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-exercises-xarray-2 exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercises: Xarray-2</p>
<p>Let’s change from climate science to finance for this example. Put the stock prices and trading volumes of three companies in one dataset. Create an Xarray Dataset that uses time and company as dimensions and contains two DataArrays: <code class="docutils literal notranslate"><span class="pre">stock_price</span></code> and <code class="docutils literal notranslate"><span class="pre">trading_volume</span></code>. You can download the data as a pandas DataFrame with the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">yfinance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">yf</span>

<span class="n">AAPL_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span>
<span class="n">GOOGL_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;GOOGL&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span>
<span class="n">MSFT_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;MSFT&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As a last thing, add the currency of the stock prices as an attribute to the Dataset.</p>
</div>
<div class="admonition-solutions-xarray-2 solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solutions: Xarray-2</p>
<p>We can use a script similar to this one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yfinance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">yf</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2020-01-01&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2024-01-01&quot;</span>

<span class="n">AAPL_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
<span class="n">GOOGL_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;GOOGL&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>
<span class="n">MSFT_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;MSFT&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>


<span class="n">stock_prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">AAPL_df</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">GOOGL_df</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">MSFT_df</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">trading_volumes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">AAPL_df</span><span class="p">[</span><span class="s2">&quot;Volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">GOOGL_df</span><span class="p">[</span><span class="s2">&quot;Volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">MSFT_df</span><span class="p">[</span><span class="s2">&quot;Volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="n">companies</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span> <span class="s2">&quot;GOOGL&quot;</span><span class="p">,</span> <span class="s2">&quot;MSFT&quot;</span><span class="p">]</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">AAPL_df</span><span class="o">.</span><span class="n">index</span><span class="p">[:]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;stock_price&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">stock_prices</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
        <span class="s2">&quot;trading_volume&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">trading_volumes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
    <span class="p">},</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">:</span> <span class="n">companies</span><span class="p">},</span>
    <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="advanced-topics">
<h3>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading"></a></h3>
<p>We have barely scratched the surface of all the features Xarray has to offer. Hopefully this quick introduction has shown you whether Xarray is the right tool for your data analysis needs. If you are interested in learning more about Xarray, here are some topics for further reading:</p>
<ul class="simple">
<li><p>Xarray integrates with Dask to support parallel computations and streaming computation on datasets that don’t fit into memory. If you work with datasets that are too large for your memory, have a read of the chapter <a class="reference external" href="https://docs.xarray.dev/en/stable/user-guide/dask.html">Parallel computing with Dask</a> in the Xarray documentation.</p></li>
<li><p>If you want to accelerate Xarray operations with your GPU, have a look at <a class="reference external" href="https://cupy-xarray.readthedocs.io/latest/">CuPy-Xarray</a>.</p></li>
<li><p>Xarray can be combined with pint, a Python library that adds support for physical quantities to NumPy arrays. This <a class="reference external" href="https://xarray.dev/blog/introducing-pint-xarray">blog post</a> provides a good introduction to the topic.</p></li>
<li><p>You can extend Xarray with your own methods using the <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.register_dataset_accessor.html">register_dataset_accessor()</a> method. This is a powerful feature that allows you to add custom methods to your own Xarray Datasets.</p></li>
</ul>
</section>
</section>
<span id="document-plotting-matplotlib"></span><section id="plotting-with-matplotlib">
<h2>Plotting with Matplotlib<a class="headerlink" href="#plotting-with-matplotlib" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>What happens if you can’t automatically produce plots?</p></li>
<li><p>When to use Matplotlib for data visualization?</p></li>
<li><p>When to prefer other libraries?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Be able to create simple plots with Matplotlib and tweak them</p></li>
<li><p>Know about object-oriented vs pyplot interfaces of Matplotlib</p></li>
<li><p>Be able to adapt gallery examples</p></li>
<li><p>Know how to look for help</p></li>
<li><p>Know that other tools exist</p></li>
</ul>
</div>
<section id="repeatability-reproducibility">
<h3>Repeatability/reproducibility<a class="headerlink" href="#repeatability-reproducibility" title="Link to this heading"></a></h3>
<p>From <a class="reference external" href="https://clauswilke.com/dataviz/">Claus O. Wilke: “Fundamentals of Data Visualization”</a>:</p>
<blockquote>
<div><p><em>One thing I have learned over the years is that automation is your friend. I
think figures should be autogenerated as part of the data analysis pipeline
(which should also be automated), and they should come out of the pipeline
ready to be sent to the printer, no manual post-processing needed.</em></p>
</div></blockquote>
<ul class="simple">
<li><p><strong>Try to minimize manual post-processing</strong>. This could bite you when you need to regenerate 50
figures one day before submission deadline or regenerate a set of figures
after the person who created them left the group.</p></li>
<li><p>There is not the one perfect language and <strong>not the one perfect library</strong> for everything.</p></li>
<li><p>Within Python, many libraries exist:</p>
<ul>
<li><p><a class="reference external" href="https://matplotlib.org/stable/gallery/index.html">Matplotlib</a>:
probably the most standard and most widely used</p></li>
<li><p><a class="reference external" href="https://seaborn.pydata.org/examples/index.html">Seaborn</a>:
high-level interface to Matplotlib, statistical functions built in</p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/index.html">Vega-Altair</a>:
declarative visualization, statistics built in
(we have an <a class="reference external" href="https://coderefinery.github.io/data-visualization-python/">entire lesson about data visualization using Vega-Altair</a>)</p></li>
<li><p><a class="reference external" href="https://plotly.com/python/">Plotly</a>:
interactive graphs</p></li>
<li><p><a class="reference external" href="https://demo.bokeh.org/">Bokeh</a>:
also here good for interactivity</p></li>
<li><p><a class="reference external" href="https://plotnine.readthedocs.io/">plotnine</a>:
implementation of a grammar of graphics in Python, it is based on <a class="reference external" href="https://ggplot2.tidyverse.org/">ggplot2</a></p></li>
<li><p><a class="reference external" href="https://yhat.github.io/ggpy/">ggplot</a>:
R users will be more at home</p></li>
<li><p><a class="reference external" href="https://www.pyngl.ucar.edu/Examples/gallery.shtml">PyNGL</a>:
used in the weather forecast community</p></li>
<li><p><a class="reference external" href="https://k3d-jupyter.org/gallery/index.html">K3D</a>:
Jupyter Notebook extension for 3D visualization</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>Two main families of libraries: procedural (e.g. Matplotlib) and declarative.</p></li>
</ul>
</section>
<section id="why-are-we-starting-with-matplotlib">
<h3>Why are we starting with Matplotlib?<a class="headerlink" href="#why-are-we-starting-with-matplotlib" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Matplotlib is perhaps the most popular Python plotting library.</p></li>
<li><p>Many libraries build on top of Matplotlib (example: <a class="reference external" href="https://seaborn.pydata.org/examples/index.html">Seaborn</a>).</p></li>
<li><p>MATLAB users will feel familiar.</p></li>
<li><p>Even if you choose to use another library (see above list), chances are high
that you need to adapt a Matplotlib plot of somebody else.</p></li>
<li><p>Libraries that are built on top of Matplotlib may need knowledge of Matplotlib
for custom adjustments.</p></li>
</ul>
<p>However it is a relatively low-level interface for
drawing (in terms of abstractions, not in terms of quality) and does not
provide statistical functions. Some figures require typing and tweaking many lines of code.</p>
<p>Many other visualization libraries exist with their own strengths, it is also a
matter of personal preferences.</p>
</section>
<section id="getting-started-with-matplotlib">
<h3>Getting started with Matplotlib<a class="headerlink" href="#getting-started-with-matplotlib" title="Link to this heading"></a></h3>
<p>We can start in a Jupyter Notebook since notebooks are typically a good fit
for data visualizations. But if you prefer to run this as a script, this is
also OK.</p>
<p>Let us create our first plot using
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="(in Matplotlib v3.10.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">subplots()</span></code></a>,
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.scatter.html#matplotlib.axes.Axes.scatter" title="(in Matplotlib v3.10.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scatter</span></code></a>, and some other methods on the
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="(in Matplotlib v3.10.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Axes</span></code></a> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># this is dataset 1 from</span>
<span class="c1"># https://en.wikipedia.org/wiki/Anscombe%27s_quartet</span>
<span class="n">data_x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.04</span><span class="p">,</span> <span class="mf">6.95</span><span class="p">,</span> <span class="mf">7.58</span><span class="p">,</span> <span class="mf">8.81</span><span class="p">,</span> <span class="mf">8.33</span><span class="p">,</span> <span class="mf">9.96</span><span class="p">,</span> <span class="mf">7.24</span><span class="p">,</span> <span class="mf">4.26</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span> <span class="mf">4.82</span><span class="p">,</span> <span class="mf">5.68</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#E69F00&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;we should label the x axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;we should label the y axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;some title&quot;</span><span class="p">)</span>

<span class="c1"># uncomment the next line if you would like to save the figure to disk</span>
<span class="c1"># fig.savefig(&quot;my-first-plot.png&quot;)</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/getting-started.png"><img alt="Result of our first plot" src="_images/getting-started.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">This is the result of our first plot.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>When running a Matplotlib script on a remote server without a
“display” (e.g. compute cluster), you may need to add the
<a class="reference external" href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.use" title="(in Matplotlib v3.10.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">matplotlib.use</span></code></a> call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>

<span class="c1"># ... rest of the script</span>
</pre></div>
</div>
</section>
<section id="exercise-matplotlib">
<h3>Exercise: Matplotlib<a class="headerlink" href="#exercise-matplotlib" title="Link to this heading"></a></h3>
<div class="admonition-exercise-matplotlib-1-extend-the-previous-example-15-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise Matplotlib-1: extend the previous example (15 min)</p>
<ul>
<li><p>Extend the previous plot by also plotting this set of values but this time
using a different color (<code class="docutils literal notranslate"><span class="pre">#56B4E9</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is dataset 2</span>
<span class="n">data2_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.14</span><span class="p">,</span> <span class="mf">8.14</span><span class="p">,</span> <span class="mf">8.74</span><span class="p">,</span> <span class="mf">8.77</span><span class="p">,</span> <span class="mf">9.26</span><span class="p">,</span> <span class="mf">8.10</span><span class="p">,</span> <span class="mf">6.13</span><span class="p">,</span> <span class="mf">3.10</span><span class="p">,</span> <span class="mf">9.13</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">,</span> <span class="mf">4.74</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Then add another color (<code class="docutils literal notranslate"><span class="pre">#009E73</span></code>) which plots the second dataset, scaled
by 2.0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we multiply all elements of data2_y by 2.0</span>
<span class="n">data2_y_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">data2_y</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Try to add a legend to the plot with <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.legend.html#matplotlib.axes.Axes.legend" title="(in Matplotlib v3.10.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">matplotlib.axes.Axes.legend()</span></code></a> and searching the web for clues on
how to add labels to each dataset.
You can also consult this great
<a class="reference external" href="https://matplotlib.org/stable/users/explain/quick_start.html">quick start guide</a>.</p></li>
<li><p>At the end it should look like this one:</p>
<figure class="align-default">
<img alt="Result of the exercise" src="_images/exercise.png" />
</figure>
</li>
<li><p>Experiment also by using named colors (e.g. “red”) instead of the hex-codes.</p></li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># this is dataset 1 from</span>
<span class="c1"># https://en.wikipedia.org/wiki/Anscombe%27s_quartet</span>
<span class="n">data_x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.04</span><span class="p">,</span> <span class="mf">6.95</span><span class="p">,</span> <span class="mf">7.58</span><span class="p">,</span> <span class="mf">8.81</span><span class="p">,</span> <span class="mf">8.33</span><span class="p">,</span> <span class="mf">9.96</span><span class="p">,</span> <span class="mf">7.24</span><span class="p">,</span> <span class="mf">4.26</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span> <span class="mf">4.82</span><span class="p">,</span> <span class="mf">5.68</span><span class="p">]</span>

<span class="c1"># this is dataset 2</span>
<span class="hll"><span class="n">data2_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.14</span><span class="p">,</span> <span class="mf">8.14</span><span class="p">,</span> <span class="mf">8.74</span><span class="p">,</span> <span class="mf">8.77</span><span class="p">,</span> <span class="mf">9.26</span><span class="p">,</span> <span class="mf">8.10</span><span class="p">,</span> <span class="mf">6.13</span><span class="p">,</span> <span class="mf">3.10</span><span class="p">,</span> <span class="mf">9.13</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">,</span> <span class="mf">4.74</span><span class="p">]</span>
</span>
<span class="c1"># here we multiply all elements of data2_y by 2.0</span>
<span class="hll"><span class="n">data2_y_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">data2_y</span><span class="p">]</span>
</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#E69F00&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;set 1&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data2_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#56B4E9&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;set 2&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data2_y_scaled</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#009E73&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;set 2 (scaled)&quot;</span><span class="p">)</span>
</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;we should label the x axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;we should label the y axis&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;some title&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span>
<span class="c1"># uncomment the next line if you would like to save the figure to disk</span>
<span class="c1"># fig.savefig(&quot;exercise-plot.png&quot;)</span>
</pre></div>
</div>
</div>
<div class="admonition-why-these-colors discussion important admonition" id="discussion-0">
<p class="admonition-title">Why these colors?</p>
<p>This qualitative color palette is optimized for all color-vision
deficiencies, see <a class="reference external" href="https://clauswilke.com/dataviz/color-pitfalls.html">https://clauswilke.com/dataviz/color-pitfalls.html</a> and
<a class="reference external" href="http://jfly.iam.u-tokyo.ac.jp/color/">Okabe, M., and K. Ito. 2008. “Color Universal Design (CUD):
How to Make Figures and Presentations That Are Friendly to Colorblind People”</a>.</p>
</div>
</section>
<hr class="docutils" />
<section id="matplotlib-has-two-different-interfaces">
<h3>Matplotlib has two different interfaces<a class="headerlink" href="#matplotlib-has-two-different-interfaces" title="Link to this heading"></a></h3>
<p>When plotting with Matplotlib, it is useful to know and understand that
there are <strong>two approaches</strong> even though the reasons of this dual approach is
outside the scope of this lesson.</p>
<ul>
<li><p>The more modern option is an <strong>object-oriented interface</strong> or <strong>explicit interface</strong> (the
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="(in Matplotlib v3.10.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">fig</span></code></a> and <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="(in Matplotlib v3.10.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ax</span></code></a> objects
can be configured separately and passed around to functions):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># this is dataset 1 from</span>
<span class="c1"># https://en.wikipedia.org/wiki/Anscombe%27s_quartet</span>
<span class="n">data_x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.04</span><span class="p">,</span> <span class="mf">6.95</span><span class="p">,</span> <span class="mf">7.58</span><span class="p">,</span> <span class="mf">8.81</span><span class="p">,</span> <span class="mf">8.33</span><span class="p">,</span> <span class="mf">9.96</span><span class="p">,</span> <span class="mf">7.24</span><span class="p">,</span> <span class="mf">4.26</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span> <span class="mf">4.82</span><span class="p">,</span> <span class="mf">5.68</span><span class="p">]</span>

<span class="hll"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span class="hll">
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#E69F00&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;we should label the x axis&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;we should label the y axis&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;some title&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</li>
<li><p>The more traditional option mimics MATLAB plotting and uses the
<strong>pyplot interface</strong> or <strong>implicit interface</strong> (<a class="reference external" href="https://matplotlib.org/stable/api/pyplot_summary.html#module-matplotlib.pyplot" title="(in Matplotlib v3.10.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">plt</span></code></a> carries
the global settings):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># this is dataset 1 from</span>
<span class="c1"># https://en.wikipedia.org/wiki/Anscombe%27s_quartet</span>
<span class="n">data_x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.04</span><span class="p">,</span> <span class="mf">6.95</span><span class="p">,</span> <span class="mf">7.58</span><span class="p">,</span> <span class="mf">8.81</span><span class="p">,</span> <span class="mf">8.33</span><span class="p">,</span> <span class="mf">9.96</span><span class="p">,</span> <span class="mf">7.24</span><span class="p">,</span> <span class="mf">4.26</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span> <span class="mf">4.82</span><span class="p">,</span> <span class="mf">5.68</span><span class="p">]</span>

<span class="hll"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;#E69F00&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;we should label the x axis&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;we should label the y axis&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;some title&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</li>
</ul>
<p>When searching for help on the internet, you will find both approaches, they
can also be mixed. Although the pyplot interface looks more compact, <strong>we
recommend to learn and use the object oriented interface.</strong></p>
<div class="admonition-why-do-we-emphasize-this discussion important admonition" id="discussion-1">
<p class="admonition-title">Why do we emphasize this?</p>
<p>One day you may want to write functions which wrap
around Matplotlib function calls and then you can send <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="(in Matplotlib v3.10.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code></a> and <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.html#matplotlib.axes.Axes" title="(in Matplotlib v3.10.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Axes</span></code></a>
into these functions and there is less risk that adjusting figures changes
settings also for unrelated figures created in other functions.</p>
<p>When using the pyplot interface, settings are modified for the entire
<a class="reference external" href="https://matplotlib.org/stable/api/pyplot_summary.html#module-matplotlib.pyplot" title="(in Matplotlib v3.10.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></a> package. The latter is acceptable for simple scripts but may yield
surprising results when introducing functions to enhance/abstract Matplotlib
calls.</p>
</div>
</section>
<hr class="docutils" />
<section id="styling-and-customizing-plots">
<h3>Styling and customizing plots<a class="headerlink" href="#styling-and-customizing-plots" title="Link to this heading"></a></h3>
<ul>
<li><p>Before you customize plots “manually” using a graphical program, please
consider how this affects reproducibility.</p></li>
<li><p><strong>Try to minimize manual post-processing</strong>. This might bite you when you
need to regenerate 50 figures one day before submission deadline or
regenerate a set of figures after the person who created them left the group.</p></li>
<li><p>Matplotlib and also all the other libraries allow to customize almost every aspect of a plot.</p></li>
<li><p>It is useful to study <a class="reference external" href="https://matplotlib.org/stable/users/explain/quick_start.html#parts-of-a-figure">Matplotlib parts of a figure</a>
so that we know what to search for to customize things.</p></li>
<li><p>Matplotlib cheatsheets: <a class="reference external" href="https://github.com/matplotlib/cheatsheets">https://github.com/matplotlib/cheatsheets</a></p></li>
<li><p>You can also select among pre-defined themes/
<a class="reference external" href="https://matplotlib.org/stable/gallery/style_sheets/style_sheets_reference.html">style
sheets</a>
with <a class="reference external" href="https://matplotlib.org/stable/api/style_api.html#matplotlib.style.use" title="(in Matplotlib v3.10.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">use</span></code></a>, for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="exercises-styling-and-customization">
<h3>Exercises: Styling and customization<a class="headerlink" href="#exercises-styling-and-customization" title="Link to this heading"></a></h3>
<p>Here are 3 exercises where we try to adapt existing scripts to either <strong>tweak
how the plot looks</strong> (exercises 1 and 2) or to <strong>modify the input data</strong> (example 3).</p>
<p>This is very close to real life: there are so many options and possibilities and it is
almost impossible to remember everything so this strategy is useful to practice:</p>
<ul class="simple">
<li><p>Select an example that is close to what you have in mind</p></li>
<li><p>Being able to adapt it to your needs</p></li>
<li><p>Being able to search for help</p></li>
<li><p>Being able to understand help request answers (not easy)</p></li>
</ul>
<div class="admonition-exercise-customization-1-log-scale-in-matplotlib-15-min exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise Customization-1: log scale in Matplotlib (15 min)</p>
<p>In this exercise we will learn how to use log scales.</p>
<ul>
<li><p>To demonstrate this we first fetch some data to plot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/plotly/datasets/master/gapminder_with_codes.csv&quot;</span>
<span class="p">)</span>
<span class="n">gapminder_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year == 2007&quot;</span><span class="p">)</span>

<span class="n">gapminder_data</span>
</pre></div>
</div>
</li>
<li><p>Try the above snippet in a notebook and it will give you an overview over the data.</p></li>
<li><p>Then we can plot the data, first using a linear scale:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP per capita (PPP dollars)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the result but we realize that a linear scale is not ideal here:</p>
<figure class="align-default">
<img alt="Gapminder data plotted using a linear scale" src="_images/gapminder-linear.png" />
</figure>
</li>
<li><p>Your task is to switch to a log scale and arrive at this result:</p>
<figure class="align-default">
<img alt="Gapminder data plotted using log scale" src="_images/gapminder-log.png" />
</figure>
</li>
<li><p>What does <code class="docutils literal notranslate"><span class="pre">alpha=0.5</span></code> do?</p></li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>See <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xscale.html#matplotlib.axes.Axes.set_xscale" title="(in Matplotlib v3.10.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ax.set_xscale()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP per capita (PPP dollars)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.artist.Artist.set_alpha.html#matplotlib.artist.Artist.set_alpha" title="(in Matplotlib v3.10.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">alpha</span></code></a> sets transparency
of points.</p></li>
</ul>
</div>
<div class="admonition-exercise-customization-2-preparing-a-plot-for-publication-15-min exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercise Customization-2: preparing a plot for publication (15 min)</p>
<p>Often we need to create figures for presentation slides and for publications
but both have different requirements: for presentation slides you have the whole
screen but for a figure in a publication you may only have few centimeters/inches.</p>
<p>For figures that go to print it is good practice to look at them at the size
they will be printed in and then often fonts and tickmarks are too small.</p>
<p>Your task is to make the tickmarks and the axis label font larger, using
<a class="reference external" href="https://matplotlib.org/stable/users/explain/quick_start.html#parts-of-a-figure">Matplotlib parts of a figure</a>
and web search, and to arrive at this:</p>
<figure class="align-default">
<img alt="Gapminder data plotted with larger font and larger ticks" src="_images/gapminder-larger-font.png" />
</figure>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>See <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.tick_params.html#matplotlib.axes.Axes.tick_params" title="(in Matplotlib v3.10.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ax.tick_params</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP per capita (PPP dollars)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span>
<span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span class="hll"><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<hr class="docutils" />
<div class="admonition-discussion discussion important admonition" id="discussion-2">
<p class="admonition-title">Discussion</p>
<p>After the exercises, the group can discuss their findings and it is important to
clarify questions at this point before moving on.</p>
</div>
</section>
<hr class="docutils" />
<section id="matplotlib-and-pandas-dataframes">
<h3>Matplotlib and pandas DataFrames<a class="headerlink" href="#matplotlib-and-pandas-dataframes" title="Link to this heading"></a></h3>
<p>In the above exercises we have sent individual columns of the <code class="docutils literal notranslate"><span class="pre">gapminder_data</span></code> DataFrame
into <code class="docutils literal notranslate"><span class="pre">ax.scatter()</span></code> like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">[</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>It is possible to do this instead and let Matplotlib “unpack” the columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gapminder_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Other input types are possible. See <a class="reference external" href="https://matplotlib.org/stable/users/explain/quick_start.html#types-of-inputs-to-plotting-functions">Types of inputs to plotting
functions</a>.</p>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Minimize manual post-processing, script everything.</p></li>
<li><p>Browse a number of example galleries to help you choose the library
that fits best your work/style.</p></li>
<li><p>Figures for presentation slides and figures for manuscripts have
different requirements.</p></li>
<li><p>Think about color-vision deficiencies when choosing colors. Use
existing solutions for this problem.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-plotting-vega-altair"></span><section id="plotting-with-vega-altair">
<h2>Plotting with <a class="reference external" href="https://altair-viz.github.io/">Vega-Altair</a><a class="headerlink" href="#plotting-with-vega-altair" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Be able to create simple plots with Vega-Altair and tweak them</p></li>
<li><p>Know how to look for help</p></li>
<li><p>Reading data with Pandas from disk or a web resource</p></li>
<li><p>Know how to tweak example plots from a gallery for your own purpose</p></li>
<li><p>We will build up
<a class="reference external" href="https://nbviewer.org/github/AaltoSciComp/python-for-scicomp/blob/master/resources/notebooks/plotting.ipynb">this notebook</a>
(spoiler alert!)</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>10 min: Introduction</p></li>
<li><p>10 min: Type-along (creating a first plot)</p></li>
<li><p>20 min: Exercise (using visual channels)</p></li>
<li><p>20 min: Exercise (adapting a gallery example and customizing)</p></li>
<li><p>10 min: Key points, discussion, and Q&amp;A</p></li>
</ul>
</div>
<section id="repeatability-reproducibility">
<h3>Repeatability/reproducibility<a class="headerlink" href="#repeatability-reproducibility" title="Link to this heading"></a></h3>
<p>From <a class="reference external" href="https://clauswilke.com/dataviz/">Claus O. Wilke: “Fundamentals of Data Visualization”</a>:</p>
<blockquote>
<div><p><em>One thing I have learned over the years is that automation is your friend. I
think figures should be autogenerated as part of the data analysis pipeline
(which should also be automated), and they should come out of the pipeline
ready to be sent to the printer, no manual post-processing needed.</em></p>
</div></blockquote>
<ul class="simple">
<li><p><strong>Try to minimize manual post-processing</strong>. This could bite you when you need to regenerate 50
figures one day before submission deadline or regenerate a set of figures
after the person who created them left the group.</p></li>
<li><p>There is not the one perfect language and <strong>not the one perfect library</strong> for everything.</p></li>
<li><p>Within Python, many libraries exist:</p>
<ul>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/index.html">Vega-Altair</a>:
declarative visualization, statistics built in</p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/gallery/index.html">Matplotlib</a>:
probably the most standard and most widely used</p></li>
<li><p><a class="reference external" href="https://seaborn.pydata.org/examples/index.html">Seaborn</a>:
high-level interface to Matplotlib, statistical functions built in</p></li>
<li><p><a class="reference external" href="https://plotly.com/python/">Plotly</a>:
interactive graphs</p></li>
<li><p><a class="reference external" href="https://demo.bokeh.org/">Bokeh</a>:
also here good for interactivity</p></li>
<li><p><a class="reference external" href="https://plotnine.readthedocs.io/">plotnine</a>:
implementation of a grammar of graphics in Python, it is based on <a class="reference external" href="https://ggplot2.tidyverse.org/">ggplot2</a></p></li>
<li><p><a class="reference external" href="https://yhat.github.io/ggpy/">ggplot</a>:
R users will be more at home</p></li>
<li><p><a class="reference external" href="https://www.pyngl.ucar.edu/Examples/gallery.shtml">PyNGL</a>:
used in the weather forecast community</p></li>
<li><p><a class="reference external" href="https://k3d-jupyter.org/gallery/index.html">K3D</a>:
Jupyter Notebook extension for 3D visualization</p></li>
<li><p><a class="reference external" href="https://docs.enthought.com/mayavi/mayavi/">Mayavi</a>:
3D scientific data visualization and plotting in Python</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>Two main families of libraries: procedural (e.g. Matplotlib) and declarative (e.g. Vega-Altair).</p></li>
</ul>
</section>
<section id="why-are-we-starting-with-vega-altair">
<h3>Why are we starting with <a class="reference external" href="https://altair-viz.github.io/">Vega-Altair</a>?<a class="headerlink" href="#why-are-we-starting-with-vega-altair" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Concise and powerful</p></li>
<li><p>“Simple, friendly and consistent API” allows us to focus on the data
visualization part and get started without too much Python knowledge</p></li>
<li><p>The way it <strong>combines visual channels with data columns</strong> can feel intuitive</p></li>
<li><p>Interfaces very nicely with <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> (<a class="reference internal" href="index.html#pandas"><span class="std std-ref">earlier episode</span></a>)</p></li>
<li><p>Easy to change figures</p></li>
<li><p>Good documentation</p></li>
<li><p>Open source</p></li>
<li><p>Makes it easy to save figures in a number of formats (svg, png, html)</p></li>
<li><p>Easy to save interactive visualizations to be used in websites</p></li>
</ul>
</section>
<section id="example-data-weather-data-from-two-norwegian-cities">
<h3>Example data: Weather data from two Norwegian cities<a class="headerlink" href="#example-data-weather-data-from-two-norwegian-cities" title="Link to this heading"></a></h3>
<p>We will experiment with some example weather data obtained from <a class="reference external" href="https://seklima.met.no/observations/">Norsk
KlimaServiceSenter</a>, Meteorologisk
institutt (MET) (CC BY 4.0).  The data is in CSV format (comma-separated
values) and contains daily and monthly weather data for two cities in Norway:
Oslo and Tromsø. You can browse the data
<a class="reference external" href="https://github.com/AaltoSciComp/python-for-scicomp/tree/master/resources/data/plotting">here in the lesson repository</a>.</p>
<p>We will use the Pandas library to read the data into a dataframe. We have learned about Pandas in an <a class="reference internal" href="index.html#pandas"><span class="std std-ref">earlier episode</span></a>.</p>
<p>Pandas can read from and write to a large set of formats
(<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/io.html">overview of input/output functions and formats</a>).
We will load a CSV file directly from the web. Instead of using a web URL we
could use a local file name instead.</p>
<p>Pandas dataframes are a great data structure for <strong>tabular data</strong> and tabular
data turns out to be a great input format for data visualization libraries.
Vega-Altair understands Pandas dataframes and can plot them directly.</p>
</section>
<section id="reading-data-into-a-dataframe">
<h3>Reading data into a dataframe<a class="headerlink" href="#reading-data-into-a-dataframe" title="Link to this heading"></a></h3>
<p>We can try this together in a notebook:
Using Pandas we can <strong>merge, join, concatenate, and compare</strong>
dataframes, see <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html">https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html</a>.</p>
<p>Let us try to <strong>concatenate</strong> two dataframes: one for Tromsø weather data (we
will now load monthly values) and one for Oslo:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">url_prefix</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/plotting/&quot;</span>

<span class="n">data_tromso</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_prefix</span> <span class="o">+</span> <span class="s2">&quot;tromso-monthly.csv&quot;</span><span class="p">)</span>
<span class="n">data_oslo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_prefix</span> <span class="o">+</span> <span class="s2">&quot;oslo-monthly.csv&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">data_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_tromso</span><span class="p">,</span> <span class="n">data_oslo</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span>
<span class="c1"># let us print the combined result</span>
<span class="n">data_monthly</span>
</pre></div>
</div>
<p>Before plotting the data, there is a problem which we may not see yet: Dates
are not in a standard date format (YYYY-MM-DD). We can fix this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace mm.yyyy to date format</span>
<span class="n">data_monthly</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%m.%Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With Pandas it is possible to do a lot more (adjusting missing values, fixing
inconsistencies, changing format).</p>
</section>
<section id="plotting-the-data">
<h3>Plotting the data<a class="headerlink" href="#plotting-the-data" title="Link to this heading"></a></h3>
<p>Now let’s plot the data. We will start with a plot that is not optimal and
then we will explore and improve a bit as we go:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<img alt="Monthly precipitation for the cities Oslo and Tromsø over the course of a year." src="_images/precipitation-on-top.svg" />
<figcaption>
<p><span class="caption-text">Monthly precipitation for the cities Oslo and Tromsø over the course of a year.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-let-us-pause-and-explain-the-code discussion important admonition" id="discussion-0">
<p class="admonition-title">Let us pause and explain the code</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">alt</span></code> is a short-hand for <code class="docutils literal notranslate"><span class="pre">altair</span></code> which we imported on top of the notebook</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Chart()</span></code> is a function defined inside <code class="docutils literal notranslate"><span class="pre">altair</span></code> which takes the data as argument</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mark_bar()</span></code> is a function that produces bar charts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encode()</span></code> is a function which encodes data columns to <strong>visual channels</strong></p></li>
</ul>
<p>Observe how we connect (encode) <strong>visual channels</strong> to data columns:</p>
<ul class="simple">
<li><p>x-coordinate with “date”</p></li>
<li><p>y-coordinate with “precipitation”</p></li>
<li><p>color with “name” (name of weather station; city)</p></li>
</ul>
</div>
<p>We can improve the plot by giving Vega-Altair a bit more information that the
x-axis is <strong>temporal</strong> (T) and that we would like to see the year and
month (yearmonth):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="hll">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
</span>    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Apart from T (temporal), there are other
<a class="reference external" href="https://altair-viz.github.io/user_guide/encodings/index.html#encoding-data-types">encoding data types</a>:</p>
<ul class="simple">
<li><p>Q (quantitative)</p></li>
<li><p>O (ordinal)</p></li>
<li><p>N (nominal)</p></li>
<li><p>T (temporal)</p></li>
<li><p>G (geojson)</p></li>
</ul>
<figure class="align-default" id="id2">
<img alt="Monthly precipitation for the cities Oslo and Tromsø over the course of a year." src="_images/precipitation-on-top-yearmonth.svg" />
<figcaption>
<p><span class="caption-text">Monthly precipitation for the cities Oslo and Tromsø over the course of a year.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Let us improve the plot with another one-line change:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id3">
<img alt="Monthly precipitation for the cities Oslo and Tromsø over the course of a year with with both cities plotted side by side." src="_images/precipitation-side.svg" />
<figcaption>
<p><span class="caption-text">Monthly precipitation for the cities Oslo and Tromsø over the course of a year with with both cities plotted side by side.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>With another one-line change we can make the bar chart stacked:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">xOffset</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id4">
<img alt="Monthly precipitation for the cities Oslo and Tromsø over the course of a year with with both cities plotted side by side." src="_images/precipitation-stacked-x.svg" />
<figcaption>
<p><span class="caption-text">Monthly precipitation for the cities Oslo and Tromsø over the course of a year
plotted as stacked bar chart.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This is not publication-quality yet but a really good start!</p>
<p>Let us try one more example where we can nicely see how Vega-Altair
is able to map visual channels to data columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span>
    <span class="n">y2</span><span class="o">=</span><span class="s2">&quot;min temperature&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id5">
<img alt="Monthly temperature ranges for two cities in Norway." src="_images/temperature-ranges-combined.svg" />
<figcaption>
<p><span class="caption-text">Monthly temperature ranges for two cities in Norway.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-what-other-marks-and-other-visual-channels-exist discussion important admonition" id="discussion-1">
<p class="admonition-title">What other marks and other visual channels exist?</p>
<ul class="simple">
<li><p><a class="reference external" href="https://altair-viz.github.io/user_guide/marks/index.html">Overview of available marks</a></p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/user_guide/encodings/channels.html">Overview of available visual channels</a></p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/index.html">Gallery of examples</a></p></li>
</ul>
</div>
</section>
<section id="exercise-using-visual-channels-to-re-arrange-plots">
<h3>Exercise: Using visual channels to re-arrange plots<a class="headerlink" href="#exercise-using-visual-channels-to-re-arrange-plots" title="Link to this heading"></a></h3>
<div class="admonition-plotting-1-using-visual-channels-to-re-arrange-plots exercise important admonition" id="exercise-0">
<p class="admonition-title">Plotting-1: Using visual channels to re-arrange plots</p>
<ol class="arabic">
<li><p>Try to reproduce the above plots if they are not already in your notebook.</p></li>
<li><p>Above we have plotted the monthly precipitation for two cities side by side
using a stacked plot. Try to arrive at the following plot where months are
along the y-axis and the precipitation amount is along the x-axis:</p>
<figure class="align-default">
<img alt="_images/precipitation-stacked-y.svg" src="_images/precipitation-stacked-y.svg" />
</figure>
</li>
<li><p>Ask the Internet or AI how to change the axis title from “precipitation”
to “Precipitation (mm)”.</p></li>
<li><p>Modify the temperature range plot to show the temperature ranges for the
two cities side by side like this:</p>
<figure class="align-default">
<img alt="_images/temperature-ranges-side.svg" src="_images/temperature-ranges-side.svg" />
</figure>
</li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ol class="arabic">
<li><p>Copy-paste code blocks from above.</p></li>
<li><p>Basically we switched x and y:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
<span class="hll">    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
</span><span class="hll">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
</span>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">yOffset</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>This can be done with the following modification:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;precipitation&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precipitation (mm)&quot;</span><span class="p">),</span>
</span>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="n">yOffset</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>We added one line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span>
    <span class="n">y2</span><span class="o">=</span><span class="s2">&quot;min temperature&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</section>
<section id="customizing-channels-for-extra-beauty">
<h3>Customizing channels for extra beauty<a class="headerlink" href="#customizing-channels-for-extra-beauty" title="Link to this heading"></a></h3>
<p>All of the visual channels can be modified with multiple different parameters.
The shorthand notation for specifying the channels can be modified to use channel
objects initialized by the user.</p>
<p>For the whole list of available channels and corresponding classes, see
<a class="reference external" href="https://altair-viz.github.io/user_guide/encodings/channels.html">this page</a>.</p>
<p>For example, we can rename channels to make them more beautiful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Temperature range (min-max)&quot;</span><span class="p">),</span>
    <span class="n">y2</span><span class="o">=</span><span class="s2">&quot;min temperature&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Station name&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id6">
<img alt="Monthly temperature ranges for two cities in Norway." src="_images/channels-renamed.svg" />
<figcaption>
<p><span class="caption-text">Monthly temperature ranges for two cities in Norway.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="saving-charts">
<h3>Saving charts<a class="headerlink" href="#saving-charts" title="Link to this heading"></a></h3>
<p>Saving charts is easy: you just call the
<a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html">chart.save()</a>-method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;yearmonth(date):T&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Temperature range (min-max)&quot;</span><span class="p">),</span>
    <span class="n">y2</span><span class="o">=</span><span class="s2">&quot;min temperature&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Station name&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;temperature_range.png&quot;</span><span class="p">,</span> <span class="n">ppi</span><span class="o">=</span><span class="mi">144</span><span class="p">)</span>
</pre></div>
</div>
<p>Altair supports png, svg and pdf saving. For png files you can adjust the image
resolution by giving an extra keyword argument (<code class="docutils literal notranslate"><span class="pre">ppi</span></code>).</p>
<p>It also supports exporting the image as
<a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html#html-format">HTML</a>
or as
<a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html#json-format">JSON</a>
that can be embedded
to any web page.</p>
<p>You can even use
<a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html#sharable-url">chart.to_url()</a>-method
to get a shareable url that you can view in an online editor (remember that
the URL will also contain some of the data used to create the plot).</p>
</section>
<section id="more-fun-with-visual-channels">
<h3>More fun with visual channels<a class="headerlink" href="#more-fun-with-visual-channels" title="Link to this heading"></a></h3>
<p>Now we will try to <strong>plot the daily data and look at snow depths</strong>. We first
read and concatenate two datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url_prefix</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/plotting/&quot;</span>

<span class="n">data_tromso</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_prefix</span> <span class="o">+</span> <span class="s2">&quot;tromso-daily.csv&quot;</span><span class="p">)</span>
<span class="n">data_oslo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url_prefix</span> <span class="o">+</span> <span class="s2">&quot;oslo-daily.csv&quot;</span><span class="p">)</span>

<span class="n">data_daily</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_tromso</span><span class="p">,</span> <span class="n">data_oslo</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We adjust the data a bit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace dd.mm.yyyy to date format</span>
<span class="n">data_daily</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_daily</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y&quot;</span><span class="p">)</span>

<span class="c1"># we are here only interested in the range december to may</span>
<span class="n">data_daily</span> <span class="o">=</span> <span class="n">data_daily</span><span class="p">[</span>
    <span class="p">(</span><span class="n">data_daily</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s2">&quot;2022-12-01&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_daily</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s2">&quot;2023-05-01&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now we can plot the snow depths for the months December to May for the two
cities:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_daily</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;snow depth&quot;</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id7">
<img alt="Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway." src="_images/snow-depth.svg" />
<figcaption>
<p><span class="caption-text">Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>What happens if we try to color the plot by the “max temperature” values?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_daily</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;snow depth&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span>
</span>    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The result looks neat:</p>
<figure class="align-default" id="id8">
<img alt="Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature." src="_images/snow-depth-color.svg" />
<figcaption>
<p><span class="caption-text">Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature.</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>We can change the color scheme (<a class="reference external" href="https://vega.github.io/vega/docs/schemes/">available color schemes</a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_daily</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;snow depth&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;max temperature&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">),</span>
</span>    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>With the following result:</p>
<figure class="align-default" id="id9">
<img alt="Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature. Warmer days are often followed by reduced snow depth." src="_images/snow-depth-plasma.svg" />
<figcaption>
<p><span class="caption-text">Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature. Warmer days are often followed by reduced snow depth.</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Let’s try one more change to show that we can experiment with different
plot types by changing <code class="docutils literal notranslate"><span class="pre">mark_bar()</span></code> to something else, in this case <code class="docutils literal notranslate"><span class="pre">mark_circle()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_daily</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
</span>    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;snow depth&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;max temperature&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">),</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id10">
<img alt="Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature. Warmer days are often followed by reduced snow depth." src="_images/snow-depth-circles.svg" />
<figcaption>
<p><span class="caption-text">Snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature. Warmer days are often followed by reduced snow depth.</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="data-transformations">
<h3>Data transformations<a class="headerlink" href="#data-transformations" title="Link to this heading"></a></h3>
<p>Vega-Altair also provides many different
<a class="reference external" href="https://altair-viz.github.io/user_guide/transform/index.html">data transformations</a>
that you can use to quickly modify plots.</p>
<p>For example, lets plot weekly average snowfall:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_daily</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;week(date)&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;mean(snow depth)&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;max temperature&quot;</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here we have used the <code class="docutils literal notranslate"><span class="pre">mean</span></code>-transform from
<a class="reference external" href="https://altair-viz.github.io/user_guide/transform/aggregate.html">Aggregate</a>-transformations
and <code class="docutils literal notranslate"><span class="pre">week</span></code>-transform from
<a class="reference external" href="https://altair-viz.github.io/user_guide/transform/timeunit.html">TimeUnit</a>-transformations.</p>
<p>Vega-Altair will then automatically do a group by-operation over weekly periods
across aggregated columns.</p>
<figure class="align-default" id="id11">
<img alt="Weekly mean snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by daily max temperature." src="_images/weekly-snow-depth.svg" />
<figcaption>
<p><span class="caption-text">Weekly mean snow depth (in cm) for the months December 2022 to May 2023 for two cities in Norway. Colored by weekly max temperature.</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="themes">
<h3>Themes<a class="headerlink" href="#themes" title="Link to this heading"></a></h3>
<p>In <a class="reference external" href="https://altair-viz.github.io/">Vega-Altair</a> you can change the theme and
select from a long <a class="reference external" href="https://github.com/vega/vega-themes">list of themes</a>.  On
top of your notebook try to add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;dark&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then re-run all cells. Later you can try some other themes such as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fivethirtyeight</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latimes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">urbaninstitute</span></code></p></li>
</ul>
<p>You can even define your own themes!</p>
</section>
<section id="exercise-adapting-a-gallery-example">
<h3>Exercise: Adapting a gallery example<a class="headerlink" href="#exercise-adapting-a-gallery-example" title="Link to this heading"></a></h3>
<p>In this exercise we can try to adapt existing scripts to either <strong>tweak how the
plot looks</strong> or to <strong>modify the input data</strong>.  This is very close to real life:
there are so many options and possibilities and it is almost impossible to
remember everything so this strategy is useful to practice:</p>
<ul class="simple">
<li><p>Select an example that is close to what you have in mind</p></li>
<li><p>Being able to adapt it to your needs</p></li>
<li><p>Being able to search for help</p></li>
</ul>
<div class="admonition-plotting-2-adapting-a-gallery-example exercise important admonition" id="exercise-1">
<p class="admonition-title">Plotting-2: Adapting a gallery example</p>
<p><strong>This is a great exercise which is very close to real life.</strong></p>
<ul class="simple">
<li><p>Browse the <a class="reference external" href="https://altair-viz.github.io/gallery/index.html">Vega-Altair example gallery</a>.</p></li>
<li><p>Select one example that is close to your current/recent visualization project
or simply interests you.</p></li>
<li><p>First try to reproduce this example, as-is, in the Jupyter Notebook.</p></li>
<li><p><strong>If you get the error “ModuleNotFoundError: No module named
‘vega_datasets’”, then try one of these examples:</strong> (they do not need the “vega_datasets” module)</p>
<ul>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/slider_cutoff.html">Slider cutoff</a>
(<strong>below you can find a walk-through for this example</strong>)</p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/multiline_tooltip_standard.html">Multi-Line tooltip</a></p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/simple_heatmap.html">Heatmap</a></p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/gallery/layered_histogram.html">Layered histogram</a></p></li>
</ul>
</li>
<li><p>Then try to print out the data that is used in this example just before the call of the plotting function
to learn about its structure. Consider writing the data to file before changing it.</p></li>
<li><p>Then try to modify the data a bit.</p></li>
<li><p>If you have time, try to feed it different, simplified data.
<strong>This will be key for adapting the examples to your projects.</strong></p></li>
</ul>
<div class="admonition-example-walk-through-for-the-slider-cutoff-example solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Example walk-through for the slider cutoff example</p>
<p>In this walk-through I imagine browsing: <a class="reference external" href="https://altair-viz.github.io/gallery/index.html">https://altair-viz.github.io/gallery/index.html</a></p>
<p>Then this example caught my eye: <a class="reference external" href="https://altair-viz.github.io/gallery/slider_cutoff.html">https://altair-viz.github.io/gallery/slider_cutoff.html</a></p>
<p>I then copy-paste the example code into a notebook and try to run it and I get
the same result.</p>
<p>If you get stuck below, <strong>you can also browse all the steps</strong> in a <a class="reference external" href="https://nbviewer.org/github/AaltoSciComp/python-for-scicomp/blob/master/resources/notebooks/plotting-exercise-2.ipynb">notebook
using
nbviewer</a>.</p>
<p>Next, there is a lot of code that I don’t (need to) understand yet but my eyes are trying to find
<code class="docutils literal notranslate"><span class="pre">alt.Chart</span></code> which tells me that the data must be the “df” in <code class="docutils literal notranslate"><span class="pre">alt.Chart(df)</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;xval&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;yval&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">slider</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="hll"><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
</span>    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;xval&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;yval&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">xval</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">,</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span>
    <span class="n">cutoff</span>
<span class="p">)</span>
</pre></div>
</div>
<p>My next step will be to print out the data <code class="docutils literal notranslate"><span class="pre">df</span></code> just before the call to <code class="docutils literal notranslate"><span class="pre">alt.Chart</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;xval&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;yval&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">slider</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="hll"><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span>
<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;xval&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;yval&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">xval</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">,</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span>
    <span class="n">cutoff</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The print reveals that <code class="docutils literal notranslate"><span class="pre">df</span></code> is a dataframe which contains x and y values:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>    xval       yval
0      0   0.496714
1      1   0.358450
2      2   1.006138
3      3   2.529168
4      4   2.295015
..   ...        ...
95    95 -10.712354
96    96 -10.416233
97    97 -10.155178
98    98 -10.150065
99    99 -10.384652

[100 rows x 2 columns]
</pre></div>
</div>
<p>The next thing that often helps me is to save the data to a comma-separated
values (CSV) file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>I then open the file in an editor and see that it contains 100 rows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>xval,yval
0,0.4967141530112327
1,0.358449851840048
2,1.0061383899407406
3,2.5291682463487657
4,2.2950148716254297
5,2.060877914676249
6,3.6400907301836405
7,4.407525459336549
8,3.938051073401597
9,4.4806111169875615
...
</pre></div>
</div>
<p>Saving the data to file often helps me to see the structure of the data and now
I am in a position to replace this with my own data. I create a file called
“mydata.csv” and there I use the maximum temperatures for months 1-10 from the
Tromso monthly data which we used further up:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>xval,yval
01,7.7
02,6.6
03,4.5
04,9.8
05,17.7
06,25.4
07,26.7
08,25.1
09,19.3
10,9.8
</pre></div>
</div>
<p>In the notebook I then verify that the reading of the data works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mydata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;mydata.csv&quot;</span><span class="p">)</span>

<span class="n">mydata</span>
</pre></div>
</div>
<p>Now I can replace the example with my own data (note how I now can comment out
some code that I don’t need any longer):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="c1"># import numpy as np</span>

<span class="c1"># rand = np.random.RandomState(42)</span>

<span class="c1"># df = pd.DataFrame({</span>
<span class="c1">#     &#39;xval&#39;: range(100),</span>
<span class="c1">#     &#39;yval&#39;: rand.randn(100).cumsum()</span>
<span class="c1"># })</span>

<span class="n">slider</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># print(df)</span>
<span class="hll"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;mydata.csv&quot;</span><span class="p">)</span>
</span>
<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;xval&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;yval&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">xval</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">,</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span>
    <span class="n">cutoff</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Seems to work! I then make few more adjustments (I want the slider to work on
the y-axis and have a more reasonable default):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">altair</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">alt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="hll"><span class="n">slider</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll"><span class="n">cutoff</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">slider</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;mydata.csv&quot;</span><span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;xval&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;yval&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
<span class="hll">        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">yval</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">,</span>
</span>        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span>
    <span class="n">cutoff</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>My next steps would then be to change axis titles, display the month names, add
a legend, and refine from here.</p>
<p><strong>You can also browse all the steps</strong> in a <a class="reference external" href="https://nbviewer.org/github/AaltoSciComp/python-for-scicomp/blob/master/resources/notebooks/plotting-exercise-2.ipynb">notebook using
nbviewer</a>.</p>
</div>
</div>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Browse a number of example galleries to help you choose the library
that fits best your work/style.</p></li>
<li><p>Minimize manual post-processing and try to script all steps.</p></li>
<li><p>CSV (comma-separated values) files are often a good format to store the data
that we wish to plot.</p></li>
<li><p>Read the data into a Pandas dataframe and then plot it with Vega-Altair
where you connect data columns to
<a class="reference external" href="https://altair-viz.github.io/user_guide/encodings/channels.html">visual channels</a>.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-work-with-data"></span><section id="working-with-data">
<h2>Working with Data<a class="headerlink" href="#working-with-data" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How do you store your data right now?</p></li>
<li><p>Are you doing data cleaning / preprocessing every time you load the data?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn benefits/drawbacks of common data formats.</p></li>
<li><p>Learn how you can read and write data in a variety of formats.</p></li>
</ul>
</div>
<figure class="align-default" id="id3">
<img alt="https://imgs.xkcd.com/comics/norm_normal_file_format.png" src="https://imgs.xkcd.com/comics/norm_normal_file_format.png" />
<figcaption>
<p><span class="caption-text">Source: <a class="reference external" href="https://xkcd.com/2116/">xkcd #2116</a></span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="what-is-a-data-format">
<h3>What is a data format?<a class="headerlink" href="#what-is-a-data-format" title="Link to this heading"></a></h3>
<p>Data format can mean two different things</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Data_structure">data structure</a> or how
you’re storing the data in memory while you’re working on it;</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/File_format">file format</a> or the way you’re
storing the data in the disk.</p></li>
</ol>
<p>Let’s consider this randomly generated DataFrame with various columns:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;carrot&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;20130101&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">),</span>
        <span class="s1">&#39;integer&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<p>This DataFrame is structured in the <em>tidy data</em> format.
In tidy data we have multiple columns of data that are collected in a Pandas
DataFrame, where each column represents a value of a specific type.</p>
<img alt="_images/tidy_data.png" src="_images/tidy_data.png" />
<p>Let’s consider another example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we have a different data structure: we have a two-dimensional array of numbers.
This is different to a Pandas DataFrame as data is stored as one contiguous block
instead of individual columns. This also means that the whole array must have one
data type.</p>
<figure class="align-default" id="id4">
<img alt="https://github.com/elegant-scipy/elegant-scipy/raw/master/figures/NumPy_ndarrays_v2.png" src="https://github.com/elegant-scipy/elegant-scipy/raw/master/figures/NumPy_ndarrays_v2.png" />
<figcaption>
<p><span class="caption-text">Source: <a class="reference external" href="https://github.com/elegant-scipy/elegant-scipy">Elegant Scipy</a></span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Now the question is: <strong>Can the data be saved to the disk without changing the
data format?</strong></p>
<p>For this we need a <strong>file format</strong> that can easily store our <strong>data structure</strong>.</p>
<div class="dropdown admonition">
<p class="admonition-title">Data type vs. data structure vs. file format</p>
<ul class="simple">
<li><p><strong>Data type:</strong> Type of a single piece of data (integer, string,
float, …).</p></li>
<li><p><strong>Data structure:</strong> How the data is organized in memory (individual
columns, 2D-array, nested dictionaries, …).</p></li>
<li><p><strong>File format:</strong> How the data is organized when it is saved to the disk
(columns of strings, block of binary data, …).</p></li>
</ul>
<p>For example, a black and white image stored as a .png-file (<strong>file format</strong>)
might be stored in memory as an NxM array (<strong>data structure</strong>) of integers
(<strong>data type</strong>) with each entry representing the color value of the pixel.</p>
</div>
</section>
<section id="what-to-look-for-in-a-file-format">
<h3>What to look for in a file format?<a class="headerlink" href="#what-to-look-for-in-a-file-format" title="Link to this heading"></a></h3>
<p>When deciding which file format you should use for your program, you should
remember the following:</p>
<p><strong>There is no file format that is good for every use case.</strong></p>
<p>and</p>
<p><strong>It is very likely, that a good format already exists for your use case.</strong></p>
<p>There are, indeed, various standard file formats for various use cases:</p>
<figure class="align-default" id="id5">
<img alt="https://imgs.xkcd.com/comics/standards.png" src="https://imgs.xkcd.com/comics/standards.png" />
<figcaption>
<p><span class="caption-text">Source: <a class="reference external" href="https://xkcd.com/927/">xkcd #927</a>.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Usually, you’ll want to consider the following things when choosing a file
format:</p>
<ol class="arabic simple">
<li><p>Is the file format good for my data structure (is it fast/space
efficient/easy to use)?</p></li>
<li><p>Is everybody else / leading authorities in my field recommending a certain
format?</p></li>
<li><p>Do I need a human-readable format or is it enough to work on it using code?</p></li>
<li><p>Do I want to archive / share the data or do I just want to store it while
I’m working?</p></li>
</ol>
<p>Pandas supports
<a class="reference external" href="https://pandas.pydata.org/docs/user_guide/io.html">many file formats</a>
for tidy data and Numpy supports
<a class="reference external" href="https://numpy.org/doc/stable/reference/routines.io.html">some file formats</a>
for array data. However, there are many other file formats that can be used
through other libraries.</p>
<p>Table below describes some data formats:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">Name:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Human</div>
<div class="line">readable:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Space</div>
<div class="line">efficiency:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Arbitrary</div>
<div class="line">data:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Tidy</div>
<div class="line">data:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Array</div>
<div class="line">data:</div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line">Long term</div>
<div class="line">storage/sharing:</div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#pickle"><span class="std std-ref">Pickle</span></a></p></td>
<td><p>❌</p></td>
<td><p>🟨</p></td>
<td><p>✅</p></td>
<td><p>🟨</p></td>
<td><p>🟨</p></td>
<td><p>❌</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#csv"><span class="std std-ref">CSV</span></a></p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>🟨</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#feather"><span class="std std-ref">Feather</span></a></p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#parquet"><span class="std std-ref">Parquet</span></a></p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>🟨</p></td>
<td><p>✅</p></td>
<td><p>🟨</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#npy"><span class="std std-ref">npy</span></a></p></td>
<td><p>❌</p></td>
<td><p>🟨</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#hdf5"><span class="std std-ref">HDF5</span></a></p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#netcdf4"><span class="std std-ref">NetCDF4</span></a></p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#json"><span class="std std-ref">JSON</span></a></p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>🟨</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#excel"><span class="std std-ref">Excel</span></a></p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>🟨</p></td>
<td><p>❌</p></td>
<td><p>🟨</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#graph"><span class="std std-ref">Graph formats</span></a></p></td>
<td><p>🟨</p></td>
<td><p>🟨</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>✅ : Good</p></li>
<li><p>🟨 : Ok / depends on a case</p></li>
<li><p>❌ : Bad</p></li>
</ul>
</div>
<p>A more in-depth analysis of the file formats mentioned above, can be found
<a class="reference internal" href="#document-data-formats"><span class="doc">here</span></a>.</p>
</section>
<section id="pros-and-cons">
<h3>Pros and cons<a class="headerlink" href="#pros-and-cons" title="Link to this heading"></a></h3>
<p>Let’s have a general look at pros and cons of some types of file formats</p>
<section id="binary-file-formats">
<h4>Binary File formats<a class="headerlink" href="#binary-file-formats" title="Link to this heading"></a></h4>
<section id="good-things">
<h5>Good things<a class="headerlink" href="#good-things" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Can represent floating point numbers with full precision.</p></li>
<li><p>Can potentially save lots of space, especially, when storing numbers.</p></li>
<li><p>Data reading and writing is usually much faster than loading from text files,
since the format contains information about the data structure, and thus
memory allocation can be done more efficiently.</p></li>
<li><p>More explicit specification for storing multiple data sets and metadata in
the same file.</p></li>
<li><p>Many binary formats allow for partial loading of the data.
This makes it possible to work with datasets that are larger than your
computer’s memory.</p></li>
</ul>
</section>
<section id="bad-things">
<h5>Bad things<a class="headerlink" href="#bad-things" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Commonly requires the use of a specific library to read and write the data.</p></li>
<li><p>Library specific formats can be version dependent.</p></li>
<li><p>Not human readable.</p></li>
<li><p>Sharing can be more difficult (requires some expertise to be able to
read the data).</p></li>
<li><p>Might require more documentation efforts.</p></li>
</ul>
</section>
</section>
<section id="textual-formats">
<h4>Textual formats<a class="headerlink" href="#textual-formats" title="Link to this heading"></a></h4>
<section id="id1">
<h5>Good things<a class="headerlink" href="#id1" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Human readable.</p></li>
<li><p>Easy to check for (structural) errors.</p></li>
<li><p>Supported by many tool out of the box.</p></li>
<li><p>Easily shared.</p></li>
</ul>
</section>
<section id="id2">
<h5>Bad things<a class="headerlink" href="#id2" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Can be slow to read and write.</p></li>
<li><p>High potential to increase required disk space substantially (e.g. when
storing floating point numbers as text).</p></li>
<li><p>Prone to losing precision when storing floating point numbers.</p></li>
<li><p>Multi-dimensional data can be hard to represent.</p></li>
<li><p>While the data format might be specified, the data structure might not be
clear when starting to read the data.</p></li>
</ul>
</section>
</section>
<section id="further-considerations">
<h4>Further considerations<a class="headerlink" href="#further-considerations" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The closer your stored data is to the code, the more likely it depends on the
environment you are working in. If you <code class="docutils literal notranslate"><span class="pre">pickle</span></code>, e.g. a generated model,
you can only be sure that the model will work as intended if you load it in
an environment that has the same versions of all libraries the model depends
on.</p></li>
</ul>
</section>
</section>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Link to this heading"></a></h3>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<p>You have a model that you have been training for a while.
Lets assume it’s a relatively simple neural network (consisting of a
network structure and it’s associated weights).</p>
<p>Let’s consider 2 scenarios</p>
<p>A: You have a different project, that is supposed to take this model, and
do some processing with it to determine it’s efficiency after different
times of training.</p>
<p>B: You want to publish the model and make it available to others.</p>
<p>What are good options to store the model in each of these scenarios?</p>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>A:</p>
<blockquote>
<div><p>Some export into a binary format that can be easily read. E.g. pickle
or a specific export function from the library you use.</p>
<p>It also depends on whether you intend to make the intermediary steps
available to others. If you do, you might also want to consider storing
structure and weights separately or use a format specific for the
type of model you are training to keep the data independent of the
library.</p>
</div></blockquote>
<p>B:</p>
<blockquote>
<div><p>You might want to consider a more general format that is supported by
many libraries, e.g. ONNX, or a format that is specifically designed
for the type of model you are training.</p>
<p>You might also want to consider additionally storing the model in a way
that is easily readable by humans, to make it easier for others to
understand the model.</p>
</div></blockquote>
</div>
</section>
<section id="case-study-converting-untidy-data-to-tidy-data">
<h3>Case study: Converting untidy data to tidy data<a class="headerlink" href="#case-study-converting-untidy-data-to-tidy-data" title="Link to this heading"></a></h3>
<p>Many data analysis tools (like Pandas) are designed to work with tidy data,
but some data is not in a suitable format. What we have seen often in the
past is people then not using the powerful tools, but write complicated
scripts that extract individual pieces from the data each time they need
to do a calculation.</p>
<p>As an example, let’s see how we can use country data from an example REST API
endpoint (for more information on how to work with web APIs, see
<a class="reference internal" href="#document-web-apis"><span class="doc">this page</span></a>). Let’s get the data with the following piece
of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.sampleapis.com/countries/countries&#39;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">countries_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s try to find the country with the largest population.</p>
<p>An example of a “questionable” way of solving this problem would be something
like the following piece of code that is written in pure Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">max_population</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_population_country</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">countries_json</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">country</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_population</span><span class="p">:</span>
        <span class="n">top_population_country</span> <span class="o">=</span> <span class="n">country</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">max_population</span> <span class="o">=</span> <span class="n">country</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">top_population_country</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a very natural way of writing a solution for the problem, but it has
major caveats:</p>
<ol class="arabic simple">
<li><p>We throw all of the other data out so we cannot answer any
follow up questions.</p></li>
<li><p>For bigger data, this would be very slow and ineffective.</p></li>
<li><p>We have to write lots of code to do a simple thing.</p></li>
</ol>
<p>Another typical solution would be something like the following code,
which picks some of the data and creates a Pandas dataframe out of it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">countries_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">countries_json</span><span class="p">:</span>
    <span class="n">countries_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">country</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">country</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>

<span class="n">countries_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">countries_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>This solution has many of the same problems as the previous one, but now we can
use Pandas to do follow up analysis.</p>
<p>Better solution would be to use Pandas’
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.from_dict.html">pandas.DataFrame.from_dict</a>
or <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.json_normalize.html">pandas.json_normalize</a>
to read the full data in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countries_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">countries_json</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">countries_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">countries_json</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">countries_df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition-key-points admonition">
<p class="admonition-title">Key points</p>
<ul class="simple">
<li><p>Convert your data to a format where it is easy to do analysis on it.</p></li>
<li><p>Check the tools you’re using if they have an existing feature that can help
you read the data in.</p></li>
</ul>
</div>
</section>
<section id="things-to-remember">
<h3>Things to remember<a class="headerlink" href="#things-to-remember" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>There is no file format that is good for every use case.</strong></p></li>
<li><p>Usually, your research question determines which libraries you want to use
to solve it. Similarly, the data format you have determines file format you
want to use.</p></li>
<li><p>However, if you’re using a previously existing framework or tools or you
work in a specific field, you should prioritize using the formats that are
used in said framework/tools/field.</p></li>
<li><p>When you’re starting your project, it’s a good idea to take your initial
data, clean it, and store the results in a good binary format that works as
a starting point for your future analysis. If you’ve written the cleaning
procedure as a script, you can always reproduce it.</p></li>
<li><p>Throughout your work, you should use code to turn important data to
a human-readable format (e.g. plots, averages,
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html#pandas.DataFrame.head" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.head()</span></code></a>), not to keep your full data in a
human-readable format.</p></li>
<li><p>Once you’ve finished, you should store the data in a format that can be
easily shared to other people.</p></li>
</ol>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/docs/user_guide/io.html">Pandas’ IO tools</a></p></li>
<li><p><a class="reference external" href="https://github.com/AaltoSciComp/python-for-scicomp/tree/master/extras/data-formats-comparison-tidy.ipynb">Tidy data comparison notebook</a></p></li>
<li><p><a class="reference external" href="https://github.com/AaltoSciComp/python-for-scicomp/tree/master/extras/data-formats-comparison-array.ipynb">Array data comparison notebook</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Pandas can read and write a variety of data formats.</p></li>
<li><p>There are many good, standard formats, and you don’t need to create your own.</p></li>
<li><p>There are plenty of other libraries dedicated to various formats.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-scripts"></span><section id="scripts">
<span id="id1"></span><h2>Scripts<a class="headerlink" href="#scripts" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Why are command line programs useful, compared to Jupyter
notebooks and similar?</p></li>
<li><p>How to create a Python script?</p></li>
<li><p>How to generalize a Python script?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to streamline your Python notebooks by creating repeatable Python scripts</p></li>
<li><p>Learn how to import other Python files</p></li>
<li><p>Learn to parse command line arguments in Python</p></li>
</ul>
</div>
<section id="why-scripts">
<h3>Why scripts?<a class="headerlink" href="#why-scripts" title="Link to this heading"></a></h3>
<p>So far we have been learning Python using Jupyter notebooks. It is very convenient: it allowed us to experiment and prototype Python code so we may think that is more than enough for your day to day work.</p>
<p>But after several weeks of hard work with Python, you may end up:</p>
<ul class="simple">
<li><p>either with 10 different notebooks (so that you can run them concurrently)</p></li>
<li><p>or with a very long notebook which is becoming hardly readable!</p></li>
</ul>
<p>Let’s imagine you have created 10 notebooks to run for 10 different input parameters and now you are willing to experiment with 1000 sets of input parameters.
Suppose you find a bug in the original notebook and need to rerun everything: are you willing to re-create manually your 1000 notebooks?</p>
<p>In this episode, we will learn how to automate your work using Python scripts so that</p>
<ul class="simple">
<li><p>you do not need to manually configure your notebooks to be able to run with different parameters</p></li>
<li><p>can easily run you work via other tools, such as on computing clusters.</p></li>
</ul>
</section>
<section id="from-jupyter-notebooks-to-python-scripts">
<h3>From Jupyter notebooks to Python scripts<a class="headerlink" href="#from-jupyter-notebooks-to-python-scripts" title="Link to this heading"></a></h3>
</section>
<section id="save-as-python-script">
<h3>Save as Python script<a class="headerlink" href="#save-as-python-script" title="Link to this heading"></a></h3>
<p>Jupyter notebooks can be parameterized for instance using <a class="reference external" href="https://papermill.readthedocs.io/en/latest/">papermill</a>. It can be an attractive approach when you have short notebooks (to generate automatically plots/reports) but as soon as you have more complex tasks to execute, we strongly recommend to generate Python scripts. This will also force you to modularize your code.  See <a class="reference external" href="https://coderefinery.github.io/modular-type-along/">CodeRefinery’s lesson on Modular code development</a>.</p>
<p>You need to convert the notebook to a Python file.
Check the <a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/user/export.html">JupyterLab documentation</a> for more information.
You can get a command line by (File → New Launcher → Terminal - if you
go through New Launcher, your command line will be in the directory
you are currently browsing), you can convert files in the terminal by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter<span class="w"> </span>nbconvert<span class="w"> </span>--to<span class="w"> </span>script<span class="w"> </span>your_notebook_name.ipynb
</pre></div>
</div>
<p>If nbconvert doesn’t work, within JupyterLab, you can export any
Jupyter notebook to a Python
script, but this downloads it to your own computer and then you need
to copy it to a place you are working (maybe upload it back to
JupyterLab?):</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="https://jupyterlab.readthedocs.io/en/stable/_images/exporting-menu.png"><img alt="JupyterLab screenshot as described in caption." src="https://jupyterlab.readthedocs.io/en/stable/_images/exporting-menu.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text">Select File (top menu bar) → Export Notebook as → <strong>Export notebook to Executable Script</strong>.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-scripts-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Scripts-1</p>
<ol class="arabic">
<li><p>Download the <a class="reference download internal" download="" href="_downloads/4b858dab9366f77b3641c99adece5fd2/weather_observations.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">weather_observations.ipynb</span></code></a> and upload them to your Jupyterlab. The script plots the temperature data for Tapiola in Espoo. The data is originally from <a class="reference external" href="https://rp5.kz">rp5.kz</a> and was slightly adjusted for this lecture.</p>
<p><strong>Hint:</strong> Copy the URL above (right-click) and in JupyterLab, use
File → Open from URL → Paste the URL.  It will both download it to
the directory JupyterLab is in and open it for you.</p>
</li>
<li><p>Open a terminal in Jupyter: File → New Launcher, then click
“Terminal” there. (if you do it this way, it will be in the right
directory.  File → New → Terminal might not be.)</p></li>
<li><p>Convert the Jupyter script to a Python script by calling:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter<span class="w"> </span>nbconvert<span class="w"> </span>--to<span class="w"> </span>script<span class="w"> </span>weather_observations.ipynb
</pre></div>
</div>
</li>
<li><p>Run the script (note: you may have <code class="docutils literal notranslate"><span class="pre">python3</span></code> rather than <code class="docutils literal notranslate"><span class="pre">python</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>weather_observations.py
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="command-line-arguments-with-sys-argv">
<h3>Command line arguments with <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a><a class="headerlink" href="#command-line-arguments-with-sys-argv" title="Link to this heading"></a></h3>
<p>We now have a Python script that is callable from the command line (e.g. for use on an HPC system).
However, this code is still not adjustable, as we still need to have a copy for each single
time range we want to plot, or need to modify our file whenever we want to just change parameters.
<strong>What we need is to allow the code to do something different based on something outside the code itself</strong>: in this case, to
plot information for different time ranges. This can be achieved by
using Pythons <a class="reference external" href="https://docs.python.org/3/library/sys.html#module-sys" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a> package, which provides access to arguments given to the Python interpreter at
startup in the <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a> list. The first (i.e. <code class="docutils literal notranslate"><span class="pre">sys.argv[0]</span></code> entry of this array is the script that is running,
and any further argument (separated by space) is appended to this list, like such:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>my_script.py<span class="w"> </span>A<span class="w"> </span>B
<span class="gp">$ </span><span class="c1"># sys.argv[1] is &#39;A&#39;</span>
<span class="gp">$ </span><span class="c1"># sys.argv[2] is &#39;B&#39;</span>
</pre></div>
</div>
<p>Lets see how it works: We modify the <strong>weather_observations.py</strong> script such that we allow start
and end times as well as the output file to be passed in as arguments
to the function.  Open it (find the <code class="docutils literal notranslate"><span class="pre">.py</span></code> file from the JupyterLab
file browser) and make these edits:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># define the start and end time for the plot</span>
<span class="hll"><span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="o">...</span>
<span class="hll">
</span><span class="c1"># select the data</span>
<span class="n">weather</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">)]</span>
<span class="o">...</span>

<span class="c1"># save the figure</span>
<span class="hll"><span class="n">output_file_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span class="hll"><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">)</span>
</span></pre></div>
</div>
<p>We can try it out (see the file <code class="docutils literal notranslate"><span class="pre">spring_in_tapiola.png</span></code> made in the
file browser):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span><span class="m">01</span>/03/2021<span class="w"> </span><span class="m">31</span>/05/2021<span class="w"> </span>spring_in_tapiola.png
</pre></div>
</div>
<div class="admonition-discussion discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion</p>
<ul class="simple">
<li><p>Does it work?</p></li>
<li><p>Why is this better than modifying the script every time I want it to
plot data for a different period?</p></li>
<li><p>What problems do you expect when using this approach (using <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a>)?</p></li>
</ul>
</div>
<p>This approach is brittle and more robust solutions exist that allow you to fully
customize your scripts and generate help texts at the same time:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/argparse.html">argparse</a>:
built-in to Python, this is the one that we will show below.</p></li>
<li><p><a class="reference external" href="http://docopt.org/">doctopt</a>: you write the help text and this generates a parser for you.</p></li>
<li><p><a class="reference external" href="https://click.palletsprojects.com/">click</a>: another nice
library for command line interfaces - very easy to use.</p></li>
</ul>
</section>
<section id="parsing-command-line-arguments-with-argparse">
<h3>Parsing command line arguments with <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a><a class="headerlink" href="#parsing-command-line-arguments-with-argparse" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Argparse</span></code></a> not only gives you descriptive command line arguments, it also automatically
generates a <code class="docutils literal notranslate"><span class="pre">--help</span></code> option for you. To use <code class="docutils literal notranslate"><span class="pre">argparse</span></code> you first set up a parser
by calling <a class="reference external" href="https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">parser</span> <span class="pre">=</span> <span class="pre">argparse.ArgumentParser()</span></code></a> and then you add arguments using
<a class="reference external" href="https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser.add_argument" title="(in Python v3.14)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">parser.add_argument(args)</span></code></a>. There are two different types of arguments:</p>
<ul class="simple">
<li><p>Positional arguments</p></li>
<li><p>Optional arguments</p></li>
</ul>
<p><strong>Positional arguments</strong> are detected by their order, while <strong>optional arguments</strong> need to be
given with their respective flags ( like <code class="docutils literal notranslate"><span class="pre">--name</span></code> or <code class="docutils literal notranslate"><span class="pre">-n</span></code>).
The following example would parse a positional argument <code class="docutils literal notranslate"><span class="pre">Name</span></code> of type <code class="docutils literal notranslate"><span class="pre">string</span></code>
and an optional argument <code class="docutils literal notranslate"><span class="pre">date</span></code> of type <code class="docutils literal notranslate"><span class="pre">string</span></code> which defaults to <code class="docutils literal notranslate"><span class="pre">01/01/2000</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

<span class="hll"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="c1"># One positional and one optional argument</span>
<span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The name of the subject&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--date&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;01/01/2000&quot;</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Birth date of the subject&quot;</span><span class="p">)</span>
</span>
<span class="hll"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span>
<span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was born on &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
<p>If this code was in <code class="docutils literal notranslate"><span class="pre">birthday.py</span></code> and we would call <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">birthday.py</span> <span class="pre">--help</span></code> it
would show the following message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>birthday.py<span class="w"> </span>--help
<span class="go">usage: birthday.py [-h] [-d DATE] N</span>

<span class="go">positional arguments:</span>
<span class="go">  N                     The name of the subject</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -d DATE, --date DATE  Birth date of the subject</span>
</pre></div>
</div>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-scripts-2 exercise important admonition" id="exercise-1">
<p class="admonition-title">Scripts-2</p>
<ol class="arabic simple">
<li><p>Take the Python script (<code class="docutils literal notranslate"><span class="pre">weather_observations.py</span></code>) we have written in the preceding exercise and use
<a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> to specify the input (URL) and output files and allow the start and end dates to be set.</p>
<ul class="simple">
<li><p>Hint: try not to do it all at once, but add one or two arguments, test, then add more, and so on.</p></li>
<li><p>Hint: The input and output filenames make sense as positional arguments, since they must always be given.  Input is usually first, then output.</p></li>
<li><p>Hint: The start and end dates should be optional parameters with the defaults as they are in the current script.</p></li>
</ul>
</li>
<li><p>Execute your script for a few different time intervals (e.g. from January 2019 to June 2020, or from May 2020 to October 2020).
Also try using this data for Cairo: <code class="docutils literal notranslate"><span class="pre">https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_cairo.csv</span></code></p></li>
</ol>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="hll"><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
</span>
<span class="hll"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Input data file&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output plot file&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;01/01/2019&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start date in DD/MM/YYYY format&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--end&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;16/10/2021&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;End date in DD/MM/YYYY format&quot;</span><span class="p">)</span>
</span>
<span class="hll"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span>
<span class="c1"># load the data</span>
<span class="hll"><span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
</span>
<span class="c1"># define the start and end time for the plot</span>
<span class="hll"><span class="n">start_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="n">end_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
<span class="c1"># preprocess the data</span>
<span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># select the data</span>
<span class="n">weather</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">)]</span>

<span class="c1"># plot the data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1"># start the figure.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">],</span> <span class="n">weather</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
<span class="c1"># label the axes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date of observation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature in Celsius&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature Observations&quot;</span><span class="p">)</span>
<span class="c1"># adjust the date labels, so that they look nicer</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

<span class="c1"># save the figure</span>
<span class="hll"><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition-discussion discussion important admonition" id="discussion-1">
<p class="admonition-title">Discussion</p>
<p><strong>What was the point of doing this?</strong></p>
<p>Now you can do this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>--help
<span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_tapiola.csv<span class="w"> </span>temperature_tapiola.png
<span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>/12/2020<span class="w"> </span>-e<span class="w"> </span><span class="m">31</span>/12/2020<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_tapiola.csv<span class="w"> </span>temperature_tapiola_dec.png
<span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>/2/2021<span class="w"> </span>-e<span class="w"> </span><span class="m">28</span>/2/2021<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_tapiola.csv<span class="w"> </span>temperature_tapiola_feb.png
<span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_cairo.csv<span class="w"> </span>temperature_cairo.png
</pre></div>
</div>
<ul class="simple">
<li><p>We can now process different input files without changing the script.</p></li>
<li><p>We can select multiple time ranges without modifying the script.</p></li>
<li><p>We can easily save these commands to know what we did.</p></li>
<li><p>This way we can also loop over file patterns (using shell loops or similar) or use
the script in a workflow management system and process many files in parallel.</p></li>
<li><p>By changing from <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a> to <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> we made the script more robust against
user input errors and also got a help text (accessible via <code class="docutils literal notranslate"><span class="pre">--help</span></code>).</p></li>
</ul>
</div>
</section>
<section id="load-larger-option-lists-using-config-files">
<h3>Load larger option lists using config files<a class="headerlink" href="#load-larger-option-lists-using-config-files" title="Link to this heading"></a></h3>
<p>In the above example we only allowed the input and output files along with start and end dates to be selected by command line arguments.
This already leads to a quite large command line call. Now imagine, that we also want to allow the user to select more specific information
from the dataset, define specific X and Y labels, write their own
title etc. Now imagine to put all this into the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>weather_observations.py<span class="w"> </span>--input<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_cairo.csv<span class="w"> </span>--output<span class="w"> </span>rain_in_tapiola.png<span class="w"> </span>--xlabel<span class="w"> </span><span class="s2">&quot;Days in June&quot;</span><span class="w"> </span>--ylabel<span class="w"> </span><span class="s2">&quot;Rainfall in mm&quot;</span><span class="w"> </span>--title<span class="w"> </span><span class="s2">&quot;Rainfall in Cairo&quot;</span><span class="w"> </span>--data_column<span class="w"> </span>RRR<span class="w"> </span>--start<span class="w"> </span><span class="m">01</span>/06/2021<span class="w"> </span>--end<span class="w"> </span><span class="m">30</span>/06/2021
</pre></div>
</div>
<p>This is an even larger line, needs scrolling and becomes quite inconvenient to modify.
Instead of putting all of this into the command line, you could think about storing and modifying the arguments in a config file.
There are several ways, how config files can be stored. You can use a simple <code class="docutils literal notranslate"><span class="pre">Parameter</span> <span class="pre">=</span> <span class="pre">Value</span></code>
format, and parse it yourself, or you can use e.g. the <code class="docutils literal notranslate"><span class="pre">JSON</span></code> or <code class="docutils literal notranslate"><span class="pre">YAML</span></code> formats.
For both parsers exist that can save you some work, and both formats also allow you to use
more complex input data, like lists, or dictionaries. We won’t go into the details of the formats, and will only give
a short example using YAML here.</p>
<p>The YAML file format can be simple or very complex allowing a large variety of data structures to be stored.
One benefit of YAML is that there is already a Python module (<a class="reference external" href="https://pyyaml.org/">yaml</a>) available for parsing it and it
directly parses numbers as numbers and text as strings, making conversions unnecessary (the same is true for JSON
with the <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> package).</p>
<p>The Python module <a class="reference download internal" download="" href="_downloads/75c4ab69c0f59fbb1589b03be360a485/optionsparser.py"><code class="xref download docutils literal notranslate"><span class="pre">optionsparser.py</span></code></a> provides a simple parser for YAML styled options files.
Similar to argparse, it takes a dict of required options, along with a dict of optional parameters.
Required arguments need to specify a type. Optional argument types are derived from their default values.</p>
<p>In our example above, we could for example add optional parameters that allow the selection of other weather data
from the dataset (precipitation …), set the labels and titles explicitly etc.</p>
<p>In the YAML format, names and values are separated by <code class="docutils literal notranslate"><span class="pre">:</span></code>. Our above example would therefore translate to the following YAML file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">input</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/data/scripts/weather_cairo.csv</span>
<span class="nt">output</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">rain_in_cairo.png</span>
<span class="nt">xlabel</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">Days in June</span>
<span class="nt">ylabel</span><span class="p">:</span><span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">Rainfall in mm</span>
<span class="nt">title</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">Rainfall in Cairo</span>
<span class="nt">data_column</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">RRR</span>
<span class="nt">start</span><span class="p">:</span><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">01/06/2021</span>
<span class="nt">end</span><span class="p">:</span><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">30/06/2021</span>
</pre></div>
</div>
</section>
<section id="exercises-3-optional">
<h3>Exercises 3 (optional)<a class="headerlink" href="#exercises-3-optional" title="Link to this heading"></a></h3>
<div class="admonition-scripts-3 exercise important admonition" id="exercise-2">
<p class="admonition-title">Scripts-3</p>
<ol class="arabic simple">
<li><p>Download the <a class="reference download external" download="" href="https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/resources/code/scripts/optionsparser.py"><code class="xref download docutils literal notranslate"><span class="pre">optionsparser.py</span></code></a>
function and load it into your working folder in Jupyterlab (Hint: in JupyterLab, File → Open from URL).
Modify the previous script to use a config file parser to read all arguments. The config file is passed in as a single argument on the command line
(using e.g. <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv" title="(in Python v3.14)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a>) still needs to be read from the command line.</p></li>
<li><p>Run your script with different config files.</p></li>
</ol>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>The modified <strong>weather_observations.py</strong> script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">optionsparser</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_parameters</span>
</span><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span> 

<span class="c1"># Lets start reading our confg file. we&#39;ll use argparse to get the config file.</span>
<span class="hll"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="hll"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span class="hll">                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Config File name &quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span>
<span class="c1"># Set optional parameters with default values and required parameter values with their type</span>
<span class="hll"><span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">           <span class="s2">&quot;xlabel&quot;</span>      <span class="p">:</span> <span class="s2">&quot;Date of observation&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;title&quot;</span>       <span class="p">:</span> <span class="s2">&quot;Weather Observations&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;start&quot;</span>       <span class="p">:</span> <span class="s2">&quot;01/06/2021&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;end&quot;</span>         <span class="p">:</span> <span class="s2">&quot;01/10/2021&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;output&quot;</span>      <span class="p">:</span> <span class="s2">&quot;weather.png&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;ylabel&quot;</span>      <span class="p">:</span> <span class="s2">&quot;Temperature in Celsius&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s2">&quot;data_column&quot;</span> <span class="p">:</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="p">}</span>
</span><span class="hll">
</span><span class="hll"><span class="n">required</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">           <span class="s2">&quot;input&quot;</span>  <span class="p">:</span> <span class="nb">str</span>
</span><span class="hll">           <span class="p">}</span>
</span>           
<span class="c1"># now, parse the config file</span>
<span class="hll"><span class="n">parameters</span> <span class="o">=</span> <span class="n">get_parameters</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
</span>
<span class="c1"># load the data</span>
<span class="hll"><span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">input</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
</span>
<span class="c1"># obtain start and end date</span>
<span class="hll"><span class="n">start_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="n">end_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
<span class="c1"># Data preprocessing</span>
<span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># select the data</span>
<span class="n">weather</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">)]</span>

<span class="c1"># Data plotting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1"># start the figure.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;Local time&#39;</span><span class="p">],</span> <span class="n">weather</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
<span class="c1"># label the axes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date of observation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature in Celsius&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature Observations&quot;</span><span class="p">)</span>
<span class="c1"># adjust the date labels, so that they look nicer</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>


<span class="c1"># save the figure</span>
<span class="hll"><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>What did this config file parser get us?  Now, we have separated the
code from the configuration.  We could save all the configuration in
version control - separately and have one script that runs them.  If
done right, our work could be much more reproducible and
understandable.</p>
<div class="admonition-further-reading admonition">
<p class="admonition-title">Further reading</p>
<ul class="simple">
<li><p>Linking Jupyterlab notebooks to python scripts (making linking <code class="docutils literal notranslate"><span class="pre">.py</span></code>- and <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code>-files easier) using <a class="reference external" href="https://jupytext.readthedocs.io/en/latest/paired-notebooks.html">jupytext</a></p></li>
<li><p>The <a class="reference external" href="https://en.wikipedia.org/wiki/YAML">wikipedia page about YAML</a> contains a lot of additional information on the YAML syntax.</p></li>
<li><p><a class="reference external" href="https://coderefinery.github.io/reproducible-research/">The Coderefinery Lesson about reproducible research</a> can give additional information about good coding practices and workflow automation.</p></li>
<li><p><a class="reference external" href="https://coderefinery.github.io/modular-type-along/">CodeRefinery’s lesson on Modular code development</a></p></li>
</ul>
</div>
</section>
</section>
<span id="document-profiling"></span><section id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand when improving code performance is worth the time and effort.</p></li>
<li><p>Knowing how to find performance bottlenecks in Python code.</p></li>
<li><p>Try <code class="docutils literal notranslate"><span class="pre">scalene</span></code> as one of many tools to profile Python code.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>Discussion: 20 min</p></li>
<li><p>Exercise: 20 min</p></li>
</ul>
</div>
<section id="should-we-even-optimize-the-code">
<h3>Should we even optimize the code?<a class="headerlink" href="#should-we-even-optimize-the-code" title="Link to this heading"></a></h3>
<p>Classic quote to keep in mind: “Premature optimization is the root of all evil.” [Donald Knuth]</p>
<figure class="align-default" id="id1">
<img alt="Humorous comic from xkcd that shows how long you can work on making a routine task more efficient before you're spending more time than you save?" src="https://imgs.xkcd.com/comics/is_it_worth_the_time.png" />
<figcaption>
<p><span class="caption-text">Figure 1: Is it worth the time? (<a class="reference external" href="https://xkcd.com/1205/">xkcd#1205</a>)</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-discussion discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion</p>
<p>It is important to ask ourselves whether it is worth it.</p>
<ul class="simple">
<li><p>Is it worth spending e.g. 2 days to make a program run 20% faster?</p></li>
<li><p>Is it worth optimizing the code so that it spends 90% less memory?</p></li>
</ul>
<p>Depends. What does it depend on?</p>
</div>
</section>
<section id="key-steps-of-optimization">
<h3>Key steps of optimization<a class="headerlink" href="#key-steps-of-optimization" title="Link to this heading"></a></h3>
<p>When you encounter a situation that you think would benefit from optimization,
follow these three steps:</p>
<ol class="arabic">
<li><p><strong>Measure:</strong> Before doing blind modifications you should figure out which
part of the code is actually the problem.</p>
<p>This is analogous to medical doctors doing lab tests and taking X-rays
to determine the disease. They won’t start treatment without figuring out
what is wrong with the patient.</p>
</li>
<li><p><strong>Diagnose:</strong> When you have found out the part of the code that is slow,
you should determine why it is slow. Doing changes without knowing why the
code is slow can be counter-productive. Remember that not all slow parts
can be endlessly optimized: some parts of the code might take time because
they do a lot of work.</p>
<p>This step is analogous to doctor creating a specialized treatment
program for a disease.</p>
</li>
<li><p><strong>Treat:</strong> When you have found out the slow part and figured what causes
it to be slow, you can then try to fix it.</p>
<p>This is analogous to doctor treating the disease with surgery or a
prescription.</p>
</li>
</ol>
</section>
<section id="using-profiling-to-measure-your-program">
<h3>Using profiling to measure your program<a class="headerlink" href="#using-profiling-to-measure-your-program" title="Link to this heading"></a></h3>
<p>While diagnosing and treating depends heavily on the case at hand, the
measurement part can be done with tools and tactics that show where the
bottlenecks are. This is called <strong>profiling</strong>.</p>
<p>Doing profiling is recommended for everyone. Even experienced programmers
can be surprised by the results of profiling.</p>
<div class="admonition-scale-matters-for-profiling discussion important admonition" id="discussion-1">
<p class="admonition-title">Scale matters for profiling</p>
<p>Sometimes we can configure the system size (for instance the time step in a simulation
or the number of time steps or the matrix dimensions) to make the program finish sooner.</p>
<p>For profiling, we should choose a system size that is <strong>representative of the real-world</strong>
use case. If we profile a program with a small input size, we might not see the same
bottlenecks as when running the program with a larger input size.</p>
<p>Often, when we scale up the system size, or scale the number of processors, new bottlenecks
might appear which we didn’t see before. This brings us back to: “measure instead of guessing”.</p>
<p>At the same time adding more time steps or more iterations can mean that the
program does the same things over and over again. Thus sometimes you can try to
profile a program for a shorter time and then extrapolate the results for the
case where you’re running for a longer time. When doing this be mindful to
profile enough so that you can make proper extrapolations.</p>
</div>
</section>
<section id="simplest-profiling-timers">
<h3>Simplest profiling: timers<a class="headerlink" href="#simplest-profiling-timers" title="Link to this heading"></a></h3>
<p>Simplest way of determining where the <strong>time-consuming parts</strong> are is to
insert timers into your code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span>

<span class="c1"># ...</span>
<span class="c1"># code before the function</span>


<span class="hll"><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class="n">result</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">()</span>
<span class="hll"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;some_function took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span>

<span class="c1"># code after the function</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>An alternative solution that also improves your code’s output is to
use Python’s
<a class="reference external" href="https://docs.python.org/3/library/logging.html">logging module</a> to log
important breakpoints in your code. You can then check the timestamps of
different log entries to see how long it took to execute a section
of your code.</p>
</section>
<section id="better-profiling-dedicated-profiling-tools">
<h3>Better profiling: Dedicated profiling tools<a class="headerlink" href="#better-profiling-dedicated-profiling-tools" title="Link to this heading"></a></h3>
<p>There are plenty of dedicated profile tools that can be used to profile
your code. These can measure the CPU time and memory utilization often on a
line-by-line level.</p>
<p>The list below here is probably not complete, but it gives an overview of the
different tools available for profiling Python code.</p>
<p><strong>CPU profilers:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/profile.html">cProfile and profile</a></p></li>
<li><p><a class="reference external" href="https://kernprof.readthedocs.io/">line_profiler</a></p></li>
<li><p><a class="reference external" href="https://github.com/benfred/py-spy">py-spy</a></p></li>
<li><p><a class="reference external" href="https://github.com/sumerc/yappi">Yappi</a></p></li>
<li><p><a class="reference external" href="https://pyinstrument.readthedocs.io/">pyinstrument</a></p></li>
<li><p><a class="reference external" href="https://perfetto.dev/docs/analysis/trace-processor-python">Perfetto</a></p></li>
</ul>
<p><strong>Memory profilers:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/memory-profiler/">memory_profiler</a> (not actively maintained)</p></li>
<li><p><a class="reference external" href="https://pympler.readthedocs.io/">Pympler</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/tracemalloc.html">tracemalloc</a></p></li>
<li><p><a class="reference external" href="https://github.com/zhuyifei1999/guppy3/">guppy/heapy</a></p></li>
</ul>
<p><strong>CPU, memory and GPU:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/plasma-umass/scalene">Scalene</a></p></li>
</ul>
</section>
<section id="tracing-profilers-vs-sampling-profilers">
<h3>Tracing profilers vs. sampling profilers<a class="headerlink" href="#tracing-profilers-vs-sampling-profilers" title="Link to this heading"></a></h3>
<p><strong>Tracing profilers</strong> record every function call and event in the program,
logging the exact sequence and duration of events.</p>
<ul class="simple">
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Provides detailed information on the program’s execution.</p></li>
<li><p>Deterministic: Captures exact call sequences and timings.</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Higher overhead, slowing down the program.</p></li>
<li><p>Can generate larger amount of data.</p></li>
</ul>
</li>
</ul>
<p><strong>Sampling profilers</strong> periodically samples the program’s state (where it is
and how much memory is used), providing a statistical view of where time is
spent.</p>
<ul class="simple">
<li><p><strong>Pros:</strong></p>
<ul>
<li><p>Lower overhead, as it doesn’t track every event.</p></li>
<li><p>Scales better with larger programs.</p></li>
</ul>
</li>
<li><p><strong>Cons:</strong></p>
<ul>
<li><p>Less precise, potentially missing infrequent or short calls.</p></li>
<li><p>Provides an approximation rather than exact timing.</p></li>
</ul>
</li>
</ul>
<div class="admonition-analogy-imagine-we-want-to-optimize-the-london-underground-subway-system discussion important admonition" id="discussion-2">
<p class="admonition-title">Analogy: Imagine we want to optimize the London Underground (subway) system</p>
<p>We wish to detect bottlenecks in the system to improve the service and for this we have
asked few passengers to help us by tracking their journey.</p>
<ul class="simple">
<li><p><strong>Tracing</strong>: We follow every train and passenger, recording every stop
and delay. When passengers enter and exit the train, we record the exact time
and location.</p></li>
<li><p><strong>Sampling</strong>: Every 5 minutes the phone notifies the passenger to note
down their current location. We then use this information to estimate
the most crowded stations and trains.</p></li>
</ul>
</div>
</section>
<section id="example-profiling-case-throwing-darts-to-calculate-pi">
<h3>Example profiling case: throwing darts to calculate pi<a class="headerlink" href="#example-profiling-case-throwing-darts-to-calculate-pi" title="Link to this heading"></a></h3>
<section id="problem-description">
<h4>Problem description<a class="headerlink" href="#problem-description" title="Link to this heading"></a></h4>
<p>In this example we’ll profile the following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_pi</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">n_darts</span>
    <span class="k">return</span> <span class="n">pi</span>
</pre></div>
</div>
<p>This code implements a well known example of the Monte Carlo method, where by
throwing darts at a dartboard we can calculate an approximation for pi.</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/dartboard.png"><img alt="Diagram that shows a unit circle inside a square with side length 1" src="_images/dartboard.png" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text">Figure 2: The algorithm throws darts at a dartboard and estimates pi by calculating the ratio of hits to throws</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="profiling-the-example">
<h4>Profiling the example<a class="headerlink" href="#profiling-the-example" title="Link to this heading"></a></h4>
<p>Let’s run this with <code class="docutils literal notranslate"><span class="pre">%%time</span></code>-magic and ten million throws:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">timeit</span>
<span class="n">calculate_pi</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1.07 s ± 30.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</pre></div>
</div>
<p>We can then profile the code with either cProfile by using the <code class="docutils literal notranslate"><span class="pre">%%prun</span></code> magic.
Here we tell the magic to sort the results by the total time used and to give us
top 5 time users:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">prun</span> <span class="o">-</span><span class="n">s</span> <span class="n">tottime</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_pi</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">n_darts</span>
    <span class="k">return</span> <span class="n">pi</span> 

<span class="n">calculate_pi</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">         30000742 function calls (30000736 primitive calls) in 4.608 seconds</span>

<span class="go">   Ordered by: internal time</span>
<span class="go">   List reduced from 150 to 5 due to restriction &lt;5&gt;</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">        4    2.545    0.636    4.005    1.001 {built-in method time.sleep}</span>
<span class="go"> 20000000    1.091    0.000    1.091    0.000 {method &#39;random&#39; of &#39;_random.Random&#39; objects}</span>
<span class="go"> 10000000    0.571    0.000    0.571    0.000 {built-in method math.sqrt}</span>
<span class="go">        3    0.172    0.057    0.270    0.090 {method &#39;poll&#39; of &#39;select.epoll&#39; objects}</span>
<span class="go">        1    0.148    0.148    0.233    0.233 &lt;string&gt;:1(calculate_pi)</span>
</pre></div>
</div>
<p>The output shows that most of the time is used by the <code class="docutils literal notranslate"><span class="pre">random.random</span></code> and
<code class="docutils literal notranslate"><span class="pre">math.sqrt</span></code> function calls. Those functions are called in every iteration of the loop,
so the profile makes sense.</p>
</section>
<section id="naive-optimization-switching-to-numpy-functions">
<h4>Naive optimization: switching to NumPy functions<a class="headerlink" href="#naive-optimization-switching-to-numpy-functions" title="Link to this heading"></a></h4>
<p>A naive approach to optimization might be to simply switch to using NumPy functions
instead of basic Python functions. The code would then look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_pi_numpy</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
<span class="hll">        <span class="n">i</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span class="hll">        <span class="n">j</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span class="hll">        <span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">n_darts</span>
    <span class="k">return</span> <span class="n">pi</span>
</pre></div>
</div>
<p>However, if we do the same profiling, we’ll find out that the program is
<strong>ten times slower</strong>. Something must have gone wrong.</p>
</section>
<section id="actual-optimization-using-vectorization">
<h4>Actual optimization: using vectorization<a class="headerlink" href="#actual-optimization-using-vectorization" title="Link to this heading"></a></h4>
<p>The reason for the bad performance is simple: we didn’t actually reduce
the number of function calls, we just switched them to ones from NumPy. These
function call have extra overhead because they have more complex logic compared
to the standard library ones.</p>
<p>The actual speedup is right around the corner: switch from the costly for-loop
to vectorized calls. NumPy’s functions can calculate all of the operations for
all of our numbers in a single function call without the for-loop:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_numpy_fast</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
<span class="hll">    <span class="n">i</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_darts</span><span class="p">)</span>
</span><span class="hll">    <span class="n">j</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_darts</span><span class="p">)</span>
</span><span class="hll">    <span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
</span><span class="hll">    <span class="n">hits</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
</span>    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">n_darts</span>
    <span class="k">return</span> <span class="n">pi</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">prun</span> <span class="o">-</span><span class="n">s</span> <span class="n">tottime</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_numpy_fast</span><span class="p">(</span><span class="n">n_darts</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_darts</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n_darts</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">)</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
    <span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">n_darts</span>
    <span class="k">return</span> <span class="n">pi</span>

<span class="n">calculate_numpy_fast</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">         664 function calls (658 primitive calls) in 0.225 seconds</span>

<span class="go">   Ordered by: internal time</span>
<span class="go">   List reduced from 129 to 5 due to restriction &lt;5&gt;</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">        1    0.202    0.202    0.205    0.205 &lt;string&gt;:1(calculate_numpy_fast)</span>
<span class="go">        2    0.010    0.005    0.010    0.005 {method &#39;__exit__&#39; of &#39;sqlite3.Connection&#39; objects}</span>
<span class="go">      2/1    0.009    0.005    0.214    0.214 &lt;string&gt;:1(&lt;module&gt;)</span>
<span class="go">        1    0.002    0.002    0.002    0.002 {method &#39;reduce&#39; of &#39;numpy.ufunc&#39; objects}</span>
<span class="go">        1    0.001    0.001    0.010    0.010 history.py:92(only_when_enabled)</span>
</pre></div>
</div>
<p>So vectorizing the code achieved around five times speedup.</p>
</section>
<section id="profiling-with-scalene">
<h4>Profiling with scalene<a class="headerlink" href="#profiling-with-scalene" title="Link to this heading"></a></h4>
<p>The previous example can also be profiled with
<a class="reference external" href="https://github.com/plasma-umass/scalene">scalene</a>. Scalene is a sampling
profiler and it can be run in Jupyter as well with <code class="docutils literal notranslate"><span class="pre">%scrun</span></code> (line-mode) and
<code class="docutils literal notranslate"><span class="pre">%%scalene</span></code> (cell-mode).</p>
<p>Scalene will produce a nice looking output containing line-by-line profiling
information.</p>
</section>
</section>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h3>
<div class="admonition-exercise-practicing-profiling exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise: Practicing profiling</p>
<p>In this exercise we will use the Scalene profiler to find out where most of the time is spent
and most of the memory is used in a given code example.</p>
<p>Please try to go through the exercise in the following steps:</p>
<ol class="arabic">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">scalene</span></code> is installed in your environment (if you have followed
this course from the start and installed the recommended software
environment, then it is).</p></li>
<li><p>Download Leo Tolstoy’s “War and Peace” from the following link (the text is
provided by <a class="reference external" href="https://www.gutenberg.org/">Project Gutenberg</a>):
<a class="reference external" href="https://www.gutenberg.org/cache/epub/2600/pg2600.txt">https://www.gutenberg.org/cache/epub/2600/pg2600.txt</a>
(right-click and “save as” to download the file and <strong>save it as “book.txt”</strong>).</p></li>
<li><p><strong>Before</strong> you run the profiler, try to predict in which function the code
(the example code is below)
will spend most of the time and in which function it will use most of the
memory.</p></li>
<li><p>Save the example code as <code class="docutils literal notranslate"><span class="pre">example.py</span></code> and
run the <code class="docutils literal notranslate"><span class="pre">scalene</span></code> profiler on the following code example and browse the
generated HTML report to find out where most of the time is spent and where
most of the memory is used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scalene<span class="w"> </span>example.py
</pre></div>
</div>
<p>Alternatively you can do this (and then open the generated file in a browser):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scalene<span class="w"> </span>example.py<span class="w"> </span>--html<span class="w"> </span>&gt;<span class="w"> </span>profile.html
</pre></div>
</div>
<p>You can find an example of the generated HTML report in the solution below.</p>
</li>
<li><p>Does the result match your prediction? Can you explain the results?</p></li>
</ol>
<p>Example code (<code class="docutils literal notranslate"><span class="pre">example.py</span></code>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The code below reads a text file and counts the number of unique words in it</span>
<span class="sd">(case-insensitive).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>


<span class="k">def</span><span class="w"> </span><span class="nf">count_unique_words1</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">count_unique_words2</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_words</span><span class="p">:</span>
                    <span class="n">unique_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">count_unique_words3</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">unique_words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># book.txt is downloaded from https://www.gutenberg.org/cache/epub/2600/pg2600.txt</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words1</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words2</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>
    <span class="n">_result</span> <span class="o">=</span> <span class="n">count_unique_words3</span><span class="p">(</span><span class="s2">&quot;book.txt&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/exercise1.png"><img alt="Result of the profiling run for the above code example." src="_images/exercise1.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Result of the profiling run for the above code example. You can click on the image to make it larger.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Results:</p>
<ul class="simple">
<li><p>Most time is spent in the <code class="docutils literal notranslate"><span class="pre">count_unique_words2</span></code> function.</p></li>
<li><p>Most memory is used in the <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> function.</p></li>
</ul>
<p>Explanation:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words2</span></code> function is the slowest because it <strong>uses a list</strong>
to store unique words and checks if a word is already in the list before
adding it.
Checking whether a list contains an element might require traversing the
whole list, which is an O(n) operation. As the list grows in size,
the lookup time increases with the size of the list.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> and <code class="docutils literal notranslate"><span class="pre">count_unique_words3</span></code> functions are faster
because they <strong>use a set</strong> to store unique words.
Checking whether a set contains an element is an O(1) operation.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words1</span></code> function uses the most memory because it <strong>creates
a list of all words</strong> in the text file and then <strong>creates a set</strong> from that
list.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">count_unique_words3</span></code> function uses less memory because it traverses
the text file line by line instead of reading the whole file into memory.</p></li>
</ul>
<p>What we can learn from this exercise:</p>
<ul class="simple">
<li><p>When processing large files, it can be good to read them line by line
or in batches
instead of reading the whole file into memory.</p></li>
<li><p>It is good to get an overview over standard data structures and their
advantages and disadvantages (e.g. adding an element to a list is fast but checking whether
it already contains the element can be slow).</p></li>
</ul>
</div>
</div>
</section>
<section id="additional-resources">
<h3>Additional resources<a class="headerlink" href="#additional-resources" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://enccs.github.io/python-perf/profile/">Python performance workshop (by ENCCS)</a></p></li>
</ul>
</section>
</section>
<span id="document-productivity"></span><section id="productivity-tools">
<h2>Productivity tools<a class="headerlink" href="#productivity-tools" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Know about tools that can help you <strong>spot code problems</strong> and help you following
a <strong>consistent code style</strong> without you having to do it manually.</p></li>
<li><p>Get an overview of <strong>AI-based tools</strong> and how they can help you
writing code.</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>Demo/discussion: 20 min</p></li>
</ul>
</div>
<section id="linters-and-formatters">
<h3>Linters and formatters<a class="headerlink" href="#linters-and-formatters" title="Link to this heading"></a></h3>
<p><strong>Linter</strong>: Tool that analyzes source code to detect potential errors, unused
imports, unused variables, code style violations, and to improve readability.</p>
<ul class="simple">
<li><p>Popular linters:</p>
<ul>
<li><p><a class="reference external" href="https://pypi.org/project/autoflake/">Autoflake</a></p></li>
<li><p><a class="reference external" href="https://flake8.pycqa.org/">Flake8</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/pyflakes/">Pyflakes</a></p></li>
<li><p><a class="reference external" href="https://pycodestyle.pycqa.org/">Pycodestyle</a></p></li>
<li><p><a class="reference external" href="https://pylint.readthedocs.io/">Pylint</a></p></li>
<li><p><a class="reference external" href="https://docs.astral.sh/ruff/">Ruff</a></p></li>
</ul>
</li>
</ul>
<p><strong>Formatter</strong>: Tool that automatically formats your code to a consistent style,
for instance following <a class="reference external" href="https://peps.python.org/pep-0008/">PEP 8</a>.</p>
<ul class="simple">
<li><p>Popular formatters:</p>
<ul>
<li><p><a class="reference external" href="https://black.readthedocs.io/">Black</a></p></li>
<li><p><a class="reference external" href="https://github.com/google/yapf">YAPF</a></p></li>
<li><p><a class="reference external" href="https://docs.astral.sh/ruff/">Ruff</a></p></li>
</ul>
</li>
</ul>
<p>In this course we will focus on <a class="reference external" href="https://docs.astral.sh/ruff/">Ruff</a> since it
can do <strong>both checking and formatting</strong> and you don’t have to switch between
multiple tools.</p>
<div class="admonition-linters-and-formatters-can-be-configured-to-your-liking discussion important admonition" id="discussion-0">
<p class="admonition-title">Linters and formatters can be configured to your liking</p>
<p>These tools typically have good defaults. But if you don’t like the defaults,
you can configure what they should ignore or how they should format or not format.</p>
</div>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<p>This code example (which we possibly recognize from the previous section about
<a class="reference external" href="https://docs.python.org/3/c-api/init.html#profiling" title="(in Python v3.14)"><span>Profiling and Tracing</span></a>)
has few problems (highlighted):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="hll"><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span>

<span class="k">def</span><span class="w"> </span><span class="nf">count_unique_words</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="hll">    <span class="n">forgotten_variable</span> <span class="o">=</span> <span class="mi">13</span>
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
<span class="hll">            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</span>            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">unique_words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>
</pre></div>
</div>
<p>Please try whether you can locate these problems using Ruff:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ruff<span class="w"> </span>check
</pre></div>
</div>
<p>Next, let us try to auto-format a code example which is badly formatted and also difficult
to read:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Badly formatted</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Auto-formatted</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="k">def</span><span class="w">  </span><span class="nf">count_unique_words</span> <span class="p">(</span><span class="n">file_path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
  <span class="n">unique_words</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
      <span class="n">words</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
      <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">unique_words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">len</span><span class="p">(</span>   <span class="n">unique_words</span>   <span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>


<span class="k">def</span><span class="w"> </span><span class="nf">count_unique_words</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">unique_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b\w+\b&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">unique_words</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">)</span>
</pre></div>
</div>
<p>This was done using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ruff<span class="w"> </span>format
</pre></div>
</div>
</div></div>
</section>
<section id="type-checking">
<h3>Type checking<a class="headerlink" href="#type-checking" title="Link to this heading"></a></h3>
<p>A (static) type checker is a tool that checks whether the types of variables in your
code match the types that you have specified.</p>
<ul class="simple">
<li><p>Tools:</p>
<ul>
<li><p><a class="reference external" href="https://mypy.readthedocs.io/">Mypy</a></p></li>
<li><p><a class="reference external" href="https://github.com/microsoft/pyright">Pyright</a> (Microsoft)</p></li>
<li><p><a class="reference external" href="https://pyre-check.org/">Pyre</a> (Meta)</p></li>
</ul>
</li>
</ul>
</section>
<section id="integration-with-editors">
<h3>Integration with editors<a class="headerlink" href="#integration-with-editors" title="Link to this heading"></a></h3>
<p>Many/most of the above tools can be integrated with your editor.  For instance,
you can configure your editor to automatically format your code when you save
the file. However, this only makes sense when all team members agree to follow
the same style, otherwise saving and possibly committing changes to version
control will show up changes to code written by others which you possibly
didn’t intend to make.</p>
</section>
<section id="integration-with-jupyter-notebooks">
<h3>Integration with Jupyter notebooks<a class="headerlink" href="#integration-with-jupyter-notebooks" title="Link to this heading"></a></h3>
<p>It is possible to automatically format your code in Jupyter notebooks!
For this to work you need
the following three dependencies installed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jupyterlab-code-formatter</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">black</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isort</span></code></p></li>
</ul>
<p>More information and a screen-cast of how this works can be found at
<a class="reference external" href="https://jupyterlab-code-formatter.readthedocs.io/">https://jupyterlab-code-formatter.readthedocs.io/</a>.</p>
</section>
<section id="integration-with-version-control">
<h3>Integration with version control<a class="headerlink" href="#integration-with-version-control" title="Link to this heading"></a></h3>
<p>If you use version control and like to have your code checked or formatted
<strong>before you commit the change</strong>, you can use tools like <a class="reference external" href="https://pre-commit.com/">pre-commit</a>.</p>
</section>
<section id="ai-assisted-coding">
<h3>AI-assisted coding<a class="headerlink" href="#ai-assisted-coding" title="Link to this heading"></a></h3>
<p>We can use AI as an assistant/apprentice:</p>
<ul class="simple">
<li><p>Code completion</p></li>
<li><p>Write a test based on an implementation</p></li>
<li><p>Write an implementation based on a test</p></li>
</ul>
<p>Or we can use AI as a mentor:</p>
<ul class="simple">
<li><p>Explain a concept</p></li>
<li><p>Improve code</p></li>
<li><p>Show a different (possibly better) way of implementing the same thing</p></li>
</ul>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/chatgpt.png"><img alt="Screenshot of ChatGPT" src="_images/chatgpt.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Example for using a chat-based AI tool.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="_images/code-completion.gif"><img alt="Screen-cast of working with GitHub Copilot" src="_images/code-completion.gif" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">Example for using AI to complete code in an editor.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-ai-tools-open-up-a-box-of-questions admonition">
<p class="admonition-title">AI tools open up a box of questions</p>
<ul class="simple">
<li><p>Legal</p></li>
<li><p>Ethical</p></li>
<li><p>Privacy</p></li>
<li><p>Lock-in/ monopolies</p></li>
<li><p>Lack of diversity</p></li>
<li><p>Will we still need to learn programming?</p></li>
<li><p>How will it affect learning and teaching programming?</p></li>
</ul>
</div>
</section>
</section>
<span id="document-scipy"></span><section id="scipy">
<h2>SciPy<a class="headerlink" href="#scipy" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>When you need more advanced mathematical functions, where do you
look?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand that SciPy exists and what kinds of things it has.</p></li>
<li><p>Understand the importance of using external libraries and how to
use them.</p></li>
<li><p>Understand the purpose of wrapping existing C/Fortran code.</p></li>
<li><p>Non-objective: know details of everything (or anything) in SciPy.</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p>Main article: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">SciPy documentation</a></p></li>
</ul>
</div>
<p>SciPy is a library that builds on top of NumPy. It contains a lot of
interfaces to battle-tested numerical routines written in Fortran or
C, as well as python implementations of many common algorithms.</p>
<section id="what-s-in-scipy">
<h3>What’s in SciPy?<a class="headerlink" href="#what-s-in-scipy" title="Link to this heading"></a></h3>
<p>Briefly, it contains functionality for</p>
<ul class="simple">
<li><p>Special functions (Bessel, Gamma, etc.)</p></li>
<li><p>Numerical integration</p></li>
<li><p>Optimization</p></li>
<li><p>Interpolation</p></li>
<li><p>Fast Fourier Transform (FFT)</p></li>
<li><p>Signal processing</p></li>
<li><p>Linear algebra (more complete than in NumPy)</p></li>
<li><p>Sparse matrices</p></li>
<li><p>Statistics</p></li>
<li><p>More I/O routine, e.g. Matrix Market format for sparse matrices,
MATLAB files (.mat), etc.</p></li>
</ul>
<p>Many (most?) of these are not written specifically for SciPy, but use
the best available open source C or Fortran libraries.  Thus, you get
the best of Python and the best of compiled languages.</p>
<p>Most functions are documented ridiculously well from a scientific
standpoint: you aren’t just using some unknown function, but have a
full scientific description and citation to the method and
implementation.</p>
</section>
<section id="exercises-use-scipy">
<h3>Exercises: use SciPy<a class="headerlink" href="#exercises-use-scipy" title="Link to this heading"></a></h3>
<p>These exercises do not exist because <em>you</em> might need <em>these</em>
functions someday.  They are because <em>you</em> will need to <em>read
documentation and understand documentation of an an external library</em>
eventually.</p>
<section id="numerical-integration">
<h4>1: Numerical integration<a class="headerlink" href="#numerical-integration" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<p>Do the following exercise <strong>or</strong> read the documentation and
understand the relevant functions of SciPy:</p>
<p>Define a function of one variable and using
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.quad.html#scipy.integrate.quad">scipy.integrate.quad</a>
calculate the integral of your function in the
interval <code class="docutils literal notranslate"><span class="pre">[0.0,</span> <span class="pre">4.0]</span></code>. Then vary the interval and also modify the function and check
whether scipy can integrate it.</p>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">integrate</span>

<span class="k">def</span><span class="w"> </span><span class="nf">myfunction</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># you need to define result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">integral</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">myfunction</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">integral</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.quad.html#scipy.integrate.quad">quad</a>
uses the Fortran library QUADPACK, which one can assume is pretty
good.  You can also see a whole lot of scientific information about
the function on the docs page - including the scientific names of
the methods used.</p>
</div>
</section>
<section id="sparse-matrices">
<h4>2: Sparse matrices<a class="headerlink" href="#sparse-matrices" title="Link to this heading"></a></h4>
<div class="admonition-exercise exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise</p>
<p>Do the following exercise <strong>or</strong> read the documentation and
understand the relevant functions of SciPy:</p>
<p>Use the SciPy sparse matrix functionality to create a random sparse
matrix with a probability of non-zero elements of 0.05 and size 10000
x 10000. The use the SciPy sparse linear algebra support to calculate
the matrix-vector product of the sparse matrix you just created and a
random vector. Use the %timeit macro to measure how long it
takes. Does the optional <code class="docutils literal notranslate"><span class="pre">format</span></code> argument when you create the
sparse matrix make a difference?</p>
<p>Then, compare to how long it takes if you’d instead first convert the
sparse matrix to a normal NumPy dense array, and use the NumPy <code class="docutils literal notranslate"><span class="pre">dot</span></code>
method to calculate the matrix-vector product.</p>
<p>Can you figure out a quick rule of thumb when it’s worth using a
sparse matrix representation vs. a dense representation?</p>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>The basic code to do the test is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.sparse</span>

<span class="n">vector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csc&#39;</span><span class="p">)</span>

<span class="c1"># We time this line</span>
<span class="n">matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</pre></div>
</div>
<p>From the top of the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/sparse.html">spare matrix module documentation</a>, we can
see there are a variety of different available sparse matrix types:
<code class="docutils literal notranslate"><span class="pre">bsr</span></code>, <code class="docutils literal notranslate"><span class="pre">coo</span></code>, <code class="docutils literal notranslate"><span class="pre">csr</span></code>, <code class="docutils literal notranslate"><span class="pre">csc</span></code>, etc.  These each represent a
different way of storing the matrices.</p>
<p>It seems that <code class="docutils literal notranslate"><span class="pre">csr</span></code> and <code class="docutils literal notranslate"><span class="pre">csc</span></code> are fairly fast.  <code class="docutils literal notranslate"><span class="pre">lil</span></code> and
<code class="docutils literal notranslate"><span class="pre">dok</span></code> are slow but it says that these are good for creating
matrices with random insertions.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">csr</span></code> takes 7ms, <code class="docutils literal notranslate"><span class="pre">lil</span></code> 42ms, <code class="docutils literal notranslate"><span class="pre">dok</span></code> 1600ms, and
converting to a non-sparse array <code class="docutils literal notranslate"><span class="pre">matrix.toarray()</span></code> and
multiplying takes 64ms on one particular computer.</p>
<p>This code allows us to time the performance at different
densities.  It seems that with the <code class="docutils literal notranslate"><span class="pre">csr</span></code> format, sparse is better
below densities of around .4 to .5:</p>
<p>..code-block:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">density</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">.01</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.3</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]:</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csr&#39;</span><span class="p">)</span>
    <span class="n">time_sparse</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;matrix.dot(vector)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
    <span class="n">matrix2</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
    <span class="n">time_full</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;matrix2.dot(vector)&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">density</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">time_sparse</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">time_full</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/tutorial/general.html">SciPy general introduction</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">SciPy documentation</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>When you need advance math or scientific functions, let’s just
admit it: you do a web search first.</p></li>
<li><p>But when you see something in SciPy come up, you know your
solutions are in good hands.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-libraries"></span><section id="library-ecosystem">
<h2>Library ecosystem<a class="headerlink" href="#library-ecosystem" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>What happens when you need some method beyond what we discuss in this course, what is available?</p></li>
<li><p>How do you decide what to build on for your work?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Know of some other available packages, but don’t necessarily know
how to use them.</p></li>
<li><p>Be able to evaluate what you should reuse and what you should
develop yourself.</p></li>
</ul>
</div>
<p>You can’t do everything yourself.  In fact, once we heard a quote such
as this:</p>
<blockquote>
<div><p>When you are a student, you are expected to do everything
yourself, and that is how you are evaluated.  When you become a
researcher, you <em>have</em> to be able to reuse what others have done.
We don’t have much practice in doing this.
– A student</p>
</div></blockquote>
<p>In this lesson, we’ll talk about the broader ecosystem in Python: all
the resources you have available to you.  Perhaps we can even classify
this into two types:</p>
<ul class="simple">
<li><p>Well-maintained libraries that are used by many others.</p></li>
<li><p>A wide variety of public code that might work but isn’t necessarily
well-maintained (for example, code from articles).</p></li>
</ul>
<p>We’ll start with the first then go to the second.</p>
<section id="glossary">
<h3>Glossary<a class="headerlink" href="#glossary" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>Library</dt><dd><p>A collection of code used by a program.</p>
</dd>
<dt>Package</dt><dd><p>A library that has been made easily installable and reusable.
Often published on public repositories such as the <a class="reference external" href="https://pypi.python.org">Python Package
Index</a></p>
</dd>
<dt>Dependency</dt><dd><p>A requirement of another program, not included in that program.</p>
</dd>
</dl>
</section>
<section id="the-python-scipy-ecosystem">
<h3>The Python/SciPy ecosystem<a class="headerlink" href="#the-python-scipy-ecosystem" title="Link to this heading"></a></h3>
<p>This section is nothing more than a tour of what exists in Python.
You aren’t expected to particularly remember any of these right now,
but searching for these repositories is a starting point of a lot of
future work.</p>
<p>The “core” packages <a class="reference external" href="https://www.scipy.org/about/">could be considered</a>.  Many other packages build on
these, and others that try to do similar things often try to conform
to their interfaces (especially numpy):</p>
<ul class="simple">
<li><p>Python</p></li>
<li><p>Numpy - arrays, everything builds on this</p></li>
<li><p>Scipy - scientific functions (not necessarily a lot builds on this)</p></li>
<li><p>matplotlib - plotting, many other plotting tools build on this</p></li>
<li><p>pandas - data structures</p></li>
<li><p>IPython / Jupyter: interactive work</p></li>
</ul>
<section id="core-numerics-libraries">
<h4>Core numerics libraries<a class="headerlink" href="#core-numerics-libraries" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/">numpy</a> - Arrays and array math.</p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/">scipy</a> - Software
for math, science, and engineering.</p></li>
</ul>
</section>
<section id="plotting">
<h4>Plotting<a class="headerlink" href="#plotting" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://matplotlib.org/">matplotlib</a> - Base plotting package,
somewhat low level but almost everything builds on it.</p></li>
<li><p><a class="reference external" href="https://seaborn.pydata.org/">seaborn</a> - Higher level plotting
interface; statistical graphics.</p></li>
<li><p><a class="reference external" href="https://altair-viz.github.io/">Vega-Altair</a> - Declarative Python
plotting.</p></li>
<li><p><a class="reference external" href="https://docs.enthought.com/mayavi/mayavi/">mayavi</a> - 3D plotting</p></li>
<li><p><a class="reference external" href="https://plotly.com/python/">Plotly</a> - Big graphing library.</p></li>
</ul>
</section>
<section id="data-analysis-and-other-important-core-packages">
<h4>Data analysis and other important core packages<a class="headerlink" href="#data-analysis-and-other-important-core-packages" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/docs/user_guide/">pandas</a> - Columnar
data analysi.</p></li>
<li><p><cite>polars &lt;https://pola.rs/&gt;</cite> - Alternative to pandas that uses similar
API, but is re-imagined for more speed.</p></li>
<li><p><a class="reference external" href="https://vaex.io/docs/index.html">Vaex</a> - Alternative for pandas
that uses similar API for lazy-loading and processing huge DataFrames.</p></li>
<li><p><a class="reference external" href="https://www.dask.org/">Dask</a> - Alternative to Pandas that uses
similar API and can do analysis in parallel.</p></li>
<li><p><a class="reference external" href="https://docs.xarray.dev/en/stable/">xarrray</a> - Framework for
working with mutli-dimensional arrays.</p></li>
<li><p><a class="reference external" href="https://www.statsmodels.org/stable/">statsmodels</a> - Statistical
models and tests.</p></li>
<li><p><a class="reference external" href="https://www.sympy.org/">SymPy</a> - Symbolic math.</p></li>
<li><p><a class="reference external" href="https://networkx.org/">networkx</a> - Graph and network analysis.</p></li>
<li><p><a class="reference external" href="https://graph-tool.skewed.de/">graph-tool</a> - Graph and network analysis
toolkit implemented in C++.</p></li>
</ul>
</section>
<section id="interactive-computing-and-human-interface">
<h4>Interactive computing and human interface<a class="headerlink" href="#interactive-computing-and-human-interface" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Interactive computing</p>
<ul>
<li><p><a class="reference external" href="https://ipython.org/">IPython</a> - Nicer interactive interpreter</p></li>
<li><p><a class="reference external" href="https://jupyter.org/">Jupyter</a> - Web-based interface to IPython
and other languages (includes projects such as jupyter notebook,
lab, hub, …)</p></li>
</ul>
</li>
<li><p>Testing</p>
<ul>
<li><p><a class="reference external" href="https://docs.pytest.org/">pytest</a> - Automated testing interface</p></li>
</ul>
</li>
<li><p>Documentation</p>
<ul>
<li><p><a class="reference external" href="https://www.sphinx-doc.org/">Sphinx</a> - Documentation generator
(also used for this lesson…)</p></li>
</ul>
</li>
<li><p>Development environments</p>
<ul>
<li><p><a class="reference external" href="https://www.spyder-ide.org/">Spyder</a> - Interactive Python
development environment.</p></li>
<li><p><a class="reference external" href="https://code.visualstudio.com/">Visual Studio Code</a> - Microsoft’s
flagship code editor.</p></li>
<li><p><a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a> - JetBrains’s
Python IDE.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://mybinder.org/">Binder</a> - load any git repository in
Jupyter automatically, good for reproducible research</p></li>
</ul>
</section>
<section id="data-format-support-and-data-ingestion">
<h4>Data format support and data ingestion<a class="headerlink" href="#data-format-support-and-data-ingestion" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://python-pillow.org/">pillow</a> - Image manipulation.  The
original PIL is no longer maintained, the new “Pillow” is a drop-in
replacement.</p></li>
<li><p><a class="reference external" href="https://www.h5py.org/">h5py</a> and <a class="reference external" href="https://www.pytables.org/">PyTables</a> -
Interfaces to the <a class="reference external" href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format">HDF5</a>
file format.</p></li>
</ul>
</section>
<section id="speeding-up-code-and-parallelism">
<h4>Speeding up code and parallelism<a class="headerlink" href="#speeding-up-code-and-parallelism" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/">MPI for Python (mpi4py)</a> - Message
Passing Interface (MPI) in Python for parallelizing jobs.</p></li>
<li><p><a class="reference external" href="https://cython.org/">cython</a> - easily make C extensions for
Python, also interface to C libraries</p></li>
<li><p><a class="reference external" href="https://numba.pydata.org/">numba</a> - just in time compiling of
functions for speed-up</p></li>
<li><p><a class="reference external" href="https://www.pypy.org/">PyPy</a> - Python written in Python so that
it can internally optimize more.</p></li>
<li><p><a class="reference external" href="https://www.dask.org/">Dask</a> - Distributed array data structure for
distributed computation</p></li>
<li><p><a class="reference external" href="https://joblib.readthedocs.io/">Joblib</a> - Easy embarrassingly
parallel computing</p></li>
<li><p><a class="reference external" href="https://ipyparallel.readthedocs.io/">IPyParallel</a> - Easy
parallel task engine.</p></li>
<li><p><a class="reference external" href="https://numexpr.readthedocs.io/">numexpr</a> - Fast evaluation of
array expressions by automatically compiling the arithmetic.</p></li>
</ul>
</section>
<section id="machine-learning">
<h4>Machine learning<a class="headerlink" href="#machine-learning" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.nltk.org/">nltk</a> - Natural language processing
toolkit.</p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/">scikit-learn</a> - Traditional
machine learning toolkit.</p></li>
<li><p><a class="reference external" href="https://xgboost.readthedocs.io/en/stable/">xgboost</a> - Toolkit for
gradient boosting algorithms.</p></li>
</ul>
</section>
<section id="deep-learning">
<h4>Deep learning<a class="headerlink" href="#deep-learning" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.tensorflow.org/">tensorflow</a> - Deep learning
library by Google.</p></li>
<li><p><a class="reference external" href="https://pytorch.org/">pytorch</a> - Currently the most popular
deep learning library.</p></li>
<li><p><a class="reference external" href="https://keras.io/">keras</a> - Simple libary for doing deep learning.</p></li>
<li><p><a class="reference external" href="https://huggingface.co">huggingface</a> - Ecosystem for sharing
and running deep learning models and datasets. Incluses packages
like <code class="docutils literal notranslate"><span class="pre">transformers</span></code>, <code class="docutils literal notranslate"><span class="pre">datasets</span></code>, <code class="docutils literal notranslate"><span class="pre">accelerate</span></code>, etc.</p></li>
<li><p><a class="reference external" href="https://jax.readthedocs.io/en/latest/index.html">jax</a> - Google’s
Python library for running NumPy and automatic differentiation
on GPUs.</p></li>
<li><p><a class="reference external" href="https://flax.readthedocs.io/en/latest/">flax</a> - Neural network
framework built on Jax.</p></li>
<li><p><a class="reference external" href="https://docs.kidger.site/equinox/">equinox</a> - Another neural
network framework built on Jax.</p></li>
<li><p><a class="reference external" href="https://www.deepspeed.ai/">DeepSpeed</a> - Algorithms for running
massive scale trainings. Included in many of the frameworks.</p></li>
<li><p><a class="reference external" href="https://lightning.ai/docs/pytorch/stable/">PyTorch Lightning</a> -
Framework for creating and training PyTorch models.</p></li>
<li><p><cite>Tensorboard &lt;https://www.tensorflow.org/tensorboard/&gt;</cite> - Tool
for visualizing model training on a web page.</p></li>
</ul>
</section>
<section id="other-packages-for-special-cases">
<h4>Other packages for special cases<a class="headerlink" href="#other-packages-for-special-cases" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://dateutil.readthedocs.io/">dateutil</a> and <a class="reference external" href="https://pythonhosted.org/pytz/">pytz</a> - Date arithmetic and handling,
timezone database and conversion.</p></li>
</ul>
</section>
</section>
<section id="connecting-python-to-other-languages">
<h3>Connecting Python to other languages<a class="headerlink" href="#connecting-python-to-other-languages" title="Link to this heading"></a></h3>
<p>As we discussed with Scipy, very many of the above packages aren’t
written in Python: they are written in some other language and have a
Python interface.  Python is written in C, and thus has great C
interfaces.  This contributes to two things:</p>
<ul class="simple">
<li><p><strong>Extending Python</strong> by writing your own modules in C.</p>
<ul>
<li><p>It’s actually common to first have (or write) an analysis package
in C or C++, then make the Python interface.  Then it can be
supported by other languages, too.</p></li>
<li><p>Or one starts an analysis package in Python, and slowly moves bits
of it to C over time as there is need.</p></li>
</ul>
</li>
<li><p><strong>Embedding Python</strong>, where you have another primary application
that uses Python under the hood as an internal scripting language.</p></li>
</ul>
<p>These features aren’t exactly unique to Python, but Python does
support them very well.  Read more: <a class="reference external" href="https://docs.python.org/extending/index.html">Extending and embedding Python</a>.</p>
<section id="tools-for-interfacing-with-other-languages">
<h4>Tools for interfacing with other languages<a class="headerlink" href="#tools-for-interfacing-with-other-languages" title="Link to this heading"></a></h4>
<p>These days, one rarely directly extends the Python interpreter, but uses</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cffi.readthedocs.io/">cffi</a> and <a class="reference external" href="https://docs.python.org/3/library/ctypes.html">ctypes</a> - interface to C
and compatible libraries</p></li>
<li><p><a class="reference external" href="https://cython.org/">cython</a> - easily make C extensions for
Python, also interface to C libraries</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/f2py/">f2py</a> - interface to Fortran
code</p></li>
<li><p><a class="reference external" href="https://swig.org/">swig</a> - connect to a variety of programming languages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Boost.python</span></code> - Another Python/C++ interface</p></li>
<li><p>[PythonCall.jl](<a class="reference external" href="https://github.com/JuliaPy/PythonCall.jl">https://github.com/JuliaPy/PythonCall.jl</a>) – Interface to call Julia from Python and viceversa</p></li>
</ul>
</section>
</section>
<section id="evaluating-python-packages-for-reuse">
<h3>Evaluating Python packages for reuse<a class="headerlink" href="#evaluating-python-packages-for-reuse" title="Link to this heading"></a></h3>
<p>Above, we talked about well-maintained mainstream packages.  <strong>Do you
trust random code you find online (for example included in a paper)?</strong></p>
<p>Especially consider scientific results, which <em>have</em> to be correct.
Still, you also <em>can’t</em> build everything yourself, so you have to
carefully evaluate the situation.</p>
<p>Below are some things to consider:</p>
<ul class="simple">
<li><p>Are there releases?  Have they been going on for a while?</p></li>
<li><p>Are releases installable without copy-paste?</p></li>
<li><p>Are dependencies handled well?</p></li>
<li><p>Does the code randomly change, so that it no longer works with your
code.  Is this relevant?</p></li>
<li><p>Is there good documentation, that not just tells how to use it but
how it works?</p></li>
<li><p>Is there automated testing?  What’s your evaluation of the risk of
undetectable scientific errors?</p></li>
<li><p>Is there a community, or is it one person?  Is it backed by some
organization?  Does it have a permanent home?</p></li>
<li><p>Is it is a public hosting site (GitLab, GitHub, Bitbucket, etc)
where a community <em>could</em> form?</p></li>
<li><p>Do others post issues and make contributions?  Are these issues
dealt with in a timely manner?  Can you search past bug reports?</p></li>
<li><p>Is the software citeable?</p></li>
</ul>
</section>
<section id="is-your-work-reuseable">
<h3>Is your work reuseable?<a class="headerlink" href="#is-your-work-reuseable" title="Link to this heading"></a></h3>
<p>Every small project you do contributes a little bit to the Python and
SciPy ecosystem.  This course has sort of started you on that path,
and a <a class="reference external" href="https://coderefinery.org">CodeRefinery workshop</a> will make
sure you have the tools to produce high-quality, reusable code.</p>
</section>
<section id="what-s-next">
<h3>What’s next?<a class="headerlink" href="#what-s-next" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The <a class="reference external" href="https://coderefinery.org">CodeRefinery workshop</a> mentioned
above will prepare you for others to reuse your code and for you to
contribute to other code.</p></li>
<li><p>The upcoming <a class="reference internal" href="#document-dependencies"><span class="doc">Dependency management</span></a> lesson will teach you how to
record and manage dependencies so that anyone can seamlessly reuse
your code.</p></li>
</ul>
</section>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h3>
<div class="admonition-libraries-1-1-libraries-in-your-work exercise important admonition" id="exercise-0">
<p class="admonition-title">Libraries 1.1: Libraries in your work</p>
<p>What libraries do you use in your work?  What have you made, which
you could have reused from some other source.  What have you used
from some other source that you wished you had re-created?</p>
<p>Discuss in the collaborative document.</p>
</div>
<div class="admonition-libraries-1-1 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Libraries 1.1</p>
<p>… is there anything to say here?</p>
</div>
<div class="admonition-libraries-1-2-evaluating-packages exercise important admonition" id="exercise-1">
<p class="admonition-title">Libraries 1.2: Evaluating packages</p>
<p>Below are some links to some packages, both public and made by the
authors of this lesson.  Evaluate them, considering “would I use
this in my project?”</p>
<ol class="loweralpha simple">
<li><p><a class="reference external" href="https://github.com/networkx/networkx/">https://github.com/networkx/networkx/</a></p></li>
<li><p>some code on webpage in a paper’s footnote</p></li>
<li><p><a class="reference external" href="https://github.com/rkdarst/pcd">https://github.com/rkdarst/pcd</a></p></li>
<li><p><a class="reference external" href="https://github.com/dftlibs/numgrid">https://github.com/dftlibs/numgrid</a></p></li>
<li><p><a class="reference external" href="https://github.com/rkdarst/dynbench">https://github.com/rkdarst/dynbench</a></p></li>
<li><p><a class="reference external" href="https://vpython.org/">https://vpython.org/</a></p></li>
</ol>
</div>
<div class="admonition-libraries-1-2 solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Libraries 1.2</p>
<ol class="loweralpha simple">
<li><p>networkx: This seems to be a relatively large, active project
using best practices.  Probably usable.</p></li>
<li><p>I would probably use it if I had to, but would prefer not to.</p></li>
<li><p>This (written by one of the authors of this lesson) has no
documenting, no community, no best practices, and is very old.
Probably not a good idea to try to use it</p></li>
<li><p>This project uses best practices, but doesn’t seem to have a big
community.  It’s probably fine to use, but who knows if it will
be maintained 10 years from now.  It does have automated tests
via Github Actions (<code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> and the green checks),
so the authors have put some work into making it correct.</p></li>
<li><p>This (also written by one of the authors) looks like it was made
for a paper of some sort.  It has some minimal documentation,
but still is missing many best practices and is clearly not
maintained anymore (look at the ancient pull request).  Probably
not a good idea to use unless you have to.</p></li>
<li><p>This project has a pretty website, and some information.  But
seems to not be using best practices of an open repository, and
custom locations which could disappear at any time.</p></li>
</ol>
<p>You notice that several of the older projects here were written by
one of the authors of this lesson.  It goes to show that everyone
starts somewhere and improves over time - don’t feel bad if your
work isn’t perfect, as long as you keep trying to get better!</p>
</div>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://new.scipy.org/topical-software.html">Topical Software in the SciPy ecosystem</a> - relatively
detailed (but not comprehensive) list of projects</p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Almost everything you need can already be found, except your
incremental work.</p></li>
<li><p>When do you build on that other work, and when do you create
things yourself?</p></li>
</ul>
</div>
</section>
</section>
<span id="document-dependencies"></span><section id="dependency-management">
<span id="id1"></span><h2>Dependency management<a class="headerlink" href="#dependency-management" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Do you expect your code to work in one year?  Five?  What if it
uses <code class="docutils literal notranslate"><span class="pre">numpy</span></code> or <code class="docutils literal notranslate"><span class="pre">pytorch</span></code> or <code class="docutils literal notranslate"><span class="pre">random-github-package</span></code> ?</p></li>
<li><p>How can my collaborators easily install my code with all the necessary dependencies?</p></li>
<li><p>How can I make it easy for my others (and me in future) to reproduce my results?</p></li>
<li><p>How can I work on two (or more) projects with different and conflicting dependencies?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to record dependencies</p></li>
<li><p>Be able to communicate the dependencies as part of a report/thesis/publication</p></li>
<li><p>Learn how to use isolated environments for different projects</p></li>
<li><p>Simplify the use and reuse of scripts and projects</p></li>
</ul>
</div>
<section id="what-even-is-a-dependency">
<h3>What even is a dependency?<a class="headerlink" href="#what-even-is-a-dependency" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Dependency</strong>: Reliance on a external component.  In this case, a
separately installed software package such as <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p></li>
</ul>
</section>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h3>
<div class="admonition-dependencies-1-discuss-dependency-management-5-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Dependencies-1: Discuss dependency management (5 min)</p>
<p>Please discuss and answer via <strong>collaborative document</strong> the
following questions:</p>
<ul class="simple">
<li><p>How do you install Python packages (libraries) that you use in your work?
From PyPI using pip? From other places using pip? Using conda?</p></li>
<li><p>How do you track/record the dependencies? Do you write them into a file or README? Into
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>?</p></li>
<li><p>If you track dependencies in a file, why do you do this?</p></li>
<li><p>Have you ever experienced that a project needed a different version of a Python
library than the one on your computer? If yes, how did you solve it?</p></li>
</ul>
</div>
</section>
<section id="pypi-the-python-package-index-and-conda-ecosystem">
<span id="pypi"></span><h3>PyPI (The Python Package Index) and conda ecosystem<a class="headerlink" href="#pypi-the-python-package-index-and-conda-ecosystem" title="Link to this heading"></a></h3>
<p>PyPI (The Python Package Index) and conda are popular packaging/dependency
management tools:</p>
<ul class="simple">
<li><p>When you use <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">uv</span></code> you typically install from <a class="reference external" href="https://pypi.org/">PyPI</a>, but you can also install packages from
source code provided in repositories in e.g. Github.</p></li>
<li><p>When you use <code class="docutils literal notranslate"><span class="pre">conda</span></code> you typically install from <a class="reference external" href="https://anaconda.org/">Anaconda Cloud</a> where there are conda channels maintained
by Anaconda Inc. and by various communities.</p></li>
</ul>
<p>Why are there two ecosystems?</p>
<div class="admonition-pypi admonition">
<p class="admonition-title">PyPI</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a>, <a class="reference external" href="https://docs.astral.sh/uv/">uv</a></p></li>
<li><p><strong>Summary:</strong> PyPI is traditionally used for Python-only packages or
for Python interfaces to external libraries. There are also packages
that have bundled external libraries (such as numpy).</p></li>
<li><p><strong>Amount of packages:</strong> Huge number.</p></li>
<li><p><strong>How libraries are handled:</strong> If your code depends on external
libraries or tools, these things need to be either included in the
pip-package or provided via some other installation system (like
operating system installer or manual installation).</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Easy to use</p></li>
<li><p>Package creation is easy</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Installing packages that need external libraries can be complicated</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-conda admonition">
<p class="admonition-title">Conda</p>
<ul class="simple">
<li><p><strong>Installation tool:</strong> <a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a>, <a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a></p></li>
<li><p><strong>Summary:</strong> Conda aims to be a more general package distribution tool
and it tries to provide not only the Python packages, but also other
libraries and tools needed by the Python packages.</p></li>
<li><p><strong>Amount of packages:</strong> Huge number in conda-forge and in other community
channels. Curated versions in licensed channels. Other packages can be
installed via pip.</p></li>
<li><p><strong>How libraries are handled:</strong> Required libraries are installed as separate
conda packages.</p></li>
<li><dl class="simple">
<dt><strong>Pros:</strong></dt><dd><ul>
<li><p>Quite easy to use</p></li>
<li><p>Easier to manage packages that need external libraries</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cons:</strong></dt><dd><ul>
<li><p>Package creation is harder</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="conda-ecosystem-explained">
<h3>Conda ecosystem explained<a class="headerlink" href="#conda-ecosystem-explained" title="Link to this heading"></a></h3>
<figure class="align-default" id="id2">
<img alt="Figure that shows non-free and free parts of the conda ecosystem. Non-free side has Anaconda Inc., Anaconda repository, Anaconda channels, Miniconda and Anaconda distribution. Free side has Community, conda-forge and Miniforge." src="_images/conda-ecosystem.png" />
<figcaption>
<p><span class="caption-text">Figure 1: Conda ecosystem visualized</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-licensing-and-conda admonition">
<p class="admonition-title">Licensing and conda</p>
<p>Conda was originally created by Anaconda Inc. and they provide their
own licensed packages. At the same time a big open-source community
provides most of the packages. Thus it is good to know what is free
and open source and what is under licenses.</p>
<p>It is highly recommended to use Miniforge to create the environments
and to use conda-forge as the main channel for software. You can add
<cite>nodefaults</cite> to channel list to disable Anaconda’s repositories.</p>
<dl class="simple">
<dt><strong>Free:</strong></dt><dd><ul class="simple">
<li><p>conda and mamba (installation tools)</p></li>
<li><p>community channels (e.g. conda-forge)</p></li>
<li><p>Miniforge</p></li>
</ul>
</dd>
<dt><strong>Licensed:</strong></dt><dd><ul class="simple">
<li><p>Anaconda distribution</p></li>
<li><p>Anaconda repository (<a class="reference external" href="https://repo.anaconda.com">repo.anaconda.com</a>)</p></li>
<li><p>Anaconda’s channels in the community repository (anaconda.org)
are free in some cases.</p></li>
<li><p>Miniconda is free, when it does not download Anaconda’s packages.</p></li>
</ul>
</dd>
</dl>
<p>All of these are licensed under Anaconda Inc. and free in some cases. See
<a class="reference external" href="https://www.anaconda.com/legal/terms/academic">Academic Policy</a>,
<a class="reference external" href="https://www.anaconda.com/legal/terms/terms-of-service#WhenYouCanUseThePlatformForFree">Terms of Service</a>
and
<a class="reference external" href="https://www.anaconda.com/legal/terms/non-profit-research">Non-profit &amp; Research Policy</a>
for more information.</p>
</div>
<ul class="simple">
<li><p>Package repositories:</p>
<ul>
<li><p><a class="reference external" href="https://anaconda.org/">Anaconda Community Repository (anaconda.org)</a>
aka. Anaconda Cloud is a package cloud maintained by Anaconda Inc.
It is a repository that houses mirrors of Anaconda’s channels and
community maintained channels.</p></li>
<li><p><a class="reference external" href="https://repo.anaconda.com">Anaconda Repository (repo.anaconda.com)</a>
houses Anaconda’s own proprietary software channels.</p></li>
</ul>
</li>
<li><p>Major package channels:</p>
<ul>
<li><p>Anaconda’s proprietary channels: <code class="docutils literal notranslate"><span class="pre">main</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">msys2</span></code> and <code class="docutils literal notranslate"><span class="pre">anaconda</span></code>.
These are sometimes called <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p></li>
<li><p><a class="reference external" href="https://conda-forge.org/">conda-forge</a> is the largest open source
community channel. It has over 27,000 packages that include open-source
versions of packages in Anaconda’s channels.</p></li>
</ul>
</li>
<li><p>Package distributions and installers:</p>
<ul>
<li><p><a class="reference external" href="https://www.anaconda.com/">Anaconda</a> is a distribution of conda packages
made by Anaconda Inc.. When using Anaconda remember to check that your
situation abides with their licensing terms.</p></li>
<li><p><a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a> is a minimal installer
maintained by Anaconda Inc. that has conda and uses Anaconda’s channels
by default. Check licensing terms when using these packages.</p></li>
<li><p><a class="reference external" href="https://github.com/conda-forge/miniforge">Miniforge</a> is an open-source
Miniconda replacement that uses conda-forge as the default channel.
Contains mamba as well.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba</a>
is a tiny stand-alone version of the mamba package manager written in C++.
It can be used to create and manage environments without installing
base-environment and Python. It is very useful if you want to automate
environment creation or want a more lightweight tool.</p></li>
</ul>
</li>
<li><p>Package managers:</p>
<ul>
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a> is a package and environment management system
used by Anaconda. It is an open source project maintained by Anaconda Inc..</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a> is a drop in
replacement for conda with additional UI features.</p></li>
</ul>
</li>
</ul>
</section>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Link to this heading"></a></h3>
<div class="admonition-dependencies-2-package-language-detective-5-min exercise important admonition" id="exercise-1">
<p class="admonition-title">Dependencies-2: Package language detective (5 min)</p>
<p>Think about the following sentences:</p>
<ol class="arabic simple">
<li><p>Yes, you can install my package with pip from GitHub.</p></li>
<li><p>I forgot to specify my channels, so my packages came from the defaults.</p></li>
<li><p>I have a Miniforge installation and I use mamba to create my environments.</p></li>
</ol>
<p>What hidden information is given in these sentences?</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ol class="arabic simple">
<li><p>The package is provided as a pip package. However, it is most likely
not uploaded to PyPI as it needs to be installed from a repository.</p></li>
<li><p>In this case the person saying the sentence is most likely using
Anaconda or Miniconda because these tools use the <code class="docutils literal notranslate"><span class="pre">defaults</span></code>-channel
as the default channel. They probably meant to install software from
conda-forge, but forgot to specify the channel.</p></li>
<li><p>Miniforge uses conda-forge as the default channel. So unless some
other channel has been specified, packages installed with these
tools come from conda-forge as well.</p></li>
</ol>
</div>
</div>
</section>
<section id="python-environments">
<h3>Python environments<a class="headerlink" href="#python-environments" title="Link to this heading"></a></h3>
<p>An <strong>environment</strong> is a basically a folder that contains a Python
interpreter and other Python packages in a folder structure similar
to the operating system’s folder structure.</p>
<p>These environments can be created by:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/venv.html">venv</a>-module in base Python</p></li>
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a></p></li>
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/">conda</a> / <a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html#">mamba</a>.</p></li>
<li><p>pip package called <a class="reference external" href="https://virtualenv.pypa.io/en/latest/">virtualenv</a></p></li>
</ul>
<p>Using these environments is highly recommended because they solve the
following problems:</p>
<ul class="simple">
<li><p>Installing packages in environments won’t modify system packages.</p></li>
<li><p>You can install specific versions of packages into them.</p></li>
<li><p>You can create an environment for each project and you won’t encounter any
problems if different projects require different versions of packages.</p></li>
<li><p>If you make some mistake and install something you did not want or need, you
can remove the environment and create a new one.</p></li>
<li><p>Others can replicate your environment by reusing the same specification
that you used to create the environment.</p></li>
</ul>
</section>
<section id="creating-python-environments">
<h3>Creating Python environments<a class="headerlink" href="#creating-python-environments" title="Link to this heading"></a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" name="Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" role="tab" tabindex="0">Creating conda environment from environment.yml</button><button aria-controls="panel-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tab" tabindex="-1">Creating virtual environment from requirements.txt</button></div><div aria-labelledby="tab-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" class="sphinx-tabs-panel group-tab" id="panel-0-Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" name="Q3JlYXRpbmcgY29uZGEgZW52aXJvbm1lbnQgZnJvbSBlbnZpcm9ubWVudC55bWw=" role="tabpanel" tabindex="0"><p>Record channels and packages you need to a file called
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">name</span></code> describes the name of the environment,
<code class="docutils literal notranslate"><span class="pre">channels</span></code>-list tells which channels should be search for packages
(channel priority goes from top to bottom) and <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>-list
contains all packages that are needed.</p>
<p>Using this file you can now create an environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
<div class="admonition-you-can-also-use-mamba admonition">
<p class="admonition-title">You can also use mamba</p>
<p>If you have mamba installed, you can replace conda
with mamba in each command.</p>
</div>
<p>You can then activate the environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>my-environment
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>my-environment
</pre></div>
</div>
<div class="admonition-conda-activate-versus-source-activate callout admonition" id="callout-0">
<p class="admonition-title">conda activate versus source activate</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span></code> will only work if you have run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code>
in the past. Running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code> will make loading environments
easier as you will always have a conda environment loaded.</p>
<p>However, this can also cause problems as programs in the
main environment will be constantly loaded and they might be used
even when they’re not supposed to be used. A common example is
not having <code class="docutils literal notranslate"><span class="pre">pip</span></code> installed in a conda environment which results
<code class="docutils literal notranslate"><span class="pre">pip</span></code> from main environment to be used instead.</p>
</div>
<p>You can then check e.g. installed versions of Python and <code class="docutils literal notranslate"><span class="pre">numpy</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; import numpy; print(f&quot;Python version: {sys.version}\nNumPy version: {numpy.__version__}&quot;)&#39;</span>
<span class="go">Python version: 3.13.0 | packaged by conda-forge | (main, Oct  8 2024, 20:04:32) [GCC 13.3.0]</span>
<span class="go">NumPy version: 2.1.2</span>
</pre></div>
</div>
<p>To deactivate the environment, you can run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>deactivate
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgdmlydHVhbCBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tabpanel" tabindex="0"><p>Record packages you need to a file called
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>numpy
matplotlib
pandas
</pre></div>
</div>
<p>This is simply a text file that lists all of the packages that
you need. It is usually called <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>Now you can create a virtual environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>my-environment
</pre></div>
</div>
<p>You can then activate the environment by sourcing a file called
<code class="docutils literal notranslate"><span class="pre">activate</span></code>.</p>
<ul>
<li><p><strong>Linux/Mac OSX</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>my-environment/bin/activate
</pre></div>
</div>
</li>
<li><p><strong>Windows</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</pre></div>
</div>
</li>
</ul>
<p>Now the environment should be active. You can then install packages
listed in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>You can then check e.g. installed versions of Python and <code class="docutils literal notranslate"><span class="pre">numpy</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; import numpy; print(f&quot;Python version: {sys.version}\nNumPy version: {numpy.__version__}&quot;)&#39;</span>
<span class="go">Python version: 3.10.12 (main, Sep 11 2024, 15:47:36) [GCC 11.4.0]</span>
<span class="go">NumPy version: 2.1.2</span>
</pre></div>
</div>
<p>To deactivate the environment, you can run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>deactivate
</pre></div>
</div>
</div></div>
<div class="admonition-creating-environments-without-environment-yml-requirements-txt admonition">
<p class="admonition-title">Creating environments without environment.yml/requirements.txt</p>
<p>It is possible to create environments with manual commands, but this
is highly discouraged for continuous use.</p>
<p>Firstly, replicating the environment becomes much harder.</p>
<p>Secondly, running package installation commands manually in an
environment can result in unexpected behaviour such as:</p>
<ul class="simple">
<li><p>Package manager might remove an already installed packages or update them.</p></li>
<li><p>Package manager might not find a package that works with already
installed packages.</p></li>
</ul>
<p>The reason for this behavior is that package managers does not know what
commands you ran in the past. It only knows the state of your environment
and what you’re currently telling it to install.</p>
<p>These kinds of problems can be mitigated by recording dependencies in an
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and using the relevant
package manager to update / recreate the environment.</p>
</div>
</section>
<section id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Link to this heading"></a></h3>
<div class="admonition-dependencies-3-create-a-python-environment-15-min exercise important admonition" id="exercise-2">
<p class="admonition-title">Dependencies-3: Create a Python environment (15 min)</p>
<p>Use conda or venv to create the environment presented in the
example.</p>
</div>
</section>
<section id="adding-more-packages-to-existing-environments">
<h3>Adding more packages to existing environments<a class="headerlink" href="#adding-more-packages-to-existing-environments" title="Link to this heading"></a></h3>
<p>Quite often when you’re creating a new environment you might forget
to add all relevant packages to <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>In these cases the best practice is to add missing packages to
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and to update the environment.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" role="tab" tabindex="0">Adding new packages to a conda environment</button><button aria-controls="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tab" tabindex="-1">Adding new packages to a virtual environment</button></div><div aria-labelledby="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" class="sphinx-tabs-panel group-tab" id="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIGNvbmRhIGVudmlyb25tZW50" role="tabpanel" tabindex="0"><p>Add new packages that you want to install to
<code class="docutils literal notranslate"><span class="pre">dependencies</span></code> in
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>.</p>
<p>Afterwards, run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>update<span class="w"> </span>--file<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>to update the environment.</p>
</div><div aria-labelledby="tab-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="QWRkaW5nIG5ldyBwYWNrYWdlcyB0byBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Add new packages that you want to install to
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>Afterwards, activate the environment and re-run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>to update the environment.</p>
</div></div>
<p>Sometimes the new packages are incompatible with the ones already
in the environment. Maybe they have different dependencies that are
not satisfied with the current versions, maybe the package you’re installing
is incompatible with the ones installed. In these cases the safest approach
is to re-create the environment. This will let the dependency solvers
to start from clean slate and with a full picture of what packages
need to be installed.</p>
</section>
<section id="pinning-package-versions">
<h3>Pinning package versions<a class="headerlink" href="#pinning-package-versions" title="Link to this heading"></a></h3>
<p>Sometimes your code will only work with a certain range of dependencies.
Maybe you use a function or a class that was introduced in a later version
or a newer version has modified its API.</p>
<p>In these situations, you’ll want to <strong>pin the package versions</strong>.</p>
<p>For example, there is usually a delay between doing research and that
research being published. During this time packages used in the research
might update and reviewers or interested researchers might not be able
to replicate your results or run your code if new versions are not
compatible.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" name="ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" role="tab" tabindex="0">environment.yml with pinned versions</button><button aria-controls="panel-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" name="cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" role="tab" tabindex="-1">requirements.txt with pinned versions</button></div><div aria-labelledby="tab-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" class="sphinx-tabs-panel group-tab" id="panel-2-ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" name="ZW52aXJvbm1lbnQueW1sIHdpdGggcGlubmVkIHZlcnNpb25z" role="tabpanel" tabindex="0"><p>When pinning versions in <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> one can use a
variety of comparison operators:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Use python 3.11</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python=3.11</span>
<span class="w">  </span><span class="c1"># numpy that is bigger or equal than version 1, but less than version 2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy&gt;=1,&lt;2</span>
<span class="w">  </span><span class="c1"># matplotlib greater than 3.8.2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib&gt;3.8.2</span>
<span class="w">  </span><span class="c1"># pandas that is compatible with 2.1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas~=2.1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" name="cmVxdWlyZW1lbnRzLnR4dCB3aXRoIHBpbm5lZCB2ZXJzaW9ucw==" role="tabpanel" tabindex="0"><p>When pinning versions in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> one can use a
variety of comparison operators:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># numpy that is bigger or equal than version 1, but less than version 2
numpy&gt;=1,&lt;2
# matplotlib greater than 3.8.2
matplotlib&gt;3.8.2
# pandas that is compatible with 2.1
pandas~=2.1
</pre></div>
</div>
</div></div>
<p>For more information on all possible specifications, see
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/version-specifiers/">this page</a>
from Python’s packaging guide.</p>
<p>See also: <a class="reference external" href="https://coderefinery.github.io/reproducible-research/dependencies/">https://coderefinery.github.io/reproducible-research/dependencies/</a></p>
<div class="admonition-to-pin-or-not-to-pin-that-is-the-question admonition">
<p class="admonition-title">To pin or not to pin? That is the question.</p>
<p>Pinning versions means that you pin the environment to
<strong>that instance in time</strong> when these specific versions of the
dependencies were being used.</p>
<p>This can be good for single-use applications, like replicating a research
paper, but it is usually bad for the long-term maintainability of the software.</p>
<p>Pinning to major versions or to compatible versions is usually the best
practice as that allows your software to co-exist with other packages even
when they are updated.</p>
<p>Remember that at some point in time you <strong>will</strong> face a situation where
newer versions of the dependencies are no longer compatible with your
software. At this point you’ll have to update your software to use the newer
versions or to lock it into a place in time.</p>
</div>
</section>
<section id="exporting-package-versions-from-an-existing-environment">
<h3>Exporting package versions from an existing environment<a class="headerlink" href="#exporting-package-versions-from-an-existing-environment" title="Link to this heading"></a></h3>
<p>Sometimes you want to create a file that contains the exact versions
of packages in the environment. This is often called <em>exporting</em> or
<em>freezing</em> and environment.</p>
<p>Doing this will create a file that does describe the installed
packages, but it won’t tell which packages are <strong>the most important
ones</strong> and which ones are just dependencies for those packages.</p>
<p>Using manually created <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>
are in most cases better than automatically created ones because they
shows which packages are the important packages needed by the software.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" role="tab" tabindex="0">Exporting environment.yml from a conda environment</button><button aria-controls="panel-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tab" tabindex="-1">Exporting requirements.txt from a virtual environment</button></div><div aria-labelledby="tab-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" id="panel-3-RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIGVudmlyb25tZW50LnltbCBmcm9tIGEgY29uZGEgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Once you have activated the environment, you can run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>If package build versions are not relevant for the use case,
one can also run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--no-builds<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>which leaves out the package build versions.</p>
<p>Alternatively one can also run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--from-history<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
<p>which creates the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>-file based on
what packages were asked to be installed.</p>
<div class="admonition-conda-lock admonition">
<p class="admonition-title">conda-lock</p>
<p>For even more reproducibility, you should try out
<a class="reference external" href="https://github.com/conda/conda-lock">conda-lock</a>.
It turns your <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> into a <code class="docutils literal notranslate"><span class="pre">conda.lock</span></code>
that has all information needed to <strong>exactly</strong> create
the same environment. You can use <code class="docutils literal notranslate"><span class="pre">conda.lock</span></code>-files
in same way as <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> when you create
an environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--file<span class="w"> </span>conda.lock
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" name="RXhwb3J0aW5nIHJlcXVpcmVtZW50cy50eHQgZnJvbSBhIHZpcnR1YWwgZW52aXJvbm1lbnQ=" role="tabpanel" tabindex="0"><p>Once you have activated the environment, you can run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</pre></div>
</div>
</div></div>
</section>
<section id="exercise-4">
<h3>Exercise 4<a class="headerlink" href="#exercise-4" title="Link to this heading"></a></h3>
<div class="admonition-dependencies-4-export-an-environment-15-min exercise important admonition" id="exercise-3">
<p class="admonition-title">Dependencies-4: Export an environment (15 min)</p>
<p>Export the environment you previously created.</p>
</div>
</section>
<section id="how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication">
<h3>How to communicate the dependencies as part of a report/thesis/publication<a class="headerlink" href="#how-to-communicate-the-dependencies-as-part-of-a-report-thesis-publication" title="Link to this heading"></a></h3>
<p>Each notebook or script or project which depends on libraries should come with
either a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>, unless you are creating
and distributing this project as Python package (see next section).</p>
<ul class="simple">
<li><p>Attach a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> to your thesis.</p></li>
<li><p>Even better: put <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> in your Git repository along your code.</p></li>
<li><p>Even better: also binderize your analysis pipeline (more about that in a later session).</p></li>
</ul>
</section>
<section id="version-pinning-for-package-creators">
<span id="version-pinning"></span><h3>Version pinning for package creators<a class="headerlink" href="#version-pinning-for-package-creators" title="Link to this heading"></a></h3>
<p>We will talk about packaging in a different session but when you create a library and package
projects, you express dependencies either in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> (or <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>)
(PyPI) or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> (conda).</p>
<p>These dependencies will then be used by either other libraries (who in turn
write their own <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> or <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>) or by
people directly (filling out <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or a <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>).</p>
<p>Now as a library creator you have a difficult choice. You can either pin versions very
narrowly like here (example taken from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy==1.19.2&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib==3.3.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas==1.1.2&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy==1.5.2&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>or you can define a range or keep them undefined like here (example taken from
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<span class="hll">   <span class="s1">&#39;numpy&#39;</span><span class="p">,</span>
</span><span class="hll">   <span class="s1">&#39;matplotlib&#39;</span>
</span><span class="hll">   <span class="s1">&#39;pandas&#39;</span>
</span><span class="hll">   <span class="s1">&#39;scipy&#39;</span>
</span><span class="p">]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>Should we pin the versions here or not?</p>
<ul class="simple">
<li><p>Pinning versions here would be good for reproducibility.</p></li>
<li><p>However pinning versions may make it difficult for this library to be used in a project alongside other
libraries with conflicting version dependencies.</p></li>
<li><p>Therefore <strong>as library creator make the version requirements as wide as possible</strong>.</p>
<ul>
<li><p>Set minimum version when you know of a reason: <code class="docutils literal notranslate"><span class="pre">&gt;=2.1</span></code></p></li>
<li><p>Sometimes set maximum version to next major version (<code class="docutils literal notranslate"><span class="pre">&lt;4</span></code>) (when
you currently use <code class="docutils literal notranslate"><span class="pre">3.x.y</span></code>) when you expect issues with next
major version.</p></li>
</ul>
</li>
<li><p>As the “end consumer” of libraries, define your dependencies as narrowly as possible.</p></li>
</ul>
</section>
<section id="common-issues">
<h3>Common issues<a class="headerlink" href="#common-issues" title="Link to this heading"></a></h3>
<p>Here are couple of common issues that arise for new users of environments.</p>
<ol class="arabic simple">
<li><p><strong>Global installs:</strong> Installing packages with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code>.
This installs packages to    your home directory and makes them globally
available. This can cause major problems because these packages override
packages installed in the environments.</p></li>
<li><p><strong>Environments using lots of storage space:</strong> Python packages that contain
libraries can take a lot of space, which can cause quota problems when
you’re installing Python environments in systems with limited storage
space. By default packages are cached to your home folder
(see these documentations for <a class="reference external" href="https://pip.pypa.io/en/stable/topics/caching/#where-is-the-cache-stored">pip</a>,
<a class="reference external" href="https://docs.conda.io/projects/conda/en/stable/user-guide/configuration/custom-env-and-pkg-locations.html">conda</a>,
and <a class="reference external" href="https://docs.astral.sh/uv/concepts/cache/#cache-directory">uv</a>).
Conda and uv reuse packages across multiple environments (if you create
another environment with the same packages, it won’t take more space).
For these tools it is important that the cache and environments are
stored in the same filesystem. Pip only caches downloads and self-built
packages, it won’t reuse them across environments.</p></li>
<li><p><strong>Environments creating huge numbers of files:</strong> Python environments
can have huge numbers of files. Some systems (like shared HPC systems) do
not like that the are lots of small files in the storage system. You can
use <a class="reference external" href="https://coderefinery.github.io/hpc-containers/">containers</a> to put
the environement into a single file to solve these problems.</p></li>
</ol>
</section>
<section id="additional-tips-and-tricks">
<h3>Additional tips and tricks<a class="headerlink" href="#additional-tips-and-tricks" title="Link to this heading"></a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tab" tabindex="0">Creating a conda environment from requirements.txt</button><button aria-controls="panel-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" name="QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" role="tab" tabindex="-1">Adding pip packages into conda environments</button><button aria-controls="panel-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" name="SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" role="tab" tabindex="-1">Installing pip packages from GitHub</button></div><div aria-labelledby="tab-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" class="sphinx-tabs-panel group-tab" id="panel-4-Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" name="Q3JlYXRpbmcgYSBjb25kYSBlbnZpcm9ubWVudCBmcm9tIHJlcXVpcmVtZW50cy50eHQ=" role="tabpanel" tabindex="0"><blockquote>
<div><p>conda supports installing an environment from <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>my-environment<span class="w"> </span>--channel<span class="w"> </span>conda-forge<span class="w"> </span>--file<span class="w"> </span>requirements.txt
</pre></div>
</div>
<p>To create an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> from this environment that mimics
the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, activate it and run</p>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--from-history<span class="w"> </span>&gt;<span class="w"> </span>environment.yml
</pre></div>
</div>
</div><div aria-labelledby="tab-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" name="QWRkaW5nIHBpcCBwYWNrYWdlcyBpbnRvIGNvbmRhIGVudmlyb25tZW50cw==" role="tabpanel" tabindex="0"><p>conda supports installing pip packages in an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>.</p>
<p>Usually this is done to add those packages that are missing
from conda channels.</p>
<p>To do this you’ll want to install <code class="docutils literal notranslate"><span class="pre">pip</span></code> into the environment
and then add pip-installed packages to a list called <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>See this example <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
<p>One can even add a full <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> to the environment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-environment</span>
<span class="nt">channels</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pip</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;-r</span><span class="nv"> </span><span class="s">requirements.txt&quot;</span>
</pre></div>
</div>
<p>Do note that in both methods the pip-packages come from PyPI
and not from conda channels. The installation of these packages
is done after conda environment is created and this can also
remove or update conda packages installed previously.</p>
</div><div aria-labelledby="tab-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" name="SW5zdGFsbGluZyBwaXAgcGFja2FnZXMgZnJvbSBHaXRIdWI=" role="tabpanel" tabindex="0"><p>Packages available in GitHub or other repositorios
can be given as a URL in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p>
<p>For example, to install a development version of the
<a class="reference external" href="https://github.com/psf/black">black code formatter</a>, one can
write the following <code class="docutils literal notranslate"><span class="pre">requirement.txt</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>git+https://github.com/psf/black
</pre></div>
</div>
<p>or</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>https://github.com/psf/black/archive/master.zip
</pre></div>
</div>
<p>First one would use git to clone the repository, second would
download the zip archive of the repository.</p>
</div></div>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<p>Other tools for dependency management:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a>: Tool for managing multiple Python
versions and environments.</p></li>
<li><p><a class="reference external" href="https://python-poetry.org/">Poetry</a>: Environment and package creation
tool.</p></li>
<li><p><a class="reference external" href="https://pipenv.pypa.io/">Pipenv</a>: Environment creation tool.</p></li>
<li><p><a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>: Tool for installing multiple
different Python versions.</p></li>
<li><p><a class="reference external" href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba</a>:
tiny version of Mamba as a static C++ executable. Does not need base
environment or Python for installing an environment.</p></li>
<li><p><a class="reference external" href="https://github.com/thoth-station/micropipenv">micropipenv</a>: Small tool
that can install dependencies from multiple different environment formats.</p></li>
<li><p><a class="reference external" href="https://pixi.sh">pixi</a> &amp; <a class="reference external" href="https://prefix.dev/">prefix.dev</a>: A package
ecosystem that install all sorts of packages using the conda ecosystem.</p></li>
</ul>
<p>Other resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://scicomp.aalto.fi/scicomp/packaging-software/">https://scicomp.aalto.fi/scicomp/packaging-software/</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>If somebody asks you what dependencies your code has, you should be able to answer this question <strong>with a file</strong>.</p></li>
<li><p>Install dependencies by first recording them in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> or
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> and install using these files, then you have a trace.</p></li>
<li><p>Use isolated environments and avoid installing packages system-wide.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-binder"></span><section id="binder">
<h2>Binder<a class="headerlink" href="#binder" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Why sharing code alone may not be sufficient.</p></li>
<li><p>How to share a computational environment?</p></li>
<li><p>What is Binder?</p></li>
<li><p>How to binderize my Python repository?</p></li>
<li><p>How to publish my Python repository?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn about reproducible computational environments.</p></li>
<li><p>Learn to create and share custom computing environments with Binder.</p></li>
<li><p>Learn to get a DOI from Zenodo for a repository.</p></li>
</ul>
</div>
<section id="why-is-it-sometimes-not-enough-to-share-your-code">
<h3>Why is it sometimes not enough to share your code?<a class="headerlink" href="#why-is-it-sometimes-not-enough-to-share-your-code" title="Link to this heading"></a></h3>
<img alt="_images/python_unmasked.jpg" src="_images/python_unmasked.jpg" />
<section id="exercise-1">
<h4>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h4>
<div class="admonition-binder-1-discuss-better-strategies-than-only-code-sharing-10-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Binder-1: Discuss better strategies than only code sharing (10 min)</p>
<p>Lea is a PhD student in computational biology and after 2 years of intensive
work, she is finally ready to publish her first paper. The code she has used
for analyzing her data is available on GitHub but her supervisor who is an
advocate of open science told her that sharing code is not sufficient.</p>
<p><strong>Why is it possibly not enough to share “just” your code?
What problems can you anticipate 2-5 years from now?</strong></p>
<p>We form small groups (4-5 persons) and discuss in groups. If the workshop is
online, each group will join a breakout room.
If joining a group is not possible or practical, we use the shared document
to discuss this collaboratively.</p>
<p>Each group write a summary (bullet points) of the discussion in the workshop
shared document (the link will be provided by your instructors).</p>
</div>
</section>
</section>
<section id="sharing-a-computing-environment-with-binder">
<h3>Sharing a computing environment with Binder<a class="headerlink" href="#sharing-a-computing-environment-with-binder" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://mybinder.readthedocs.io/en/latest/">Binder</a> allows you to create
custom computing environments that can be shared and used by many remote users.
It uses  <a class="reference external" href="https://repo2docker.readthedocs.io/en/latest/">repo2docker</a>  to
create a container image (<a class="reference external" href="https://www.docker.com/">docker</a> image) of a
project using information contained in included configuration files.</p>
<p>Repo2docker is a standalone package that you can install locally on your laptop
but an <a class="reference external" href="https://mybinder.org/">online Binder</a> service is freely available.
This is what we will be using in the tutorial.</p>
<p>The main objective of this exercise is to learn to fork a repository and add a
requirement file to share the computational environment with Binder.</p>
<img alt="https://opendreamkit.org/public/images/use-cases/reproducible_logbook.png" src="https://opendreamkit.org/public/images/use-cases/reproducible_logbook.png" />
<p>Credit: <a class="reference external" href="https://opendreamkit.org/2017/11/02/use-case-publishing-reproducible-notebooks/">Juliette Taka, Logilab and the OpenDreamKit project (2017)</a></p>
<section id="binder-exercise-demo">
<h4>Binder exercise/demo<a class="headerlink" href="#binder-exercise-demo" title="Link to this heading"></a></h4>
<p>In an earlier episode (Data visualization with Matplotlib) we have created this notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/plotly/datasets/master/gapminder_with_codes.csv&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data_2007</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2007</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_2007</span><span class="p">[</span><span class="s2">&quot;gdpPercap&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_2007</span><span class="p">[</span><span class="s2">&quot;lifeExp&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP (USD) per capita&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;life expectancy (years)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We will now first share it via <a class="reference external" href="https://github.com/">GitHub</a> “statically”,
then using <a class="reference external" href="https://mybinder.org/">Binder</a>.</p>
<div class="admonition-binder-2-exercise-demo-make-your-notebooks-reproducible-by-anyone-15-min exercise important admonition" id="exercise-1">
<p class="admonition-title">Binder-2: Exercise/demo: Make your notebooks reproducible by anyone (15 min)</p>
<p>Instructor demonstrates this.  <strong>This exercise (and all following)
requires git/GitHub knowledge and accounts, which wasn’t a
prerequisite of this course.  Thus, this is a demo (and might even
be too fast for you to type-along).  Watch the video if you
are reading this later on</strong>:</p>
<ul>
<li><p>Creates a GitHub repository</p></li>
<li><p>Uploads the notebook file</p></li>
<li><p>Then we look at the statically rendered version of the notebook on GitHub</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file which contains:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pandas==1.2.3
matplotlib==3.4.2
</pre></div>
</div>
</li>
<li><p>Commit and push also this file to your notebook repository.</p></li>
<li><p>Visit <a class="reference external" href="https://mybinder.org">https://mybinder.org</a> and copy paste the code under “Copy the text below …” into your <cite>README.md</cite>:</p>
<img alt="_images/binder.jpg" src="_images/binder.jpg" />
</li>
<li><p>Check that your notebook repository now has a “launch binder”
badge in your <cite>README.md</cite> file on GitHub.</p></li>
<li><p>Try clicking the button and see how your repository is launched
on Binder (can take a minute or two). Your notebooks can now be explored and executed in the cloud.</p></li>
<li><p>Enjoy being fully reproducible!</p></li>
</ul>
</div>
</section>
</section>
<section id="how-can-i-get-a-doi-from-zenodo">
<h3>How can I get a DOI from Zenodo?<a class="headerlink" href="#how-can-i-get-a-doi-from-zenodo" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://about.zenodo.org/">Zenodo</a> is a general purpose open-access
repository built and operated by <a class="reference external" href="https://home.cern/">CERN</a> and <a class="reference external" href="https://www.openaire.eu/">OpenAIRE</a> that allows researchers to archive and get a
<a class="reference external" href="https://www.doi.org/">Digital Object Identifier (DOI)</a> to data that they
share.</p>
<div class="admonition-binder-3-link-a-github-repository-with-zenodo-optional exercise important admonition" id="exercise-2">
<p class="admonition-title">Binder-3: Link a Github repository with Zenodo (optional)</p>
<p><strong>Everything you deposit on Zenodo is meant to be kept (long-term archive).
Therefore we recommend to practice with the Zenodo “sandbox” (practice/test area)
instead:</strong> <a class="reference external" href="https://sandbox.zenodo.org">https://sandbox.zenodo.org</a></p>
<ol class="arabic simple">
<li><p><strong>Link GitHub with Zenodo</strong>:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Go to <a class="reference external" href="https://sandbox.zenodo.org">https://sandbox.zenodo.org</a> (or to <a class="reference external" href="https://zenodo.org">https://zenodo.org</a> for the real upload later, after practicing).</p></li>
<li><p>Log in to Zenodo with your GitHub account. Be aware that you may need to
authorize Zenodo application (Zenodo will redirect you back to GitHub for
Authorization).</p></li>
<li><p>Choose the repository webhooks options.</p></li>
<li><p>From the drop-down menu next to your email address at the top of the page, select GitHub.</p></li>
<li><p>You will be presented with a list of all your Github repositories.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Archiving a repo</strong>:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Select a repository you want to archive on Zenodo.</p></li>
<li><p>Toggle the “on” button next to the repository ou need to archive.</p></li>
<li><p>Click on the Repo that you want to reserve.</p></li>
<li><p>Click on Create release button at the top of the page. Zenodo will redirect you back to GitHub’s repo page to generate a release.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>Trigger Zenodo to Archive your repository</strong></p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Go to GitHub and create a release. Zenodo will automatically download a .zip-ball of each new release and register a DOI.</p></li>
<li><p>If this is the first release of your code then you should give it a
version number of v1.0.0. Add description for your release then click the
Publish release button.</p></li>
<li><p>Zenodo takes an archive of your GitHub repository each time you create a new Release.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p><strong>To ensure that everything is working</strong>:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Go to <a class="reference external" href="https://zenodo.org/account/settings/github/">https://zenodo.org/account/settings/github/</a> (or the corresponding
sandbox at <a class="reference external" href="https://sandbox.zenodo.org/account/settings/github/">https://sandbox.zenodo.org/account/settings/github/</a>), or the
Upload page (<a class="reference external" href="https://zenodo.org/deposit">https://zenodo.org/deposit</a>), you will find your repo is
listed.</p></li>
<li><p>Click on the repo, Zenodo will redirect you to a page that contains a DOI for your repo will the information that you added to the repo.</p></li>
<li><p>You can edit the archive on Zenodo and/or publish a new version of your software.</p></li>
<li><p>It is recommended that you add a description for your repo and fill in other metadata in the edit page. Instead of editing metadata
manually, you can also add a <code class="docutils literal notranslate"><span class="pre">.zenodo.json</span></code> or a <code class="docutils literal notranslate"><span class="pre">CITATION.cff</span></code> file to your repo and Zenodo will infer the metadata from this file.</p></li>
<li><p>Your code is now published on a Github public repository and archived on Zenodo.</p></li>
<li><p>Update the README file in your repository with the newly created zenodo badge.</p></li>
</ul>
</div></blockquote>
</div>
</section>
<section id="create-a-binder-link-for-your-zenodo-doi">
<h3>Create a Binder link for your Zenodo DOI<a class="headerlink" href="#create-a-binder-link-for-your-zenodo-doi" title="Link to this heading"></a></h3>
<p>Rather than specifying a GitHub repository when launching binder, you can instead use a Zenodo DOI.</p>
<div class="admonition-binder-4-link-binder-with-zenodo-10-min exercise important admonition" id="exercise-3">
<p class="admonition-title">Binder-4: Link Binder with Zenodo (10 min)</p>
<p>We will be using an existing Zenodo DOI <a class="reference external" href="https://doi.org/10.5281/zenodo.3247652">10.5281/zenodo.3886864</a> to start Binder:</p>
<blockquote>
<div><ul class="simple">
<li><p>Go to <a class="reference external" href="https://mybinder.org">https://mybinder.org</a> and fill information using Zenodo DOI (as shown on the animation below):</p></li>
</ul>
<img alt="https://miro.medium.com/max/1050/1*xOABVY2hNtVmjV5-LXreFw.gif" src="https://miro.medium.com/max/1050/1*xOABVY2hNtVmjV5-LXreFw.gif" />
<ul class="simple">
<li><p>You can also get a Binder badge and update the README file in the
repository. It is good practice to add both the Zenodo badge and the
corresponding Binder badge.</p></li>
</ul>
</div></blockquote>
</div>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>It is easy to sharing reproducible computational environments</p></li>
<li><p>Binder provides a way for anyone to test and run code - without
you needing to set up a dedicated server for it.</p></li>
<li><p>Zenodo provides permanent archives and a DOI.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-parallel"></span><section id="parallel-programming">
<h2>Parallel programming<a class="headerlink" href="#parallel-programming" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>When you need more than one processor, what do you do?</p></li>
<li><p>How can we use more than one processor/core in Python?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand the major strategies of parallelizing code</p></li>
<li><p>Understand mechanics of the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package</p></li>
<li><p>Know when to use more advanced packages or approaches</p></li>
</ul>
</div>
<section id="modes-of-parallelism">
<h3>Modes of parallelism<a class="headerlink" href="#modes-of-parallelism" title="Link to this heading"></a></h3>
<p>You realize you do have more computation to do than you can on one processor?
What do you do?</p>
<ol class="arabic simple">
<li><p>Profile your code, identify the <em>actual</em> slow spots.</p></li>
<li><p>Can you improve your code in those areas? Use an existing library?</p></li>
<li><p>Are there are any low-effort optimizations that you can make?</p></li>
<li><p>Consider using <a class="reference external" href="https://numba.pydata.org/">numba</a> or
<a class="reference external" href="https://cython.org/">cython</a> to accelerate key functions.</p></li>
<li><p>Think about parallelizing.</p></li>
</ol>
<p>Many times in science, you want to parallelize your code: either if the computation
takes too much time on one core or when the code needs to be parallel to even
be allowed to run on a specific hardware (e.g. supercomputers).</p>
<p><strong>Parallel computing</strong> is when many different tasks are carried out
simultaneously.  There are three main models:</p>
<ul class="simple">
<li><p><strong>Embarrassingly parallel:</strong> the code does not need to
synchronize/communicate with other instances, and you can run
multiple instances of the code separately, and combine the results
later.  If you can do this, great!  (array jobs, task queues,
workflow management tools)</p></li>
<li><p><strong>Multithreading:</strong> Parallel threads need to communicate and do so via
the same memory (variables, state, etc). (OpenMP, <code class="docutils literal notranslate"><span class="pre">threading</span></code>)</p></li>
<li><p><strong>Multiprocessing, message passing:</strong> Different processes manage
their own memory segments. They share data by communicating (passing
messages) as needed. (<code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code>, MPI).</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Parallel programming is not magic, but many things can go wrong and
you can get unexpected results or difficult to debug problems.
Parallel programming is a fascinating world to get involved in, but
make sure you invest enough time to do it well.</p>
<p>See the video by Raymond Hettinger (“See Also” at bottom
of page) for an entertaining take on this.</p>
</div>
</section>
<section id="multithreading-and-the-gil">
<h3>Multithreading and the GIL<a class="headerlink" href="#multithreading-and-the-gil" title="Link to this heading"></a></h3>
<p>The designers of the Python language made the choice
that <strong>only one thread in a process can run actual Python code</strong>
by using the so-called <strong>global interpreter lock (GIL)</strong>.
This means that approaches that may work in other languages (C, C++, Fortran),
may not work in Python.
At first glance, this is bad for parallelism.  <em>But it’s not all bad!:</em></p>
<ul class="simple">
<li><p>External libraries (NumPy, SciPy, Pandas, etc), written in C or other
languages, can release the lock and run multi-threaded.</p></li>
<li><p>Most input/output releases the GIL, and input/output is slow. The
<code class="docutils literal notranslate"><span class="pre">threading</span></code> library can be used to multithread I/O.</p></li>
<li><p>Python libraries like <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> and <code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> run <em>multiple
Python processes</em> and this circumvents the GIL.</p></li>
</ul>
<p>Consider the following code which does a symmetrical matrix inversion
of a fairly large matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">4000</span><span class="p">,</span><span class="mi">4000</span><span class="p">))</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time spent for inverting A is&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we run this in a Jupyter notebook or through a Python script, <strong>it
will automatically use multithreading</strong> through OpenMP. We can force
NumPy to use only one thread by setting an environment variable
(either <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OMP_NUM_THREADS=1</span></code> or <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MKL_NUM_THREADS=1</span></code>,
depending on how NumPy is compiled on your machine),
and this will normally result in significantly longer runtime.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.python.org/moin/GlobalInterpreterLock">More on the global interpreter lock</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/threading.html">Threading python module</a>.  This is
very low level and you shouldn’t use it unless you really know what
you are doing.</p></li>
<li><p>We recommend you find a UNIX threading tutorial first before embarking
on using the <a class="reference external" href="https://docs.python.org/3/library/threading.html#module-threading" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> module.</p></li>
</ul>
</div>
</section>
<section id="multiprocessing">
<h3>multiprocessing<a class="headerlink" href="#multiprocessing" title="Link to this heading"></a></h3>
<p>As opposed to threading, Python has a reasonable way of doing
something similar that uses multiple processes: the
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#module-multiprocessing" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> module.
The interface is a lot like threading, but in the background creates
new processes to get around the global interpreter lock.</p>
<p>To show an example,
the <a class="reference external" href="https://doi.org/10.18637%2Fjss.v040.i01">split-apply-combine</a>
or <a class="reference external" href="https://en.wikipedia.org/wiki/MapReduce">map-reduce</a> paradigm is
quite useful for many scientific workflows.  Consider you have this:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
<p>You can apply the function to every element in a list using the
<a class="reference external" href="https://docs.python.org/3/library/functions.html#map" title="(in Python v3.14)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> function:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]))</span>
<span class="go">[1, 4, 9, 16, 25, 36]</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.pool.Pool</span></code></a> class provides an equivalent but
parallelized (via multiprocessing) way of doing this.  The pool class,
by default, creates one new process per CPU and does parallel
calculations on the list:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="go">[1, 4, 9, 16, 25, 36]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Running the above example <strong>interactively</strong> in a Jupyter notebook
or through an Python/IPython terminal may or may not work on your
computer! This is a feature and not a bug, as covered in the
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html">documentation</a>.</p>
<p>Fortunately, there is a fork of multiprocesssing called
<a class="reference external" href="https://pypi.org/project/multiprocess/">multiprocess</a> which does
work in interactive environments. All we have to do is install it
by <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">multiprocess</span></code> and change the import statement:
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">multiprocess</span> <span class="pre">import</span> <span class="pre">Pool</span></code>.</p>
</div>
</section>
<section id="exercises-multiprocessing">
<h3>Exercises, multiprocessing<a class="headerlink" href="#exercises-multiprocessing" title="Link to this heading"></a></h3>
<div class="admonition-parallel-1-multiprocessing exercise important admonition" id="exercise-0">
<p class="admonition-title">Parallel-1, multiprocessing</p>
<p>Here, you find some code which calculates pi by a stochastic
algorithm.  You don’t really need to worry how the algorithm works,
but it computes random points in a 1x1 square, and computes the
number that fall into a circle.  Copy it into a Jupyter notebook
and use the <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> cell magic on the computation part (the
one highlighted line after timeit below):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make n trials of points in the square.  Return (n, number_in_circle)</span>

<span class="sd">    This is our basic function.  By design, it returns everything it\</span>
<span class="sd">    needs to compute the final answer: both n (even though it is an input</span>
<span class="sd">    argument) and n_inside_circle.  To compute our final answer, all we</span>
<span class="sd">    have to do is sum up the n:s and the n_inside_circle:s and do our</span>
<span class="sd">    computation&quot;&quot;&quot;</span>
    <span class="n">n_inside_circle</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">n_inside_circle</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_inside_circle</span>

<span class="o">%%</span><span class="n">timeit</span>
<span class="hll"><span class="n">n</span><span class="p">,</span> <span class="n">n_inside_circle</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span>
<span class="n">pi</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_inside_circle</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="n">pi</span>
</pre></div>
</div>
<p>Using the <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.pool.Pool</span></code></a> code from the lesson, run
the <code class="docutils literal notranslate"><span class="pre">sample</span></code> function 10 times, each with <code class="docutils literal notranslate"><span class="pre">10**5</span></code> samples
only.  Combine the results and time the calculation.  What is the
difference in time taken?</p>
<p>NOTE: If you’re working in an interactive environment and this
doesn’t work with the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module, install and use
the <code class="docutils literal notranslate"><span class="pre">multiprocess</span></code> module instead!</p>
<p>(optional, advanced) Do the same but with
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.ThreadPool" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.pool.ThreadPool</span></code></a> instead.  This works identically
to <code class="docutils literal notranslate"><span class="pre">Pool</span></code>, but uses threads instead of different processes.
Compare the time taken.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>See the finished notebook here <a class="reference internal" href="#document-parallel-pi-multiprocessing"><span class="doc">Python multithreading solution</span></a>.</p>
<p>You notice the version with <code class="docutils literal notranslate"><span class="pre">ThreadPool</span></code> is no faster, and
probably takes even longer.  This is because this is a
pure-Python function which can not run simultaneously in
multiple threads.</p>
</div>
</div>
<div class="admonition-advanced-parallel-2-running-on-a-cluster exercise important admonition" id="exercise-1">
<p class="admonition-title">(advanced) Parallel-2 Running on a cluster</p>
<p>How does the pool know how many CPUs to take?  What happens if you
run on a computer cluster and request only part of the CPUs on a
node?</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>Pool by default uses one process for each CPU on the node - it
doesn’t know about your cluster’s scheduling system.  It’s
possible that you have permission to use 2 CPUs but it is trying
to use 12.  This is generally a bad situation, and will just
slow you down (and make other users on the same node upset)!</p>
<p>You either need to be able to specify the number of CPUs to use
(and pass it the right number), or make it aware of the cluster
system.  For example, on a Slurm cluster you would check the
environment variable <code class="docutils literal notranslate"><span class="pre">SLURM_CPUS_PER_TASK</span></code>.</p>
<p>Whatever you do, document what your code is doing under the
hood, so that other users know what is going on (we’ve learned
this from experience…).</p>
</div>
</div>
</section>
<section id="mpi">
<h3>MPI<a class="headerlink" href="#mpi" title="Link to this heading"></a></h3>
<p>The message passing interface (MPI) approach to parallelization
is that:</p>
<ul class="simple">
<li><p>Tasks (cores) have a rank and are numbered 0, 1, 2, 3, …</p></li>
<li><p>Each task (core) manages its own memory</p></li>
<li><p>Tasks communicate and share data by sending messages</p></li>
<li><p>Many higher-level functions exist to distribute information to other tasks
and gather information from other tasks</p></li>
<li><p>All tasks typically run the entire code and we have to be careful to avoid
that all tasks do the same thing</p></li>
</ul>
<p>Introductory MPI lessons where Python is included:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://rantahar.github.io/introduction-to-mpi/">https://rantahar.github.io/introduction-to-mpi/</a></p></li>
<li><p><a class="reference external" href="https://pdc-support.github.io/introduction-to-mpi/">https://pdc-support.github.io/introduction-to-mpi/</a></p></li>
</ul>
<p>These blog posts are good for gentle MPI/mpi4py introduction:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.kth.se/blogs/pdc/2019/08/parallel-programming-in-python-mpi4py-part-1/">https://www.kth.se/blogs/pdc/2019/08/parallel-programming-in-python-mpi4py-part-1/</a></p></li>
<li><p><a class="reference external" href="https://www.kth.se/blogs/pdc/2019/11/parallel-programming-in-python-mpi4py-part-2/">https://www.kth.se/blogs/pdc/2019/11/parallel-programming-in-python-mpi4py-part-2/</a></p></li>
</ul>
<p>Those who use MPI in C, C++, Fortran, will probably understand the steps in the
following example. For learners new to MPI, we can explore this example
together.</p>
<p>Here we reuse the example of approximating pi with a stochastic
algorithm from above, and we have highlighted the lines which are important
to get this MPI example to work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">mpi4py</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPI</span>
</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make n trials of points in the square.  Return (n, number_in_circle)</span>

<span class="sd">    This is our basic function.  By design, it returns everything it\</span>
<span class="sd">    needs to compute the final answer: both n (even though it is an input</span>
<span class="sd">    argument) and n_inside_circle.  To compute our final answer, all we</span>
<span class="sd">    have to do is sum up the n:s and the n_inside_circle:s and do our</span>
<span class="sd">    computation&quot;&quot;&quot;</span>
    <span class="n">n_inside_circle</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">n_inside_circle</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_inside_circle</span>


<span class="hll"><span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
</span><span class="hll"><span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
</span><span class="hll"><span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span>

<span class="hll"><span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span>    <span class="n">n_task</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">n_task</span> <span class="o">=</span> <span class="n">n</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">_</span><span class="p">,</span> <span class="n">n_inside_circle</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">n_task</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;before gather: rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">, n_inside_circle: </span><span class="si">{</span><span class="n">n_inside_circle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">n_inside_circle</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">n_inside_circle</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after gather: rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">, n_inside_circle: </span><span class="si">{</span><span class="n">n_inside_circle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="hll"><span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span>    <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">n_inside_circle</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">number of darts: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, estimate: </span><span class="si">{</span><span class="n">pi_estimate</span><span class="si">}</span><span class="s2">, time spent: </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exercises-mpi">
<h3>Exercises, MPI<a class="headerlink" href="#exercises-mpi" title="Link to this heading"></a></h3>
<div class="admonition-parallel-3-mpi exercise important admonition" id="exercise-2">
<p class="admonition-title">Parallel-3, MPI</p>
<p>We can do this as <strong>exercise or as demo</strong>. Note that this example requires <code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> and a
MPI installation such as for instance <a class="reference external" href="https://www.open-mpi.org/">OpenMPI</a>.</p>
<ul class="simple">
<li><p>Try to run this example on one core: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">python</span> <span class="pre">example.py</span></code>.</p></li>
<li><p>Then compare the output with a run on multiple cores (in this case 2): <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">mpiexec</span> <span class="pre">-n</span> <span class="pre">2</span> <span class="pre">python</span> <span class="pre">example.py</span></code>.</p></li>
<li><p>Can you guess what the <code class="docutils literal notranslate"><span class="pre">comm.gather</span></code> function does by looking at the print-outs right before and after.</p></li>
<li><p>Why do we have the if-statement <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">rank</span> <span class="pre">==</span> <span class="pre">0</span></code> at the end?</p></li>
<li><p>Why did we use <code class="docutils literal notranslate"><span class="pre">_,</span> <span class="pre">n_inside_circle</span> <span class="pre">=</span> <span class="pre">sample(n_task)</span></code> and not <code class="docutils literal notranslate"><span class="pre">n,</span> <span class="pre">n_inside_circle</span> <span class="pre">=</span> <span class="pre">sample(n_task)</span></code>?</p></li>
</ul>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>We first run the example normally, and get:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>example.py
<span class="go">before gather: rank 0, n_inside_circle: 7854305</span>
<span class="go">after gather: rank 0, n_inside_circle: [7854305]</span>

<span class="go">number of darts: 10000000, estimate: 3.141722, time spent: 2.5 seconds</span>
</pre></div>
</div>
<p>Next we take advantage of the MPI parallelisation and run on 2 cores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>python<span class="w"> </span>mpi_test.py
<span class="go">before gather: rank 0, n_inside_circle: 3926634</span>
<span class="go">before gather: rank 1, n_inside_circle: 3925910</span>
<span class="go">after gather: rank 1, n_inside_circle: None</span>
<span class="go">after gather: rank 0, n_inside_circle: [3926634, 3925910]</span>

<span class="go">number of darts: 10000000, estimate: 3.1410176, time spent: 1.3 seconds</span>
</pre></div>
</div>
<p>Note that two MPI processes are now printing output. Also, the parallel
version runs twice as fast!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">comm.gather</span></code> function collects (gathers) values of a
given variable from all MPI ranks onto one <cite>root</cite> rank, which is
conventionally rank 0.</p>
<p>A conditional <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">rank</span> <span class="pre">==</span> <span class="pre">0</span></code> is typically used to print output
(or write data to file, etc) from only one rank.</p>
<p>An underscore <code class="docutils literal notranslate"><span class="pre">_</span></code> is often used as a variable name in cases
where the data is unimportant and will not be reused.</p>
</div>
</div>
</section>
<section id="coupling-to-other-languages">
<h3>Coupling to other languages<a class="headerlink" href="#coupling-to-other-languages" title="Link to this heading"></a></h3>
<p>As mentioned further up in “Multithreading and the GIL”, Python has the global
interpreter lock (GIL) which prevents us from using shared-memory
parallelization strategies like OpenMP “directly”.</p>
<p>However, an interesting workaround for this can be to couple Python with other
languages which do not have the GIL.  This also works just as well when you don’t
need parallelism, but need to make an optimized algorithm for a small part of the code.</p>
<p>Two strategies are common:</p>
<ul>
<li><p>Couple Python with compiled languages like C, C++, Fortran, or Rust and let those handle the shared-memory parallelization:</p>
<blockquote>
<div><ul class="simple">
<li><p>C: use the <a class="reference external" href="https://cffi.readthedocs.io/">cffi</a> package (C foreign function interface).  <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> is a similar but slightly more primitive module that is in the standard library.</p></li>
<li><p>C++: use <a class="reference external" href="https://pybind11.readthedocs.io/">pybind11</a></p></li>
<li><p>Fortran: create a C interface using <code class="docutils literal notranslate"><span class="pre">iso_c_binding</span></code> and then couple the C layer to Python
using <a class="reference external" href="https://cffi.readthedocs.io/">cffi</a></p></li>
<li><p>Rust: use <a class="reference external" href="https://pyo3.rs/">PyO3</a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Let compiled languages do the shared-memory parallelization part (as in above
point) and let Python do the MPI work and distribute tasks across nodes using
an <code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> layer.</p></li>
</ul>
<p>Coupling Python with other languages using the above tools is not difficult but
it goes beyond the scope of this course.</p>
<p>Before you take this route, <strong>profile the application</strong> first to be sure where
the bottleneck is.</p>
<p>Of course sometimes coupling languages is not about overcoming bottlenecks but
about combining existing programs which have been written in different
languages for whatever reason.</p>
<p>Examples of scientific codes that combine Python and other languages:</p>
<ul class="simple">
<li><p>The numerical toolkit <a class="reference external" href="https://runko.readthedocs.io/">Runko</a> for simulating
astrophysical plasmas. The code is written in C++17 and Python.</p></li>
<li><p>The quantum chemistry code <a class="reference external" href="https://veloxchem.org/">VeloxChem</a> is a Python
based program for spectroscopy calculations in high-performance computing
environments. The code is written in Python, C++, and has kernels in CUDA and
HIP for running on GPUs.</p></li>
</ul>
</section>
<section id="dask-and-task-queues">
<h3>Dask and task queues<a class="headerlink" href="#dask-and-task-queues" title="Link to this heading"></a></h3>
<p>There are other strategies that go completely beyond the manual
parallelization methods above.  We won’t go into much detail.</p>
<section id="dask">
<h4>Dask<a class="headerlink" href="#dask" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://dask.org/">Dask</a> is a array model extension and task
scheduler.  By using the new array classes, you can automatically
distribute operations across multiple CPUs.</p>
<p>Dask is very popular for data analysis and is used by a number of high-level Python libraries:</p>
<ul class="simple">
<li><p>Dask arrays scale NumPy (see also <a class="reference external" href="https://xarray.pydata.org/en/stable/">xarray</a></p></li>
<li><p>Dask dataframes scale Pandas workflows</p></li>
<li><p>Dask-ML scales Scikit-Learn</p></li>
</ul>
<p>Dask divides arrays into many small pieces (chunks), as small as necessary to fit it into memory. Operations are delayed (lazy computing) e.g. tasks are queue and no computation is performed until you actually ask values to be computed (for instance print mean values). Then data is loaded into memory and computation proceeds in a streaming fashion, block-by-block.</p>
<div class="admonition-example-from-dask-org discussion important admonition" id="discussion-0">
<p class="admonition-title">Example from dask.org</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Arrays implement the Numpy API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dask.array</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">da</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
                     <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># It runs using multiple threads on your machine.</span>
<span class="c1"># It could also be distributed to multiple machines</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="exercises-dask">
<h3>Exercises, Dask<a class="headerlink" href="#exercises-dask" title="Link to this heading"></a></h3>
<div class="admonition-dask-examples-optional exercise important admonition" id="exercise-3">
<p class="admonition-title">Dask-Examples (optional)</p>
<p><a class="reference external" href="https://github.com/dask/dask-examples">Dask examples</a> illustrate the usage of dask and can be run interactively through <a class="reference external" href="https://mybinder.org/">mybinder</a>. Start an <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab">interactive session on mybinder</a> and test/run a few dask examples.</p>
</div>
<section id="task-queues">
<h4>Task queues<a class="headerlink" href="#task-queues" title="Link to this heading"></a></h4>
<p>A <strong>task queue</strong> has a scheduler which takes a list of small jobs and
distributes them to runners for computation.  It serves as a
synchronization layer and may be useful for <em>embarrassingly parallel</em> jobs.</p>
<p>There are different descriptions of <a class="reference external" href="https://www.fullstackpython.com/task-queues.html">task queues in Python</a>. Job runners ask
the queue for the task which needs to be done next.  If you can divide
your job into many small parts, this may be useful to you.  However,
if you have a cluster with a job scheduler, this may be a bit
redundant.</p>
</section>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/Bv25Dwe84g0">Thinking about Concurrency, Raymond Hettinger</a>.  Good introduction to simple and
safe concurrent code.</p></li>
<li><p><a class="reference external" href="https://enccs.github.io/hpda-python/performance-boosting/">Introduction to Numba and Cython</a>.</p></li>
<li><p><a class="reference external" href="https://enccs.github.io/hpda-python/parallel-computing/">More detailed exposition of parallel computing in Python</a>.</p></li>
<li><p><a class="reference external" href="https://enccs.github.io/hpda-python/dask/">Introduction to Dask for scalable analytics</a>.</p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Pure Python is not very good for highly parallel code.</p></li>
<li><p>Luckily it interfaces to many things which <em>are</em> good, and give
you the full control you need.</p></li>
<li><p>Combining vectorized functions (NumPy, Scipy, pandas, etc.) with
the parallel strategies listed here will get you very far.</p></li>
<li><p>Another popular framework similar to <cite>multiprocessing</cite> is
<a class="reference external" href="https://joblib.readthedocs.io/en/latest/">joblib</a>.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-packaging"></span><section id="packaging">
<h2>Packaging<a class="headerlink" href="#packaging" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How to organize Python projects larger than one script?</p></li>
<li><p>What is a good file and folder structure for Python projects?</p></li>
<li><p>How can you make your Python functions most usable by your collaborators?</p></li>
<li><p>How to prepare your code to make a Python package?</p></li>
<li><p>How to publish your Python package?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn to identify the components of a Python package</p></li>
<li><p>Learn to create a Python package</p></li>
<li><p>Learn to publish a Python package</p></li>
</ul>
</div>
<section id="organizing-python-projects">
<h3>Organizing Python projects<a class="headerlink" href="#organizing-python-projects" title="Link to this heading"></a></h3>
<p>Python projects often start as a single script or Jupyter notebook but
they can grow out of a single file.</p>
<p>In the <a class="reference internal" href="index.html#scripts"><span class="std std-ref">Scripts</span></a> episode we have also learned how to import functions
and objects from other Python files (modules). Now we will take it a step further.</p>
<p><strong>Recommendations</strong>:</p>
<ul class="simple">
<li><p>Collect related functions into modules (files).</p></li>
<li><p>Collect related modules into packages (we will show how).</p></li>
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">LICENSE</span></code> file to your code from <a class="reference external" href="https://choosealicense.com">choosealicense.com</a>
(see <a class="reference external" href="https://github.com/coderefinery/social-coding/blob/main/licensing-and-cakes.md">Software Licensing and Open source explained with cakes</a>).</p></li>
<li><p>Write a <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file describing what the code does and how to use it.</p></li>
<li><p>It is also recommended to <a class="reference external" href="https://coderefinery.github.io/documentation/">document your package</a>.</p></li>
<li><p>When the project grows, you might need <a class="reference external" href="https://coderefinery.github.io/testing/">automated testing</a>.</p></li>
</ul>
<p>To have a concrete but still simple example, we will create a project
consisting of 3 functions, each in its own file. We can then imagine that each
file would contain many more functions. To make it more interesting,
one of these functions will depend on an external library: <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p>
<p>These are the 3 files:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">adding.py</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">subtracting.py</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">integrating.py</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">integrate</span>


<span class="k">def</span><span class="w"> </span><span class="nf">integral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will add a fourth file:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">__init__.py</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example calculator package.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.adding</span><span class="w"> </span><span class="kn">import</span> <span class="n">add</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.subtracting</span><span class="w"> </span><span class="kn">import</span> <span class="n">subtract</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.integrating</span><span class="w"> </span><span class="kn">import</span> <span class="n">integral</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
</pre></div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file will be the interface of our package/library.
It also holds the package docstring and the version string.
Note how it imports functions from the various modules using <em>relative imports</em>
(with the dot).</p>
<p>After that let’s create a file called <code class="docutils literal notranslate"><span class="pre">README.md</span></code> to the project root
that will describe our project to other people who might want to use it.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">README.md</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># calculator</span>

Great calculator with amazing mathematics functions:

<span class="k">-</span><span class="w"> </span><span class="sb">`calculator.adding.add`</span>: Adds numbers
<span class="k">-</span><span class="w"> </span><span class="sb">`calculator.subtracting.subtract`</span>: Subtracts numbers
<span class="k">-</span><span class="w"> </span><span class="sb">`calculator.integrating.integral`</span>: Integrate functions
</pre></div>
</div>
</div>
<p>Now our folder should look something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>calculator_myname
├── calculator
│   ├── adding.py
│   ├── __init__.py
│   ├── integrating.py
│   └── subtracting.py
└── README.md
</pre></div>
</div>
<p>After this we need to create a file called
<a class="reference external" href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/">pyproject.toml</a>,
which describes our package.
To make this easier we’ll use <code class="docutils literal notranslate"><span class="pre">flit</span></code> (which is already installed in the
course environment) in a terminal to initialize it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>flit<span class="w"> </span>init
<span class="go">Module name [calculator]: calculator_myname</span>
<span class="go">Author: Firstname Lastname</span>
<span class="go">Author email: firstname.lastname@example.org</span>
<span class="go">Home page: http://www.example.org</span>
<span class="go">Choose a license (see http://choosealicense.com/ for more info)</span>
<span class="go">1. MIT - simple and permissive</span>
<span class="go">2. Apache - explicitly grants patent rights</span>
<span class="go">3. GPL - ensures that code based on this is shared with the same terms</span>
<span class="go">4. Skip - choose a license later</span>
<span class="go">Enter 1-4: 1</span>

<span class="go">Written pyproject.toml; edit that file to add optional extra info.</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flit</span></code> will ask us questions about your project and it create a
<code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> into the project folder. The name of the package
(Module name) should be something that is not already in use. In best
case scenario it should be the same as the Python module name. In our
case, let’s use a different name and let’s fix this later.</p>
<p>This is how we will arrange the files in the project folder/repository:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>calculator_myname
├── calculator
<span class="hll">│   ├── adding.py
</span><span class="hll">│   ├── __init__.py
</span><span class="hll">│   ├── integrating.py
</span><span class="hll">│   └── subtracting.py
</span>├── LICENSE
└── README.md
</pre></div>
</div>
<p>Now we are ready to test the package. For this we need to be in the “root”
folder, what we have called the <em>project-folder</em>.  We also need to have
<code class="docutils literal notranslate"><span class="pre">scipy</span></code> available in our environment:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">calculator</span><span class="w"> </span><span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">integral</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 + 3 =&quot;</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">integral_x_squared</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integral_x_squared</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package is not yet pip-installable, though. We will make this possible in
the next section.</p>
</section>
<section id="testing-a-local-pip-install">
<h3>Testing a local pip install<a class="headerlink" href="#testing-a-local-pip-install" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> specification tells Pip what our package is and
what it should install. It currently looks like this:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;flit_core &gt;=3.11,&lt;4&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;flit_core.buildapi&quot;</span>

<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;calculator_myname&quot;</span>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Firstname Lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;firstname.lastname@example.org&quot;</span><span class="p">}]</span>
<span class="n">readme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;README.md&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">license-files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;LICENSE&quot;</span><span class="p">]</span>
<span class="n">dynamic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

<span class="k">[project.urls]</span>
<span class="n">Home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://www.example.org&quot;</span>
</pre></div>
</div>
</div>
<p>Let’s do couple of finishing touches to it. Because we have different names
for the package and our module import, we’ll add a section that specifies
that.</p>
<p>We also need to add the dependency to <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p>
<p>After the changes our <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> looks like this:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;flit_core &gt;=3.11,&lt;4&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;flit_core.buildapi&quot;</span>

<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;calculator_myname&quot;</span>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Firstname Lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;firstname.lastname@example.org&quot;</span><span class="p">}]</span>
<span class="n">readme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;README.md&quot;</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span>
<span class="n">license-files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;LICENSE&quot;</span><span class="p">]</span>
<span class="n">dynamic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
<span class="hll"><span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span class="hll"><span class="w">    </span><span class="s2">&quot;scipy&quot;</span>
</span><span class="hll"><span class="p">]</span>
</span>
<span class="k">[project.urls]</span>
<span class="n">Home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://www.example.org&quot;</span>

<span class="hll"><span class="k">[tool.flit.module]</span>
</span><span class="hll"><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;calculator&quot;</span>
</span></pre></div>
</div>
</div>
<p>Note how our package requires <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and we decided to not pin the version
here (see <a class="reference internal" href="index.html#version-pinning"><span class="std std-ref">Version pinning for package creators</span></a>).</p>
<p>Now we have all the building blocks to test a local pip install. This is a good
test before trying to upload a package to PyPI or test-PyPI
(see <a class="reference internal" href="index.html#pypi"><span class="std std-ref">PyPI (The Python Package Index) and conda ecosystem</span></a>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometime you need to rely on unreleased, development versions as
dependencies and this is also possible. For example, to use the
latest <code class="docutils literal notranslate"><span class="pre">xarray</span></code> you could add:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s2">&quot;scipy&quot;</span><span class="p">,</span>
     <span class="s2">&quot;xarray @ https://github.com/pydata/xarray/archive/main.zip&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pip.pypa.io/en/stable/reference/requirement-specifiers/">pip requirement specifiers</a></p></li>
<li><p>pyOpenSci tutorial on
<a class="reference external" href="https://www.pyopensci.org/python-package-guide/tutorials/pyproject-toml.html">pyproject.toml metadata</a></p></li>
</ul>
</div>
</div>
</section>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h3>
<div class="admonition-packaging-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Packaging-1</p>
<p>To test a local pip install:</p>
<ul class="simple">
<li><p>Create a new folder outside of our example project</p></li>
<li><p>Create a new virtual environment and activate it (more on this in <a class="reference internal" href="index.html#dependency-management"><span class="std std-ref">Dependency management</span></a>)</p></li>
</ul>
<div class="dropdown admonition hint">
<p class="admonition-title">Hint</p>
<p>To create and activate a virtual environment</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Unix/macOS</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
which<span class="w"> </span>python
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>python -m venv .venv
.venv\Scripts\activate
where python
</pre></div>
</div>
</div></div>
</div>
<ul>
<li><p>Install the example package from the project folder
into the new environment:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">editable</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">project</span><span class="o">-</span><span class="n">folder</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>Test the local installation:</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">calculator</span><span class="w"> </span><span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">integral</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 + 3 =&quot;</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">integral_x_squared</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integral_x_squared</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Make a change in the <code class="docutils literal notranslate"><span class="pre">subtract</span></code> function above such that it always
returns a float <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">float(x</span> <span class="pre">-</span> <span class="pre">y)</span></code>.</p></li>
<li><p>Open a new Python console and test the following lines. Compare it with
the previous output.</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">calculator</span><span class="w"> </span><span class="kn">import</span> <span class="n">subtract</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="sharing-packages-via-pypi">
<h3>Sharing packages via PyPI<a class="headerlink" href="#sharing-packages-via-pypi" title="Link to this heading"></a></h3>
<div class="admonition-demo demo admonition" id="demo-0">
<p class="admonition-title">Demo</p>
<p>Most people will watch and observe this, due to the speed with which we will
move.</p>
</div>
<p>Once we are able to pip-install the example package locally, we are ready for
upload.</p>
<p>We exercise by uploading to <a class="reference external" href="https://test.pypi.org/">test-PyPI</a>, not the
real <a class="reference external" href="https://pypi.org/">PyPI</a>, so that if we mess things up, nothing bad
happens.</p>
<p>We need two more things:</p>
<ul class="simple">
<li><p>We will do this using <a class="reference external" href="https://twine.readthedocs.io/">Twine</a> so you need
to pip install that, too.</p></li>
<li><p>You need an account on <a class="reference external" href="https://test.pypi.org/">test-PyPI</a></p></li>
</ul>
<p>Let’s try it out. First we create the distribution package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>-m<span class="w"> </span>build
</pre></div>
</div>
<p>We need also have <code class="docutils literal notranslate"><span class="pre">twine</span></code> installed, but it is included in the course
environment.</p>
<p>And use twine to upload the distribution files to test-PyPI:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twine<span class="w"> </span>upload<span class="w"> </span>-r<span class="w"> </span>testpypi<span class="w"> </span>dist/*

<span class="go">Uploading distributions to https://test.pypi.org/legacy/</span>
<span class="go">Enter your API token:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To generate an API token,  proceed to the <a class="reference external" href="https://test.pypi.org/manage/account/token/">Create API token</a> page in test-PyPI.
You will be prompted for your password.</p>
<div class="admonition-the-long-version-for-finding-the-create-api-token-page solution important dropdown admonition" id="solution-0">
<p class="admonition-title">The long-version for finding the <em>Create API token</em> page</p>
<ol class="arabic simple">
<li><p>Log on to <a class="reference external" href="https://test.pypi.org/">test-PyPI</a> at <a class="reference external" href="https://test.pypi.org">https://test.pypi.org</a></p></li>
<li><p>In the top-right corner, click on the drop-down menu and click <strong>Account settings</strong> or
follow this <a class="reference external" href="https://test.pypi.org/manage/account/#api-tokens">link</a>.</p></li>
<li><p>Scroll down to the section <strong>API tokens</strong> and click the button <strong>Add API token</strong>,
which opens up the
<a class="reference external" href="https://test.pypi.org/manage/account/token/">Create API token</a> page.</p></li>
</ol>
</div>
<ol class="arabic simple">
<li><p>Under <strong>Token name</strong> write something memorable.
It should remind you the <em>purpose</em>
or the <em>name of the computer</em>, such that when you are done
using it, you can safely delete it.</p></li>
<li><p>Under <strong>Scope</strong> select <code class="docutils literal notranslate"><span class="pre">Entire</span> <span class="pre">account</span> <span class="pre">(all</span> <span class="pre">projects)</span></code>.</p></li>
<li><p>Click on <strong>Create token</strong>.</p></li>
<li><p>Click on <strong>Copy token</strong> once a long string which starts
with <code class="docutils literal notranslate"><span class="pre">pypi-</span></code> is generated.</p></li>
</ol>
<p>Paste that token back into the terminal where <code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">upload</span> <span class="pre">...</span></code> is running and press ENTER.</p>
</div>
<p>Once this is done, create yet another virtual environment and try to install from test-PyPI (adapt <code class="docutils literal notranslate"><span class="pre">myname</span></code>).</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">Linux / macOS</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv-calculator
<span class="gp"> $ </span><span class="nb">source</span><span class="w"> </span>venv-calculator/bin/activate
<span class="gp"> $ </span>which<span class="w"> </span>python
<span class="hll"><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>-i<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>--extra-index-url<span class="w"> </span>https://pypi.org/simple/<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>calculator_myname
</span><span class="gp"> $ </span>deactivate
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv-calculator
<span class="gp"> $ </span>venv-calculator<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
<span class="gp"> $ </span>where<span class="w"> </span>python
<span class="hll"><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-i<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span>--extra-index-url<span class="w"> </span>https://pypi.org/simple/<span class="w"> </span>calculator_myname
</span><span class="gp"> $ </span>deactivate
</pre></div>
</div>
</div></div>
<p>If you upload packages to PyPI or test PyPI often you can create an API token and
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/pypirc/#common-configurations">save it in the .pypirc file</a>.</p>
</section>
<section id="tools-that-simplify-sharing-via-pypi">
<h3>Tools that simplify sharing via PyPI<a class="headerlink" href="#tools-that-simplify-sharing-via-pypi" title="Link to this heading"></a></h3>
<p>The solution that we have used to create the example package (using
<code class="docutils literal notranslate"><span class="pre">setuptools</span></code> and <code class="docutils literal notranslate"><span class="pre">twine</span></code>) is not the only approach. There are many ways to
achieve this and we avoided going into too many details and comparisons to not
confuse too much. If you web-search this, you will also see that recently the
trend goes towards using <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> as more general
alternative to the previous <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>There are at least five tools which try to make the packaging and PyPI interaction easier:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a></p></li>
<li><p><a class="reference external" href="https://pdm-project.org/">PDM</a></p></li>
<li><p><a class="reference external" href="https://hatch.pypa.io/latest/">Hatch</a></p></li>
<li><p><a class="reference external" href="https://python-poetry.org/">Poetry</a></p></li>
<li><p><a class="reference external" href="https://flit.pypa.io/">Flit</a></p></li>
</ul>
<p>Today, due to standards such as <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> and <code class="docutils literal notranslate"><span class="pre">pylock.toml</span></code>, to specify the
package metadata and dependency lock file respectively, the above are largely
cross-compatible amongst each other and with <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<figure class="align-default" id="id8">
<img alt="Flowchart to help decide on a packaging tool" src="https://www.pyopensci.org/python-package-guide/_images/python-package-tools-decision-tree.png" />
<figcaption>
<p><span class="caption-text">Credits: pyOpenSci’s Python Package Guide licensed CC-BY-SA 4.0</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
<div class="legend">
<p>The properties of the project and your development requirements may determine which packaging
tool suits you. Use the above decision tree from <a class="reference external" href="https://www.pyopensci.org/python-package-guide/package-structure-code/python-package-build-tools.html">pyOpenSci</a> to help make that choice.</p>
</div>
</figcaption>
</figure>
</section>
<section id="building-a-conda-package-and-share-it">
<h3>Building a conda package and share it<a class="headerlink" href="#building-a-conda-package-and-share-it" title="Link to this heading"></a></h3>
<div class="admonition-prerequisites callout admonition" id="callout-0">
<p class="admonition-title">Prerequisites</p>
<p>To generate a conda build recipe, the package <code class="docutils literal notranslate"><span class="pre">grayskull</span></code> and
to build it, the package <code class="docutils literal notranslate"><span class="pre">conda-build</span></code> are required.
You may install these with <strong>Anaconda Navigator</strong> or from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>install<span class="w"> </span>-n<span class="w"> </span>base<span class="w"> </span>grayskull<span class="w"> </span>conda-build
</pre></div>
</div>
</div>
<p>The simplest way for creating a conda package for your python script is to
first publish it in <a class="reference external" href="https://pypi.org/">PyPI</a> following the steps explained
above.</p>
<section id="building-a-python-package-with-grayskull-and-conda-build">
<h4>Building a python package with grayskull and conda-build<a class="headerlink" href="#building-a-python-package-with-grayskull-and-conda-build" title="Link to this heading"></a></h4>
<p>Once build, the conda package can be installed locally. For this example, we
will use <a class="reference external" href="https://pypi.org/project/runtest/">runtest</a>.  <a class="reference external" href="https://github.com/bast/runtest">runtest</a> is a numerically tolerant end-to-end test
library for research software.</p>
<ol class="arabic">
<li><p>Generate the <em>recipe</em> by executing (<code class="docutils literal notranslate"><span class="pre">grayskull</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">grayskull</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>grayskull<span class="w"> </span>pypi<span class="w"> </span>runtest
</pre></div>
</div>
<p>The command above will create a new folder called <cite>runtest</cite> containing a file <cite>meta.yaml</cite>,
the conda recipe for building the <cite>runtest</cite> package.</p>
</li>
<li><p>View the contents of <cite>meta.yaml</cite> and ensure requirements :</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flit-core &gt;=2,&lt;4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
</pre></div>
</div>
<p>In the requirements above, we specified what is required for the <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#host">host</a> and for <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#run">running</a>  the package.</p>
<div class="admonition-remark callout admonition" id="callout-1">
<p class="admonition-title">Remark</p>
<p>For pure python recipes, this is all you need for building a python package with conda.
If your package needs to be built (for instance compilation), you would need additional files e.g. <cite>build.sh</cite> (to build on Linux/Mac-OSX) and <cite>bld.bat</cite> (to build on Windows systems). You can also add test scripts for testing your package. See <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html#writing-the-build-script-files-build-sh-and-bld-bat">documentation</a></p>
</div>
</li>
<li><p>Build your package with conda</p>
<p>Your package is now ready to be build with conda:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>build<span class="w"> </span>runtest
</pre></div>
</div>
<div class="admonition-conda-package-location callout admonition" id="callout-2">
<p class="admonition-title">Conda package location</p>
<p>Look at the messages produced while building. The location of the local conda package is given (search for <cite>anaconda upload</cite>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/username/miniforge3/conda-bld/noarch/runtest-2.3.4-py_0.tar.bz2
</pre></div>
</div>
<p>The prefix <code class="docutils literal notranslate"><span class="pre">/home/username/miniforge3/</span></code> may be different on your machine.
depending on your operating system (Linux, Mac-OSX or Windows). The sub-folder is named <code class="docutils literal notranslate"><span class="pre">noarch</span></code> since
it is a pure-python package and the recipe indicates the same.</p>
<p>If package contained compiled code then the sub-folder would have been named <code class="docutils literal notranslate"><span class="pre">win-64</span></code> or <code class="docutils literal notranslate"><span class="pre">linux-64</span></code>.
It could then be converted to other platforms using
<a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html#converting-a-package-for-use-on-all-platforms">conda convert</a>.</p>
</div>
</li>
<li><p>Check within new environment</p>
<p>It is not necessary to create a new conda environment to install it but as explained in previous episode, it is good practice to have isolated environments.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>local-runtest<span class="w"> </span>--use-local<span class="w"> </span>runtest
</pre></div>
</div>
<p>We can then check <cite>runtest</cite> has been successfully installed in <cite>local-runtest</cite> conda environment. Open a new Terminal with <cite>local-runtest</cite> environment (either from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>local-runtest
</pre></div>
</div>
<p>or via <strong>Anaconda Navigator</strong> (Open Terminal), import runtest and
check its version:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">runtest</span>
<span class="nb">print</span><span class="p">(</span><span class="n">runtest</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition-building-a-conda-package-from-scratch callout admonition" id="callout-3">
<p class="admonition-title">Building a conda package from scratch</p>
<p>It is possible to build a conda package from scratch without using conda grayskull.
We recommend you to check the
<a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html">conda-build documentation</a>
for more information.</p>
</div>
<p>To be able to share and install your local conda package anywhere (on other platforms), you would need to upload it to a <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">conda channel</a> (see below).</p>
</section>
</section>
<section id="tools-that-simplify-sharing-conda-packages">
<h3>Tools that simplify sharing conda packages<a class="headerlink" href="#tools-that-simplify-sharing-conda-packages" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://pixi.sh">pixi</a> is package management tool to cover all features of conda, along with
ability to initialize and package new projects.</p></li>
<li><p><a class="reference external" href="https://rattler.build">rattler-build</a> is a build tool which combines the functionalities of
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">grayskull</span></code>, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code> and allows you to also publish packages.</p></li>
</ul>
<section id="publishing-a-python-package">
<h4>Publishing a python package<a class="headerlink" href="#publishing-a-python-package" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Upload your package to <a class="reference external" href="https://conda-forge.org/">conda-forge</a>:
conda-forge is a conda channel: it contains community-led collection of
recipes, build infrastructure and distributions for the conda package
manager. Anyone can
<a class="reference external" href="https://conda-forge.org/docs/maintainer/adding_pkgs/">publish conda packages to conda-forge</a>
if certain
<a class="reference external" href="https://conda-forge.org/docs/maintainer/guidelines/">guidelines</a> are respected.</p></li>
<li><p>Upload your package to <a class="reference external" href="https://bioconda.github.io/">bioconda</a>: bioconda is
a very popular channel for the conda package manager specializing in
bioinformatics software. As for conda-forge, you need to follow their
<a class="reference external" href="https://bioconda.github.io/contributor/guidelines.html">guidelines</a> when
building conda recipes.</p></li>
</ul>
<p>You can also <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/create-custom-channels.html">create your own conda channel</a>
for publishing your packages.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>It is worth it to organize your code for publishing, even if only
you are using it.</p></li>
<li><p>PyPI is a place for Python packages</p></li>
<li><p>conda is similar but is not limited to Python</p></li>
</ul>
</div>
</section>
</section>
</section>
<span id="document-web-apis"></span><section id="web-apis-with-python">
<h2>Web APIs with Python<a class="headerlink" href="#web-apis-with-python" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>Have you ever needed to get some data from somewhere else on the web?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand a web server and API and why might you need to talk to one.</p></li>
<li><p>Basics of the <a class="reference external" href="https://requests.readthedocs.io/en/latest/">requests</a> Python library</p></li>
<li><p>Some lightweight recommendations on saving data when you get to more serious data download.</p></li>
</ul>
</div>
<section id="requests">
<h3>Requests<a class="headerlink" href="#requests" title="Link to this heading"></a></h3>
<p>Requests is a Python library that makes <strong>requests</strong> to web servers.  It provides a nice interface and is one of the go-to tools.  It does the raw data-download for simple web servers.</p>
<p>First, let’s take a tour of the Requests webpage.  Below, we embed the Requests website into a Jupyter notebook, but you might want to open it in another browser tab: <a class="reference external" href="https://requests.readthedocs.io/en/latest/">https://requests.readthedocs.io/en/latest/</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Embed the requests homepage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">requests_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://requests.readthedocs.io/en/latest/&quot;</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">requests_documentation_url</span><span class="p">,</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="s1">&#39;30%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="retrieve-data-from-api">
<h3>Retrieve data from API<a class="headerlink" href="#retrieve-data-from-api" title="Link to this heading"></a></h3>
<p>An <strong>API (Application Programming Interface)</strong> is the definition of the way computer programs communicate with each other.  We use Requests to connect to the API of a web server, tell it what we want, and it returns it to us.  This is called the <strong>request-response</strong> cycle.</p>
<p>We can find a list of some free APIs (available without authentication) at <a class="reference external" href="https://apipheny.io/free-api/#apis-without-key">https://apipheny.io/free-api/#apis-without-key</a> . These APIs can be used for developing and testing our code.</p>
<p>Let’s make a request to the Cat Fact API.  If we go to <a class="reference external" href="https://catfact.ninja/">https://catfact.ninja/</a>, it gives us the definitions:</p>
<ul class="simple">
<li><p>GET <code class="docutils literal notranslate"><span class="pre">/fact</span></code> is the <strong>API endpoint</strong>.</p></li>
<li><p><strong>GET</strong> is the type of request we make and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/fact</span></code> is the <strong>path</strong>.</p></li>
</ul>
<p>You can even test this in your web browser: <a class="reference external" href="https://catfact.ninja/fact">https://catfact.ninja/fact</a></p>
<p>Using the Requests library, we do this with <a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.get" title="(in Requests v2.32.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://catfact.ninja/fact&#39;</span>

<span class="c1"># Make a request</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.Response" title="(in Requests v2.32.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">requests.Response</span></code></a> object tells us what the server said.  We can access the response content using <a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.Response.content" title="(in Requests v2.32.5)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

<span class="c1"># Display</span>
<span class="n">display</span><span class="p">(</span><span class="n">response_content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The response content is in the <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON format</a> and Requests gives us the <a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.Response.json" title="(in Requests v2.32.5)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> method that decodes it and returns the corresponding data as Python objects.  This is equivalent to <a class="reference external" href="https://docs.python.org/3/library/json.html#json.load" title="(in Python v3.14)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.load()</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Display</span>
<span class="n">display</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>(Note that, normally, we could study the API documentation to check the response format beforehand. However, many times manual inspection and trial-and-error is needed, as we did here.)</p>
</section>
<section id="api-which-requires-parameters">
<h3>API which requires parameters<a class="headerlink" href="#api-which-requires-parameters" title="Link to this heading"></a></h3>
<p>Let’s then examine another API which accepts <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/quickstart/#passing-parameters-in-urls">parameters</a> to specify the information request. In particular, we will request a list of Finnish universities from <a class="reference external" href="http://universities.hipolabs.com">http://universities.hipolabs.com</a> using the <code class="docutils literal notranslate"><span class="pre">/search</span></code> end point and a parameter <em>country</em> with value <em>Finland</em>, like this:
<code class="docutils literal notranslate"><span class="pre">http://universities.hipolabs.com/search?country=Finland</span></code> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://universities.hipolabs.com/search?country=Finland&#39;</span>

<span class="c1"># Make a request</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Decode JSON</span>
<span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Display</span>
<span class="n">display</span><span class="p">(</span><span class="n">response_json</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>URLs containing parameters can always be constructed manually using the <em>&amp;</em> character and then listing the parameter (<em>key</em>, <em>value</em>) pairs as above.</p>
<p>However, <em>Requests</em> allows us to provide the parameters as a dictionary of strings, using the <em>params</em> keyword argument to <a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.get" title="(in Requests v2.32.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a>. This is easier to read and less error-prone.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://universities.hipolabs.com/search&#39;</span>

<span class="c1"># Make the parameter dictionary</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;country&#39;</span> <span class="p">:</span> <span class="s1">&#39;Finland&#39;</span><span class="p">}</span>

<span class="c1"># Get response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Decode JSON</span>
<span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Display</span>
<span class="n">display</span><span class="p">(</span><span class="n">response_json</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises-1">
<h3>Exercises 1<a class="headerlink" href="#exercises-1" title="Link to this heading"></a></h3>
<div class="admonition-exercise-webapis-1-request-different-activity-suggestions-from-the-bored-api exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise WebAPIs-1: Request different activity suggestions from the Bored API</p>
<p>Go to the <a class="reference external" href="https://www.boredapi.com/documentation">documentation page of the Bored API</a>. The Bored API is an open API which can be used to randomly generate activity suggestions.</p>
<p>Let’s examine the first sample query on the page http://www.boredapi.com/api/activity/ with a sample JSON response</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;activity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Learn Express.js&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;accessibility&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.25</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;education&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;participants&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;link&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://expressjs.com/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3943506&quot;</span>
<span class="p">}</span><span class="w"> </span>
</pre></div>
</div>
<p>Let’s replicate the query and see if we can get another random suggestion.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import module</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># URL of the activity API end point</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://www.boredapi.com/api/activity/&quot;</span>

<span class="c1"># Send the request using the get() function</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the JSON content of the response</span>
<span class="n">display</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s try to narrow down the suggestions by adding some parameters</p>
<ul class="simple">
<li><p>type</p></li>
<li><p>participants</p></li>
</ul>
<p>All possible parameter values are presented at the bottom of the bored documentation page.  <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/quickstart/#parameters">Relevant parts in the <em>Requests</em> documentation</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span>
    <span class="s1">&#39;participants&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Send the request using get() with parameters</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the JSON content of the response</span>
<span class="n">display</span><span class="p">(</span><span class="s2">&quot;Response&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s narrow the request further with more parameters</p>
<ul class="simple">
<li><p>price range</p></li>
<li><p>accessibility range</p></li>
</ul>
<p>(All possible parameter values are again presented at the bottom of the document page.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;social&#39;</span><span class="p">,</span>
    <span class="s1">&#39;participants&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;minprice&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;maxprice&#39;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Send the request using get() with parameters</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the JSON content of the response</span>
<span class="n">display</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises-2">
<h3>Exercises 2<a class="headerlink" href="#exercises-2" title="Link to this heading"></a></h3>
<div class="admonition-exercise-webapis-2-examine-request-and-response-headers exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise WebAPIs-2: Examine request and response headers</p>
<p>Request <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/quickstart/#response-headers">headers</a> are similar to request parameters but usually define meta information regarding, e.g., content encoding (gzip, utf-8) or user identification (user-agent/user ID/etc., password/access token/etc.).</p>
<p>Let’s first make a request.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import modules</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># URL of the activity API end point</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://www.boredapi.com/api/activity/&quot;</span>

<span class="c1"># Make the request using the get() function</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can access the headers of the original request</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;Request headers&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can also access the headers of the response</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;Response headers&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>In many cases, the default headers</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="err">&#39;User</span><span class="mi">-</span><span class="err">Age</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;py</span><span class="kc">t</span><span class="err">ho</span><span class="kc">n</span><span class="mi">-</span><span class="err">reques</span><span class="kc">ts</span><span class="err">/</span><span class="mf">2.28.1</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w"> </span><span class="err">&#39;Accep</span><span class="kc">t</span><span class="mf">-E</span><span class="kc">n</span><span class="err">codi</span><span class="kc">n</span><span class="err">g&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;gzip</span><span class="p">,</span><span class="w"> </span><span class="err">de</span><span class="kc">flate</span><span class="p">,</span><span class="w"> </span><span class="err">br&#39;</span><span class="p">,</span>
<span class="w"> </span><span class="err">&#39;Accep</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;*/*&#39;,</span>
<span class="err"> &#39;Connection&#39;: &#39;keep-alive&#39;}</span>
</pre></div>
</div>
<p>added automatically by <em>Requests</em> are sufficient. However, similarly to parameters, we can pass <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/quickstart/#custom-headers">custom headers</a> to the <em>get</em> function as an argument.</p>
<p>This is useful when, for example, the API has restricted access and requires a user ID and/or password as a part of the headers.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="err">&#39;User</span><span class="mi">-</span><span class="err">Age</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;py</span><span class="kc">t</span><span class="err">ho</span><span class="kc">n</span><span class="mi">-</span><span class="err">reques</span><span class="kc">ts</span><span class="err">/</span><span class="mf">2.28.1</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w"> </span><span class="err">&#39;Accep</span><span class="kc">t</span><span class="mf">-E</span><span class="kc">n</span><span class="err">codi</span><span class="kc">n</span><span class="err">g&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;gzip</span><span class="p">,</span><span class="w"> </span><span class="err">de</span><span class="kc">flate</span><span class="p">,</span><span class="w"> </span><span class="err">br&#39;</span><span class="p">,</span>
<span class="w"> </span><span class="err">&#39;Accep</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;*/*&#39;,</span>
<span class="err"> &#39;Connection&#39;: &#39;keep-alive&#39;,</span>
<span class="err"> &#39;example-user-id&#39; : &#39;example-password&#39;}</span>
</pre></div>
</div>
<p>For examples of APIs using this type of authentication, see</p>
<ul class="simple">
<li><p><a class="reference external" href="https://api.imgur.com/oauth2">Imgur API</a></p></li>
</ul>
<p>For more on authentication, see also <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/authentication/"><em>Requests</em> documentation</a>.</p>
</section>
<section id="exercises-3">
<h3>Exercises 3<a class="headerlink" href="#exercises-3" title="Link to this heading"></a></h3>
<div class="admonition-exercise-webapis-3-scrape-links-from-a-webpage-advanced exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercise WebAPIs-3: Scrape links from a webpage (Advanced)</p>
<p>Let’s use <em>Requests</em> to get the HTML source code of www.example.com, examine it, and use the <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">Beautiful Soup</a> library to extract links from it.  <strong>Note:</strong> This requires the extra <code class="docutils literal notranslate"><span class="pre">bs4</span></code> Python package to be installed, which was not in our initial requirements.  Consider this a demo.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import module</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># Define webpage to scrape</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://www.example.com/&quot;</span>

<span class="c1"># Make a request for the URL</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Examine the response</span>
<span class="n">display</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Looks like HTML :) Let&#39;s access it using the text attribute</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import beautiful soup module</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># Create soup</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract page title from the HTML</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found title: </span><span class="si">{</span><span class="n">soup</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract links (hrefs) from the HTML</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found link: </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract all text from the HTML</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found text: </span><span class="si">{</span><span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
</section>
<section id="after-exercises-saving-retrieved-data-to-disk">
<h3>After exercises: Saving retrieved data to disk<a class="headerlink" href="#after-exercises-saving-retrieved-data-to-disk" title="Link to this heading"></a></h3>
<p>Usually, we want to save the retrieved data to disk for later use. For example, we might collect data for one year and later analyze it for a longitudinal study.</p>
<p>To save the retrieved JSON objects to disk, it is practical to use the JSONLINES file format. The JSONLINES format contains a single valid JSON object on each line. This is preferable to saving each object as its own file since we don’t, in general, want to end up with excessive amounts of individual files (say, hundreds of thousands or millions).</p>
<p>For example, let’s retrieve three cat facts and save them to a JSONLINES file using the <a class="reference external" href="https://jsonlines.readthedocs.io/en/latest/">jsonlines library</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jsonlines</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://catfact.ninja/fact&#39;</span>

<span class="c1"># Make three requests in loop and make a list of response JSON objects</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>

    <span class="c1"># Logging</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Make request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Make a request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Decode to JSON</span>
    <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                
    <span class="c1"># Open a jsonlines writer in &#39;append&#39; mode </span>
    <span class="k">with</span> <span class="n">jsonlines</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;catfacts.jsonl&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>

        <span class="c1"># Write</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>
        
    <span class="c1"># Sleep for one second between requests</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can then read the objects from the disk using the same library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open a jsonlines reader</span>
<span class="k">with</span> <span class="n">jsonlines</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;catfacts.jsonl&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    
    <span class="c1"># Read and display</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrap-up">
<h3>Wrap-up<a class="headerlink" href="#wrap-up" title="Link to this heading"></a></h3>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Requests is a common tool</p></li>
<li><p>Web APIs may often require some trial and error, but actually getting data is usually not that difficult</p></li>
<li><p>Storing all the data and processing it well can be a much larger issue.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-cython"></span><section id="extending-python-with-cython">
<span id="cython"></span><h2>Extending Python with Cython<a class="headerlink" href="#extending-python-with-cython" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How does runtime performance of Python compare to languages like C, C++
or Fortran?</p></li>
<li><p>How do we use code written in other languages from within Python? In what
situations is this useful?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand how compiled extension modules can speed up code execution.</p></li>
<li><p>Build your first compiled extension module with Cython.</p></li>
<li><p>Learn to optimize your Cython code with static type declarations.</p></li>
<li><p>Learn to use Numpy arrays in Cython code and implement common performance
enhancements for Cythonized arrays.</p></li>
</ul>
</div>
<div class="admonition-callout callout admonition" id="callout-0">
<p class="admonition-title">Callout</p>
<p>Using Cython requires that you have a working environment for compiling
C code. This goes beyond the software requirements for this course, so the
teaching will be given in form of demonstrations and no exercises.
You may still follow along with the code examples but you will need to have
Cython and a working C compiler available. You can install both to your
Conda environment with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">cython</span> <span class="pre">c-compiler</span></code>.</p>
</div>
<section id="python-and-performance">
<h3>Python and performance<a class="headerlink" href="#python-and-performance" title="Link to this heading"></a></h3>
<p>Interpreted languages like Python are rather slow to execute compared to
languages like C or Fortran that are compiled to machine code ahead of
execution. Python in particular is both strongly typed and dynamically typed:
this means that all variables have a type that matters for operations that
can be performed on the variable, and that the type is determined only during
runtime by the Python interpreter. The interpreter does a lot of
“unboxing” of variable types when performing operations, and this comes with
significant overhead. For example, when just adding two integers</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>the Python interpreter needs to:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Check the types of both operands</p></li>
<li><p>Check whether they both support the <code class="docutils literal notranslate"><span class="pre">+</span></code> operation</p></li>
<li><p>Extract the function that performs the <code class="docutils literal notranslate"><span class="pre">+</span></code> operation (due to operator
overloading objects can have a custom definition for addition)</p></li>
<li><p>Extract the actual values of the objects</p></li>
<li><p>Perform the <code class="docutils literal notranslate"><span class="pre">+</span></code> operation</p></li>
<li><p>Construct a new integer object for the result (“boxing”)</p></li>
</ol>
<a class="center reference internal image-reference" href="_images/unboxing-boxing.png"><img alt="_images/unboxing-boxing.png" class="center" src="_images/unboxing-boxing.png" style="width: 90.0%;" />
</a>
</div></blockquote>
<p>Meanwhile in languages like C, the types are known at compilation time, which
allows the compiler to optimize many of the above steps away for better
performance at runtime.</p>
<p>Scientific programs often include computationally expensive sections (e.g.
simulations of any kind). So how do we make Python execute our code faster in
these situations? Well that’s the neat part: we don’t! Instead, we write the
performance critical parts in a faster language and make them usable
from Python.</p>
<p>This is called extending Python, and usually boils down to writing C-code
with Python-specific boilerplate, or using a specialized tool for generating
such C code from Python code (so-called <em>transpilers</em>). The C-code is compiled
into a shared library, in this context called a <strong>Python extension module</strong>.
Most scientific Python libraries (Numpy, Scipy etc) do exactly this: their
computationally intensive parts are either written in a compiled language,
or they call an external library written in such language.</p>
<p>When working on your own Python project, you may find that there is a C
library that does exactly what you need, but it doesn’t provide a Python
interface. Or you may have computationally intensive code that doesn’t
vectorize nicely for Numpy. In cases like these it can be useful to write
your own extension modules that you then import into your Python code.</p>
<p>Here we discuss one popular approach for extending Python with compiled code:
using a tool called Cython.</p>
</section>
<section id="id1">
<h3>Cython<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://cython.org/">Cython</a> is a framework for writing Python-like code
that can be processed with the Cython compiler to produce optimized code.
Cython is designed to provide C-like performance for code that is mostly
written in Python by adding only a few C-like declarations to existing
Python code. As such, Cython aims to provide the best of the both worlds:
the good programmer productivity of Python together with the high performance
of C. Cython also makes it easy to interact with external C/C++ code.</p>
<p>The Cython compiler processes code written in Python, or more
commonly the Cython extension of Python language, and turns it into valid
C-code which is then compiled into a Python extension module using a
C compiler (GCC, Clang, MSVC, …). The Cython programming language is a
superset of Python that adds C-like static type declarations and other
features that make it possible to generate efficient machine code.</p>
<div class="admonition-callout callout admonition" id="callout-1">
<p class="admonition-title">Callout</p>
<p>Unlike plain Python code, Cython code must be compiled ahead of time before
it can be executed. This is usually done during the build phase of a
project. Note that Cython is <em>not</em> a just-in-time (JIT) compiler like e.g.
Numba, although you <em>can</em> call the Cython compiler at runtime for JIT-like
behavior if you really want to.</p>
</div>
</section>
<section id="your-first-cython-module">
<h3>Your first Cython module<a class="headerlink" href="#your-first-cython-module" title="Link to this heading"></a></h3>
<p>Suppose we have a Python module called <code class="docutils literal notranslate"><span class="pre">my_module.py</span></code> that contains:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Cython allows one to compile <code class="docutils literal notranslate"><span class="pre">my_module.py</span></code> directly to machine code while
still allowing its contents to be imported and used from Python code. We can
Cythonize the module “manually” from command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cythonize<span class="w"> </span>-i<span class="w"> </span>my_module.py
</pre></div>
</div>
<p>This produces a file called <code class="docutils literal notranslate"><span class="pre">my_module.c</span></code>, full of C code. One can
investigate the generated <code class="docutils literal notranslate"><span class="pre">.c</span></code> file but it is not really meant for humans to
read, because of all the boilerplate that Cython adds in order to make the
compiled code available to Python. Already this simple function results in
over 7000 lines of C code!</p>
<p>The option <code class="docutils literal notranslate"><span class="pre">-i</span></code> (meaning inplace) tells Cython to also compile the generated
<code class="docutils literal notranslate"><span class="pre">.c</span></code> file into an extension module in the same directory.
This could also be done manually by invoking a C-compiler of your choice.
On Linux/Mac systems the compiled module will be called something
like <code class="docutils literal notranslate"><span class="pre">my_module.cpython-314-x86_64-linux-gnu.so</span></code>, on Windows the suffix will
be <code class="docutils literal notranslate"><span class="pre">.pyd</span></code>.</p>
<p>The extension module can be imported from Python in the same way as one would
import a pure Python module, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">my_module</span><span class="w"> </span><span class="kn">import</span> <span class="n">add</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Usually when working with Cython, one does not Cythonize the whole program but
only selected modules. A typical Cython project is separated into plain Python
modules (file suffix <code class="docutils literal notranslate"><span class="pre">.py</span></code>), and Cython code files (suffix <code class="docutils literal notranslate"><span class="pre">.pyx</span></code>).
The <code class="docutils literal notranslate"><span class="pre">.pyx</span></code> files will usually contain Cython-specific code like static type
information, so that they are not valid Python code anymore and must be
Cythonized before use.</p>
<div class="admonition-callout callout admonition" id="callout-2">
<p class="admonition-title">Callout</p>
<p>Real-world project don’t usually invoke Cython from the command line and
instead use an established build tool like <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> to handle the
Cythonization during the project’s build phase. More info is available on
the <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#compilation">Cython documentation</a>.
See also the <a class="reference internal" href="#document-packaging"><span class="doc">course page on packaging</span></a>.</p>
</div>
</section>
<section id="using-cython-with-jupyter">
<h3>Using Cython with Jupyter<a class="headerlink" href="#using-cython-with-jupyter" title="Link to this heading"></a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Due to a <a class="reference external" href="https://github.com/cython/cython/issues/7319">known issue</a> with <code class="docutils literal notranslate"><span class="pre">%%cython</span> <span class="pre">-a</span></code> in <code class="docutils literal notranslate"><span class="pre">jupyter-lab</span></code> we have to use the <code class="docutils literal notranslate"><span class="pre">jupyter-nbclassic</span></code> interface
for this episode.</p>
</div>
<p>Jupyter supports Cython compilation directly inside notebooks via <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/quickstart/build.html#using-the-jupyter-notebook">an extension</a>,
assuming your environment has Cython installed.</p>
<p>We first load the Cython extension, e.g. in the very first cell:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">Cython</span>
</pre></div>
</div>
<p>We can Cythonize cell contents using the magic <code class="docutils literal notranslate"><span class="pre">%%cython</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">cython</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The compiled function can then be called from other cells.</p>
<div class="admonition-demo demo admonition" id="demo-0">
<p class="admonition-title">Demo</p>
<p>There is also <code class="docutils literal notranslate"><span class="pre">%%cython</span> <span class="pre">--annotate</span></code>, or <code class="docutils literal notranslate"><span class="pre">%%cython</span> <span class="pre">-a</span></code> for short, which is
useful for analyzing the generated C code. Try executing the code for
<cite>add()</cite> with this magic command in Jupyter. Upon doing so:</p>
<ol class="arabic simple">
<li><p>Estimate the amount of interactions with the Python runtime, by the intensity of the yellow background colour.</p></li>
<li><p>You will be able to inspect the underlying C code.</p></li>
</ol>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<img alt="_images/jupyter-cython-annotate.png" src="_images/jupyter-cython-annotate.png" />
</div>
</div>
</section>
<section id="adding-static-type-information">
<h3>Adding static type information<a class="headerlink" href="#adding-static-type-information" title="Link to this heading"></a></h3>
<p>So far our Cythonized extension module is rather minimal. We have reduced some
of the interpreting overhead by compiling the code, but it’s still using Python’s
fully dynamic type system with the same boxing and unboxing overhead as in
standard Python. This is because there are no type declarations in the code
that Cython could use to optimize.</p>
<p>When Cythonizing a Python code, static type information can be added
either:</p>
<ul class="simple">
<li><p>In function signatures by prefixing the formal arguments by their
type.</p></li>
<li><p>By declaring variables with the <code class="docutils literal notranslate"><span class="pre">cdef</span></code> Cython keyword, followed by
the the type.</p></li>
</ul>
<p>To make Cython function that adds two integers and returns the result as
an integer, we would write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">cdef</span> <span class="nb">int</span> <span class="n">result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The function works now only with integers but with less boxing/unboxing
overhead. Store this as <code class="docutils literal notranslate"><span class="pre">my_module.pyx</span></code> (note the file extension) and
Cythonize as before:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cythonize<span class="w"> </span>-i<span class="w"> </span>my_module.pyx
</pre></div>
</div>
<p>Import this into Python and confirm that it works as expected with integers.
However, if passing floating-point numbers the function is forced to interpret
the inputs as integers before performing the addition. For example,
<code class="docutils literal notranslate"><span class="pre">add(1.4,</span> <span class="pre">2.7)</span></code> would return <code class="docutils literal notranslate"><span class="pre">3</span></code>. This happens because there is an automatic
conversion from the input Python objects to the
declared C-types, in this case integers, when calling the Cythonized function
from Python. Similarly the returned C variable is converted to a corresponding
Python object.</p>
<p>To make the function work with floats we’d instead declare the types to be
either <code class="docutils literal notranslate"><span class="pre">float</span></code> (32-bit) or <code class="docutils literal notranslate"><span class="pre">double</span></code> (64-bit) type instead of <code class="docutils literal notranslate"><span class="pre">int</span></code>.
The table below lists the most common C types and their corresponding
Python types. More information can be found in the <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html">Cython
documentation</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>From Python types</p></th>
<th class="head"><p>To C types</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int</p></td>
<td><p>int, long</p></td>
</tr>
<tr class="row-odd"><td><p>int, float</p></td>
<td><p>float, double</p></td>
</tr>
<tr class="row-even"><td><p>str/bytes</p></td>
<td><p>char *</p></td>
</tr>
</tbody>
</table>
</section>
<section id="using-numpy-arrays-with-cython">
<h3>Using Numpy arrays with Cython<a class="headerlink" href="#using-numpy-arrays-with-cython" title="Link to this heading"></a></h3>
<p>Cython has built-in support for Numpy arrays.</p>
<p>As discussed in the <a class="reference internal" href="#document-numpy-advanced"><span class="doc">Numpy lectures</span></a>, Numpy arrays provide
great performance for vectorized operations. In contrast, thing like
<code class="docutils literal notranslate"><span class="pre">for</span></code>-loops over Numpy arrays should be avoided because of interpreting
overhead inherent to Python <code class="docutils literal notranslate"><span class="pre">for</span></code>-loops. There is also overhead from
accessing individual elements of Numpy arrays.</p>
<p>With Cython we can bypass both restrictions and write efficient loops over
Numpy arrays. Consider e.g. a double loop that sets values of a 2D array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">slow_looper</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

   <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>We can Cythonize this as before to optimize the <code class="docutils literal notranslate"><span class="pre">for</span></code>-loops. A quick check
with <code class="docutils literal notranslate"><span class="pre">timeit</span></code> shows that with <code class="docutils literal notranslate"><span class="pre">N=100</span></code>, the pure Python version takes 820μs
and the Cythonized version (without any static typing) takes 700μs. This is
nice, but we are still bottlenecked by array lookups and assignments, i.e. the
<code class="docutils literal notranslate"><span class="pre">[]</span></code> operator, which invokes Python code.</p>
<p>We can get a huge speedup by adding a static type declaration for the Numpy
array, and for the other variables too while we are at it. To do this we must
import compile-time information about the Numpy module using the
Cython-specific <code class="docutils literal notranslate"><span class="pre">cimport</span></code> keyword, then use Cython’s Numpy interface to
declare the array’s datatype and dimensions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>   <span class="c1"># Normal Numpy import</span>
<span class="n">cimport</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">cnp</span> <span class="c1"># Import for Numpy C-API</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fast_looper</span><span class="p">(</span><span class="nb">int</span> <span class="n">N</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

   <span class="c1"># Type declaration: 2D array of 32-bit integers</span>
   <span class="n">cdef</span> <span class="n">cnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">cnp</span><span class="o">.</span><span class="n">int32_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">]</span> <span class="n">data</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

   <span class="n">cdef</span> <span class="nb">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="c1"># double loop is done at nearly C speed</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Cythonizing and running the function with <code class="docutils literal notranslate"><span class="pre">timeit</span></code> shows that the function
now only takes 3.30μs with <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">=</span> <span class="pre">100</span></code>. This is ~250 times faster than the
pure Python implementation!</p>
<div class="admonition-callout callout admonition" id="callout-3">
<p class="admonition-title">Callout</p>
<p><code class="docutils literal notranslate"><span class="pre">cimport</span> <span class="pre">numpy</span></code> needs access to Numpy C-headers which are usually included
in Python distributions. This usually works out of the box for Jupyter
notebooks. However, if using the command line <code class="docutils literal notranslate"><span class="pre">cythonize</span></code> tool you may need
to manually set include paths for the C compiler.
Refer to <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/numpy_tutorial.html#compilation">the docs</a>
for more details.</p>
</div>
<div class="admonition-callout callout admonition" id="callout-4">
<p class="admonition-title">Callout</p>
<p>It is good practice to also call <code class="docutils literal notranslate"><span class="pre">cnp.import_array()</span></code> after doing the
<code class="docutils literal notranslate"><span class="pre">cimport</span></code> of Numpy. This is required for accessing attributes (like
<code class="docutils literal notranslate"><span class="pre">.shape</span></code>) of typed Numpy arrays.</p>
</div>
</section>
<section id="more-numpy-indexing-enhancements">
<h3>More Numpy indexing enhancements<a class="headerlink" href="#more-numpy-indexing-enhancements" title="Link to this heading"></a></h3>
<p>When indexing arrays, Numpy does some bounds checking in an attempt to catch
logic errors (e.g. attempting to access element at index 100 of an array of
length 10). Numpy also checks for negative indices to support wraparound
syntax like <code class="docutils literal notranslate"><span class="pre">a[-1]</span></code>. We can tell Cython to disable these checks for some
extra performance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">cimport</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">cnp</span>
<span class="n">cimport</span> <span class="n">cython</span>

<span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fast_looper</span><span class="p">(</span><span class="nb">int</span> <span class="n">N</span><span class="p">):</span>
   <span class="c1"># ... Same function body as above ...</span>
</pre></div>
</div>
<p>Whether these decorators <em>actually</em> result in faster code or not depends on
how complicated your array usage is. In this simple example there is likely
no measurable improvement: even if the checks are kept, modern compilers and
processors are rather good at predicting unlikely branches and optimize the
execution accordingly (“branch prediction”).</p>
<p>Disabling bounds checking of course means that out-of-bounds indexing will go
undetected and lead to undefined behavior. It may crash your program or cause
memory corruption, so be very careful if using these decorators!</p>
</section>
<section id="when-to-cythonize">
<h3>When to Cythonize?<a class="headerlink" href="#when-to-cythonize" title="Link to this heading"></a></h3>
<p>Static typing in Cython is a tradeoff between performance and the dynamical
nature of Python code. You most certainly do not want to Cythonize your whole
project: at that point you may just as well pick a different programming
language!</p>
<p>Here are some rules of thumb to keep in mind when optimizing your code with
Cython (see also <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/quickstart/cythonize.html#determining-where-to-add-types">Cython docs</a>):</p>
<ul class="simple">
<li><p>Only Cythonize the modules/functions for which performance is <em>really</em>
needed. Profiling tools help at identifying such bottlenecks.</p></li>
<li><p>Static type declarations work the best for fundamental data types (integers,
floats, strings) and for contiguous arrays. Operations on heterogeneous lists
and dictionaries do not usually benefit much from Cython.</p></li>
</ul>
</section>
<section id="alternatives-to-cython">
<h3>Alternatives to Cython<a class="headerlink" href="#alternatives-to-cython" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://numba.pydata.org/">Numba</a> is a tool that compiles Python code to
optimized machine code on the fly without needing a manual compilation step.
It works with Numpy but does not support all of Python’s features.</p>
<p>For creating compiled extension modules there are a plethora of tools and
libraries. If you already have a working C/C++ codebase and would like
to use it from Python, consider using one of the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/ctypes.html">ctypes</a>: part of Python standard library.</p></li>
<li><p><a class="reference external" href="https://cffi.readthedocs.io/en/stable/index.html">CFFI</a>: somewhat similar to <cite>ctypes</cite> but with more features and probably better for large projects.</p></li>
<li><p><a class="reference external" href="https://pybind11.readthedocs.io/en/stable/index.html">pybind11</a>: very robust and modern way of creating extension modules. C++ only.</p></li>
<li><p><a class="reference external" href="https://pyo3.rs/v0.27.1/">PyO3</a> for Rust code.</p></li>
</ul>
</section>
<section id="further-reading">
<h3>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Cython <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html">memory views</a>
are a newer and more general way of interfacing with Numpy arrays and other buffer-like objects.</p></li>
<li><p><a class="reference external" href="https://cython.readthedocs.io/en/latest/src/tutorial/external.html">Calling C functions from Cython</a></p></li>
</ul>
</section>
<section id="acknowledgements">
<h3>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading"></a></h3>
<p>This material has been adapted from the “Python for HPC” course by CSC - IT Center for Science.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-installation"></span><section id="software-installation">
<h2>Software installation<a class="headerlink" href="#software-installation" title="Link to this heading"></a></h2>
<p>This course is interactive and demonstrates many different tools.
Thus, even beyond Python, extra software (Python libraries) needs to
be installed.  This page contains the instructions.</p>
<p><strong>Once the course starts, we don’t have time to stop for installing
software.</strong></p>
<p>Please make sure before the course that you have all the required
software installed or some other way access to it.  For example, the
workshop could be done with a remote Jupyter server, as long as you
can use the terminal from the Jupyter (you need to be able to access
the command line for some lessons).</p>
<div class="important admonition">
<p class="admonition-title">Do you need help?</p>
<p>Participants from a partner institution are invited to install help
sessions. (Hint: ask your institution to become a partner if it
isn’t already!)</p>
<p>Otherwise, if you need installation help, show this page to someone
around you and they can probably help.  These are relatively
standard tools.</p>
<p>Don’t be afraid to ask for help.  Installing scientific software is
<em>harder than it should be</em> and it helps to have someone guide you
through it.</p>
</div>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h3>
<p>We expect you to have a working Python installation with some common
libraries.  <strong>We currently recommend Miniforge, which includes the base and
packages through a different, freely usable channel.</strong>  You can
explore the options in the tabs below.</p>
<div class="dropdown admonition">
<p class="admonition-title">Python, conda, anaconda, miniforge, etc?</p>
<p>Unfortunately there’s a lot of jargon.  We’ll go over this in the
course but here is a crash course:</p>
<ul class="simple">
<li><p><strong>Python</strong> is a programming language very commonly used in
science, it’s the topic of this course.</p></li>
<li><p><strong>Conda</strong> is a package manager: it allows distributing and
installing packages, and is designed for complex scientific
code.</p></li>
<li><p><strong>Mamba</strong> is a re-implementation of Conda to be much faster with
resolving dependencies and installing things.</p></li>
<li><p>An <strong>Environment</strong> is a self-contained collections of packages
which can be installed separately from others.  They are used so
each project can install what it needs without affecting others.</p></li>
<li><p><strong>Anaconda</strong> is a commercial distribution of Python+Conda+many
packages that all work together.  It used to be freely usable for
research, but since ~2023-2024 it’s more limited.  Thus, we don’t
recommend it (even though it has a nice graphical user interface).</p></li>
<li><p><strong>conda-forge</strong> is another channel of distributing packages that
is maintained by the community, and thus can be used by anyone.
(Anaconda’s parent company also hosts conda-forge packages)</p></li>
<li><p><strong>miniforge</strong> is a distribution of conda pre-configured for
conda-forge.  It operates via the command line.</p></li>
<li><p><strong>miniconda</strong> is a distribution of conda pre-configured to use
the Anaconda channels.</p></li>
</ul>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-0-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button><button aria-controls="panel-0-T3RoZXIgb3B0aW9ucw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tab" tabindex="-1">Other options</button></div><div aria-labelledby="tab-0-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-0-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><p>This is our recommended method - it can be used for any purpose
and makes a strong base for the future.</p>
<p>Follow the <a class="reference external" href="https://github.com/conda-forge/miniforge">instructions on the miniforge web page</a>.  This installs
the base, and from here other packages can be installed.</p>
<p>Miniforge uses the command line - this gives you the most power
but can feel unfamiliar.  See the <a class="reference external" href="https://scicomp.aalto.fi/scicomp/shell/">command line crash course</a> for an intro.</p>
</div><div aria-labelledby="tab-0-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p>Anaconda is easier to get started with, but may be more limiting
in the future.  The Anaconda Navigator provides a graphical
interface to most of what you would need.</p>
<p>The <a class="reference external" href="https://docs.continuum.io/anaconda/install/">Anaconda Python distribution</a> conveniently packages
everything, but its license has does not allow large organizations to
use it for free (and has actually been enforced against
universities).</p>
<p>Note the license of Anaconda - there were recently issues with
it being used by large universities for free, and this is not
yet fully resolved.</p>
</div><div aria-labelledby="tab-0-T3RoZXIgb3B0aW9ucw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tabpanel" tabindex="0"><p>There are many ways to install Python.  Other methods can work,
as long as you can install the libraries from the
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file mentioned in the Miniforge
instructions.</p>
<p>We don’t currently provide a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> for installing
the required packages without Conda/Mamba, though.</p>
</div></div>
</section>
<section id="starting-python">
<h3>Starting Python<a class="headerlink" href="#starting-python" title="Link to this heading"></a></h3>
<p>You need to Python in a way that activates conda/mamba.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-1-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button><button aria-controls="panel-1-T3RoZXIgb3B0aW9ucw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tab" tabindex="-1">Other options</button></div><div aria-labelledby="tab-1-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-1-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-TGludXggLyBNYWNPUw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tab" tabindex="0">Linux / MacOS</button><button aria-controls="panel-2-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-2-TGludXggLyBNYWNPUw==" class="sphinx-tabs-panel group-tab" id="panel-2-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tabpanel" tabindex="0"><p>Linux/MacOS: Each time you start a new command line terminal,
you can activate Miniforge by running.  This is needed so that
Miniforge is usable wherever you need, but doesn’t affect any
other software on your computer (this is not needed if you
choose “Do you wish to update your shell profile to
automatically initialize conda?”, but then it will always be
active):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>~/miniforge3/bin/activate
</pre></div>
</div>
</div><div aria-labelledby="tab-2-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>Windows: Use the “Miniforge Prompt” to start Miniforge.  This
will set up everything so that <code class="docutils literal notranslate"><span class="pre">conda</span></code> and <code class="docutils literal notranslate"><span class="pre">mamba</span></code> are
available.</p>
</div></div>
</div><div aria-labelledby="tab-1-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p>The <a class="reference external" href="https://docs.anaconda.com/navigator/">Anaconda Navigator</a> provides a convenient
way to access the software. It can be installed from that page.</p>
</div><div aria-labelledby="tab-1-T3RoZXIgb3B0aW9ucw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tabpanel" tabindex="0"><p>You are on your own here.</p>
</div></div>
</section>
<section id="python-for-scicomp-software-environment">
<h3>Python for SciComp software environment<a class="headerlink" href="#python-for-scicomp-software-environment" title="Link to this heading"></a></h3>
<p>Once Python and conda/mamba are installed, you can use it to install
an environment.  An <strong>environment</strong> is a self-contained set of extra
libraries - different projects can use different environments to not
interfere with each other.  This environment will have all of the
software needed for this particular course.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-3-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button><button aria-controls="panel-3-T3RoZXIgb3B0aW9ucw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tab" tabindex="-1">Other options</button></div><div aria-labelledby="tab-3-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-3-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><p>This <a class="reference external" href="https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/software/environment.yml">environment file</a>
contains all packages needed for the course, and can be
installed with.  The following command will install an
environment named <code class="docutils literal notranslate"><span class="pre">python-for-scicomp</span></code> (there may be lots of
warning messages: this is OK if it still goes through):</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-TGludXggLyBNYWNPUw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tab" tabindex="0">Linux / MacOS</button><button aria-controls="panel-4-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-4-TGludXggLyBNYWNPUw==" class="sphinx-tabs-panel group-tab" id="panel-4-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mamba<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>python-for-scicomp<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/software/environment.yml
</pre></div>
</div>
</div><div aria-labelledby="tab-4-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mamba<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>python-for-scicomp<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/software/environment.yml
</pre></div>
</div>
</div></div>
<p>Each time you start a new command line, you need to activate
miniforge and this environment:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-TGludXggLyBNYWNPUw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tab" tabindex="0">Linux / MacOS</button><button aria-controls="panel-5-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-5-TGludXggLyBNYWNPUw==" class="sphinx-tabs-panel group-tab" id="panel-5-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>~/miniforge3/bin/activate
<span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
</pre></div>
</div>
</div><div aria-labelledby="tab-5-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Start the Miniforge Prompt.</span>
<span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
</pre></div>
</div>
</div></div>
</div><div aria-labelledby="tab-3-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p>Anaconda includes most of the things needed for the course
automatically, but as of 2024 not everything.  You can use the
navigator to create new environments from this <a class="reference external" href="https://raw.githubusercontent.com/AaltoSciComp/python-for-scicomp/master/software/environment.yml">this environment
file</a>.
You’ll have to download it and then <a class="reference external" href="https://docs.anaconda.com/navigator/tutorials/manage-environments/#importing-an-environment">import it</a>.</p>
<p>When running this course’s exercise, make sure the
<code class="docutils literal notranslate"><span class="pre">python-for-scicomp</span></code> environment is activated before starting
JupyterLab or any code.  You need to start termnials or
JupyterLab from the Anaconda Navigator for the
<code class="docutils literal notranslate"><span class="pre">python-for-scicomp</span></code> environment to be used.</p>
</div><div aria-labelledby="tab-3-T3RoZXIgb3B0aW9ucw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-T3RoZXIgb3B0aW9ucw==" name="T3RoZXIgb3B0aW9ucw==" role="tabpanel" tabindex="0"><p><strong>Minoconda, Anaconda command line, other conda/mamba command
line tools</strong>: see “Miniforge” instructions.</p>
<p>Virtual environments: we don’t currently provide a
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> but many package names can probably be
copied from the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file.  We really recommend
conda/mamba based systems: it’s designed for complex scientific
software.</p>
<p>Any other Python distribution which you can install libraries into
would work, but because there are so many different ways to do this,
we don’t support them.  You would need the extra libraries mentioned
in the Miniforge instructions.</p>
<p>Remember you need to activate the environment each time you use it.</p>
</div></div>
</section>
<section id="jupyterlab">
<h3>JupyterLab<a class="headerlink" href="#jupyterlab" title="Link to this heading"></a></h3>
<p>We do most of the lessons from JupyterLab (and JupyterLab provides
most of the other tools we need).</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-6-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button></div><div aria-labelledby="tab-6-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-6-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><p>JupyterLab was instaled in the previous step.  To run it, first,
start the Miniforge command line interface.  Remember, you may
need to activate Miniforge and the environment first.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-TGludXggLyBNYWNPUw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tab" tabindex="0">Linux / MacOS</button><button aria-controls="panel-7-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-7-TGludXggLyBNYWNPUw==" class="sphinx-tabs-panel group-tab" id="panel-7-TGludXggLyBNYWNPUw==" name="TGludXggLyBNYWNPUw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>~/miniforge3/bin/activate
<span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
<span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
</div><div aria-labelledby="tab-7-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Start the Miniforge Prompt.</span>
<span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>python-for-scicomp
<span class="gp">$ </span>jupyter-lab
</pre></div>
</div>
</div></div>
</div><div aria-labelledby="tab-6-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p>If you install the full Anaconda distribution, this will be
available and can be started either through Anaconda Navigator
or command line.</p>
<p>Make sure the <code class="docutils literal notranslate"><span class="pre">python-for-scicomp</span></code> environment is selected and
you can start JupyterLab.</p>
</div></div>
</section>
<section id="verification-of-python-and-jupyterlab">
<h3>Verification of Python and JupyterLab<a class="headerlink" href="#verification-of-python-and-jupyterlab" title="Link to this heading"></a></h3>
<div class="admonition-watch-the-video admonition">
<p class="admonition-title">Watch the video</p>
<p>See this <a class="reference external" href="https://youtu.be/OEX1ss_HCHc">verification in video form</a> - if you can do this, you are
ready to go for day one.  Your exact steps may be a bit different.</p>
<p>Remember that you need to activate the environment first - see the
step above.</p>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-TWluaWZvcmdl" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tab" tabindex="0">Miniforge</button><button aria-controls="panel-8-QW5hY29uZGE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tab" tabindex="-1">Anaconda</button></div><div aria-labelledby="tab-8-TWluaWZvcmdl" class="sphinx-tabs-panel group-tab" id="panel-8-TWluaWZvcmdl" name="TWluaWZvcmdl" role="tabpanel" tabindex="0"><p>You can start JupyterLab from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter-lab
<span class="gp gp-VirtualEnv">(... Jupyter starts in a web browser)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-QW5hY29uZGE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-QW5hY29uZGE=" name="QW5hY29uZGE=" role="tabpanel" tabindex="0"><p><strong>You should be able to start JupyterLab.</strong>  You can do this from the
<a class="reference external" href="https://docs.anaconda.com/anaconda/navigator/">Anaconda Navigator</a> (recommended if you have it):</p>
<figure class="align-default" id="id1">
<img alt="_images/anaconda-navigator-jupyterlab.png" class="with-border" src="_images/anaconda-navigator-jupyterlab.png" />
<figcaption>
<p><span class="caption-text">Starting JupyterLab from the Anaconda Navigator.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>… or you can start JupyterLab from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jupyter-lab
<span class="gp gp-VirtualEnv">(... Jupyter starts in a web browser)</span>
</pre></div>
</div>
</div></div>
<p><strong>Verify that you can start a Jupyter notebook.</strong> We will learn how to
do this in day 1, but you can try running <code class="docutils literal notranslate"><span class="pre">print(&quot;Hello,</span> <span class="pre">world!&quot;)</span></code>
if you want.</p>
<figure class="align-default" id="id2">
<img alt="_images/jupyterlab-notebook.png" class="with-border" src="_images/jupyterlab-notebook.png" />
<figcaption>
<p><span class="caption-text">Starting a Jupyter Notebook from JupyterLab.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="text-editor">
<h3>Text editor<a class="headerlink" href="#text-editor" title="Link to this heading"></a></h3>
<p>For one portion of the course, you will need a text editor.  <strong>If you
don’t know what to use, you can use the text editor that comes from
JupyterLab and it will do everything you need - no extra installation
needed.</strong></p>
<div class="toggle admonition">
<p class="admonition-title">Other editors</p>
<p>Because we need to be simple in our teaching, we only teach the
most basic editors.  We encourage you to try out more advanced ones
yourself.</p>
<p>For other editors, see the <a class="reference external" href="https://coderefinery.github.io/installation/editors/">CodeRefinery instructions</a>.  You don’t
exactly need a terminal editor - the graphical ones, such as VSCode or
whatever you use now, will work as well.</p>
</div>
</section>
<section id="command-line">
<h3>Command line<a class="headerlink" href="#command-line" title="Link to this heading"></a></h3>
<p><strong>You need access to the command line for some lessons.  JupyterLab
includes it, so no extra installation is needed.</strong>  If you want to
test in advance:</p>
<ul>
<li><p>You can start it from JupyterLab (recommended):</p>
<figure class="align-default" id="id3">
<a class="with-border reference internal image-reference" href="_images/jupyterlab-terminal.png"><img alt="_images/jupyterlab-terminal.png" class="with-border" src="_images/jupyterlab-terminal.png" style="width: 421.5px; height: 181.5px;" />
</a>
<figcaption>
<p><span class="caption-text">From the JupyterLab launcher, select “Terminal”.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</li>
</ul>
<div class="toggle admonition">
<p class="admonition-title">Other ways to access the command line</p>
<ul>
<li><p>From the Anaconda Navigator:</p>
<figure class="align-default" id="id4">
<img alt="_images/anaconda-prompt.png" class="with-border" src="_images/anaconda-prompt.png" />
<figcaption>
<p><span class="caption-text">From the Anaconda Navigator, you can select “environments” on the
left, then click on one, then the arrow, then “Open terminal”.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>From your operating system’s terminal applications, if you activate
Anaconda.</p></li>
</ul>
</div>
<section id="verification-of-the-command-line">
<h4>Verification of the command line<a class="headerlink" href="#verification-of-the-command-line" title="Link to this heading"></a></h4>
<p>To verify command line usage, type the following commands (without the
<code class="docutils literal notranslate"><span class="pre">$</span></code>), and you should see the corresponding output that lists the
Python version:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>-V
<span class="go">Python 3.8.3</span>

<span class="gp">#</span><span class="c1"># Or python... if it&#39;s installed as that</span>
<span class="gp">$ </span>python<span class="w"> </span>-V
<span class="go">Python 3.8.3</span>
</pre></div>
</div>
<p>Any recent version of Python 3 should work for the course (for example
3.8 or higher).</p>
</section>
</section>
<section id="zoom">
<h3>Zoom<a class="headerlink" href="#zoom" title="Link to this heading"></a></h3>
<p>If this is an online workshop, it might use Zoom.  You can see
<a class="reference external" href="https://coderefinery.github.io/installation/zoom/">CodeRefinery instructions for it</a>.</p>
</section>
<section id="need-help">
<h3>Need help?<a class="headerlink" href="#need-help" title="Link to this heading"></a></h3>
<p>If you have access, come to one of the installation help sessions.
Or, ask your colleagues: these are standard tools and you can
definitely find someone can help you get set up!</p>
</section>
<section id="see-also">
<h3>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=ddCde5Nu2qo&amp;list=PLpLblYHCzJAB6blBBa0O2BEYadVZV3JYf">Research Software Hour on conda</a></p></li>
<li><p><a class="reference external" href="https://docs.conda.io/en/latest/">Conda manual</a> (technical)</p></li>
<li><p><a class="reference external" href="https://www.anaconda.com/products/distribution">Anaconda individual edition home</a></p></li>
<li><p><a class="reference external" href="https://docs.anaconda.com/anaconda/user-guide/getting-started/">Anaconda getting started</a></p></li>
</ul>
</section>
</section>
<span id="document-quick-reference"></span><section id="quick-reference">
<h2>Quick reference<a class="headerlink" href="#quick-reference" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">Pandas cheatsheet</a> (pandas.pydata.org)</p></li>
<li><p><a class="reference external" href="http://datacamp-community-prod.s3.amazonaws.com/f04456d7-8e61-482f-9cc9-da6f7f25fc9b">Pandas cheatsheet</a>
(via <a class="reference external" href="https://www.datacamp.com/community/data-science-cheatsheets">Datacamp</a>)</p></li>
<li><p><a class="reference external" href="http://datacamp-community-prod.s3.amazonaws.com/da466534-51fe-4c6d-b0cb-154f4782eb54">Numpy cheatsheet</a>
(via <a class="reference external" href="https://www.datacamp.com/community/data-science-cheatsheets">Datacamp</a>)</p></li>
<li><p><a class="reference external" href="https://comp.anu.edu.au/courses/comp2420/labs/lab-1/helpManuals/JupyterLab-Cheatsheet.pdf">JupyterLab cheatsheet</a></p></li>
<li><p><a class="reference external" href="https://datacamp-community-prod.s3.amazonaws.com/e1a8f39d-71ad-4d13-9a6b-618fe1b8c9e9">Matplotlib cheatsheet</a>
(via <a class="reference external" href="https://www.datacamp.com/cheat-sheet">Datacamp</a>)</p></li>
<li><p><a class="reference external" href="https://web.itu.edu.tr/iguzel/files/Python_Cheat_Sheets.pdf">Numpy, Pandas, Matplotlib, Scikit-learn all together</a></p></li>
</ul>
</section>
<span id="document-exercises"></span><section id="list-of-exercises">
<h2>List of exercises<a class="headerlink" href="#list-of-exercises" title="Link to this heading"></a></h2>
<section id="full-list">
<h3>Full list<a class="headerlink" href="#full-list" title="Link to this heading"></a></h3>
<p>This is a list of all exercises and solutions in this lesson, mainly
as a reference for helpers and instructors.  This list is
automatically generated from all of the other pages in the lesson.
Any single teaching event will probably cover only a subset of these,
depending on their interests.</p>
</section>
</section>
<span id="document-guide"></span><section id="instructor-s-guide">
<h2>Instructor’s guide<a class="headerlink" href="#instructor-s-guide" title="Link to this heading"></a></h2>
<section id="learner-personas">
<h3>Learner personas<a class="headerlink" href="#learner-personas" title="Link to this heading"></a></h3>
<p>A is a early career PhD researcher who has been using Python a bit,
but is not sure what they know or don’t know.  They want to be able to
do their research more efficiently and make sure that they are using
the right tools.  A may know that numpy exists, etc. and could
theoretically read some about it themselves, but aren’t sure if they
are going in the right direction.</p>
<p>A2 can use numpy and pandas, but have learned little bits here and
there and hasn’t had a comprehensive introduction.  They want to
ensure they are using best practices.  (Baseline of high-level
packages)</p>
<p>B is a mid-to-late undergraduate student who has used Python in some
classes.  They have possibly learned the syntax and enough to use it
in courses, but in a course-like manner where they are expected to
create everything themselves.</p>
<p>Prerequisites:
- Knowing basic Python syntax
- Watch the command line crash course, if you aren’t familiar.</p>
<p>Not prerequisites:
- Any external libraries, e.g. numpy
- Knowing how to make scripts or use Jupyter</p>
</section>
<section id="about-each-section">
<h3>About each section<a class="headerlink" href="#about-each-section" title="Link to this heading"></a></h3>
<p>In general, “Python for Scientific Computing could be a multi-year
course.  We can’t even pretend to really teach even a small fraction
of it.  We can, however, introduce people to things that can very
easily be missed in the typical academic career path.</p>
<ul class="simple">
<li><p><strong>Python intro:</strong> We can’t really replace a Python tutorial, but
here we try to outline some of the main points.  We don’t go over
this in the course.</p></li>
<li><p><strong>Jupyter:</strong> Jupyter is somewhat useful, but the main reason we go
over it is that it provides a convenient user interface for the
other programming lessons (it’s easier to spend a bit of time with
Jupyter than expect people to be able to use some
editor/IDE/shell/etc).  So, we do start from the beginning, so that
people can do the other lessons, but also try to teach some advanced
tips and tricks.</p></li>
<li><p><strong>Numpy:</strong> The basic of much of the rest of scipy, so we need to
cover it.  We try to get the main principles out, but if someone
already knows it this can be a bit boring.  We try to make sure
everyone comes out with an appreciation for vectorization and
broadcasting.</p></li>
<li><p><strong>Pandas:</strong> A lot of similar goals to the Numpy section, especially
the concepts behind Dataframes that one needs to know in order to
read other documentation.</p></li>
<li><p><strong>Visualization:</strong> Matplotlib is getting a bit old, but is still the
backbone of other plotting packages.  We try to get forth the ideas
of the matplotlib API that can be seen in other packages and the
importance of scripted plots.</p></li>
<li><p><strong>Data formats:</strong> Input/output/storage is a common task, and can
easily either be a bottleneck or a huge mess.  This lessons tries to
show some best practices with data formats and, as usual, get the
idea to not “do it yourself”.  Pandas is used as a common framework,
but we should point out there are plenty of other options.</p></li>
<li><p><strong>Scripts:</strong> The most important lesson here is to break out of
Jupyter/run buttons of editors.  If you can’t make actual programs
with an actual interface, you can’t scale up.</p>
<ul>
<li><p>This is the first lesson to introduce the command line.  We
recommend being as simple as possible: at least demonstrate the
JupyterLab terminal and discuss the bigger picture behind what it
means and why.</p></li>
<li><p>This is also the first lesson to use non-Jupyter code editor.  We
recommend again being simple: use the JupyterLab code editor to
start off, and carefully explain what is going on.</p></li>
</ul>
</li>
<li><p><strong>Scipy:</strong> We don’t cover much here (this is super short), but the
point is scipy exists and the concept of wrapping existing C/fortran
libraries and so on.</p></li>
<li><p><strong>Library ecosystem:</strong> This was an overview of the types of packages
available in the “scipy ecosystem”, which is a large and ill-defined
thing.  But there is another point: choosing what to use.  Do you
trust a half-done thing published on someone’s personal webpage?  If
it’s on Github?  How do you make your code more reusable?  When
coming from academic courses, you get a “build it yourself” idea,
which isn’t sustainable in research.</p></li>
<li><p><strong>Parallel programming:</strong></p></li>
<li><p><strong>Dependencies:</strong> The main point here is environments, another thing
you often don’t learn in courses.</p>
<ul>
<li><p>There is a lot of material here.  Consider what you will demo,
what will be done as exercises, and what is advanced/optional.
However, it is the fourth-day lesson that is most interactive, so
it is OK if it take a while to go through everything.</p></li>
<li><p>If someone else installs Anaconda for a user (e.g. admin-managed
laptop), the conda environment creations (with <code class="docutils literal notranslate"><span class="pre">--name</span></code>,
possibly with <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> too?) may not work.  Be prepared for
this and mention it.  You don’t need to solve the problem but
acknowledge that the lesson becomes a demo.  The virtualenv part
should hopefully work for them.</p></li>
</ul>
</li>
<li><p><strong>Binder:</strong> Binder exists and can help make code
reproducible/reusable by others.</p></li>
<li><p><strong>Packaging:</strong> How to make your code reusable by others.  By the
time we get here, people are tired and the topics get involved.  We
more explicitly say “you might want to watch and take this as a
demo”.</p></li>
</ul>
</section>
</section>
<span id="document-data-formats"></span><section id="in-depth-analysis-of-some-selected-file-formats">
<h2>In depth analysis of some selected file formats<a class="headerlink" href="#in-depth-analysis-of-some-selected-file-formats" title="Link to this heading"></a></h2>
<p>Here is a selection of file formats that are commonly used in data science. They are somewhat ordered by their intended use.</p>
<section id="storing-arbitrary-python-objects">
<h3>Storing arbitrary Python objects<a class="headerlink" href="#storing-arbitrary-python-objects" title="Link to this heading"></a></h3>
<section id="pickle">
<span id="id1"></span><h4>Pickle<a class="headerlink" href="#pickle" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Binary format</p></li>
<li><p><strong>Packages needed:</strong> None (<a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a>-module is included with Python).</p></li>
<li><p><strong>Space efficiency:</strong> 🟨</p></li>
<li><p><strong>Arbitrary data:</strong> ✅</p></li>
<li><p><strong>Tidy data:</strong> 🟨</p></li>
<li><p><strong>Array data:</strong> 🟨</p></li>
<li><p><strong>Long term archival/sharing:</strong> ❌! See warning below.</p></li>
<li><p><strong>Best use cases:</strong> Saving Python objects for debugging.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Loading pickles that you have not created is
risky as they can contain arbitrary executable code.</p>
<p>Do not unpickle objects from sources that you do not trust!</p>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Pickle</span></code></a> is Python’s own serialization library.
It allows you to store Python objects into a binary file, but it is not a format you will want to use for long term storage or data sharing.
It is best suited for debugging your code by saving the Python variables for later inspection:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data_array.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data_array.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data_array_pickle</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h3>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<ul>
<li><p>Create an arbitrary python object (for example, a string or a list). Pickle it.</p>
<p>Read the pickled object back in and check if it matches the original one.</p>
</li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="n">my_object</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;string.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">my_object</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;string.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">my_pickled_object</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">my_object</span><span class="p">,</span> <span class="n">my_pickled_object</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_object</span> <span class="o">==</span> <span class="n">my_pickled_object</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="storing-tidy-data">
<h3>Storing tidy data<a class="headerlink" href="#storing-tidy-data" title="Link to this heading"></a></h3>
<section id="csv-comma-separated-values">
<span id="csv"></span><h4>CSV (comma-separated values)<a class="headerlink" href="#csv-comma-separated-values" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type:</strong> Text format</p></li>
<li><p><strong>Packages needed:</strong> numpy, pandas</p></li>
<li><p><strong>Space efficiency:</strong> ❌</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> ✅</p></li>
<li><p><strong>Array data:</strong> 🟨</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Sharing data. Small data. Data that needs to be human-readable.</p></li>
</ul>
</div>
<p>CSV is by far the most popular file format, as it is human-readable and easily shareable.
However, it is not the best format to use when you’re working with big data.</p>
<p>Pandas has a very nice interface for writing and reading CSV files with <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/io.html#io-store-in-csv">to_csv</a>- and <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/io.html#io-read-csv-table">read_csv</a>-functions:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dataset_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;dataset.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Numpy has <a class="reference external" href="https://numpy.org/doc/stable/reference/routines.io.html#text-files">routines</a> for saving and loading arrays as CSV files as well:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;data_array.csv&#39;</span><span class="p">,</span> <span class="n">data_array</span><span class="p">)</span>

<span class="n">data_array_csv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data_array.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Storing data in CSVs can reduce data precision</p>
<blockquote>
<div><p>When working with floating point numbers you should be careful to save the data with enough decimal places so that you won’t lose precision.</p>
<p>For example, double-precision floating point numbers have <a class="reference external" href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">~16 decimal places of precision</a>, but if you use normal Python to write these numbers, you can easily lose some of that precision.
Let’s consider the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">test_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Write the number in a file</span>
<span class="n">test_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sqrt2.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">test_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">test_number</span><span class="p">)</span>
<span class="n">test_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># Read the number from a file</span>
<span class="n">test_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sqrt2.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">test_number2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">test_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
<span class="n">test_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># Calculate the distance between these numbers</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">test_number</span> <span class="o">-</span> <span class="n">test_number2</span><span class="p">))</span>
</pre></div>
</div>
<p>CSV writing routines in Pandas and numpy try to avoid problems such as these by writing the floating point numbers with enough precision, but even they are not infallible.
We can check whether our written data matches the generated data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">dataset_csv</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data_array</span> <span class="o">==</span> <span class="n">data_array_csv</span><span class="p">)</span>
</pre></div>
</div>
<p>In our case some rows of <code class="docutils literal notranslate"><span class="pre">dataset_csv</span></code> loaded from CSV do not match the original <code class="docutils literal notranslate"><span class="pre">dataset</span></code> as the last decimal can sometimes be rounded due to <a class="reference external" href="https://docs.python.org/3/tutorial/floatingpoint.html#representation-error">complex technical reasons</a>.</p>
<p>Storage of these high-precision CSV files is usually very inefficient storage-wise.</p>
<p>Binary files, where floating point numbers are represented in their native binary format, do not suffer from such problems.</p>
</div></blockquote>
</div>
</section>
<section id="feather">
<span id="id2"></span><h4>Feather<a class="headerlink" href="#feather" title="Link to this heading"></a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Requires additional packages</p>
<blockquote>
<div><p>Using Feather requires <a class="reference external" href="https://arrow.apache.org/docs/python">pyarrow-package</a> to be installed.</p>
<p>You can try installing pyarrow with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>pyarrow
</pre></div>
</div>
<p>or you can take this as a demo.</p>
</div></blockquote>
</div>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type:</strong> Binary format</p></li>
<li><p><strong>Packages needed:</strong> pandas, pyarrow</p></li>
<li><p><strong>Space efficiency:</strong> ✅</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> ✅</p></li>
<li><p><strong>Array data:</strong> ❌</p></li>
<li><p><strong>Long term archival/sharing:</strong> ❌</p></li>
<li><p><strong>Best use cases:</strong> Temporary storage of tidy data.</p></li>
</ul>
</div>
<p><a class="reference external" href="https://arrow.apache.org/docs/python/feather.html">Feather</a> is a file format for storing data frames quickly.
There are libraries for Python, R and Julia.</p>
<p>We can work with Feather files with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-feather" title="(in pandas v2.3.3)"><span class="xref std std-ref">to_feather- and read_feather-functions</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s1">&#39;dataset.feather&#39;</span><span class="p">)</span>
<span class="n">dataset_feather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s1">&#39;dataset.feather&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Feather is not a good format for storing array data, so we won’t present an example of that here.</p>
</section>
<section id="parquet">
<span id="id3"></span><h4>Parquet<a class="headerlink" href="#parquet" title="Link to this heading"></a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Requires additional packages</p>
<blockquote>
<div><p>Using Parquet requires <a class="reference external" href="https://arrow.apache.org/docs/python">pyarrow-package</a> to be installed.</p>
<p>You can try installing PyArrow with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>pyarrow
</pre></div>
</div>
<p>or you can take this as a demo.</p>
</div></blockquote>
</div>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type:</strong> Binary format</p></li>
<li><p><strong>Packages needed:</strong> pandas, pyarrow</p></li>
<li><p><strong>Space efficiency:</strong> ✅</p></li>
<li><p><strong>Arbitrary data:</strong> 🟨</p></li>
<li><p><strong>Tidy data:</strong> ✅</p></li>
<li><p><strong>Array data:</strong> 🟨</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Working with big datasets in tidy data format. Archival of said data.</p></li>
</ul>
</div>
<p><a class="reference external" href="https://arrow.apache.org/docs/python/parquet.html">Parquet</a> is a standardized open-source
columnar storage format that is commonly used for storing big data.
Parquet is usable from many different languages (C, Java, Python, MATLAB, Julia, etc.).</p>
<p>We can work with Parquet files with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-parquet" title="(in pandas v2.3.3)"><span class="xref std std-ref">to_parquet- and read_parquet-functions</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;dataset.parquet&#39;</span><span class="p">)</span>
<span class="n">dataset_parquet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;dataset.parquet&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Parquet can be used to store arbitrary data and arrays as well, but doing that is more complicated so we won’t do that here.</p>
</section>
</section>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Link to this heading"></a></h3>
<div class="admonition-exercise exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise</p>
<ul>
<li><p>Create the example <code class="docutils literal notranslate"><span class="pre">dataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;carrot&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;20130101&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">),</span>
        <span class="s1">&#39;integer&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Save the dataset <code class="docutils literal notranslate"><span class="pre">dataset</span></code> as CSV. Load the dataset into a variable <code class="docutils literal notranslate"><span class="pre">dataset_csv</span></code>.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">dataset.compare(dataset_csv)</span></code> to check if loaded dataset matches the original one.</p></li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;carrot&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;20130101&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">),</span>
        <span class="s1">&#39;integer&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
        <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dataset_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;dataset.csv&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">dataset_csv</span><span class="p">))</span>
</pre></div>
</div>
<p>Dataset might not be completely the same. Sometimes the CSV format cannot
fully represent a floating point value, which will result in rounding errors.</p>
</div>
</section>
<section id="storing-array-data">
<h3>Storing array data<a class="headerlink" href="#storing-array-data" title="Link to this heading"></a></h3>
<section id="npy-numpy-array-format">
<span id="npy"></span><h4>npy (numpy array format)<a class="headerlink" href="#npy-numpy-array-format" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Binary format</p></li>
<li><p><strong>Packages needed:</strong> numpy</p></li>
<li><p><strong>Space efficiency:</strong> 🟨</p></li>
<li><p><strong>Arbitrary data:</strong> ✅</p></li>
<li><p><strong>Tidy data:</strong> ❌</p></li>
<li><p><strong>Array data:</strong> ✅</p></li>
<li><p><strong>Long term archival/sharing:</strong> ❌</p></li>
<li><p><strong>Best use cases:</strong> Saving numpy arrays temporarily.</p></li>
</ul>
</div>
<p>If you want to temporarily store numpy arrays, you can use the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html#numpy.save" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.save()</span></code></a>- and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.load.html#numpy.load" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.load()</span></code></a>-functions:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;data_array.npy&#39;</span><span class="p">,</span> <span class="n">data_array</span><span class="p">)</span>
<span class="n">data_array_npy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data_array.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There also exists <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.savez.html#numpy.savez" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.savez()</span></code></a>-function for storing multiple datasets in a single file:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s1">&#39;data_arrays.npz&#39;</span><span class="p">,</span> <span class="n">data_array0</span><span class="o">=</span><span class="n">data_array</span><span class="p">,</span> <span class="n">data_array1</span><span class="o">=</span><span class="n">data_array</span><span class="p">)</span>
<span class="n">data_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data_arrays.npz&#39;</span><span class="p">)</span>
<span class="n">data_arrays</span><span class="p">[</span><span class="s1">&#39;data_array0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>For big arrays it’s good idea to check other binary formats such as HDF5 or NetCDF4.</p>
<p><code class="docutils literal notranslate"><span class="pre">np.save</span></code>- and <code class="docutils literal notranslate"><span class="pre">np.savez</span></code>-functions work with
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/sparse.html">sparse matrices</a>,
but one can also use dedicated
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.save_npz.html">scipy.sparse.save_npz</a>- and
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.load_npz.html">scipy.sparse.load_npz</a>-functions.
Storing sparse matrices using these functions can give huge storage savings.</p>
</section>
<section id="hdf5-hierarchical-data-format-version-5">
<span id="hdf5"></span><h4>HDF5 (Hierarchical Data Format version 5)<a class="headerlink" href="#hdf5-hierarchical-data-format-version-5" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type:</strong> Binary format</p></li>
<li><p><strong>Packages needed:</strong> numpy, pandas, PyTables, h5py</p></li>
<li><p><strong>Space efficiency:</strong> ✅</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> ❌</p></li>
<li><p><strong>Array data:</strong> ✅</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Working with big datasets in array data format.</p></li>
</ul>
</div>
<p>HDF5 is a high performance storage format for storing large amounts of data in multiple datasets in a single file.
It is especially popular in fields where you need to store big multidimensional arrays such as physical sciences.</p>
<p>Pandas allows you to store tables as HDF5 with <a class="reference external" href="https://www.pytables.org/">PyTables</a>, which uses HDF5 to write the files.
You can create a HDF5 file with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-hdf5" title="(in pandas v2.3.3)"><span class="xref std std-ref">to_hdf- and read_parquet-functions</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s1">&#39;dataset.h5&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;dataset&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">dataset_hdf5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;dataset.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For writing data that is not a table, you can use the excellent <a class="reference external" href="https://docs.h5py.org/en/stable/">h5py-package</a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>

<span class="c1"># Writing:</span>

<span class="c1"># Open HDF5 file</span>
<span class="n">h5_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;data_array.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># Write dataset</span>
<span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;data_array&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_array</span><span class="p">)</span>
<span class="c1"># Close file and write data to disk. Important!</span>
<span class="n">h5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Reading:</span>

<span class="c1"># Open HDF5 file again</span>
<span class="n">h5_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;data_array.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="c1"># Read the full dataset</span>
<span class="n">data_array_h5</span> <span class="o">=</span> <span class="n">h5_file</span><span class="p">[</span><span class="s1">&#39;data_array&#39;</span><span class="p">][()]</span>
<span class="c1"># Close file</span>
<span class="n">h5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="netcdf4-network-common-data-form-version-4">
<span id="netcdf4"></span><h4>NetCDF4 (Network Common Data Form version 4)<a class="headerlink" href="#netcdf4-network-common-data-form-version-4" title="Link to this heading"></a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Requires additional packages</p>
<blockquote>
<div><p>Using NetCDF4 requires <a class="reference external" href="https://unidata.github.io/netcdf4-python">netCDF4</a>- or <a class="reference external" href="https://github.com/h5netcdf/h5netcdf">h5netcdf</a>-package to be installed.
h5netcdf is often mentioned as being faster to the official netCDF4-package, so we’ll be using it in the example.</p>
<p>A great NetCDF4 interface is provided by a <a class="reference external" href="https://docs.xarray.dev/en/stable/getting-started-guide/quick-overview.html#read-write-netcdf-files">xarray-package</a>.</p>
<p>You can try installing these packages with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>h5netcdf<span class="w"> </span>xarray
</pre></div>
</div>
<p>or you can take this as a demo.</p>
</div></blockquote>
</div>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Binary format</p></li>
<li><p><strong>Packages needed:</strong> pandas, netCDF4/h5netcdf, xarray</p></li>
<li><p><strong>Space efficiency:</strong> ✅</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> ❌</p></li>
<li><p><strong>Array data:</strong> ✅</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Working with big datasets in array data format. Especially useful if the dataset contains spatial or temporal dimensions. Archiving or sharing those datasets.</p></li>
</ul>
</div>
<p>NetCDF4 is a data format that uses HDF5 as its file format, but it has standardized structure of datasets and metadata related to these datasets.
This makes it possible to be read from various different programs.</p>
<p>NetCDF4 is a common format for storing large data from big simulations in physical sciences.</p>
<p>Using interface provided by <code class="docutils literal notranslate"><span class="pre">xarray</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write tidy data as NetCDF4</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;dataset.nc&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;h5netcdf&#39;</span><span class="p">)</span>
<span class="c1"># Read tidy data from NetCDF4</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="n">dataset_xarray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;dataset.nc&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;h5netcdf&#39;</span><span class="p">)</span>
<span class="n">dataset_netcdf4</span> <span class="o">=</span> <span class="n">dataset_xarray</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">dataset_xarray</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Working with array data is easy as well:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write array data as NetCDF4</span>
<span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;data_array.nc&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;h5netcdf&#39;</span><span class="p">)</span>
<span class="c1"># Read array data from NetCDF4</span>
<span class="n">data_array_xarray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="s1">&#39;data_array.nc&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;h5netcdf&#39;</span><span class="p">)</span>
<span class="n">data_array_netcdf4</span> <span class="o">=</span> <span class="n">data_array_xarray</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">data_array_xarray</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The advantage of NetCDF4 compared to HDF5 is that one can easily add other metadata e.g. spatial dimensions (<code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">z</span></code>) or timestamps (<code class="docutils literal notranslate"><span class="pre">t</span></code>) that tell where the grid-points are situated.
As the format is standardized, many programs can use this metadata for visualization and further analysis.</p>
</section>
</section>
<section id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Link to this heading"></a></h3>
<div class="admonition-exercise exercise important admonition" id="exercise-2">
<p class="admonition-title">Exercise</p>
<ul>
<li><p>Create an example numpy array:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Store the array as a npy.</p></li>
<li><p>Read the dataframe back in and compare it to the original one. Does the data match?</p></li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;data_array.npy&#39;</span><span class="p">,</span> <span class="n">data_array</span><span class="p">)</span>
<span class="n">data_array_npy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data_array.npy&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data_array</span> <span class="o">==</span> <span class="n">data_array_npy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="other-file-formats">
<h3>Other file formats<a class="headerlink" href="#other-file-formats" title="Link to this heading"></a></h3>
<section id="json-javascript-object-notation">
<span id="json"></span><h4>JSON (JavaScript Object Notation)<a class="headerlink" href="#json-javascript-object-notation" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Text format</p></li>
<li><p><strong>Packages needed:</strong> None (<a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.14)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a>-module is included with Python).</p></li>
<li><p><strong>Space efficiency:</strong> ❌</p></li>
<li><p><strong>Arbitrary data:</strong> 🟨</p></li>
<li><p><strong>Tidy data:</strong> ❌</p></li>
<li><p><strong>Array data:</strong> ❌</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Saving nested/relational data, storing web requests.</p></li>
</ul>
</div>
<p>JSON is a popular human-readable data format.
It is especially common when dealing with web applications (REST-APIs etc.).</p>
<p>You rarely want to keep your data in this format, unless you’re working with
nested data with multiple layers or lots of interconnections.</p>
<p>Similarly to other popular files, Pandas can write and read json files with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_json.html#pandas.DataFrame.to_json" title="(in pandas v2.3.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_json()</span></code></a>- and <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_json.html#pandas.read_json" title="(in pandas v2.3.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_json()</span></code></a>-functions:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;dataset.json&#39;</span><span class="p">)</span>
<span class="n">dataset_json</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;dataset.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="excel">
<span id="id4"></span><h4>Excel<a class="headerlink" href="#excel" title="Link to this heading"></a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Requires additional packages</p>
<p>Using Excel files with Pandas requires <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/">openpyxl</a>-package to be installed.</p>
</div>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Text format</p></li>
<li><p><strong>Packages needed:</strong> <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/">openpyxl</a></p></li>
<li><p><strong>Space efficiency:</strong> ❌</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> 🟨</p></li>
<li><p><strong>Array data:</strong> ❌</p></li>
<li><p><strong>Long term archival/sharing:</strong> ✅</p></li>
<li><p><strong>Best use cases:</strong> Sharing data in many fields. Quick data analysis.</p></li>
</ul>
</div>
<p>Excel is very popular in social sciences and economics.
However, it is <a class="reference external" href="https://www.bbc.com/news/technology-54423988">not a good format</a> for data science.</p>
<p>See Pandas’ documentation on <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-excel" title="(in pandas v2.3.3)"><span class="xref std std-ref">working with Excel files</span></a>.</p>
</section>
<section id="graph-formats-adjency-lists-gt-graphml-etc">
<span id="graph"></span><h4>Graph formats (adjency lists, gt, GraphML etc.)<a class="headerlink" href="#graph-formats-adjency-lists-gt-graphml-etc" title="Link to this heading"></a></h4>
<div class="admonition-key-features admonition">
<p class="admonition-title">Key features</p>
<ul class="simple">
<li><p><strong>Type</strong>: Many different formats</p></li>
<li><p><strong>Packages needed:</strong> Depends on a format.</p></li>
<li><p><strong>Space efficiency:</strong> 🟨</p></li>
<li><p><strong>Arbitrary data:</strong> ❌</p></li>
<li><p><strong>Tidy data:</strong> ❌</p></li>
<li><p><strong>Array data:</strong> ❌</p></li>
<li><p><strong>Long term archival/sharing:</strong> 🟨</p></li>
<li><p><strong>Best use cases:</strong> Saving graphs or data that can be represented as a graph.</p></li>
</ul>
</div>
<p>There are plenty of data formats for storing graphs.
We won’t list them here as optimal data format depends heavily on the graph structure.</p>
<p>One can use functions in libraries such as
<a class="reference external" href="https://networkx.org/documentation/stable/reference/readwrite/index.html">networkx</a>,
<a class="reference external" href="https://graph-tool.skewed.de/static/doc/quickstart.html#graph-i-o">graph-tool</a>,
<a class="reference external" href="https://igraph.readthedocs.io/en/stable/tutorial.html#igraph-and-the-outside-world">igraph</a>
to read and write graphs.</p>
</section>
</section>
</section>
</div>
<section id="who-is-the-course-for">
<span id="learner-personas"></span><h2>Who is the course for?<a class="headerlink" href="#who-is-the-course-for" title="Link to this heading"></a></h2>
<p>The course is targeted towards these learner personas:</p>
<ul class="simple">
<li><p>A is a early career PhD researcher who has been using Python a bit,
but is not sure what they know or don’t know.  They want to be able
to do their research more efficiently and make sure that they are
using the right tools.  A may know that numpy exists, etc. and could
theoretically read some about it themselves, but aren’t sure if they
are going in the right direction.</p></li>
<li><p>A2 can use numpy and pandas, but have learned little bits here and
there and hasn’t had a comprehensive introduction.  They want to
ensure they are using best practices.  (Baseline of high-level
packages)</p></li>
<li><p>B is a mid-to-late undergraduate student who has used Python in some
classes.  They have possibly learned the syntax and enough to use it
in courses, but in a course-like manner where they are expected to
create everything themselves: they want to know how to reuse tools
that already exist.</p></li>
</ul>
</section>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h2>
<section id="why-python">
<h3>Why Python<a class="headerlink" href="#why-python" title="Link to this heading"></a></h3>
<p>Python has become popular, largely due to good reasons. It’s very easy
to get started, there’s lots of educational material, a huge amount of
libraries for doing everything imaginable.  Particularly in the
scientific computing space, there is the Numpy, Scipy, and matplotlib
libraries which form the basis of almost everything.  Numpy and Scipy
are excellent examples of using Python as a glue language, meaning to
glue together battle-tested and well performing code and present them
with an easy to use interface.  Also machine learning and deep
learning frameworks have embraced python as the glue language of
choice.  And finally, Python is open source, meaning that anybody can
download and install it on their computer, without having to bother
with acquiring a license or such.  This makes it easier to distribute
your code e.g. to collaborators in different universities.</p>
</section>
<section id="why-not-python-for-scientific-computing">
<h3>Why not Python for Scientific Computing<a class="headerlink" href="#why-not-python-for-scientific-computing" title="Link to this heading"></a></h3>
<p>While Python is extremely popular in scientific computing today, there
are certainly things better left to other tools.</p>
<ul class="simple">
<li><p>Implementing performance-critical kernels.  Python is a <strong>very</strong>
slow language, which often doesn’t matter if you can offload the
heavy lifting to fast compiled code, e.g. by using Numpy array
operations.  But if what you’re trying to do isn’t <em>vectorizable</em>
then you’re out of luck.  An alternative to Python, albeit much less
mature and with a smaller ecosystem, but which provides very fast
generated code, is <em>Julia</em>.</p></li>
<li><p>Creating libraries that can be called from other languages.  In this
case you’ll often want to create a library with a C interface, which
can then be called from most languages.  Suitable languages for this
sort of task, depending on what you are doing, could be Rust, C,
C++, or Fortran.</p></li>
<li><p>You really like static typing, or functional programming
approaches. <em>Haskell</em> might be what you’re looking for.</p></li>
</ul>
</section>
<section id="python-2-vs-python-3">
<h3>Python 2 vs Python 3<a class="headerlink" href="#python-2-vs-python-3" title="Link to this heading"></a></h3>
<p>Python 3.0 came out in September 2008 and was just slightly different
enough that most code had to be changed, which meant that many
projects ignored it for many years.  It was about 3-5 years until the
differences were reduced enough (and better transition plans came out,
so that it was reasonable to use a single code for both versions) that
it become more and more adopted in the scientific community.  Python 2
finally became unsupported in 2020, and by now Python 3 is the defacto
standard.</p>
<p>At this point, all new projects should use Python 3, and existing
actively developed projects should be upgraded to use it.  Still, you
might find some old unmaintained tools that are only compatible with
Python 2.</p>
</section>
</section>
<section id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Link to this heading"></a></h2>
<p>This course was originally designed by Janne Blomqvist.</p>
<p>In 2020 it was completely redesigned by a team of the following:</p>
<ul class="simple">
<li><p>Authors: Radovan Bast, Richard Darst, Anne Fouilloux, Thor Wikfeldt, …</p></li>
<li><p>Editor:</p></li>
<li><p>Testers and advisors: Enrico Glerean</p></li>
</ul>
<p>We follow The Carpentries Code of Conduct: <a class="reference external" href="https://docs.carpentries.org/topic_folders/policies/code-of-conduct.html">https://docs.carpentries.org/topic_folders/policies/code-of-conduct.html</a></p>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://enccs.github.io/hpda-python/">High Performance Data Analytics in Python</a> is a logical follow-up to
this lesson that goes more in-depth to tools of high-performance
and large-scale Python.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>