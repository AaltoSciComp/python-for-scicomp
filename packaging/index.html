

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Packaging" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://aaltoscicomp.github.io/python-for-scicomp/packaging/" />
<meta property="og:site_name" content="Python for Scientific Computing" />
<meta property="og:description" content="Organizing Python projects: Python projects often start as a single script or Jupyter notebook but they can grow out of a single file. In the Scripts episode we have also learned how to import func..." />
<meta name="description" content="Organizing Python projects: Python projects often start as a single script or Jupyter notebook but they can grow out of a single file. In the Scripts episode we have also learned how to import func..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Packaging &mdash; Python for Scientific Computing  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../_static/logo-hexagons-02-compact.svg.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=187304be"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=35a8b989"></script>
      <script src="../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = "div.highlight"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script src="../_static/tabs.js?v=3030b3cb"></script>
      <script data-domain="aaltoscicomp.github.io/python-for-scicomp" defer="defer" src="https://plausible.cs.aalto.fi/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Web APIs with Python" href="../web-apis/" />
    <link rel="prev" title="Parallel programming" href="../parallel/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Python for Scientific Computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python/">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy-advanced/">Advanced NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xarray/">Xarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-matplotlib/">Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotting-vega-altair/">Plotting with Vega-Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../work-with-data/">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling/">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../productivity/">Productivity tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/">Library ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependency management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binder/">Binder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel programming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Packaging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#organizing-python-projects">Organizing Python projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-a-local-pip-install">Testing a local pip install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-1">Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sharing-packages-via-pypi">Sharing packages via PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tools-that-simplify-sharing-via-pypi">Tools that simplify sharing via PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-conda-package-and-share-it">Building a conda package and share it</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-a-python-package-with-grayskull-and-conda-build">Building a python package with grayskull and conda-build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publishing-a-python-package">Publishing a python package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../web-apis/">Web APIs with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-formats/">In depth analysis of some selected file formats</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python for Scientific Computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Packaging</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/AaltoSciComp/python-for-scicomp/blob/master/content/packaging.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="packaging">
<h1>Packaging<a class="headerlink" href="#packaging" title="Link to this heading"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How to organize Python projects larger than one script?</p></li>
<li><p>What is a good file and folder structure for Python projects?</p></li>
<li><p>How can you make your Python functions most usable by your collaborators?</p></li>
<li><p>How to prepare your code to make a Python package?</p></li>
<li><p>How to publish your Python package?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn to identify the components of a Python package</p></li>
<li><p>Learn to create a Python package</p></li>
<li><p>Learn to publish a Python package</p></li>
</ul>
</div>
<section id="organizing-python-projects">
<h2>Organizing Python projects<a class="headerlink" href="#organizing-python-projects" title="Link to this heading"></a></h2>
<p>Python projects often start as a single script or Jupyter notebook but
they can grow out of a single file.</p>
<p>In the <a class="reference internal" href="../scripts/#scripts"><span class="std std-ref">Scripts</span></a> episode we have also learned how to import functions
and objects from other Python files (modules). Now we will take it a step further.</p>
<p><strong>Recommendations</strong>:</p>
<ul class="simple">
<li><p>Collect related functions into modules (files).</p></li>
<li><p>Collect related modules into packages (we will show how).</p></li>
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">LICENSE</span></code> file to your code from <a class="reference external" href="https://choosealicense.com">choosealicense.com</a>
(see <a class="reference external" href="https://github.com/coderefinery/social-coding/blob/main/licensing-and-cakes.md">Software Licensing and Open source explained with cakes</a>).</p></li>
<li><p>Write a <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file describing what the code does and how to use it.</p></li>
<li><p>It is also recommended to <a class="reference external" href="https://coderefinery.github.io/documentation/">document your package</a>.</p></li>
<li><p>When the project grows, you might need <a class="reference external" href="https://coderefinery.github.io/testing/">automated testing</a>.</p></li>
</ul>
<p>To have a concrete but still simple example, we will create a project
consisting of 3 functions, each in its own file. We can then imagine that each
file would contain many more functions. To make it more interesting,
one of these functions will depend on an external library: <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p>
<p>These are the 3 files:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">adding.py</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">subtracting.py</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">integrating.py</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>


<span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">lower_limit</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will add a fourth file:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">__init__.py</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example calculator package.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">.adding</span> <span class="kn">import</span> <span class="n">add</span>
<span class="kn">from</span> <span class="nn">.subtracting</span> <span class="kn">import</span> <span class="n">subtract</span>
<span class="kn">from</span> <span class="nn">.integrating</span> <span class="kn">import</span> <span class="n">integral</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
</pre></div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file will be the interface of our package/library.
It also holds the package docstring and the version string.
Note how it imports functions from the various modules using <em>relative imports</em>
(with the dot).</p>
<p>This is how we will arrange the files in the project folder/repository:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>project-folder
├── calculator
<span class="hll">│   ├── adding.py
</span><span class="hll">│   ├── __init__.py
</span><span class="hll">│   ├── integrating.py
</span><span class="hll">│   └── subtracting.py
</span>├── LICENSE
└── README.md
</pre></div>
</div>
<p>Now we are ready to test the package. For this we need to be in the “root”
folder, what we have called the <em>project-folder</em>.  We also need to have
<code class="docutils literal notranslate"><span class="pre">scipy</span></code> available in our environment:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">calculator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">integral</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 + 3 =&quot;</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">integral_x_squared</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integral_x_squared</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package is not yet pip-installable, though. We will make this possible in
the next section.</p>
</section>
<section id="testing-a-local-pip-install">
<h2>Testing a local pip install<a class="headerlink" href="#testing-a-local-pip-install" title="Link to this heading"></a></h2>
<p>To make our example package pip-installable we need to add one more file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>project-folder
├── calculator
│   ├── adding.py
│   ├── __init__.py
│   ├── integrating.py
│   └── subtracting.py
├── LICENSE
├── README.md
<span class="hll">└── pyproject.toml
</span></pre></div>
</div>
<p>This is how <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> looks:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">pyproject.toml</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">build</span><span class="o">-</span><span class="n">system</span><span class="p">]</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;setuptools&gt;=61.0&quot;</span><span class="p">]</span>
<span class="n">build</span><span class="o">-</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;setuptools.build_meta&quot;</span>

<span class="p">[</span><span class="n">project</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;calculator-myname&quot;</span>
<span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;A small example package&quot;</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
<span class="n">readme</span> <span class="o">=</span> <span class="s2">&quot;README.md&quot;</span>
<span class="n">authors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Firstname Lastname&quot;</span><span class="p">,</span> <span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;firstname.lastname@example.org&quot;</span> <span class="p">}</span>
<span class="p">]</span>
<span class="hll"><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">    <span class="s2">&quot;scipy&quot;</span>
</span><span class="hll"><span class="p">]</span>
</span></pre></div>
</div>
</div>
<p>Note how our package requires <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and we decided to not pin the version
here (see <a class="reference internal" href="../dependencies/#version-pinning"><span class="std std-ref">Version pinning for package creators</span></a>).</p>
<p>Now we have all the building blocks to test a local pip install. This is a good
test before trying to upload a package to PyPI or test-PyPI
(see <a class="reference internal" href="../dependencies/#pypi"><span class="std std-ref">PyPI (The Python Package Index) and conda ecosystem</span></a>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometime you need to rely on unreleased, development versions as
dependencies and this is also possible. For example, to use the
latest <code class="docutils literal notranslate"><span class="pre">xarray</span></code> you could add:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s2">&quot;scipy&quot;</span><span class="p">,</span>
     <span class="s2">&quot;xarray @ https://github.com/pydata/xarray/archive/main.zip&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pip.pypa.io/en/stable/reference/requirement-specifiers/">pip requirement specifiers</a></p></li>
<li><p>pyOpenSci tutorial on
<a class="reference external" href="https://www.pyopensci.org/python-package-guide/tutorials/pyproject-toml.html">pyproject.toml metadata</a></p></li>
</ul>
</div>
</div>
</section>
<section id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading"></a></h2>
<div class="admonition-packaging-1 exercise important admonition" id="exercise-0">
<p class="admonition-title">Packaging-1</p>
<p>To test a local pip install:</p>
<ul>
<li><p>Create a new folder outside of our example project</p></li>
<li><p>Create a new virtual environment (<a class="reference internal" href="../dependencies/#dependency-management"><span class="std std-ref">Dependency management</span></a>)</p></li>
<li><p>Install the example package from the project folder
into the new environment:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">editable</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">project</span><span class="o">-</span><span class="n">folder</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>Test the local installation:</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">calculator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">integral</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 + 3 =&quot;</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">integral_x_squared</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integral_x_squared</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Make a change in the <code class="docutils literal notranslate"><span class="pre">subtract</span></code> function above such that it always
returns a float <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">float(x</span> <span class="pre">-</span> <span class="pre">y)</span></code>.</p></li>
<li><p>Open a new Python console and test the following lines. Compare it with
the previous output.</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">calculator</span> <span class="kn">import</span> <span class="n">subtract</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2 - 3 =&quot;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="sharing-packages-via-pypi">
<h2>Sharing packages via PyPI<a class="headerlink" href="#sharing-packages-via-pypi" title="Link to this heading"></a></h2>
<div class="admonition-demo demo admonition" id="demo-0">
<p class="admonition-title">Demo</p>
<p>Most people will watch and observe this, due to the speed with which we will
move.</p>
</div>
<p>Once we are able to pip-install the example package locally, we are ready for
upload.</p>
<p>We exercise by uploading to <a class="reference external" href="https://test.pypi.org/">test-PyPI</a>, not the
real <a class="reference external" href="https://pypi.org/">PyPI</a>, so that if we mess things up, nothing bad
happens.</p>
<p>We need two more things:</p>
<ul class="simple">
<li><p>We will do this using <a class="reference external" href="https://twine.readthedocs.io/">Twine</a> so you need
to pip install that, too.</p></li>
<li><p>You need an account on <a class="reference external" href="https://test.pypi.org/">test-PyPI</a></p></li>
</ul>
<p>Let’s try it out. First we create the distribution package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>-m<span class="w"> </span>build
</pre></div>
</div>
<p>We need twine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>twine
</pre></div>
</div>
<p>And use twine to upload the distribution files to test-PyPI:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twine<span class="w"> </span>upload<span class="w"> </span>-r<span class="w"> </span>testpypi<span class="w"> </span>dist/*

<span class="go">Uploading distributions to https://test.pypi.org/legacy/</span>
<span class="go">Enter your API token:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To generate an API token,  proceed to the <a class="reference external" href="https://test.pypi.org/manage/account/token/">Create API token</a> page in test-PyPI.
You will be prompted for your password.</p>
<div class="admonition-the-long-version-for-finding-the-create-api-token-page solution important dropdown admonition" id="solution-0">
<p class="admonition-title">The long-version for finding the <em>Create API token</em> page</p>
<ol class="arabic simple">
<li><p>Log on to <a class="reference external" href="https://test.pypi.org/">test-PyPI</a> at <a class="reference external" href="https://test.pypi.org">https://test.pypi.org</a></p></li>
<li><p>In the top-right corner, click on the drop-down menu and click <strong>Account settings</strong> or
follow this <a class="reference external" href="https://test.pypi.org/manage/account/#api-tokens">link</a>.</p></li>
<li><p>Scroll down to the section <strong>API tokens</strong> and click the button <strong>Add API token</strong>,
which opens up the
<a class="reference external" href="https://test.pypi.org/manage/account/token/">Create API token</a> page.</p></li>
</ol>
</div>
<ol class="arabic simple">
<li><p>Under <strong>Token name</strong> write something memorable.
It should remind you the <em>purpose</em>
or the <em>name of the computer</em>, such that when you are done
using it, you can safely delete it.</p></li>
<li><p>Under <strong>Scope</strong> select <code class="docutils literal notranslate"><span class="pre">Entire</span> <span class="pre">account</span> <span class="pre">(all</span> <span class="pre">projects)</span></code>.</p></li>
<li><p>Click on <strong>Create token</strong>.</p></li>
<li><p>Click on <strong>Copy token</strong> once a long string which starts
with <code class="docutils literal notranslate"><span class="pre">pypi-</span></code> is generated.</p></li>
</ol>
<p>Paste that token back into the terminal where <code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">upload</span> <span class="pre">...</span></code> is running and press ENTER.</p>
</div>
<p>Once this is done, create yet another virtual environment and try to install from test-PyPI (adapt <code class="docutils literal notranslate"><span class="pre">myname</span></code>).</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Linux / macOS</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv-calculator
<span class="gp"> $ </span><span class="nb">source</span><span class="w"> </span>venv-calculator/bin/activate
<span class="gp"> $ </span>which<span class="w"> </span>python
<span class="hll"><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>-i<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>--extra-index-url<span class="w"> </span>https://pypi.org/simple/<span class="w"> </span><span class="se">\</span>
</span><span class="hll"><span class="w">     </span>calculator-myname
</span><span class="gp"> $ </span>deactivate
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv-calculator
<span class="gp"> $ </span>venv-calculator<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
<span class="gp"> $ </span>where<span class="w"> </span>python
<span class="hll"><span class="gp"> $ </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-i<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span>--extra-index-url<span class="w"> </span>https://pypi.org/simple/<span class="w"> </span>calculator-myname
</span><span class="gp"> $ </span>deactivate
</pre></div>
</div>
</div></div>
</section>
<section id="tools-that-simplify-sharing-via-pypi">
<h2>Tools that simplify sharing via PyPI<a class="headerlink" href="#tools-that-simplify-sharing-via-pypi" title="Link to this heading"></a></h2>
<p>The solution that we have used to create the example package (using
<code class="docutils literal notranslate"><span class="pre">setuptools</span></code> and <code class="docutils literal notranslate"><span class="pre">twine</span></code>) is not the only approach. There are many ways to
achieve this and we avoided going into too many details and comparisons to not
confuse too much. If you web-search this, you will also see that recently the
trend goes towards using <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> as more general
alternative to the previous <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>There are at least two tools which try to make the packaging and PyPI interaction easier:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://python-poetry.org/">Poetry</a></p></li>
<li><p><a class="reference external" href="https://flit.pypa.io/">Flit</a></p></li>
</ul>
<p>If you upload packages to PyPI or test PyPI often you can create an API token and
<a class="reference external" href="https://packaging.python.org/en/latest/specifications/pypirc/#common-configurations">save it in the .pypirc file</a>.</p>
</section>
<section id="building-a-conda-package-and-share-it">
<h2>Building a conda package and share it<a class="headerlink" href="#building-a-conda-package-and-share-it" title="Link to this heading"></a></h2>
<div class="admonition-prerequisites callout admonition" id="callout-0">
<p class="admonition-title">Prerequisites</p>
<p>To generate a conda build recipe, the package <code class="docutils literal notranslate"><span class="pre">grayskull</span></code> and
to build it, the package <code class="docutils literal notranslate"><span class="pre">conda-build</span></code> are required.
You may install these with <strong>Anaconda Navigator</strong> or from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>install<span class="w"> </span>-n<span class="w"> </span>base<span class="w"> </span>grayskull<span class="w"> </span>conda-build
</pre></div>
</div>
</div>
<p>The simplest way for creating a conda package for your python script is to
first publish it in <a class="reference external" href="https://pypi.org/">PyPI</a> following the steps explained
above.</p>
<section id="building-a-python-package-with-grayskull-and-conda-build">
<h3>Building a python package with grayskull and conda-build<a class="headerlink" href="#building-a-python-package-with-grayskull-and-conda-build" title="Link to this heading"></a></h3>
<p>Once build, the conda package can be installed locally. For this example, we
will use <a class="reference external" href="https://pypi.org/project/runtest/">runtest</a>.  <a class="reference external" href="https://github.com/bast/runtest">runtest</a> is a numerically tolerant end-to-end test
library for research software.</p>
<ol class="arabic">
<li><p>Generate the <em>recipe</em> by executing (<code class="docutils literal notranslate"><span class="pre">grayskull</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">grayskull</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>grayskull<span class="w"> </span>pypi<span class="w"> </span>runtest
</pre></div>
</div>
<p>The command above will create a new folder called <cite>runtest</cite> containing a file <cite>meta.yaml</cite>,
the conda recipe for building the <cite>runtest</cite> package.</p>
</li>
<li><p>View the contents of <cite>meta.yaml</cite> and ensure requirements :</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flit-core &gt;=2,&lt;4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
</pre></div>
</div>
<p>In the requirements above, we specified what is required for the <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#host">host</a> and for <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#run">running</a>  the package.</p>
<div class="admonition-remark callout admonition" id="callout-1">
<p class="admonition-title">Remark</p>
<p>For pure python recipes, this is all you need for building a python package with conda.
If your package needs to be built (for instance compilation), you would need additional files e.g. <cite>build.sh</cite> (to build on Linux/Mac-OSX) and <cite>bld.bat</cite> (to build on Windows systems). You can also add test scripts for testing your package. See <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html#writing-the-build-script-files-build-sh-and-bld-bat">documentation</a></p>
</div>
</li>
<li><p>Build your package with conda</p>
<p>Your package is now ready to be build with conda:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>build<span class="w"> </span>runtest
</pre></div>
</div>
<div class="admonition-conda-package-location callout admonition" id="callout-2">
<p class="admonition-title">Conda package location</p>
<p>Look at the messages produced while building. The location of the local conda package is given (search for <cite>anaconda upload</cite>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/username/miniforge3/conda-bld/noarch/runtest-2.3.4-py_0.tar.bz2
</pre></div>
</div>
<p>The prefix <code class="docutils literal notranslate"><span class="pre">/home/username/miniforge3/</span></code> may be different on your machine.
depending on your operating system (Linux, Mac-OSX or Windows). The sub-folder is named <code class="docutils literal notranslate"><span class="pre">noarch</span></code> since
it is a pure-python package and the recipe indicates the same.</p>
<p>If package contained compiled code then the sub-folder would have been named <code class="docutils literal notranslate"><span class="pre">win-64</span></code> or <code class="docutils literal notranslate"><span class="pre">linux-64</span></code>.
It could then be converted to other platforms using
<a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html#converting-a-package-for-use-on-all-platforms">conda convert</a>.</p>
</div>
</li>
<li><p>Check within new environment</p>
<p>It is not necessary to create a new conda environment to install it but as explained in previous episode, it is good practice to have isolated environments.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>local-runtest<span class="w"> </span>--use-local<span class="w"> </span>runtest
</pre></div>
</div>
<p>We can then check <cite>runtest</cite> has been successfully installed in <cite>local-runtest</cite> conda environment. Open a new Terminal with <cite>local-runtest</cite> environment (either from the command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda<span class="w"> </span>activate<span class="w"> </span>local-runtest
</pre></div>
</div>
<p>or via <strong>Anaconda Navigator</strong> (Open Terminal), import runtest and
check its version:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">runtest</span>
<span class="nb">print</span><span class="p">(</span><span class="n">runtest</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition-building-a-conda-package-from-scratch callout admonition" id="callout-3">
<p class="admonition-title">Building a conda package from scratch</p>
<p>It is possible to build a conda package from scratch without using conda grayskull.
We recommend you to check the
<a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html">conda-build documentation</a>
for more information.</p>
</div>
<p>To be able to share and install your local conda package anywhere (on other platforms), you would need to upload it to a <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">conda channel</a> (see below).</p>
</section>
<section id="publishing-a-python-package">
<h3>Publishing a python package<a class="headerlink" href="#publishing-a-python-package" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Upload your package to <a class="reference external" href="https://conda-forge.org/">conda-forge</a>:
conda-forge is a conda channel: it contains community-led collection of
recipes, build infrastructure and distributions for the conda package
manager. Anyone can
<a class="reference external" href="https://conda-forge.org/docs/maintainer/adding_pkgs/">publish conda packages to conda-forge</a>
if certain
<a class="reference external" href="https://conda-forge.org/docs/maintainer/guidelines/">guidelines</a> are respected.</p></li>
<li><p>Upload your package to <a class="reference external" href="https://bioconda.github.io/">bioconda</a>: bioconda is
a very popular channel for the conda package manager specializing in
bioinformatics software. As for conda-forge, you need to follow their
<a class="reference external" href="https://bioconda.github.io/contributor/guidelines.html">guidelines</a> when
building conda recipes.</p></li>
</ul>
<p>You can also <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/create-custom-channels.html">create your own conda channel</a>
for publishing your packages.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>It is worth it to organize your code for publishing, even if only
you are using it.</p></li>
<li><p>PyPI is a place for Python packages</p></li>
<li><p>conda is similar but is not limited to Python</p></li>
</ul>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../parallel/" class="btn btn-neutral float-left" title="Parallel programming" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../web-apis/" class="btn btn-neutral float-right" title="Web APIs with Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>